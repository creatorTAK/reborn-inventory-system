<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Cache Bust: 2025-11-13 13:45 - REBORN Theme v3.0 -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Furira ãƒ¡ãƒ‹ãƒ¥ãƒ¼</title>
  <link rel="stylesheet" href="https://www.reborn-inventory.com/css/reborn-brand-colors.css?v=9635">
  <link rel="stylesheet" href="https://www.reborn-inventory.com/css/reborn-theme.css?v=9635">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, var(--reborn-primary) 0%, var(--reborn-primary-dark) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .menu-container {
      width: 100%;
      max-width: 500px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 30px 20px;
      margin: auto;
    }

    .menu-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .menu-logo {
      width: 280px;
      height: auto;
      margin: -35px auto -45px;
      display: block;
    }

    .menu-subtitle {
      font-size: 14px;
      color: #6b7280;
    }

    .menu-items {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .menu-item {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 18px 20px;
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: space-between;
      text-decoration: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .menu-item:active {
      transform: scale(0.98);
      background: #f9fafb;
    }

    .menu-item:hover {
      border-color: var(--reborn-primary);
      background: var(--reborn-primary-lightest);
    }

    .menu-item.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f9fafb;
    }

    .menu-item.disabled:active {
      transform: none;
    }

    .menu-item-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-item-icon {
      font-size: 24px;
    }

    .menu-item-arrow {
      font-size: 14px;
      color: #9ca3af;
      transition: transform 0.2s;
    }

    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .accordion-menu {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .accordion-header {
      padding: 18px 20px;
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s;
    }

    .accordion-header:active {
      background: #f9fafb;
    }

    .accordion-header:hover {
      background: #f9f5ff;
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      background: #f9fafb;
    }

    .accordion-content.open {
      max-height: 1000px;
    }

    .accordion-item {
      padding: 14px 20px 14px 56px;
      font-size: 15px;
      color: #4b5563;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      transition: background 0.2s;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      border-top: 1px solid #e5e7eb;
    }

    .accordion-item:active {
      background: #f3f4f6;
    }

    .accordion-item:hover {
      background: #f3f4f6;
    }

    .accordion-item.coming-soon {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .accordion-item.coming-soon:active {
      background: transparent;
    }

    .accordion-arrow {
      transition: transform 0.3s;
      font-size: 14px;
      color: #9ca3af;
    }

    .accordion-arrow.open {
      transform: rotate(180deg);
    }

    .coming-soon-badge {
      font-size: 11px;
      background: #fbbf24;
      color: #78350f;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      margin-left: auto;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 480px) {
      .menu-container {
        padding: 24px 16px;
      }

      .menu-title {
        font-size: 24px;
      }

      .menu-item {
        padding: 16px 18px;
        font-size: 15px;
      }

      .menu-item-icon {
        font-size: 22px;
      }
    }
  </style>
</head>
<body>
  <div class="menu-container">
    <div class="menu-header">
      <img src="https://reborn-inventory-system.pages.dev/images/furira-square-logo.png" alt="Furira" class="menu-logo">
      <div class="menu-subtitle">ãƒ•ãƒªãƒåœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
    </div>

    <div class="menu-items">
      <!-- å•†å“ç™»éŒ² -->
      <a href="#" onclick="navigateToPage('product'); return false;" class="menu-item">
        <div class="menu-item-content">
          <span class="menu-item-icon">ğŸ“</span>
          <span>å•†å“ç™»éŒ²</span>
        </div>
        <span class="menu-item-arrow">â€º</span>
      </a>

      <!-- åœ¨åº«ç®¡ç† -->
      <a href="#" onclick="navigateToPage('inventory'); return false;" class="menu-item">
        <div class="menu-item-content">
          <span class="menu-item-icon">ğŸ“¦</span>
          <span>åœ¨åº«ç®¡ç†</span>
        </div>
        <span class="menu-item-arrow">â€º</span>
      </a>

      <!-- å…¥å‡ºåº«å±¥æ­´ -->
      <a href="#" onclick="navigateToPage('inventory_history'); return false;" class="menu-item">
        <div class="menu-item-content">
          <span class="menu-item-icon">ğŸ“Š</span>
          <span>å…¥å‡ºåº«å±¥æ­´</span>
        </div>
        <span class="menu-item-arrow">â€º</span>
      </a>

      <!-- å£²ä¸Šç®¡ç† -->
      <a href="#" class="menu-item disabled">
        <div class="menu-item-content">
          <span class="menu-item-icon">ğŸ“ˆ</span>
          <span>å£²ä¸Šç®¡ç†</span>
        </div>
        <span class="menu-item-arrow">â€º</span>
      </a>

      <!-- ãƒã‚¹ã‚¿ç®¡ç†ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
      <div class="accordion-menu">
        <div class="accordion-header" onclick="toggleAccordion('master')">
          <div class="menu-item-content">
            <span class="menu-item-icon">ğŸ—‚ï¸</span>
            <span>ãƒã‚¹ã‚¿ç®¡ç†</span>
          </div>
          <span class="accordion-arrow" id="master-arrow">â–¼</span>
        </div>
        <div class="accordion-content" id="master-content">
          <a href="#" onclick="openPWAPage('/master-management.html?category=product'); return false;" class="accordion-item">
            <span>ğŸ“¦ å•†å“é–¢é€£ãƒã‚¹ã‚¿ç®¡ç†</span>
          </a>
          <a href="#" onclick="openPWAPage('/master-management.html?category=business'); return false;" class="accordion-item">
            <span>ğŸ¢ æ¥­å‹™é–¢é€£ãƒã‚¹ã‚¿ç®¡ç†</span>
          </a>
          <a href="#" onclick="openGASPage('shipping-master'); return false;" class="accordion-item">
            <span>ğŸšš ç™ºé€æ–¹æ³•ãƒã‚¹ã‚¿ç®¡ç†</span>
          </a>
          <a href="#" onclick="openGASPage('packaging-master'); return false;" class="accordion-item">
            <span>ğŸ“¦ æ¢±åŒ…è³‡æãƒã‚¹ã‚¿ç®¡ç†</span>
          </a>
        </div>
      </div>

      <!-- è¨­å®šç®¡ç†ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
      <div class="accordion-menu">
        <div class="accordion-header" onclick="toggleAccordion('config')">
          <div class="menu-item-content">
            <span class="menu-item-icon">âš™ï¸</span>
            <span>è¨­å®šç®¡ç†</span>
          </div>
          <span class="accordion-arrow" id="config-arrow">â–¼</span>
        </div>
        <div class="accordion-content" id="config-content">
          <a href="#" onclick="navigateToPage('config-basic'); return false;" class="accordion-item">
            <span>ğŸ‘¤ åŸºæœ¬è¨­å®š</span>
          </a>
          <a href="#" onclick="navigateToPage('config-management'); return false;" class="accordion-item">
            <span>ğŸ”¢ ç®¡ç†ç•ªå·è¨­å®š</span>
          </a>
          <a href="#" onclick="navigateToPage('config-product'); return false;" class="accordion-item">
            <span>ğŸ“ å•†å“ç™»éŒ²è¨­å®š</span>
          </a>
          <a href="#" onclick="navigateToPage('config-shipping'); return false;" class="accordion-item">
            <span>ğŸ“¦ é…é€è¨­å®š</span>
          </a>
          <a href="#" onclick="navigateToPage('config-procure'); return false;" class="accordion-item">
            <span>ğŸ’¼ ä»•å…¥ãƒ»å‡ºå“è¨­å®š</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK (compatç‰ˆ: UMDå½¢å¼) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    console.log('[menu_home] ========== ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é–‹å§‹ ==========');

    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyCe-mj6xoV1HbHkIOVqeHCjwwtCorUZQ",
      authDomain: "reborn-chat.firebaseapp.com",
      projectId: "reborn-chat",
      storageBucket: "reborn-chat.firebasestorage.app",
      messagingSenderId: "345706548795",
      appId: "1:345706548795:web:058a553da6b4b74db5161e"
    };

    let db = null;
    let firestoreReady = false;

    // FirebaseåˆæœŸåŒ–
    try {
      console.log('[menu_home] FirebaseåˆæœŸåŒ–é–‹å§‹');
      console.log('[menu_home] firebase:', typeof firebase);

      if (typeof firebase === 'undefined') {
        throw new Error('Firebase SDK ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
      }

      // FirebaseåˆæœŸåŒ–
      const app = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      firestoreReady = true;

      console.log('[menu_home] âœ… FirebaseåˆæœŸåŒ–å®Œäº†');
      console.log('[menu_home] db:', db);

    } catch (error) {
      console.error('[menu_home] âŒ FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      console.error('[menu_home] error.message:', error.message);
      console.error('[menu_home] error.stack:', error.stack);
    }

    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‹é–‰
    window.toggleAccordion = function(type) {
      console.log('[menu_home] toggleAccordion:', type);
      const content = document.getElementById(type + '-content');
      const arrow = document.getElementById(type + '-arrow');

      if (!content || !arrow) {
        console.error('[menu_home] âŒ ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', type);
        return;
      }

      console.log('[menu_home] content.classList:', content.classList);
      console.log('[menu_home] arrow.classList:', arrow.classList);

      if (content.classList.contains('open')) {
        content.classList.remove('open');
        arrow.classList.remove('open');
        console.log('[menu_home] âœ… ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‰ã˜ã¾ã—ãŸ');
      } else {
        content.classList.add('open');
        arrow.classList.add('open');
        console.log('[menu_home] âœ… ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ãã¾ã—ãŸ');
      }
    };

    // PWAç‰ˆãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆæœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageé€ä¿¡ï¼‰
    window.openPWAPage = function(path) {
      console.log('[menu_home] ========== openPWAPageé–‹å§‹ ==========');
      console.log('[menu_home] PWAç‰ˆãƒšãƒ¼ã‚¸:', path);
      console.log('[menu_home] window.parent:', window.parent);
      console.log('[menu_home] window.top:', window.top);
      console.log('[menu_home] window.location.ancestorOrigins:', window.location.ancestorOrigins);

      try {
        // çµ¶å¯¾URLã‚’æ§‹ç¯‰
        const baseUrl = 'https://reborn-inventory-system.pages.dev';
        const fullUrl = baseUrl + path;
        console.log('[menu_home] å®Œå…¨URL:', fullUrl);

        // æœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageã§é·ç§»ã‚’ä¾é ¼
        if (window.top && window.top !== window) {
          const message = {
            type: 'navigateTo',
            url: fullUrl
          };

          // æœ€ä¸Šä½ã®originã‚’å–å¾—ï¼ˆancestorOriginsã®æœ€å¾Œã®è¦ç´ ï¼‰
          let targetOrigin = '*';
          if (window.location.ancestorOrigins && window.location.ancestorOrigins.length > 0) {
            targetOrigin = window.location.ancestorOrigins[window.location.ancestorOrigins.length - 1];
          }

          console.log('[menu_home] é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', message);
          console.log('[menu_home] targetOrigin:', targetOrigin);
          console.log('[menu_home] é€ä¿¡å…ˆ: window.top');

          window.top.postMessage(message, targetOrigin);
          console.log('[menu_home] âœ… æœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageé€ä¿¡ã—ã¾ã—ãŸ');

          // 3ç§’å¾…ã£ã¦ã‚‚é·ç§»ã—ãªã„å ´åˆã¯è­¦å‘Š
          setTimeout(function() {
            console.warn('[menu_home] âš ï¸ 3ç§’çµŒéã—ã¦ã‚‚é·ç§»ã—ã¦ã„ã¾ã›ã‚“');
            alert('ãƒšãƒ¼ã‚¸é·ç§»ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          }, 3000);
        } else {
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã
          console.log('[menu_home] iframeå¤–ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™');
          window.location.href = fullUrl;
          console.log('[menu_home] âœ… ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ãã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('[menu_home] âŒ ã‚¨ãƒ©ãƒ¼:', error);
        console.error('[menu_home] error.name:', error.name);
        console.error('[menu_home] error.message:', error.message);
        console.error('[menu_home] error.stack:', error.stack);
        alert('ã‚¨ãƒ©ãƒ¼: ãƒšãƒ¼ã‚¸é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ - ' + error.message);
      }

      console.log('[menu_home] ========== openPWAPageå®Œäº† ==========');
    };

    // GASãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆæœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageé€ä¿¡ï¼‰
    window.openGASPage = function(page) {
      console.log('[menu_home] ========== openGASPageé–‹å§‹ ==========');
      console.log('[menu_home] GASãƒšãƒ¼ã‚¸:', page);
      console.log('[menu_home] window.parent:', window.parent);
      console.log('[menu_home] window.top:', window.top);

      try {
        // GASãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’æ§‹ç¯‰
        const gasDeployId = 'AKfycbx6ybbRLDqKQJ8IR-NPoVP8981Gtozzz0N3880XanEGRS4--iZtset8PFrVcD_u9YAHMA';
        const baseUrl = 'https://script.google.com/macros/s/' + gasDeployId + '/exec';
        const fullUrl = baseUrl + '?menu=' + page;
        console.log('[menu_home] å®Œå…¨URL:', fullUrl);

        // æœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageã§é·ç§»ã‚’ä¾é ¼
        if (window.top && window.top !== window) {
          const message = {
            type: 'navigateTo',
            url: fullUrl
          };

          // æœ€ä¸Šä½ã®originã‚’å–å¾—ï¼ˆancestorOriginsã®æœ€å¾Œã®è¦ç´ ï¼‰
          let targetOrigin = '*';
          if (window.location.ancestorOrigins && window.location.ancestorOrigins.length > 0) {
            targetOrigin = window.location.ancestorOrigins[window.location.ancestorOrigins.length - 1];
          }

          console.log('[menu_home] é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', message);
          console.log('[menu_home] targetOrigin:', targetOrigin);
          console.log('[menu_home] é€ä¿¡å…ˆ: window.top');

          window.top.postMessage(message, targetOrigin);
          console.log('[menu_home] âœ… æœ€ä¸Šä½ã®è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸postMessageé€ä¿¡ã—ã¾ã—ãŸ');

          // 3ç§’å¾…ã£ã¦ã‚‚é·ç§»ã—ãªã„å ´åˆã¯è­¦å‘Š
          setTimeout(function() {
            console.warn('[menu_home] âš ï¸ 3ç§’çµŒéã—ã¦ã‚‚é·ç§»ã—ã¦ã„ã¾ã›ã‚“');
            alert('ãƒšãƒ¼ã‚¸é·ç§»ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          }, 3000);
        } else {
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã
          console.log('[menu_home] iframeå¤–ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™');
          window.location.href = fullUrl;
          console.log('[menu_home] âœ… ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ãã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('[menu_home] âŒ ã‚¨ãƒ©ãƒ¼:', error);
        console.error('[menu_home] error.name:', error.name);
        console.error('[menu_home] error.message:', error.message);
        alert('ã‚¨ãƒ©ãƒ¼: ãƒšãƒ¼ã‚¸é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ - ' + error.message);
      }

      console.log('[menu_home] ========== openGASPageå®Œäº† ==========');
    };

    // ãƒšãƒ¼ã‚¸é·ç§»ï¼ˆFirestoreçµŒç”±ã§è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«é€šçŸ¥ï¼‰
    window.navigateToPage = async function(page) {
      console.log('[menu_home] ========== navigateToPageé–‹å§‹ ==========');
      console.log('[menu_home] é·ç§»å…ˆ:', page);
      console.log('[menu_home] firestoreReady:', firestoreReady);

      if (!firestoreReady || !db) {
        console.error('[menu_home] âŒ FirestoreãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        alert('ã‚¨ãƒ©ãƒ¼: FirestoreãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      try {
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã‹ã‚‰å–å¾—ï¼ˆGASå´ã§æ¸¡ã•ã‚Œã‚‹ï¼‰
        const sessionId = '<?= sessionId ?>';
        console.log('[menu_home] Firestoreæ›¸ãè¾¼ã¿é–‹å§‹...');
        console.log('[menu_home] sessionId:', sessionId);

        // Firestoreã®navigationã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«æ›¸ãè¾¼ã¿
        await db.collection('navigation').doc('menuControl').set({
          action: 'navigate',
          page: page,
          sessionId: sessionId,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          from: 'menu_home'
        });

        console.log('[menu_home] âœ… Firestoreæ›¸ãè¾¼ã¿æˆåŠŸ');
        console.log('[menu_home] ========== navigateToPageå®Œäº† ==========');

      } catch (error) {
        console.error('[menu_home] âŒ Firestoreã‚¨ãƒ©ãƒ¼:', error);
        console.error('[menu_home] error.message:', error.message);
        console.error('[menu_home] error.stack:', error.stack);
        alert('ã‚¨ãƒ©ãƒ¼: ãƒšãƒ¼ã‚¸é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ - ' + error.message);
      }
    };

    console.log('[menu_home] ========== ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº† ==========');
  </script>
</body>
</html>
