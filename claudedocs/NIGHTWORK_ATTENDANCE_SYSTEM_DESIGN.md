# ナイトワーク勤怠管理システム 設計メモ

**作成日**: 2025-11-28
**ステータス**: 構想段階（未着手）
**関連**: 送迎システム（別途ドキュメント予定）

---

## 概要

スナック・ラウンジ等のナイトワーク店舗向けに特化した勤怠管理システム。
汎用システムでは対応できない業界特有の給与計算（ドリンクバック、指名バック等）に対応。

---

## 背景・市場ニーズ

- 既存の勤怠システムは汎用的で、ナイトワーク特有のニーズに未対応
- 顔認証システム等は導入されているが、月額3,000〜5,000円で機能が限定的
- ドリンクバック、指名バック等の計算は手作業が多い
- スナック・ラウンジは全国に5〜10万店舗と推定され、市場規模は大きい

---

## ターゲット

- スナック、ラウンジ、クラブ等のナイトワーク店舗
- キャスト数: 5〜30名規模
- 既存システムに不満を持つ店舗

---

## ユーザー種別と権限

| ユーザー | できること |
|----------|-----------|
| **オーナー/ママ** | 全機能（設定、給与確定、シフト決定、SNS投稿） |
| **キャスト** | 自分の勤怠確認、シフト希望提出、給与明細確認 |

---

## 機能一覧

### コア機能（全プラン共通）

#### 打刻機能
- **GPS打刻**: 店舗から半径50m以内でのみ打刻可能
- **QRコード打刻**（オプション）: 店舗タブレットに表示される動的QR（30秒更新）をスキャン
- 出勤・退勤の記録
- 位置情報の記録（不正防止）

#### 勤怠管理
- 出退勤記録一覧
- 労働時間の自動計算
- 遅刻・早退・欠勤の記録

#### 給与計算（ナイトワーク特化）
| 項目 | 計算方式 |
|------|----------|
| 基本時給 | 労働時間 × 時給 |
| ドリンクバック | 杯数 × 単価（300〜500円） |
| 指名バック | 指名数 × 単価（1,000〜2,000円） |
| 同伴バック | 同伴数 × 単価（2,000〜3,000円） |
| ボトルバック | ボトル売上 × %（10〜20%） |
| ペナルティ | 遅刻/当欠で減額 |
| 日払い/週払い | 前払い分を差し引き |
| 源泉徴収 | 10.21%（個人事業主扱い） |

#### 給与明細（キャスト向け）
- 今月の実績（出勤日数、労働時間、ドリンク数等）
- 見込み給与のリアルタイム表示
- 過去の給与明細閲覧

### シフト・予約機能（スタンダード以上）

#### シフト管理
- 月間シフト表
- キャストからのシフト希望提出
- シフト調整・確定

#### 来店予約管理
- 顧客情報管理
- 予約登録・変更・キャンセル
- 指名キャストの指定

#### イベントカレンダー
- イベント登録
- カレンダー表示
- リマインダー機能

### SNS自動化機能（プレミアム）

#### 出勤情報の自動投稿
- 毎日の出勤キャスト一覧を自動投稿
- 投稿時間の設定可能（例: 18:00）
- Instagram / X（Twitter）対応

#### イベント告知の自動化
- カレンダー連携で自動告知
- 7日前、3日前、当日のカウントダウン投稿
- AIによる投稿文自動生成

#### 求人投稿の自動提案
- シフト空き状況を分析
- 人手不足を検知して求人投稿を提案
- ワンタップで投稿可能

#### キャスト誕生日投稿
- 誕生日データから自動投稿
- お祝いメッセージをAI生成

#### AI投稿文生成
- OpenAI API（GPT）を使用
- 店舗のトーンに合わせたカスタマイズ

---

## 料金プラン

| プラン | 対象 | キャスト数 | 月額 | 初期費用 |
|--------|------|:---------:|-----:|--------:|
| **ライト** | 小規模・会員制 | 〜5名 | 3,000円 | 0円 |
| **スタンダード** | 中規模 | 〜15名 | 5,000円 | 0円 |
| **プレミアム** | 集客重視・大規模 | 無制限 | 8,000円 | 0円 |

### オプション
| オプション | 内容 | 費用 |
|------------|------|-----:|
| タブレット導入 | Fire HD + 設定済み | 15,000円（初回） |
| タブレットレンタル | 月額に含む | +1,000円/月 |

---

## 技術スタック

| 機能 | 技術 |
|------|------|
| フロントエンド | PWA（HTML/CSS/JavaScript） |
| バックエンド | Firebase（Firestore, Cloud Functions） |
| 認証 | Firebase Authentication |
| 位置情報 | Web Geolocation API |
| QRコード | qrcode.js / html5-qrcode |
| SNS連携 | Instagram Graph API / Twitter API v2 |
| AI生成 | OpenAI API（GPT） |
| 通知 | FCM（Firebase Cloud Messaging） |
| メール送信 | Google Workspace SMTP |

### メール送信設計（重要）

有料サービスとしてプロフェッショナルな印象を与えるため、メール周りは以下を推奨：

| 方法 | アイコン | コスト | 推奨度 |
|------|----------|--------|:------:|
| **Google Workspace** | プロフィール写真でロゴ表示可能 | 月680円〜/ユーザー | ⭐推奨 |
| Resend（無料） | 文字アイコンのみ | 無料（3,000通/月） | △ |
| BIMI認証 | 認証済みロゴ | 年間15〜20万円 + 商標必要 | × 高コスト |

**Google Workspace導入時のメリット**:
- Gmailでロゴ（プロフィール写真）が表示される
- `noreply@[ドメイン].jp` で信頼性向上
- SMTP経由で送信可能
- 月額コストが低い（1アカウントで十分）

**実装案**:
```
1. 専用ドメイン取得（例: nightwork-kintai.jp）
2. Google Workspace契約（Business Starter: 680円/月）
3. noreply@nightwork-kintai.jp を作成
4. プロフィール写真にロゴを設定
5. SMTP経由でメール送信（nodemailer等）
```

**参考**: フリラ（REBORN）でResendを使用したところ、Gmailアイコンが文字（F→N）になり、
ロゴ表示にはGoogle WorkspaceまたはBIMI認証が必要と判明（2025-12-01確認）。

---

## データ構造（Firestore）

```
Firestore
├── shops/{shopId}                    # 店舗情報
│   ├── name: "スナック○○"
│   ├── location: {lat, lng}          # GPS打刻用
│   ├── hourlyRates: {基本: 2000, 指名: 2500}
│   ├── drinkBackRate: 300
│   └── plan: "standard"
│
├── casts/{castId}                    # キャスト情報
│   ├── shopId
│   ├── name
│   ├── hourlyRate
│   ├── birthday
│   └── profileImage
│
├── attendance/{recordId}             # 勤怠記録
│   ├── castId
│   ├── shopId
│   ├── date
│   ├── clockIn
│   ├── clockOut
│   ├── workHours
│   ├── drinks: 8
│   ├── nominations: 3
│   └── location: {lat, lng}
│
├── shifts/{shiftId}                  # シフト
│   ├── shopId
│   ├── date
│   └── assignments: [{castId, start, end}]
│
├── reservations/{reservationId}      # 来店予約
│   ├── shopId
│   ├── customerName
│   ├── date
│   ├── time
│   ├── requestedCast
│   └── status
│
├── events/{eventId}                  # イベント
│   ├── shopId
│   ├── title
│   ├── date
│   └── description
│
└── payrolls/{payrollId}              # 給与データ
    ├── castId
    ├── shopId
    ├── month
    ├── breakdown: {hourly, drinkBack, nominationBack, ...}
    ├── totalAmount
    └── status: "未払い" | "支払済"
```

---

## 開発フェーズ

| Phase | 機能 | 期間目安 |
|:-----:|------|:--------:|
| 1 | 打刻（GPS）+ 基本勤怠 | 2〜3週間 |
| 2 | 給与計算（バック類対応） | 2〜3週間 |
| 3 | シフト管理 | 2週間 |
| 4 | QRコード打刻 | 1週間 |
| 5 | 来店予約・カレンダー | 2週間 |
| 6 | SNS自動化 | 3〜4週間 |

**MVP（Phase 1〜2）**: 約1ヶ月で競合と差別化可能な状態に

---

## 競合との差別化

| 機能 | 顔認証システム（競合） | 本システム |
|------|:--------------------:|:---------:|
| 打刻 | ○ | ○（GPS + QR） |
| 基本給与計算 | ○ | ○ |
| ドリンクバック | × | ○ |
| 指名バック | × | ○ |
| 同伴バック | × | ○ |
| ボトルバック | × | ○ |
| 日払い管理 | × | ○ |
| シフト管理 | △ | ○ |
| 来店予約 | × | ○ |
| イベントカレンダー | × | ○ |
| キャスト専用アプリ | × | ○ |
| SNS自動化 | × | ○ |
| AI投稿生成 | × | ○ |

---

## 関連システム

### 送迎システム（別途開発予定）
- ドライバー配車、リアルタイム位置情報
- 店舗への月次請求
- ドライバー報酬計算（65%）
- **勤怠システムとセットで導入すると相乗効果**

### REBORN（在庫管理システム）
- 技術基盤（Firebase + PWA + 権限設計）を共有
- 別事業（古着物販）だが、設計パターンは流用可能

---

## メモ

- 知り合いのママさんから「顔認証システムはあるが、ナイトワーク特有のバック計算に対応していない」という不満の声あり
- ユーザーは10年のナイトワーク業界経験（求人・送迎サービス営業）があり、業界知識が豊富
- 最初の10店舗で実績を作り、口コミで広げる戦略
- ナイトワーク業界は横のつながりが強く、良いシステムは紹介で広がりやすい

---

**最終更新**: 2025-12-01（メール送信設計を追加）
