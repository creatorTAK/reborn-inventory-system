<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="apple-touch-icon" sizes="180x180" href="https://creatortak.github.io/reborn-inventory-system/icon-180.png">
<base target="_top">

<!-- iOS PWAå¯¾å¿œ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="REBORN">

<!-- PWAå¯¾å¿œ -->
<link rel="manifest" href="<?= ScriptApp.getService().getUrl() ?>?menu=manifest">
<meta name="theme-color" content="#000000">

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- REBORN Brand Colors & Theme -->
<link rel="stylesheet" href="https://www.reborn-inventory.com/css/reborn-brand-colors.css?v=0bd1a9b">
<link rel="stylesheet" href="https://www.reborn-inventory.com/css/reborn-theme.css?v=0bd1a9b">

<?!= include('sp_styles'); ?>
<?!= include('mobile_header'); ?>

<!-- Sortable.js - ã‚¿ãƒƒãƒå¯¾å¿œã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="<?!= typeof isSidebar !== 'undefined' && isSidebar ? 'sidebar' : '' ?>">
<script>
function navigateInPWA(url) {
  try {
    // iframeå†…ã«ã„ã‚‹å ´åˆã€æœ€ä¸Šä½ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«postMessageã§é€šçŸ¥
    if (window.top && window.top !== window.self) {
      console.log('ğŸ“¤ postMessageé€ä¿¡ (to window.top):', url);
      window.top.postMessage({
        type: 'navigate',
        url: url
      }, '*'); // GASã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹iframeã‹ã‚‰é€ä¿¡ã™ã‚‹ãŸã‚ã€ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
    } else {
      // iframeå¤–ï¼ˆé€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã®å ´åˆ
      window.location.href = url;
    }
  } catch (e) {
    console.error('âŒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼:', e);
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: é€šå¸¸ã®é·ç§»
    window.location.href = url;
  }
}
</script>

<!-- çµ±ä¸€ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="header">
  <div class="header-content">
    <button class="back-button" id="back-button">
      <i class="bi bi-chevron-left"></i>
    </button>
    <div class="header-title">
      <span style="font-size: 20px;">ğŸ“</span>
      å•†å“ç™»éŒ²
    </div>
    <div style="width: 40px;"></div>
  </div>
  </div>
</div>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
<div class="content-container">
<?!= include('sp_block_manage'); ?>
<?!= include('sp_block_basic'); ?>
<?!= include('sp_block_title'); ?>
<?!= include('sp_block_description'); ?> <!-- â˜… æ–°è¦ã€Œå•†å“ã®èª¬æ˜ã€ï¼ˆå•†å“åã®ä¸‹ï¼‰ -->
<?!= include('sp_block_product_images'); ?> <!-- å•†å“ç”»åƒï¼ˆæ¡ä»¶ä»˜ãè¡¨ç¤ºï¼‰ -->
<?!= include('sp_block_shipping'); ?> <!-- é…é€ã«ã¤ã„ã¦ -->
<?!= include('sp_block_procure'); ?> <!-- ä»•å…¥æƒ…å ± -->
<?!= include('sp_block_listing'); ?> <!-- å‡ºå“æƒ…å ± -->
<div class="actions">
<button onclick="onSave()">ä¿å­˜</button>
<button onclick="onReset()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>
<div class="msg" id="msg"></div>
</div> <!-- /content-container -->

<script>
  // FCMãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å®šç¾©ï¼ˆsp_scripts.html ã§ä½¿ç”¨ï¼‰
  var GLOBAL_FCM_TOKEN = '<?= fcmToken ?>';
</script>

<!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³å‡¦ç† --><script>
  console.log('[sidebar_product] âœ… Script loaded - Version @944-GAS-Brand-Preload');
  
  async function goBack() {
    console.log('[sidebar_product] >>> goBack() called at', new Date().toISOString());
    const isInIframe = window.self !== window.top;
    console.log('[sidebar_product] isInIframe:', isInIframe);
    
    if (isInIframe) {
      console.log('[sidebar_product] iframeå†…ã§é–‹ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€postMessageé€ä¿¡');
      window.top.postMessage({ type: 'navigateToHome' }, '*');
      console.log('[sidebar_product] âœ… postMessageé€ä¿¡å®Œäº†');
    } else {
      console.log('[sidebar_product] ç›´æ¥é–‹ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€google.script.host.close()');
      google.script.host.close();
    }
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    console.log('[sidebar_product] DOMContentLoaded fired');
    const backButton = document.getElementById('back-button');
    console.log('[sidebar_product] backButton element:', backButton);
    
    if (backButton) {
      backButton.addEventListener('click', goBack);
      console.log('[sidebar_product] âœ… æˆ»ã‚‹ãƒœã‚¿ãƒ³ã«goBack()ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ');
    } else {
      console.error('[sidebar_product] âŒ æˆ»ã‚‹ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
  });
</script>

<?!= include('sp_scripts'); ?>
</body>
</html>