<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="apple-touch-icon" sizes="180x180" href="https://creatortak.github.io/reborn-inventory-system/icon-180.png">
<base target="_top">

<!-- iOS PWA対応 -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="REBORN">

<!-- PWA対応 -->
<link rel="manifest" href="<?= ScriptApp.getService().getUrl() ?>?menu=manifest">
<meta name="theme-color" content="#000000">

<?!= include('sp_styles'); ?>
<?!= include('mobile_header'); ?>

<!-- Sortable.js - タッチ対応のドラッグ&ドロップライブラリ -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="<?!= typeof isSidebar !== 'undefined' && isSidebar ? 'sidebar' : '' ?>">
<script>
function navigateInPWA(url) {
  try {
    // iframe内にいる場合、最上位ウィンドウにpostMessageで通知
    if (window.top && window.top !== window.self) {
      console.log('📤 postMessage送信 (to window.top):', url);
      window.top.postMessage({
        type: 'navigate',
        url: url
      }, '*'); // GASのサンドボックスiframeから送信するため、ワイルドカードを使用
    } else {
      // iframe外（通常のブラウザ）の場合
      window.location.href = url;
    }
  } catch (e) {
    console.error('❌ ナビゲーションエラー:', e);
    // フォールバック: 通常の遷移
    window.location.href = url;
  }
}
</script>

<?!= include('sp_block_manage'); ?>
<?!= include('sp_block_basic'); ?>
<?!= include('sp_block_title'); ?>
<?!= include('sp_block_description'); ?> <!-- ★ 新規「商品の説明」（商品名の下） -->
<?!= include('sp_block_shipping'); ?> <!-- 配送について -->
<?!= include('sp_block_procure'); ?> <!-- 仕入情報 -->
<?!= include('sp_block_listing'); ?> <!-- 出品情報 -->
<div class="actions">
<button onclick="onSave()">保存</button>
<button onclick="onReset()">リセット</button>
</div>
<div class="msg" id="msg"></div>
<?!= include('sp_scripts'); ?>
</body>
</html>