# REBORN Inventory - TDD運用ポリシー & Issue管理ルール

## 📖 目的

このドキュメントは、REBORN Inventoryプロジェクトにおける：
- **TDD（テスト駆動開発）の運用方針**
- **Issue管理ルール**
- **開発フロー**

を定義し、不具合を防ぎ、効率的な開発を実現するためのガイドラインです。

---

## 🎯 TDD運用ポリシー

### TDDを適用する場面

#### ✅ TDD適用推奨

| 場面 | 例 | 理由 |
|------|-----|------|
| **複雑なロジックがある機能** | AI生成、管理番号の自動採番 | バグが起きやすく、テストケースで整理すると設計が改善される |
| **既存機能の修正** | リセット機能の不具合修正 | 修正後のデグレード（別の箇所が壊れる）を防げる |
| **複数の条件分岐がある機能** | フォームのバリデーション | 網羅的にテストケースを洗い出せる |
| **何度も使われる重要な機能** | 商品登録の基幹機能 | 品質保証が重要 |

#### ❌ TDD不要な場面

| 場面 | 例 | 理由 |
|------|-----|------|
| **単純なUI調整** | ボタンの色変更、余白調整 | 見た目の確認だけで済む |
| **文言修正** | ラベルテキストの変更 | リスクが低い |
| **一時的なデバッグコード** | Logger.log追加 | すぐ消すコード |
| **プロトタイプ・実験** | 新機能の動作確認 | 仕様が固まってから正式にテスト |

### TDD適用判断フローチャート

```
開発タスク発生
    ↓
不具合修正？ → YES → TDD適用
    ↓ NO
新機能追加？
    ↓ YES
複雑なロジック/条件分岐？ → YES → TDD適用
    ↓ NO
重要な基幹機能？ → YES → TDD適用
    ↓ NO
UI調整/文言修正/デバッグ？ → YES → TDD不要
    ↓ NO
判断に迷う → チームで相談
```

---

## 📋 Issue管理ルール

### Issue管理の基本原則

1. **不具合は必ず起票する**
   - どんな小さな不具合でも `docs/issues.md` に記録
   - 口頭やチャットだけで済ませない

2. **修正前に起票する**
   - 先にコードを修正しない
   - Issue起票 → 修正実装 の順序を守る

3. **チェックボックスで進捗管理**
   - `[ ]` 未完了 / `[x]` 完了
   - 作業の進捗を見える化

4. **完了したIssueはアーカイブ**
   - `✅ DONE` になったら `docs/issues-closed.md` に移動
   - `docs/issues.md` は常に未完了のIssueのみ

5. **定期的にissues.mdを確認**
   - 開発前に必ず確認（未解決の不具合把握）
   - 週次レビュー推奨

---

### Issue ID体系

各Issueには一意のIDを付与します。

| プレフィックス | 対象 | 例 |
|--------------|------|-----|
| `AI-XXX` | AI生成機能 | AI-001, AI-002 |
| `RESET-XXX` | リセット機能 | RESET-001, RESET-002 |
| `FORM-XXX` | フォーム機能 | FORM-001, FORM-002 |
| `DB-XXX` | データベース/スプレッドシート | DB-001, DB-002 |
| `UI-XXX` | UI調整 | UI-001, UI-002 |
| `IMG-XXX` | 画像機能 | IMG-001, IMG-002 |
| `NUM-XXX` | 管理番号機能 | NUM-001, NUM-002 |
| `BUG-XXX` | その他バグ | BUG-001, BUG-002 |

**連番ルール：**
- 3桁の連番（001, 002, ...）
- カテゴリごとに独立してカウント

---

### Issue記法ルール

#### 基本フォーマット

```markdown
## [ID] | [カテゴリ]: [タイトル]

### 📌 基本情報
- [ ] カテゴリ: [バグ修正 / 機能追加 / 改善]
- [ ] 優先度: [高 / 中 / 低]
- [ ] 影響範囲: [機能名]
- [ ] 発見日: YYYY-MM-DD

### 🐛 不具合内容 / 💡 要望内容
[具体的な説明]

### ✅ 期待動作
[どうあるべきか]

### 📍 関連ファイル
- `ファイル名` (関数名/行数)

### 🧪 テストケース
#### TC-[ID]-001: [テスト名]
**前提条件:**
- 項目A: 値X
- 項目B: 値Y

**実行操作:**
1. 操作1
2. 操作2

**期待結果:**
- 項目A: 期待値X
- 項目B: 期待値Y

### ✏️ 修正内容
- [ ] 修正タスク1
- [ ] 修正タスク2
- [ ] テスト実行

### 📝 テスト結果
- [ ] TC-[ID]-001: PASS / FAIL
- [ ] デグレード確認: OK / NG

### 状態
- [ ] ✅ DONE (完了日: )

---
```

#### チェックボックスの使い方

- `[ ]` : 未完了
- `[x]` : 完了
- 進捗に応じてチェックを入れる

#### 状態管理

- 作業中: `- [ ] ✅ DONE (完了日: )`
- 完了: `- [x] ✅ DONE (完了日: 2025-10-21)`
- 完了後は `docs/issues-closed.md` に移動

---

## 🔄 開発フロー

### 全体フロー

```
1. 不具合発見 / 新機能要望
   ↓
2. docs/issues.md に起票（ISSUE_TEMPLATE.md を使用）
   ↓
3. TDD適用判断（TDDポリシー参照）
   ↓
4. 【TDD適用の場合】
   a. テストケースを先に書く（issues.md内）
   b. 修正実装
   c. テスト実行・記録

   【TDD不要の場合】
   a. 修正実装
   b. 動作確認
   ↓
5. チェックボックスを埋める（進捗管理）
   ↓
6. 完了確認
   ↓
7. ✅ DONE → docs/issues-closed.md に移動
```

### 開発前チェックリスト

開発を始める前に必ず確認：

```markdown
- [ ] docs/issues.md を確認（未解決の不具合把握）
- [ ] 関連するIssueがないか検索
- [ ] 新しい不具合/要望なら起票
- [ ] TDD適用判断
- [ ] テストケース作成（TDD適用の場合）
```

### 修正後チェックリスト

修正完了後に必ず確認：

```markdown
- [ ] テストケース実行・記録
- [ ] デグレード確認（関連機能が壊れていないか）
- [ ] issues.md のチェックボックス更新
- [ ] ✅ DONE 記入
- [ ] issues-closed.md に移動
- [ ] Git commit & push
```

---

## 🛠️ 実践例：リセット機能の不具合修正

### Step 1: 不具合発見
ユーザーから「リセットボタンを押しても、管理番号プレフィックスが残る」報告

### Step 2: Issue起票
`docs/issues.md` に `RESET-001` として起票

### Step 3: TDD適用判断
- 既存機能の修正 → ✅ TDD適用

### Step 4: テストケース作成
Issue内にテストケース `TC-RESET-001` を記載

### Step 5: 修正実装
`sp_scripts.html` の `resetForm` 関数を修正

### Step 6: テスト実行
TC-RESET-001 を手動実行 → PASS

### Step 7: 完了
`✅ DONE (2025-10-21)` に変更し、`issues-closed.md` に移動

---

## 📁 ファイル構成

```
docs/
├── TDD_POLICY.md          # このファイル（運用ルール）
├── ISSUE_TEMPLATE.md      # Issue起票テンプレート（コピペ用）
├── issues.md              # 未完了Issue（作業中）
└── issues-closed.md       # 完了Issue（アーカイブ）
```

---

## 💡 運用のコツ

### 1. Issueは小さく分ける
- 1つのIssueに複数の不具合を詰め込まない
- 修正範囲が明確になる

### 2. テストケースは具体的に
- 「動作確認」ではなく「TC-XXX-001を実行」と書く
- 再現可能な手順を記載

### 3. 定期的にレビュー
- 週1回、issues.md を見直す
- 優先度の見直し

### 4. アーカイブを活用
- issues-closed.md は知見の宝庫
- 似た不具合が起きたときの参考資料

### 5. 完璧を求めすぎない
- 最初は簡素でOK
- 運用しながら改善

---

## 📚 参考資料

- [ISSUE_TEMPLATE.md](./ISSUE_TEMPLATE.md) - Issue起票テンプレート
- [issues.md](./issues.md) - 未完了Issue一覧
- [issues-closed.md](./issues-closed.md) - 完了Issueアーカイブ

---

**更新履歴:**
- 2025-10-21: 初版作成
