<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAS APIæ¥ç¶šãƒ†ã‚¹ãƒˆ - REBORN</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 32px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .test-section {
      margin-bottom: 24px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .test-section h2 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .test-section p {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 16px;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-all;
      display: none;
    }

    .result.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      display: block;
    }

    .result.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
      display: block;
    }

    .result.loading {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
      display: block;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .status-badge.pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-badge.success {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.error {
      background: #f8d7da;
      color: #721c24;
    }

    .info-box {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .info-box h3 {
      font-size: 14px;
      color: #004085;
      margin-bottom: 8px;
    }

    .info-box ul {
      margin-left: 20px;
      font-size: 13px;
      color: #004085;
    }

    .info-box li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª GAS APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
    <p class="subtitle">ARCH-001: PWAå®Œå…¨ç§»è¡Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - Phase 1</p>

    <div class="info-box">
      <h3>ğŸ“‹ ã“ã®ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦</h3>
      <ul>
        <li>PWAã‹ã‚‰GAS APIã‚’ç›´æ¥å‘¼ã³å‡ºã›ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
        <li>ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶ç´„ãŒãªã„ã“ã¨ã‚’ç¢ºèª</li>
        <li>å„ç¨®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª</li>
      </ul>
    </div>

    <!-- Test 1: åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h2>
        <span>1ï¸âƒ£ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ</span>
        <span class="status-badge pending" id="status-1">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>GAS APIã«æ¥ç¶šã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™</p>
      <button onclick="runTest1()" id="btn-1">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-1"></div>
    </div>

    <!-- Test 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾— -->
    <div class="test-section">
      <h2>
        <span>2ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—</span>
        <span class="status-badge pending" id="status-2">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>getUserListForUI APIã®å‹•ä½œç¢ºèª</p>
      <button onclick="runTest2()" id="btn-2">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-2"></div>
    </div>

    <!-- Test 3: è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã— -->
    <div class="test-section">
      <h2>
        <span>3ï¸âƒ£ è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã—</span>
        <span class="status-badge pending" id="status-3">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>ä¸¦åˆ—å®Ÿè¡Œã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª</p>
      <button onclick="runTest3()" id="btn-3">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-3"></div>
    </div>

  </div>

  <!-- api.jsèª­ã¿è¾¼ã¿ -->
  <script src="/js/api.js"></script>

  <script>
    // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
    function showResult(testId, status, message) {
      const resultEl = document.getElementById(`result-${testId}`);
      const statusEl = document.getElementById(`status-${testId}`);
      const btnEl = document.getElementById(`btn-${testId}`);

      resultEl.className = `result ${status}`;
      resultEl.textContent = message;

      if (status === 'loading') {
        statusEl.className = 'status-badge pending';
        statusEl.textContent = 'å®Ÿè¡Œä¸­...';
        btnEl.disabled = true;
      } else if (status === 'success') {
        statusEl.className = 'status-badge success';
        statusEl.textContent = 'æˆåŠŸ âœ“';
        btnEl.disabled = false;
      } else if (status === 'error') {
        statusEl.className = 'status-badge error';
        statusEl.textContent = 'å¤±æ•— âœ—';
        btnEl.disabled = false;
      }
    }

    // Test 1: åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
    async function runTest1() {
      try {
        showResult(1, 'loading', 'æ¥ç¶šä¸­...');

        const startTime = performance.now();
        const result = await GasApi.testGasApi();
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const message = `âœ… æ¥ç¶šæˆåŠŸï¼

ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€‘
${JSON.stringify(result, null, 2)}

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ GAS APIã«æ­£å¸¸ã«æ¥ç¶šã§ãã¾ã—ãŸ
âœ“ JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£ã—ãå–å¾—ã§ãã¾ã—ãŸ
âœ“ ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶ç´„ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“`;

        showResult(1, 'success', message);

      } catch (error) {
        const message = `âŒ æ¥ç¶šå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ GAS APIã®URLãŒé–“é•ã£ã¦ã„ã‚‹
â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ
â€¢ GASãƒ‡ãƒ—ãƒ­ã‚¤ã®å•é¡Œ`;

        showResult(1, 'error', message);
        console.error('[Test 1 Error]', error);
      }
    }

    // Test 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
    async function runTest2() {
      try {
        showResult(2, 'loading', 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');

        const startTime = performance.now();
        const result = await GasApi.getUserList();
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const userCount = Array.isArray(result) ? result.length : 0;
        const message = `âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼

ã€å–å¾—çµæœã€‘
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${userCount}äºº

${Array.isArray(result) ? JSON.stringify(result.slice(0, 3), null, 2) + (result.length > 3 ? '\n... ä»– ' + (result.length - 3) + 'äºº' : '') : JSON.stringify(result, null, 2)}

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ getUserListForUI APIãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ
âœ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå–å¾—ã§ãã¾ã—ãŸ`;

        showResult(2, 'success', message);

      } catch (error) {
        const message = `âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ getUserListForUI APIã®å®Ÿè£…å•é¡Œ
â€¢ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®èª­ã¿å–ã‚Šæ¨©é™å•é¡Œ
â€¢ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ä¸ä¸€è‡´`;

        showResult(2, 'error', message);
        console.error('[Test 2 Error]', error);
      }
    }

    // Test 3: è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã—
    async function runTest3() {
      try {
        showResult(3, 'loading', 'ä¸¦åˆ—å®Ÿè¡Œä¸­...');

        const startTime = performance.now();

        // 3ã¤ã®APIã‚’åŒæ™‚ã«å‘¼ã³å‡ºã—
        const [testResult, userListResult, userCountResult] = await Promise.all([
          GasApi.testGasApi(),
          GasApi.getUserList(),
          GasApi.getExistingUserCount()
        ]);

        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const message = `âœ… ä¸¦åˆ—å®Ÿè¡ŒæˆåŠŸï¼

ã€å®Ÿè¡Œçµæœã€‘
â€¢ testGasApi: ${testResult.status}
â€¢ getUserList: ${Array.isArray(userListResult) ? userListResult.length + 'ä»¶å–å¾—' : 'OK'}
â€¢ getExistingUserCount: ${userCountResult}äºº

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ è¤‡æ•°APIã‚’ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã—ãŸ
âœ“ å…¨ã¦ã®APIãŒæ­£å¸¸ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã—ãŸ
âœ“ ä¸¦åˆ—å®Ÿè¡Œã«ã‚ˆã‚Šé«˜é€ŸåŒ–ãŒå®Ÿç¾ã—ã¦ã„ã¾ã™

ã€å‚è€ƒã€‘
iframeçµŒç”±ã®å ´åˆ: ç´„2000-3000msÃ—3 = 6000-9000ms
ç›´æ¥APIå‘¼ã³å‡ºã—: ${duration}ms
â†’ ç´„${Math.round((6000 / duration))}å€ã®é«˜é€ŸåŒ–ï¼`;

        showResult(3, 'success', message);

      } catch (error) {
        const message = `âŒ ä¸¦åˆ—å®Ÿè¡Œå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ ä¸€éƒ¨ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæœªå®Ÿè£…
â€¢ åŒæ™‚å®Ÿè¡Œã«ã‚ˆã‚‹è² è·å•é¡Œ
â€¢ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®å•é¡Œ`;

        showResult(3, 'error', message);
        console.error('[Test 3 Error]', error);
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ§ª GAS APIãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†');
      console.log('ğŸ“ GasApi ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', window.GasApi);

      // GasApiãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
      if (!window.GasApi) {
        alert('âš ï¸ api.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      }
    });
  </script>
</body>
</html>
