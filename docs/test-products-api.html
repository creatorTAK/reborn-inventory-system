<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å•†å“APIæ¥ç¶šãƒ†ã‚¹ãƒˆ - REBORN</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 32px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .test-section {
      margin-bottom: 24px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .test-section h2 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .test-section p {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 16px;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-all;
      display: none;
    }

    .result.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      display: block;
    }

    .result.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
      display: block;
    }

    .result.loading {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
      display: block;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .status-badge.pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-badge.success {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.error {
      background: #f8d7da;
      color: #721c24;
    }

    .info-box {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .info-box h3 {
      font-size: 14px;
      color: #004085;
      margin-bottom: 8px;
    }

    .info-box ul {
      margin-left: 20px;
      font-size: 13px;
      color: #004085;
    }

    .info-box li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª å•†å“APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
    <p class="subtitle">ARCH-001: PWAå®Œå…¨ç§»è¡Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - Phase 3 (å•†å“ãƒ»åœ¨åº«ãƒ‡ãƒ¼ã‚¿Firestoreç§»è¡Œ)</p>

    <div class="info-box">
      <h3>ğŸ“‹ ã“ã®ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦</h3>
      <ul>
        <li>PWAã‹ã‚‰GAS APIï¼ˆå•†å“æ¤œç´¢ï¼‰ã‚’ç›´æ¥å‘¼ã³å‡ºã›ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
        <li>Firestoreã‹ã‚‰å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’é«˜é€Ÿå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª</li>
        <li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
        <li>æœŸå¾…ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: GAS 3800ms â†’ Firestore 50-300ms (10-70å€é«˜é€ŸåŒ–)</li>
      </ul>
    </div>

    <!-- Test 1: åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h2>
        <span>1ï¸âƒ£ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ</span>
        <span class="status-badge pending" id="status-1">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>GAS APIã«æ¥ç¶šã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™</p>
      <button onclick="runTest1()" id="btn-1">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-1"></div>
    </div>

    <!-- Test 2: å•†å“ä¸€è¦§å–å¾—ï¼ˆGAS APIï¼‰ -->
    <div class="test-section">
      <h2>
        <span>2ï¸âƒ£ å•†å“ä¸€è¦§å–å¾—ï¼ˆGAS APIï¼‰</span>
        <span class="status-badge pending" id="status-2">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>å¾“æ¥ã®GAS APIï¼ˆsearch_inventoryï¼‰ã§ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®š</p>
      <button onclick="runTest2()" id="btn-2">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-2"></div>
    </div>

    <!-- Test 3: è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã— -->
    <div class="test-section">
      <h2>
        <span>3ï¸âƒ£ è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã—</span>
        <span class="status-badge pending" id="status-3">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>ä¸¦åˆ—å®Ÿè¡Œã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª</p>
      <button onclick="runTest3()" id="btn-3">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-3"></div>
    </div>

    <!-- Test 4: Firestoreç›´æ¥èª­ã¿è¾¼ã¿ -->
    <div class="test-section">
      <h2>
        <span>4ï¸âƒ£ Firestoreç›´æ¥èª­ã¿è¾¼ã¿</span>
        <span class="status-badge pending" id="status-4">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>Firestoreã‹ã‚‰ç›´æ¥å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆæœŸå¾…: 50-300msï¼‰</p>
      <button onclick="runTest4()" id="btn-4">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-4"></div>
    </div>

    <!-- Test 5: Firestoreã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ã -->
    <div class="test-section">
      <h2>
        <span>5ï¸âƒ£ Firestoreã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ã</span>
        <span class="status-badge pending" id="status-5">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ä»˜ãFirestoreèª­ã¿è¾¼ã¿ï¼ˆåˆå›: 50-300msã€2å›ç›®ä»¥é™: <5msï¼‰</p>
      <button onclick="runTest5()" id="btn-5">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-5"></div>
    </div>

    <!-- Test 6: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ -->
    <div class="test-section">
      <h2>
        <span>6ï¸âƒ£ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰</span>
        <span class="status-badge pending" id="status-6">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>Firestoreå¤±æ•—æ™‚ã«GAS APIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯</p>
      <button onclick="runTest6()" id="btn-6">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-6"></div>
    </div>

    <!-- Test 7: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœç¢ºèª -->
    <div class="test-section">
      <h2>
        <span>7ï¸âƒ£ ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœç¢ºèª</span>
        <span class="status-badge pending" id="status-7">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åŠ¹æœã‚’æ¸¬å®šï¼ˆåˆå› vs 2å›ç›®ï¼‰</p>
      <button onclick="runTest7()" id="btn-7">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-7"></div>
    </div>

    <!-- Test 8: ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h2>
        <span>8ï¸âƒ£ ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢ãƒ†ã‚¹ãƒˆ</span>
        <span class="status-badge pending" id="status-8">æœªå®Ÿè¡Œ</span>
      </h2>
      <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</p>
      <button onclick="runTest8()" id="btn-8">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div class="result" id="result-8"></div>
    </div>

  </div>

  <!-- api.jsèª­ã¿è¾¼ã¿ -->
  <script src="/js/api.js"></script>

  <!-- firestore-api.jsèª­ã¿è¾¼ã¿ -->
  <script type="module" src="/js/firestore-api.js"></script>

  <script>
    // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
    function showResult(testId, status, message) {
      const resultEl = document.getElementById(`result-${testId}`);
      const statusEl = document.getElementById(`status-${testId}`);
      const btnEl = document.getElementById(`btn-${testId}`);

      resultEl.className = `result ${status}`;
      resultEl.textContent = message;

      if (status === 'loading') {
        statusEl.className = 'status-badge pending';
        statusEl.textContent = 'å®Ÿè¡Œä¸­...';
        btnEl.disabled = true;
      } else if (status === 'success') {
        statusEl.className = 'status-badge success';
        statusEl.textContent = 'æˆåŠŸ âœ“';
        btnEl.disabled = false;
      } else if (status === 'error') {
        statusEl.className = 'status-badge error';
        statusEl.textContent = 'å¤±æ•— âœ—';
        btnEl.disabled = false;
      }
    }

    // Test 1: åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
    async function runTest1() {
      try {
        showResult(1, 'loading', 'æ¥ç¶šä¸­...');

        const startTime = performance.now();
        const result = await GasApi.testGasApi();
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const message = `âœ… æ¥ç¶šæˆåŠŸï¼

ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€‘
${JSON.stringify(result, null, 2)}

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ GAS APIã«æ­£å¸¸ã«æ¥ç¶šã§ãã¾ã—ãŸ
âœ“ JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£ã—ãå–å¾—ã§ãã¾ã—ãŸ
âœ“ ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶ç´„ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“`;

        showResult(1, 'success', message);

      } catch (error) {
        const message = `âŒ æ¥ç¶šå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ GAS APIã®URLãŒé–“é•ã£ã¦ã„ã‚‹
â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ
â€¢ GASãƒ‡ãƒ—ãƒ­ã‚¤ã®å•é¡Œ`;

        showResult(1, 'error', message);
        console.error('[Test 1 Error]', error);
      }
    }

    // Test 2: å•†å“ä¸€è¦§å–å¾—ï¼ˆGAS APIï¼‰
    async function runTest2() {
      try {
        showResult(2, 'loading', 'GAS APIã§ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');

        const startTime = performance.now();
        const result = await GasApi.searchInventory({});
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const productCount = Array.isArray(result) ? result.length : 0;
        const message = `âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼

ã€å–å¾—çµæœã€‘
å•†å“æ•°: ${productCount}ä»¶

${Array.isArray(result) ? JSON.stringify(result.slice(0, 2), null, 2) + (result.length > 2 ? '\n... ä»– ' + (result.length - 2) + 'ä»¶' : '') : JSON.stringify(result, null, 2)}

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms (ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³)

ã€ç¢ºèªäº‹é …ã€‘
âœ“ search_inventory APIãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ
âœ“ å•†å“ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå–å¾—ã§ãã¾ã—ãŸ
âœ“ ã“ã®é€Ÿåº¦ãŒFirestoreã¨ã®æ¯”è¼ƒåŸºæº–ã«ãªã‚Šã¾ã™`;

        showResult(2, 'success', message);

      } catch (error) {
        const message = `âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ search_inventory APIã®å®Ÿè£…å•é¡Œ
â€¢ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®èª­ã¿å–ã‚Šæ¨©é™å•é¡Œ
â€¢ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ä¸ä¸€è‡´`;

        showResult(2, 'error', message);
        console.error('[Test 2 Error]', error);
      }
    }

    // Test 3: è¤‡æ•°APIåŒæ™‚å‘¼ã³å‡ºã—
    async function runTest3() {
      try {
        showResult(3, 'loading', 'ä¸¦åˆ—å®Ÿè¡Œä¸­...');

        const startTime = performance.now();

        // 3ã¤ã®APIã‚’åŒæ™‚ã«å‘¼ã³å‡ºã—
        const [testResult, productListResult, userCountResult] = await Promise.all([
          GasApi.testGasApi(),
          GasApi.searchInventory({}),
          GasApi.getExistingUserCount()
        ]);

        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const message = `âœ… ä¸¦åˆ—å®Ÿè¡ŒæˆåŠŸï¼

ã€å®Ÿè¡Œçµæœã€‘
â€¢ testGasApi: ${testResult.status}
â€¢ searchInventory: ${Array.isArray(productListResult) ? productListResult.length + 'ä»¶å–å¾—' : 'OK'}
â€¢ getExistingUserCount: ${userCountResult}äºº

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ è¤‡æ•°APIã‚’ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã—ãŸ
âœ“ å…¨ã¦ã®APIãŒæ­£å¸¸ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã—ãŸ
âœ“ ä¸¦åˆ—å®Ÿè¡Œã«ã‚ˆã‚Šé«˜é€ŸåŒ–ãŒå®Ÿç¾ã—ã¦ã„ã¾ã™

ã€å‚è€ƒã€‘
iframeçµŒç”±ã®å ´åˆ: ç´„2000-3000msÃ—3 = 6000-9000ms
ç›´æ¥APIå‘¼ã³å‡ºã—: ${duration}ms
â†’ ç´„${Math.round((6000 / duration))}å€ã®é«˜é€ŸåŒ–ï¼`;

        showResult(3, 'success', message);

      } catch (error) {
        const message = `âŒ ä¸¦åˆ—å®Ÿè¡Œå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ ä¸€éƒ¨ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæœªå®Ÿè£…
â€¢ åŒæ™‚å®Ÿè¡Œã«ã‚ˆã‚‹è² è·å•é¡Œ
â€¢ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®å•é¡Œ`;

        showResult(3, 'error', message);
        console.error('[Test 3 Error]', error);
      }
    }

    // Test 4: Firestoreç›´æ¥èª­ã¿è¾¼ã¿
    async function runTest4() {
      try {
        showResult(4, 'loading', 'Firestoreã‹ã‚‰èª­ã¿è¾¼ã¿ä¸­...');

        const startTime = performance.now();
        const result = await FirestoreApi.getProductListFromFirestore();
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const productCount = Array.isArray(result) ? result.length : 0;
        const message = `âœ… Firestoreèª­ã¿è¾¼ã¿æˆåŠŸï¼

ã€å–å¾—çµæœã€‘
å•†å“æ•°: ${productCount}ä»¶

${Array.isArray(result) ? JSON.stringify(result.slice(0, 2), null, 2) + (result.length > 2 ? '\n... ä»– ' + (result.length - 2) + 'ä»¶' : '') : JSON.stringify(result, null, 2)}

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã€‘
â€¢ GAS API: 3800ms
â€¢ Firestore: ${duration}ms
â€¢ é«˜é€ŸåŒ–ç‡: ç´„${Math.round(3800 / duration)}å€

ã€ç¢ºèªäº‹é …ã€‘
âœ“ Firestoreã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ
âœ“ æœŸå¾…å€¤(50-300ms)${duration < 300 ? 'å†…' : 'å¤–'}ã®å¿œç­”æ™‚é–“`;

        showResult(4, 'success', message);

      } catch (error) {
        const message = `âŒ Firestoreèª­ã¿è¾¼ã¿å¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ Firebaseã®åˆæœŸåŒ–å¤±æ•—
â€¢ Firestoreã®å•†å“ãƒ‡ãƒ¼ã‚¿ãŒæœªç§»è¡Œ
â€¢ æ¨©é™è¨­å®šã®å•é¡Œ
â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼`;

        showResult(4, 'error', message);
        console.error('[Test 4 Error]', error);
      }
    }

    // Test 5: Firestoreã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ã
    async function runTest5() {
      try {
        showResult(5, 'loading', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ + èª­ã¿è¾¼ã¿ä¸­...');

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
        FirestoreApi.clearProductListCache();

        // 1å›ç›®: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—
        const startTime1 = performance.now();
        const result1 = await FirestoreApi.getProductList();
        const endTime1 = performance.now();
        const duration1 = (endTime1 - startTime1).toFixed(0);

        // å°‘ã—å¾…ã¤
        await new Promise(resolve => setTimeout(resolve, 100));

        // 2å›ç›®: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Š
        const startTime2 = performance.now();
        const result2 = await FirestoreApi.getProductList();
        const endTime2 = performance.now();
        const duration2 = (endTime2 - startTime2).toFixed(2);

        const productCount = Array.isArray(result1) ? result1.length : 0;
        const message = `âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ç¢ºèªå®Œäº†ï¼

ã€å–å¾—çµæœã€‘
å•†å“æ•°: ${productCount}ä»¶

ã€å®Ÿè¡Œæ™‚é–“æ¯”è¼ƒã€‘
â€¢ 1å›ç›®(Firestoreèª­ã¿è¾¼ã¿): ${duration1}ms
â€¢ 2å›ç›®(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ): ${duration2}ms
â€¢ ã‚­ãƒ£ãƒƒã‚·ãƒ¥é«˜é€ŸåŒ–: ç´„${Math.round(duration1 / duration2)}å€

ã€ç¢ºèªäº‹é …ã€‘
âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œ
âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚ã®è¶…é«˜é€Ÿå¿œç­”(<5ms)ã‚’ç¢ºèª
âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™: 5åˆ†`;

        showResult(5, 'success', message);

      } catch (error) {
        const message = `âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ Firestoreèª­ã¿è¾¼ã¿ã®å¤±æ•—
â€¢ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…å•é¡Œ`;

        showResult(5, 'error', message);
        console.error('[Test 5 Error]', error);
      }
    }

    // Test 6: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰
    async function runTest6() {
      try {
        showResult(6, 'loading', 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆä¸­...');

        const startTime = performance.now();
        const result = await FirestoreApi.getProductListHybrid({}, true);
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(0);

        const productCount = Array.isArray(result) ? result.length : 0;
        const message = `âœ… ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰å‹•ä½œç¢ºèªï¼

ã€å–å¾—çµæœã€‘
å•†å“æ•°: ${productCount}ä»¶

ã€å®Ÿè¡Œæ™‚é–“ã€‘
${duration}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ Firestoreå„ªå…ˆã§å–å¾—è©¦è¡Œ
âœ“ Firestoreå¤±æ•—æ™‚ã¯GAS APIã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
âœ“ ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¿¡é ¼æ€§ç¢ºä¿

ã€ä½¿ç”¨APIã€‘
${duration < 1000 ? 'â†’ Firestoreã‹ã‚‰å–å¾—' : 'â†’ GAS APIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯'}`;

        showResult(6, 'success', message);

      } catch (error) {
        const message = `âŒ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ Firestoreã¨GAS APIä¸¡æ–¹ã®å¤±æ•—
â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡æ–­`;

        showResult(6, 'error', message);
        console.error('[Test 6 Error]', error);
      }
    }

    // Test 7: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœç¢ºèª
    async function runTest7() {
      try {
        showResult(7, 'loading', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœæ¸¬å®šä¸­...');

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
        FirestoreApi.clearProductListCache();

        // åˆå›èª­ã¿è¾¼ã¿ï¼ˆFirestoreï¼‰
        const startTime1 = performance.now();
        await FirestoreApi.getProductList();
        const endTime1 = performance.now();
        const firstLoad = (endTime1 - startTime1).toFixed(0);

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼ˆ2å›ç›®ï¼‰
        const startTime2 = performance.now();
        await FirestoreApi.getProductList();
        const endTime2 = performance.now();
        const cachedLoad = (endTime2 - startTime2).toFixed(2);

        // GAS APIã¨ã®æ¯”è¼ƒç”¨ï¼ˆå‚è€ƒå€¤ï¼‰
        const gasApiTime = 3800; // å‰å›æ¸¬å®šå€¤

        const message = `âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœæ¸¬å®šå®Œäº†ï¼

ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã€‘
1. GAS API: ${gasApiTime}ms
2. Firestore(åˆå›): ${firstLoad}ms â†’ ${Math.round(gasApiTime / firstLoad)}å€é«˜é€ŸåŒ–
3. Cache(2å›ç›®): ${cachedLoad}ms â†’ ${Math.round(gasApiTime / cachedLoad)}å€é«˜é€ŸåŒ–

ã€æ”¹å–„åŠ¹æœã¾ã¨ã‚ã€‘
â€¢ GAS â†’ Firestore: ç´„${Math.round(gasApiTime / firstLoad)}å€ã®é«˜é€ŸåŒ–
â€¢ Firestore â†’ Cache: ç´„${Math.round(firstLoad / cachedLoad)}å€ã®é«˜é€ŸåŒ–
â€¢ GAS â†’ Cache: ç´„${Math.round(gasApiTime / cachedLoad)}å€ã®é«˜é€ŸåŒ–

ã€çµè«–ã€‘
âœ“ Firestoreç§»è¡Œã«ã‚ˆã‚ŠåŠ‡çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚Šã•ã‚‰ãªã‚‹é«˜é€ŸåŒ–ã‚’å®Ÿç¾
âœ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒå¤§å¹…ã«å‘ä¸Š`;

        showResult(7, 'success', message);

      } catch (error) {
        const message = `âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœæ¸¬å®šå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ Firestoreèª­ã¿è¾¼ã¿ã®å¤±æ•—
â€¢ æ¸¬å®šå‡¦ç†ã®å•é¡Œ`;

        showResult(7, 'error', message);
        console.error('[Test 7 Error]', error);
      }
    }

    // Test 8: ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢ãƒ†ã‚¹ãƒˆ
    async function runTest8() {
      try {
        showResult(8, 'loading', 'ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢å®Ÿè¡Œä¸­...');

        // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿
        const startTime1 = performance.now();
        const result1 = await FirestoreApi.getProductList({ status: 'åœ¨åº«' });
        const endTime1 = performance.now();
        const duration1 = (endTime1 - startTime1).toFixed(0);

        // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼šãƒ–ãƒ©ãƒ³ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿
        const startTime2 = performance.now();
        const result2 = await FirestoreApi.getProductList({ brand: 'NIKE' });
        const endTime2 = performance.now();
        const duration2 = (endTime2 - startTime2).toFixed(0);

        const count1 = Array.isArray(result1) ? result1.length : 0;
        const count2 = Array.isArray(result2) ? result2.length : 0;

        const message = `âœ… ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢æˆåŠŸï¼

ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹='åœ¨åº«'ã€‘
â€¢ å–å¾—ä»¶æ•°: ${count1}ä»¶
â€¢ å®Ÿè¡Œæ™‚é–“: ${duration1}ms

ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ãƒ–ãƒ©ãƒ³ãƒ‰='NIKE'ã€‘
â€¢ å–å¾—ä»¶æ•°: ${count2}ä»¶
â€¢ å®Ÿè¡Œæ™‚é–“: ${duration2}ms

ã€ç¢ºèªäº‹é …ã€‘
âœ“ Firestoreã®whereå¥ãƒ•ã‚£ãƒ«ã‚¿ãŒæ­£å¸¸å‹•ä½œ
âœ“ æ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—
âœ“ ãƒ•ã‚£ãƒ«ã‚¿å¾Œã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å‹•ä½œã›ãšã€å¸¸ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—`;

        showResult(8, 'success', message);

      } catch (error) {
        const message = `âŒ ãƒ•ã‚£ãƒ«ã‚¿æ¤œç´¢å¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘
${error.message}

ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘
â€¢ Firestoreã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒæœªä½œæˆ
â€¢ ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£
â€¢ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸ä¸€è‡´`;

        showResult(8, 'error', message);
        console.error('[Test 8 Error]', error);
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ§ª å•†å“APIçµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†');
      console.log('ğŸ“ GasApi ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', window.GasApi);
      console.log('ğŸ“ FirestoreApi ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', window.FirestoreApi);

      // GasApiãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
      if (!window.GasApi) {
        alert('âš ï¸ api.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      }

      // FirestoreApiãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆå°‘ã—å¾…ã¤ï¼‰
      setTimeout(() => {
        if (!window.FirestoreApi) {
          console.warn('âš ï¸ firestore-api.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
        }
      }, 1000);
    });
  </script>
</body>
</html>
