<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- v310: ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆéŸ³å£°å…¥åŠ›å¯¾å¿œ -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ãƒ˜ãƒ«ãƒ— - ãƒ•ãƒªãƒ©</title>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/reborn-brand-colors.css?v=9635">
  <link rel="stylesheet" href="/css/reborn-theme.css?v=9635">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .help-header {
      background: linear-gradient(135deg, var(--reborn-primary, #40B4E5) 0%, var(--reborn-primary-dark, #1E8FBF) 100%);
      padding: 24px 20px;
      color: white;
      text-align: center;
    }

    .help-header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .help-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .help-container {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }

    .help-section {
      background: white;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .help-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #6b7280;
      padding: 12px 16px 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .help-item {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      border-bottom: 1px solid #f3f4f6;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      color: inherit;
    }

    .help-item:last-child {
      border-bottom: none;
    }

    .help-item:active {
      background: #f9fafb;
    }

    .help-item-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--reborn-primary-lightest, #E8F7FC);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .help-item-icon i {
      font-size: 20px;
      color: var(--reborn-primary, #40B4E5);
    }

    .help-item-content {
      flex: 1;
    }

    .help-item-title {
      font-size: 15px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 2px;
    }

    .help-item-desc {
      font-size: 13px;
      color: #6b7280;
    }

    .help-item-arrow {
      color: #9ca3af;
      font-size: 18px;
    }

    /* FAQ ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ */
    .faq-item {
      border-bottom: 1px solid #f3f4f6;
    }

    .faq-item:last-child {
      border-bottom: none;
    }

    .faq-question {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .faq-question:active {
      background: #f9fafb;
    }

    .faq-question-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--reborn-primary, #40B4E5);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .faq-question-text {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
    }

    .faq-toggle {
      color: #9ca3af;
      font-size: 18px;
      transition: transform 0.3s;
    }

    .faq-item.open .faq-toggle {
      transform: rotate(180deg);
    }

    .faq-answer {
      display: none;
      padding: 0 16px 14px 56px;
      font-size: 14px;
      color: #4b5563;
      line-height: 1.6;
    }

    .faq-item.open .faq-answer {
      display: block;
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .help-footer {
      padding: 24px 20px;
      text-align: center;
    }

    .help-footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 12px;
    }

    .help-footer-links a {
      color: #6b7280;
      font-size: 13px;
      text-decoration: none;
    }

    .help-footer-links a:hover {
      color: var(--reborn-primary);
      text-decoration: underline;
    }

    .help-footer-copyright {
      color: #9ca3af;
      font-size: 12px;
    }

    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
    .back-button {
      position: absolute;
      top: 20px;
      left: 16px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 20px;
    }

    .back-button:active {
      background: rgba(255, 255, 255, 0.3);
    }

    /* v288: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
    .menu-button {
      position: absolute;
      top: 20px;
      right: 16px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 20px;
    }

    .menu-button:active {
      background: rgba(255, 255, 255, 0.3);
    }

    .help-header {
      position: relative;
    }

    /* ========================================
       AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ UI
       ======================================== */

    /* ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆFABï¼‰ */
    .chat-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--reborn-primary, #40B4E5) 0%, var(--reborn-primary-dark, #1E8FBF) 100%);
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(64, 180, 229, 0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      z-index: 1000;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .chat-fab:active {
      transform: scale(0.95);
    }

    .chat-fab:hover {
      box-shadow: 0 6px 16px rgba(64, 180, 229, 0.5);
    }

    .chat-fab .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ef4444;
      color: white;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 10px;
      display: none;
    }

    /* ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« */
    .chat-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      top: 0;
      background: white;
      z-index: 1001;
      display: none;
      flex-direction: column;
    }

    .chat-panel.open {
      display: flex;
    }

    @media (min-width: 480px) {
      .chat-panel {
        bottom: 100px;
        right: 24px;
        left: auto;
        top: auto;
        width: 380px;
        height: 520px;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }
    }

    /* ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ */
    .chat-header {
      background: linear-gradient(135deg, var(--reborn-primary, #40B4E5) 0%, var(--reborn-primary-dark, #1E8FBF) 100%);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    @media (min-width: 480px) {
      .chat-header {
        border-radius: 16px 16px 0 0;
      }
    }

    .chat-header-avatar {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .chat-header-info {
      flex: 1;
    }

    .chat-header-title {
      font-size: 16px;
      font-weight: 600;
    }

    .chat-header-status {
      font-size: 12px;
      opacity: 0.9;
    }

    .chat-close-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    /* ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .chat-message {
      max-width: 85%;
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
    }

    .chat-message.user {
      align-self: flex-end;
      background: var(--reborn-primary, #40B4E5);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .chat-message.ai {
      align-self: flex-start;
      background: white;
      color: #1f2937;
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .chat-message.ai.typing {
      color: #9ca3af;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 4px 0;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #9ca3af;
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-indicator span:nth-child(1) { animation-delay: 0s; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-4px); opacity: 1; }
    }

    /* ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .chat-welcome {
      text-align: center;
      padding: 20px;
      color: #6b7280;
    }

    .chat-welcome-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .chat-welcome-title {
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 4px;
    }

    .chat-welcome-desc {
      font-size: 13px;
    }

    /* ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
    .chat-quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 12px 16px;
      background: white;
      border-top: 1px solid #e5e7eb;
    }

    .quick-action-btn {
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 6px 12px;
      font-size: 12px;
      color: #374151;
      cursor: pointer;
      transition: background 0.2s;
    }

    .quick-action-btn:active {
      background: #e5e7eb;
    }

    /* ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ */
    .chat-input-area {
      padding: 12px 16px;
      background: white;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    @media (min-width: 480px) {
      .chat-input-area {
        border-radius: 0 0 16px 16px;
      }
    }

    .chat-input {
      flex: 1;
      border: 1px solid #e5e7eb;
      border-radius: 20px;
      padding: 10px 16px;
      font-size: 14px;
      resize: none;
      max-height: 100px;
      min-height: 40px;
      line-height: 1.4;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input:focus {
      border-color: var(--reborn-primary, #40B4E5);
    }

    .chat-send-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--reborn-primary, #40B4E5);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
      transition: background 0.2s, opacity 0.2s;
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .chat-send-btn:not(:disabled):active {
      background: var(--reborn-primary-dark, #1E8FBF);
    }

    /* éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ */
    .chat-voice-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .chat-voice-btn:hover {
      background: #e5e7eb;
    }

    .chat-voice-btn.recording {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
      animation: pulse-recording 1.5s infinite;
    }

    .chat-voice-btn.not-supported {
      display: none;
    }

    @keyframes pulse-recording {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
    }
  </style>
</head>
<body>
  <div class="help-header">
    <button class="back-button" onclick="goBack()" title="æˆ»ã‚‹">
      <i class="bi bi-chevron-left"></i>
    </button>
    <h1>ãƒ˜ãƒ«ãƒ—</h1>
    <p>ãŠå›°ã‚Šã®éš›ã¯ã“ã¡ã‚‰ã‚’ã”ç¢ºèªãã ã•ã„</p>
    <button class="menu-button" onclick="window.parent.postMessage({type:'toggleDrawer'}, '*')" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
      <i class="bi bi-list"></i>
    </button>
  </div>

  <div class="help-container">
    <!-- ã‚ˆãã‚ã‚‹è³ªå• -->
    <div class="help-section">
      <div class="help-section-title">ã‚ˆãã‚ã‚‹è³ªå•</div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-question">
          <span class="faq-question-icon">Q</span>
          <span class="faq-question-text">å•†å“ã‚’ç™»éŒ²ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ</span>
          <i class="bi bi-chevron-down faq-toggle"></i>
        </div>
        <div class="faq-answer">
          ç”»é¢ä¸‹éƒ¨ã®ã€Œç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã‹ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œå•†å“ç™»éŒ²ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚ã‚«ãƒ¡ãƒ©ã§å•†å“ã‚’æ’®å½±ã—ã€å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-question">
          <span class="faq-question-icon">Q</span>
          <span class="faq-question-text">ãƒãƒ£ãƒƒãƒˆã§é€šçŸ¥ãŒå±Šãã¾ã›ã‚“</span>
          <i class="bi bi-chevron-down faq-toggle"></i>
        </div>
        <div class="faq-answer">
          1. ç«¯æœ«ã®é€šçŸ¥è¨­å®šã§ãƒ•ãƒªãƒ©ã®é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
          2. ãƒã‚¤ãƒšãƒ¼ã‚¸â†’åŸºæœ¬è¨­å®šã‹ã‚‰é€šçŸ¥è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
          3. ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-question">
          <span class="faq-question-icon">Q</span>
          <span class="faq-question-text">ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã«ä¿å­˜ã•ã‚Œã¾ã™ã‹ï¼Ÿ</span>
          <i class="bi bi-chevron-down faq-toggle"></i>
        </div>
        <div class="faq-answer">
          ãƒ‡ãƒ¼ã‚¿ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆFirestoreï¼‰ã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒã‚ã‚Œã°ã€ã©ã®ç«¯æœ«ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-question">
          <span class="faq-question-icon">Q</span>
          <span class="faq-question-text">ã‚¢ãƒ—ãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã«ã¯ï¼Ÿ</span>
          <i class="bi bi-chevron-down faq-toggle"></i>
        </div>
        <div class="faq-answer">
          ãƒ•ãƒªãƒ©ã¯PWAï¼ˆProgressive Web Appï¼‰ã®ãŸã‚ã€è‡ªå‹•çš„ã«æœ€æ–°ç‰ˆã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æ›´æ–°ãŒåæ˜ ã•ã‚Œãªã„å ´åˆã¯ã€ã‚¢ãƒ—ãƒªã‚’å®Œå…¨ã«çµ‚äº†ã—ã¦ã‹ã‚‰å†åº¦é–‹ã„ã¦ãã ã•ã„ã€‚
        </div>
      </div>
    </div>

    <!-- æ“ä½œã‚¬ã‚¤ãƒ‰ -->
    <div class="help-section">
      <div class="help-section-title">æ“ä½œã‚¬ã‚¤ãƒ‰</div>

      <a class="help-item" href="#" onclick="showGuide('product'); return false;">
        <div class="help-item-icon">
          <i class="bi bi-camera"></i>
        </div>
        <div class="help-item-content">
          <div class="help-item-title">å•†å“ç™»éŒ²ã®ä½¿ã„æ–¹</div>
          <div class="help-item-desc">å†™çœŸæ’®å½±ã‹ã‚‰ç™»éŒ²å®Œäº†ã¾ã§</div>
        </div>
        <i class="bi bi-chevron-right help-item-arrow"></i>
      </a>

      <a class="help-item" href="#" onclick="showGuide('inventory'); return false;">
        <div class="help-item-icon">
          <i class="bi bi-box-seam"></i>
        </div>
        <div class="help-item-content">
          <div class="help-item-title">åœ¨åº«ç®¡ç†ã®ä½¿ã„æ–¹</div>
          <div class="help-item-desc">åœ¨åº«ç¢ºèªãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´</div>
        </div>
        <i class="bi bi-chevron-right help-item-arrow"></i>
      </a>

      <a class="help-item" href="#" onclick="showGuide('chat'); return false;">
        <div class="help-item-icon">
          <i class="bi bi-chat"></i>
        </div>
        <div class="help-item-content">
          <div class="help-item-title">ãƒãƒ£ãƒƒãƒˆã®ä½¿ã„æ–¹</div>
          <div class="help-item-desc">ãƒãƒ¼ãƒ é€£çµ¡ãƒ»é€šçŸ¥è¨­å®š</div>
        </div>
        <i class="bi bi-chevron-right help-item-arrow"></i>
      </a>
    </div>

    <!-- ãŠå•ã„åˆã‚ã› -->
    <div class="help-section">
      <div class="help-section-title">ã‚µãƒãƒ¼ãƒˆ</div>

      <a class="help-item" href="mailto:support@furira.jp">
        <div class="help-item-icon">
          <i class="bi bi-envelope"></i>
        </div>
        <div class="help-item-content">
          <div class="help-item-title">ãƒ¡ãƒ¼ãƒ«ã§ãŠå•ã„åˆã‚ã›</div>
          <div class="help-item-desc">support@furira.jp</div>
        </div>
        <i class="bi bi-chevron-right help-item-arrow"></i>
      </a>
    </div>

    <!-- ã‚¢ãƒ—ãƒªæƒ…å ± -->
    <div class="help-section">
      <div class="help-section-title">ã‚¢ãƒ—ãƒªæƒ…å ±</div>

      <div class="help-item" style="cursor: default;">
        <div class="help-item-icon">
          <i class="bi bi-info-circle"></i>
        </div>
        <div class="help-item-content">
          <div class="help-item-title">ãƒãƒ¼ã‚¸ãƒ§ãƒ³</div>
          <div class="help-item-desc" id="app-version">v287</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <div class="help-footer">
    <div class="help-footer-links">
      <a href="/privacy-policy.html" target="_blank">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
      <a href="/terms-of-service.html" target="_blank">åˆ©ç”¨è¦ç´„</a>
    </div>
    <div class="help-footer-copyright">&copy; 2025 ãƒ•ãƒªãƒ©</div>
  </div>

  <!-- AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ FAB -->
  <button class="chat-fab" onclick="toggleChatPanel()" title="AIã«è³ªå•ã™ã‚‹">
    <i class="bi bi-chat-dots-fill"></i>
  </button>

  <!-- AIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      <div class="chat-header-avatar">ğŸ¤–</div>
      <div class="chat-header-info">
        <div class="chat-header-title">ãƒ•ãƒªãƒ© AIã‚µãƒãƒ¼ãƒˆ</div>
        <div class="chat-header-status">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</div>
      </div>
      <button class="chat-close-btn" onclick="toggleChatPanel()">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <div class="chat-messages" id="chatMessages">
      <div class="chat-welcome">
        <div class="chat-welcome-icon">ğŸ‘‹</div>
        <div class="chat-welcome-title">ã“ã‚“ã«ã¡ã¯ï¼</div>
        <div class="chat-welcome-desc">ãƒ•ãƒªãƒ©ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ä½•ã§ã‚‚èã„ã¦ãã ã•ã„</div>
      </div>
    </div>

    <div class="chat-quick-actions" id="quickActions">
      <button class="quick-action-btn" onclick="sendQuickMessage('å•†å“ç™»éŒ²ã®æ–¹æ³•ã‚’æ•™ãˆã¦')">ğŸ“¦ å•†å“ç™»éŒ²ã®æ–¹æ³•</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('é€šçŸ¥ãŒå±Šã‹ãªã„')">ğŸ”” é€šçŸ¥ãŒå±Šã‹ãªã„</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('åœ¨åº«ç®¡ç†ã®ä½¿ã„æ–¹')">ğŸ“Š åœ¨åº«ç®¡ç†</button>
    </div>

    <div class="chat-input-area">
      <textarea
        class="chat-input"
        id="chatInput"
        placeholder="è³ªå•ã‚’å…¥åŠ›..."
        rows="1"
        onkeydown="handleKeyDown(event)"
        oninput="autoResize(this)"
      ></textarea>
      <button class="chat-voice-btn" id="chatVoiceBtn" onclick="toggleVoiceInput()" title="éŸ³å£°å…¥åŠ›">
        <i class="bi bi-mic-fill"></i>
      </button>
      <button class="chat-send-btn" id="chatSendBtn" onclick="sendMessage()" disabled>
        <i class="bi bi-send-fill"></i>
      </button>
    </div>
  </div>

  <script>
    // FAQã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³
    function toggleFaq(element) {
      // ä»–ã®FAQã‚’é–‰ã˜ã‚‹
      document.querySelectorAll('.faq-item.open').forEach(item => {
        if (item !== element) {
          item.classList.remove('open');
        }
      });
      // ã‚¯ãƒªãƒƒã‚¯ã—ãŸFAQã‚’ãƒˆã‚°ãƒ«
      element.classList.toggle('open');
    }

    // æ“ä½œã‚¬ã‚¤ãƒ‰è¡¨ç¤ºï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
    function showGuide(type) {
      // TODO: è©³ç´°ã‚¬ã‚¤ãƒ‰ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã¾ãŸã¯ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
      alert('ã€Œ' + type + 'ã€ã®ã‚¬ã‚¤ãƒ‰ã¯æº–å‚™ä¸­ã§ã™ã€‚');
    }

    // æˆ»ã‚‹ãƒœã‚¿ãƒ³
    function goBack() {
      // è¦ªãƒ•ãƒ¬ãƒ¼ãƒ ã«æˆ»ã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'requestBack' }, '*');
      } else {
        window.history.back();
      }
    }

    // ========================================
    // AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ©Ÿèƒ½
    // ========================================

    // Cloudflare Worker ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    const CHATBOT_API_ENDPOINT = 'https://reborn-help-chatbot.mercari-yasuhirotakuji.workers.dev/chat';

    // ä¼šè©±å±¥æ­´ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¶­æŒç”¨ï¼‰
    let conversationHistory = [];

    // ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ã®é–‹é–‰
    function toggleChatPanel() {
      const panel = document.getElementById('chatPanel');
      panel.classList.toggle('open');

      if (panel.classList.contains('open')) {
        document.getElementById('chatInput').focus();
      }
    }

    // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•ãƒªã‚µã‚¤ã‚º
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';

      // é€ä¿¡ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
      const sendBtn = document.getElementById('chatSendBtn');
      sendBtn.disabled = !textarea.value.trim();
    }

    // Enterã‚­ãƒ¼ã§é€ä¿¡ï¼ˆShift+Enterã¯æ”¹è¡Œï¼‰
    function handleKeyDown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // ã‚¯ã‚¤ãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    function sendQuickMessage(message) {
      document.getElementById('chatInput').value = message;
      sendMessage();
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();

      if (!message) return;

      // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
      input.value = '';
      autoResize(input);
      document.getElementById('chatSendBtn').disabled = true;

      // ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
      document.getElementById('quickActions').style.display = 'none';

      // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
      const welcome = document.querySelector('.chat-welcome');
      if (welcome) welcome.remove();

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      addMessage(message, 'user');

      // ä¼šè©±å±¥æ­´ã«è¿½åŠ 
      conversationHistory.push({ role: 'user', content: message });

      // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤º
      const typingId = showTypingIndicator();

      try {
        // APIã‚’å‘¼ã³å‡ºã—
        const response = await fetch(CHATBOT_API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: message,
            history: conversationHistory.slice(-10) // ç›´è¿‘10ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦é€ä¿¡
          }),
        });

        // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
        removeTypingIndicator(typingId);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error);
        }

        const aiResponse = data.response || 'ã™ã¿ã¾ã›ã‚“ã€å›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚';

        // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        addMessage(aiResponse, 'ai');

        // ä¼šè©±å±¥æ­´ã«è¿½åŠ 
        conversationHistory.push({ role: 'assistant', content: aiResponse });

      } catch (error) {
        console.error('ãƒãƒ£ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
        removeTypingIndicator(typingId);

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        addMessage('ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ç¾åœ¨AIã‚µãƒãƒ¼ãƒˆã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãçµŒã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ã„ãŸã ãã‹ã€ãƒ¡ãƒ¼ãƒ«ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚', 'ai');
      }
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
    function addMessage(text, type) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${type}`;
      messageDiv.textContent = text;
      messagesContainer.appendChild(messageDiv);

      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤º
    function showTypingIndicator() {
      const messagesContainer = document.getElementById('chatMessages');
      const typingDiv = document.createElement('div');
      const typingId = 'typing-' + Date.now();
      typingDiv.id = typingId;
      typingDiv.className = 'chat-message ai typing';
      typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
      messagesContainer.appendChild(typingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return typingId;
    }

    // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
    function removeTypingIndicator(typingId) {
      const typingDiv = document.getElementById(typingId);
      if (typingDiv) {
        typingDiv.remove();
      }
    }

    // å…¥åŠ›ç›£è¦–ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      const input = document.getElementById('chatInput');
      if (input) {
        input.addEventListener('input', function() {
          autoResize(this);
        });
      }
    });

    // ========================================
    // éŸ³å£°å…¥åŠ›æ©Ÿèƒ½ï¼ˆWeb Speech APIï¼‰
    // ========================================

    let recognition = null;
    let isRecording = false;

    // Web Speech API ã®åˆæœŸåŒ–
    function initVoiceInput() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const voiceBtn = document.getElementById('chatVoiceBtn');

      if (!SpeechRecognition) {
        // éŸ³å£°èªè­˜éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
        if (voiceBtn) {
          voiceBtn.classList.add('not-supported');
        }
        console.log('Web Speech API not supported');
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'ja-JP';
      recognition.continuous = false;
      recognition.interimResults = true;

      recognition.onstart = function() {
        isRecording = true;
        if (voiceBtn) {
          voiceBtn.classList.add('recording');
          voiceBtn.querySelector('i').className = 'bi bi-stop-fill';
        }
      };

      recognition.onend = function() {
        isRecording = false;
        if (voiceBtn) {
          voiceBtn.classList.remove('recording');
          voiceBtn.querySelector('i').className = 'bi bi-mic-fill';
        }
      };

      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        isRecording = false;
        if (voiceBtn) {
          voiceBtn.classList.remove('recording');
          voiceBtn.querySelector('i').className = 'bi bi-mic-fill';
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        if (event.error === 'no-speech') {
          showVoiceError('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
        } else if (event.error === 'not-allowed') {
          showVoiceError('ãƒã‚¤ã‚¯ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        } else {
          showVoiceError('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      };

      recognition.onresult = function(event) {
        const input = document.getElementById('chatInput');
        const sendBtn = document.getElementById('chatSendBtn');
        let finalTranscript = '';
        let interimTranscript = '';

        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript;
          } else {
            interimTranscript += transcript;
          }
        }

        // ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›æ¬„ã«è¿½åŠ 
        if (finalTranscript) {
          const currentValue = input.value;
          input.value = currentValue + (currentValue ? ' ' : '') + finalTranscript;
          autoResize(input);
          if (sendBtn) {
            sendBtn.disabled = !input.value.trim();
          }
        }
      };
    }

    // éŸ³å£°å…¥åŠ›ã®é–‹å§‹/åœæ­¢ãƒˆã‚°ãƒ«
    function toggleVoiceInput() {
      if (!recognition) {
        showVoiceError('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
        return;
      }

      if (isRecording) {
        recognition.stop();
      } else {
        try {
          recognition.start();
        } catch (e) {
          console.error('Failed to start recognition:', e);
        }
      }
    }

    // éŸ³å£°ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showVoiceError(message) {
      // ä¸€æ™‚çš„ãªãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 13px;
        z-index: 9999;
        animation: fadeInOut 3s ease-in-out;
      `;
      toast.textContent = message;

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 
      if (!document.getElementById('voiceToastStyle')) {
        const style = document.createElement('style');
        style.id = 'voiceToastStyle';
        style.textContent = `
          @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
          }
        `;
        document.head.appendChild(style);
      }

      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«éŸ³å£°å…¥åŠ›ã‚’åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', initVoiceInput);
  </script>
</body>
</html>
