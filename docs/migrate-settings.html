<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - FURIRA</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .card { background: #f5f5f5; border-radius: 8px; padding: 20px; margin: 20px 0; }
    pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 12px; }
    button { background: #40B4E5; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
    button:hover { background: #1E8FBF; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .success { color: #22c55e; }
    .error { color: #ef4444; }
    .warning { color: #f59e0b; }
    #status { margin-top: 20px; padding: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ“¦ è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>

  <div class="card">
    <h2>ç¾åœ¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</h2>
    <p>ä»¥ä¸‹ã®å€¤ã‚’Firestoreã«ä¿å­˜ã—ã¾ã™ï¼š</p>

    <h3>å‰²å¼•æƒ…å ±</h3>
    <pre id="discountPreview"></pre>

    <h3>ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°</h3>
    <pre id="hashtagPreview"></pre>
  </div>

  <div class="card">
    <h2>æ“ä½œ</h2>
    <button id="checkBtn">ç¾åœ¨ã®Firestoreè¨­å®šã‚’ç¢ºèª</button>
    <button id="migrateBtn">Firestoreã«ä¿å­˜</button>
  </div>

  <div id="status"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyA4hNktMqmUBArzKRpMt_Q9f5EiL0xlegk",
      authDomain: "furira.jp",
      projectId: "reborn-chat",
      storageBucket: "reborn-chat.firebasestorage.app",
      messagingSenderId: "618498936498",
      appId: "1:618498936498:web:ccd51d56455cb34261c4ba",
      measurementId: "G-LT40ET0CXZ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ç¾åœ¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    const discountConfig = {
      'ãƒ•ã‚©ãƒ­ãƒ¼å‰²': [
        { 'ç¯„å›²': 'ã€œ2,999å††', 'å‰²å¼•é¡': '100å††å¼•' },
        { 'ç¯„å›²': 'ã€œ5,999å††', 'å‰²å¼•é¡': '200å††å¼•' },
        { 'ç¯„å›²': 'ã€œ8,999å††', 'å‰²å¼•é¡': '300å††å¼•' },
        { 'ç¯„å›²': '9,000å††ã€œ', 'å‰²å¼•é¡': '500å††å¼•' }
      ],
      'ãƒªãƒ”ãƒ¼ãƒˆå‰²': [
        { 'ç¯„å›²': '', 'å‰²å¼•é¡': '200å††å¼•' }
      ],
      'ã¾ã¨ã‚å‰²': [
        { 'ç¯„å›²': '2ç‚¹', 'å‰²å¼•é¡': '300å††' },
        { 'ç¯„å›²': '3ç‚¹', 'å‰²å¼•é¡': '500å††' },
        { 'ç¯„å›²': '4ç‚¹', 'å‰²å¼•é¡': '1,000å††' }
      ]
    };

    const hashtagConfig = {
      commonPrefix: '#REBORN_',
      hashtags: [
        {
          title: 'å…¨å•†å“',
          suffix: 'å…¨å•†å“',
          icon: 'ğŸ·ï¸',
          defaultChecked: true
        }
      ]
    };

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    document.getElementById('discountPreview').textContent = JSON.stringify(discountConfig, null, 2);
    document.getElementById('hashtagPreview').textContent = JSON.stringify(hashtagConfig, null, 2);

    const statusDiv = document.getElementById('status');

    function showStatus(message, type = 'info') {
      const color = type === 'success' ? '#dcfce7' : type === 'error' ? '#fee2e2' : type === 'warning' ? '#fef3c7' : '#e0f2fe';
      statusDiv.innerHTML = `<div style="background: ${color}; padding: 15px; border-radius: 8px;">${message}</div>`;
    }

    // ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèª
    document.getElementById('checkBtn').addEventListener('click', async () => {
      showStatus('Firestoreã‚’ç¢ºèªä¸­...');
      try {
        const docRef = db.collection('settings').doc('common');
        const doc = await docRef.get();

        if (doc.exists) {
          const data = doc.data();
          let html = '<h3>ç¾åœ¨ã®Firestoreè¨­å®š:</h3>';
          html += '<pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px;">';
          html += 'discount: ' + (data.discount ? JSON.stringify(data.discount, null, 2) : '(æœªè¨­å®š)') + '\n\n';
          html += 'hashtag: ' + (data.hashtag ? JSON.stringify(data.hashtag, null, 2) : '(æœªè¨­å®š)');
          html += '</pre>';

          if (data.discount && data.hashtag) {
            html += '<p class="warning">âš ï¸ ä¸¡æ–¹ã¨ã‚‚æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã™ã‚‹å ´åˆã¯ã€ŒFirestoreã«ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>';
          } else if (data.discount || data.hashtag) {
            html += '<p class="warning">âš ï¸ ä¸€éƒ¨ã®è¨­å®šãŒå­˜åœ¨ã—ã¾ã™ã€‚</p>';
          } else {
            html += '<p class="success">âœ… è¨­å®šãŒç©ºã§ã™ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>';
          }

          statusDiv.innerHTML = html;
        } else {
          showStatus('âš ï¸ settings/common ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½œæˆã•ã‚Œã¾ã™ã€‚', 'warning');
        }
      } catch (error) {
        showStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    });

    // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    document.getElementById('migrateBtn').addEventListener('click', async () => {
      if (!confirm('Firestoreã«å‰²å¼•æƒ…å ±ã¨ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¨­å®šã‚’ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      showStatus('ä¿å­˜ä¸­...');
      try {
        const docRef = db.collection('settings').doc('common');

        await docRef.set({
          discount: discountConfig,
          hashtag: hashtagConfig
        }, { merge: true });

        showStatus('âœ… ä¿å­˜å®Œäº†ï¼Firestoreã«è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚<br><br>ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã€å•†å“ç™»éŒ²ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'success');
      } catch (error) {
        showStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    });
  </script>
</body>
</html>
