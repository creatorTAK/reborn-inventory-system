<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - FURIRA</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .card { background: #f5f5f5; border-radius: 8px; padding: 20px; margin: 20px 0; }
    pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 12px; }
    button { background: #40B4E5; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
    button:hover { background: #1E8FBF; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .success { color: #22c55e; }
    .error { color: #ef4444; }
    .warning { color: #f59e0b; }
    #status { margin-top: 20px; padding: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ“¦ è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>

  <div class="card">
    <h2>ç¾åœ¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</h2>
    <p>ä»¥ä¸‹ã®å€¤ã‚’Firestoreã«ä¿å­˜ã—ã¾ã™ï¼š</p>

    <h3>ğŸ”˜ å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³</h3>
    <pre id="conditionButtonsPreview" style="max-height: 300px; overflow-y: auto;"></pre>

    <h3>ğŸ’° å‰²å¼•æƒ…å ±</h3>
    <pre id="discountPreview"></pre>

    <h3>ğŸ·ï¸ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°</h3>
    <pre id="hashtagPreview"></pre>
  </div>

  <div class="card">
    <h2>æ“ä½œ</h2>
    <button id="checkBtn">ç¾åœ¨ã®Firestoreè¨­å®šã‚’ç¢ºèª</button>
    <button id="migrateBtn">ã™ã¹ã¦Firestoreã«ä¿å­˜</button>
    <button id="migrateConditionBtn" style="background: #22c55e;">å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ã¿ä¿å­˜</button>
  </div>

  <div id="status"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyA4hNktMqmUBArzKRpMt_Q9f5EiL0xlegk",
      authDomain: "furira.jp",
      projectId: "reborn-chat",
      storageBucket: "reborn-chat.firebasestorage.app",
      messagingSenderId: "618498936498",
      appId: "1:618498936498:web:ccd51d56455cb34261c4ba",
      measurementId: "G-LT40ET0CXZ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ç¾åœ¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    const discountConfig = {
      'ãƒ•ã‚©ãƒ­ãƒ¼å‰²': [
        { 'ç¯„å›²': 'ã€œ2,999å††', 'å‰²å¼•é¡': '100å††å¼•' },
        { 'ç¯„å›²': 'ã€œ5,999å††', 'å‰²å¼•é¡': '200å††å¼•' },
        { 'ç¯„å›²': 'ã€œ8,999å††', 'å‰²å¼•é¡': '300å††å¼•' },
        { 'ç¯„å›²': '9,000å††ã€œ', 'å‰²å¼•é¡': '500å††å¼•' }
      ],
      'ãƒªãƒ”ãƒ¼ãƒˆå‰²': [
        { 'ç¯„å›²': '', 'å‰²å¼•é¡': '200å††å¼•' }
      ],
      'ã¾ã¨ã‚å‰²': [
        { 'ç¯„å›²': '2ç‚¹', 'å‰²å¼•é¡': '300å††' },
        { 'ç¯„å›²': '3ç‚¹', 'å‰²å¼•é¡': '500å††' },
        { 'ç¯„å›²': '4ç‚¹', 'å‰²å¼•é¡': '1,000å††' }
      ]
    };

    const hashtagConfig = {
      commonPrefix: '#REBORN_',
      hashtags: [
        {
          title: 'å…¨å•†å“',
          suffix: 'å…¨å•†å“',
          icon: 'ğŸ·ï¸',
          defaultChecked: true
        }
      ]
    };

    // å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆé…åˆ—å½¢å¼ã«å¤‰æ›ï¼‰
    const conditionButtonsConfig = [
      { 'å•†å“ã®çŠ¶æ…‹': 'æ–°å“ã€æœªä½¿ç”¨', 'ãƒ©ãƒ™ãƒ«': 'ã‚¿ã‚°ä»˜ãæœªä½¿ç”¨', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ã‚¿ã‚°ä»˜ãæœªä½¿ç”¨å“ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'æ–°å“ã€æœªä½¿ç”¨', 'ãƒ©ãƒ™ãƒ«': 'æ–°å“æœªé–‹å°', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'æ–°å“æœªé–‹å°ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'æ–°å“ã€æœªä½¿ç”¨', 'ãƒ©ãƒ™ãƒ«': 'è©¦ç€ã®ã¿', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'è©¦ç€ã®ã¿ã®æœªä½¿ç”¨å“ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'æœªä½¿ç”¨ã«è¿‘ã„', 'ãƒ©ãƒ™ãƒ«': 'æ•°å›ç€ç”¨', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'æ•°å›ã®ã¿ç€ç”¨ã®ç¾å“ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'æœªä½¿ç”¨ã«è¿‘ã„', 'ãƒ©ãƒ™ãƒ«': 'ã»ã¼æœªä½¿ç”¨', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ã»ã¼æœªä½¿ç”¨ã«è¿‘ã„çŠ¶æ…‹ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'æœªä½¿ç”¨ã«è¿‘ã„', 'ãƒ©ãƒ™ãƒ«': 'å®¤å†…è©¦ç€ã®ã¿', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'å®¤å†…ã§è©¦ç€ã—ãŸã®ã¿ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—', 'ãƒ©ãƒ™ãƒ«': 'ç¾å“', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ã»ã¨ã‚“ã©ä½¿ç”¨æ„ŸãŒãªãã€ã¨ã¦ã‚‚ç¶ºéº—ãªçŠ¶æ…‹ã§ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—', 'ãƒ©ãƒ™ãƒ«': 'ä¿ç®¡æ™‚ã®ã‚·ãƒ¯', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ä¿ç®¡æ™‚ã®å°ã•ãªã‚·ãƒ¯ãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—', 'ãƒ©ãƒ™ãƒ«': 'ç€ç”¨æ„Ÿå°‘ãªã„', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ç€ç”¨æ„ŸãŒå°‘ãªãã€ã¾ã ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'ä½¿ç”¨æ„Ÿã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'è‹¥å¹²ã®ä½¿ç”¨æ„ŸãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'å°ã•ãªæ±šã‚Œ', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ç›®ç«‹ãŸãªã„ç¨‹åº¦ã®å°ã•ãªæ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'æ¯›ç‰ã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'è‹¥å¹²ã®æ¯›ç‰ãŒã”ã–ã„ã¾ã™ãŒã€ã¾ã ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'è‰²è¤ªã›ã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'è‹¥å¹²ã®è‰²è¤ªã›ãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'ä½¿ç”¨æ„Ÿå¼·ã„', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ä½¿ç”¨æ„ŸãŒå¼·ã‚ã§ã™ãŒã€ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'æ±šã‚Œã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'æ±šã‚ŒãŒã”ã–ã„ã¾ã™ã€‚å†™çœŸã§ã”ç¢ºèªãã ã•ã„ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'å‚·ã‚„æ±šã‚Œã‚ã‚Š', 'ãƒ©ãƒ™ãƒ«': 'å‚·ã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'å‚·ãŒã”ã–ã„ã¾ã™ã€‚å†™çœŸã§ã”ç¢ºèªãã ã•ã„ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'å…¨ä½“çš„ã«çŠ¶æ…‹ãŒæ‚ªã„', 'ãƒ©ãƒ™ãƒ«': 'å…¨ä½“çš„ã«å‚·ã‚ã‚Š', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'å…¨ä½“çš„ã«å‚·ã‚„æ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ã®ä¸Šã”è³¼å…¥ãã ã•ã„ã€‚' },
      { 'å•†å“ã®çŠ¶æ…‹': 'å…¨ä½“çš„ã«çŠ¶æ…‹ãŒæ‚ªã„', 'ãƒ©ãƒ™ãƒ«': 'ç›®ç«‹ã¤æ±šã‚Œ', 'ãƒ†ã‚­ã‚¹ãƒˆ': 'ç›®ç«‹ã¤æ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚å†™çœŸã‚’ã‚ˆãã”ç¢ºèªãã ã•ã„ã€‚' }
    ];

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    document.getElementById('conditionButtonsPreview').textContent = JSON.stringify(conditionButtonsConfig, null, 2);
    document.getElementById('discountPreview').textContent = JSON.stringify(discountConfig, null, 2);
    document.getElementById('hashtagPreview').textContent = JSON.stringify(hashtagConfig, null, 2);

    const statusDiv = document.getElementById('status');

    function showStatus(message, type = 'info') {
      const color = type === 'success' ? '#dcfce7' : type === 'error' ? '#fee2e2' : type === 'warning' ? '#fef3c7' : '#e0f2fe';
      statusDiv.innerHTML = `<div style="background: ${color}; padding: 15px; border-radius: 8px;">${message}</div>`;
    }

    // ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèª
    document.getElementById('checkBtn').addEventListener('click', async () => {
      showStatus('Firestoreã‚’ç¢ºèªä¸­...');
      try {
        const docRef = db.collection('settings').doc('common');
        const doc = await docRef.get();

        if (doc.exists) {
          const data = doc.data();
          let html = '<h3>ç¾åœ¨ã®Firestoreè¨­å®š:</h3>';
          html += '<pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto;">';
          html += 'ğŸ”˜ conditionButtons: ' + (data.conditionButtons && data.conditionButtons.length > 0 ? data.conditionButtons.length + 'ä»¶' : '(æœªè¨­å®š)') + '\n\n';
          html += 'ğŸ’° discount: ' + (data.discount ? 'è¨­å®šæ¸ˆã¿' : '(æœªè¨­å®š)') + '\n\n';
          html += 'ğŸ·ï¸ hashtag: ' + (data.hashtag ? 'è¨­å®šæ¸ˆã¿' : '(æœªè¨­å®š)');
          html += '</pre>';

          if (data.conditionButtons && data.conditionButtons.length > 0) {
            html += '<p class="success">âœ… å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã¯æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼ˆ' + data.conditionButtons.length + 'ä»¶ï¼‰</p>';
          } else {
            html += '<p class="warning">âš ï¸ å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ãŒæœªè¨­å®šã§ã™ã€‚ã€Œå•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ã¿ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>';
          }

          statusDiv.innerHTML = html;
        } else {
          showStatus('âš ï¸ settings/common ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½œæˆã•ã‚Œã¾ã™ã€‚', 'warning');
        }
      } catch (error) {
        showStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    });

    // å…¨è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    document.getElementById('migrateBtn').addEventListener('click', async () => {
      if (!confirm('Firestoreã«å…¨ã¦ã®è¨­å®šï¼ˆå•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ãƒ»å‰²å¼•æƒ…å ±ãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼‰ã‚’ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      showStatus('ä¿å­˜ä¸­...');
      try {
        const docRef = db.collection('settings').doc('common');

        await docRef.set({
          conditionButtons: conditionButtonsConfig,
          discount: discountConfig,
          hashtag: hashtagConfig
        }, { merge: true });

        // localStorageã«ã‚‚ä¿å­˜
        localStorage.setItem('rebornConfig_conditionButtons', JSON.stringify(conditionButtonsConfig));
        localStorage.setItem('rebornConfig_discount', JSON.stringify(discountConfig));
        localStorage.setItem('rebornConfig_hashtag', JSON.stringify(hashtagConfig));

        showStatus('âœ… ä¿å­˜å®Œäº†ï¼Firestoreã¨localStorageã«è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚<br><br>ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã€å•†å“ç™»éŒ²ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'success');
      } catch (error) {
        showStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    });

    // å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    document.getElementById('migrateConditionBtn').addEventListener('click', async () => {
      if (!confirm('å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆ18ä»¶ï¼‰ã‚’Firestoreã«ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      showStatus('ä¿å­˜ä¸­...');
      try {
        const docRef = db.collection('settings').doc('common');

        await docRef.set({
          conditionButtons: conditionButtonsConfig
        }, { merge: true });

        // localStorageã«ã‚‚ä¿å­˜
        localStorage.setItem('rebornConfig_conditionButtons', JSON.stringify(conditionButtonsConfig));

        showStatus('âœ… å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆ18ä»¶ï¼‰ï¼<br><br>ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã€å•†å“ç™»éŒ²ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'success');
      } catch (error) {
        showStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    });
  </script>
</body>
</html>
