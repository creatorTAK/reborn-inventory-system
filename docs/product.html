<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="apple-touch-icon" sizes="180x180" href="https://creatortak.github.io/reborn-inventory-system/icon-180.png">
<base target="_top">

<!-- iOS PWAå¯¾å¿œ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="ãƒ•ãƒªãƒ©">

<!-- PWAå¯¾å¿œ -->
<meta name="theme-color" content="#000000">

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Algolia Search SDK (Liteç‰ˆ) -->
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<!-- REBORN Brand Colors & Theme -->
<link rel="stylesheet" href="https://www.reborn-inventory.com/css/reborn-brand-colors.css?v=0bd1a9b">
<link rel="stylesheet" href="/css/reborn-theme.css?v=296">

<!-- å¤–éƒ¨CSSãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»å‹•ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰-->
<link rel="stylesheet" href="/css/product-styles.css?v=183-guide-toggle">
<!-- Sortable.js - ã‚¿ãƒƒãƒå¯¾å¿œã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="">


<!-- ã‚µãƒ–ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆç™½èƒŒæ™¯ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ï¼‰ -->
<style>
  .sub-header {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 56px;
    padding: 0 16px;
    background: #ffffff;
    border-bottom: 1px solid #f0f0f0;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .sub-header-back {
    position: absolute;
    left: 8px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: #374151;
    font-size: 20px;
    cursor: pointer;
  }
  .sub-header-back:hover {
    background: #f3f4f6;
  }
  .sub-header-back:active {
    background: #e5e7eb;
  }
  .sub-header-title {
    font-size: 17px;
    font-weight: 600;
    color: #111827;
  }
  .sub-header-menu {
    position: absolute;
    right: 8px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: #374151;
    font-size: 20px;
    cursor: pointer;
  }
  .sub-header-menu:hover {
    background: #f3f4f6;
  }
  .sub-header-menu:active {
    background: #e5e7eb;
  }
  .sub-header-icons {
    position: absolute;
    right: 8px;
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .sub-header-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: #374151;
    font-size: 20px;
    cursor: pointer;
  }
  .sub-header-icon:hover {
    background: #f3f4f6;
  }
  .sub-header-icon:active {
    background: #e5e7eb;
  }
  /* è¨­å®šãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ */
  .settings-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    min-width: 200px;
    padding: 8px 0;
    display: none;
    z-index: 1001;
  }
  .settings-dropdown.active {
    display: block;
  }
  .settings-dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border: none;
    background: none;
    width: 100%;
    font-size: 14px;
    color: #374151;
    cursor: pointer;
    text-align: left;
  }
  .settings-dropdown-item:hover {
    background: #f3f4f6;
  }
  .settings-dropdown-item i {
    font-size: 18px;
    color: #6b7280;
    width: 20px;
    text-align: center;
  }
  .settings-dropdown-toggle {
    justify-content: space-between;
  }
  .settings-dropdown-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 4px 0;
  }
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.3s;
    border-radius: 24px;
  }
  .toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
  }
  input:checked + .toggle-slider {
    background-color: #40B4E5;
  }
  input:checked + .toggle-slider:before {
    transform: translateX(20px);
  }
</style>
<div class="sub-header" id="pageHeader" style="display: none;">
  <button class="sub-header-back" onclick="window.parent.postMessage({type:'navigateToPage', page:'home'}, '*')" title="æˆ»ã‚‹">
    <i class="bi bi-chevron-left"></i>
  </button>
  <span class="sub-header-title">å•†å“ç™»éŒ²</span>
  <div class="sub-header-icons">
    <button class="sub-header-icon" onclick="window.parent.postMessage({type:'openChatRooms'}, '*')" title="ãŠçŸ¥ã‚‰ã›">
      <i class="bi bi-bell"></i>
    </button>
    <div style="position: relative;">
      <button class="sub-header-icon" onclick="toggleSettingsDropdown(event)" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
        <i class="bi bi-list"></i>
      </button>
      <div class="settings-dropdown" id="settingsDropdown">
        <div class="settings-dropdown-item settings-dropdown-toggle">
          <div style="display: flex; align-items: center; gap: 12px;">
            <i class="bi bi-lightbulb" id="guideModeIcon"></i>
            <span>ãƒ’ãƒ³ãƒˆ</span>
          </div>
          <label class="toggle-switch" onclick="event.stopPropagation()">
            <input type="checkbox" id="guideModeToggle" onchange="toggleGuideModeFromToggle(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="settings-dropdown-divider"></div>
        <button class="settings-dropdown-item" onclick="window.parent.postMessage({type:'navigate', page:'config-product'}, '*')">
          <i class="bi bi-sliders"></i>
          <span>å•†å“ç™»éŒ²è¨­å®š</span>
        </button>
        <button class="settings-dropdown-item" onclick="window.parent.postMessage({type:'navigate', page:'config-system'}, '*')">
          <i class="bi bi-gear-wide-connected"></i>
          <span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// ===== è¨­å®šãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ & ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ =====
function toggleSettingsDropdown(event) {
  event.stopPropagation();
  const dropdown = document.getElementById('settingsDropdown');
  dropdown.classList.toggle('active');
}

// ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.addEventListener('click', function(event) {
  const dropdown = document.getElementById('settingsDropdown');
  if (dropdown && !dropdown.contains(event.target)) {
    dropdown.classList.remove('active');
  }
});

function toggleGuideModeFromToggle(isOn) {
  toggleGuideMode(isOn);
  updateGuideModeUI(isOn);
}

function toggleGuideMode(isOn) {
  if (isOn) {
    document.body.classList.add('guide-mode-on');
    localStorage.setItem('guideMode', 'on');
  } else {
    document.body.classList.remove('guide-mode-on');
    localStorage.setItem('guideMode', 'off');
  }
}

function updateGuideModeUI(isOn) {
  const toggle = document.getElementById('guideModeToggle');
  const icon = document.getElementById('guideModeIcon');
  if (toggle) toggle.checked = isOn;
  if (icon) icon.style.color = isOn ? '#40B4E5' : '';
}

// ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
  const guideMode = localStorage.getItem('guideMode');
  if (guideMode === 'on') {
    document.body.classList.add('guide-mode-on');
    updateGuideModeUI(true);
  }
});
</script>

<!-- ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆQRè‡ªå‹•è¡¨ç¤ºæ™‚ã¯æœ€åˆéè¡¨ç¤ºï¼‰ -->
<div id="mainFormContent" style="display: none;">

<!-- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
<div class="platform-tabs-container">
  <div class="platform-tabs" id="platformTabs">
    <button class="platform-tab active" data-platform="mercari" onclick="selectPlatform('mercari')">
      <img src="/images/platform/mercari.png" alt="ãƒ¡ãƒ«ã‚«ãƒª" class="platform-logo" style="width:18px;height:18px;">
      <span>ãƒ¡ãƒ«ã‚«ãƒª</span>
    </button>
    <button class="platform-tab" data-platform="mercari-shops" onclick="selectPlatform('mercari-shops')">
      <img src="/images/platform/mercari-shops.png" alt="ãƒ¡ãƒ«ã‚«ãƒªShops" class="platform-logo" style="width:18px;height:18px;">
      <span>ãƒ¡ãƒ«ã‚«ãƒªShops</span>
    </button>
    <button class="platform-tab" data-platform="yahoo-fleamarket" onclick="selectPlatform('yahoo-fleamarket')">
      <img src="/images/platform/yahoo-fleamarket.png" alt="Yahoo!ãƒ•ãƒªãƒ" class="platform-logo" style="width:18px;height:18px;">
      <span>Yahoo!ãƒ•ãƒªãƒ</span>
    </button>
    <button class="platform-tab" data-platform="yahoo-auction" onclick="selectPlatform('yahoo-auction')">
      <img src="/images/platform/yahoo-auction.png" alt="Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³" class="platform-logo" style="width:18px;height:18px;">
      <span>Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</span>
    </button>
    <button class="platform-tab" data-platform="rakuma" onclick="selectPlatform('rakuma')">
      <img src="/images/platform/rakuma.png" alt="ãƒ©ã‚¯ãƒ" class="platform-logo" style="width:18px;height:18px;">
      <span>ãƒ©ã‚¯ãƒ</span>
    </button>
    <button class="platform-tab" data-platform="base" onclick="selectPlatform('base')">
      <img src="/images/platform/base.png" alt="BASE" class="platform-logo" style="width:18px;height:18px;">
      <span>BASE</span>
    </button>
  </div>
</div>

<!-- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->

<!-- ãƒ¡ãƒ«ã‚«ãƒªç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div id="platform-content-mercari" class="platform-content">
<div class="content-container">

<!-- ä»•å…¥å•†å“ç´ä»˜ã‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆã‚¹ã‚­ãƒ£ãƒ³å¾Œã«è¡¨ç¤ºï¼‰ -->
<div class="group qr-status-section" id="qrStatusSection" style="display: none;">
  <div id="qrScanStatus" style="padding: 12px; border-radius: 8px; background: #d1fae5; border: 1px solid #10b981;">
    <!-- ã‚¹ã‚­ãƒ£ãƒ³çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
  </div>
  <!-- ä»•å…¥å•†å“IDï¼ˆéè¡¨ç¤ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ -->
  <input type="hidden" id="invId" name="invId" value="">
</div>

<div class="group management-section">
  <div class="group-title">ç®¡ç†ç•ªå·</div>

  <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px;">
    ğŸ’¡ ç®¡ç†ç•ªå·ã¯åœ¨åº«ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ç•ªå·ã§ã™ã€‚é ­æ–‡å­—ã¯è¨­å®šç®¡ç†ã§è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚
  </div>

  <div class="form-section">
    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
    <div id="managementNumberFields" style="display: none;"></div>

    <!-- ä½¿ç”¨å¯èƒ½ãªç®¡ç†ç•ªå· -->
    <div id="managementNumberPreview" style="margin-top: 8px; display: none;">
      <label style="font-size: 12px; color: #6b7280; margin-bottom: 4px; display: block;">ä½¿ç”¨å¯èƒ½ãªç®¡ç†ç•ªå·</label>
      <div style="display: flex; gap: 4px; align-items: stretch;">
        <input id="ç®¡ç†ç•ªå·" type="text" readonly placeholder="è‡ªå‹•æ¡ç•ªã•ã‚Œã¾ã™" class="mgmt-number-field" style="flex: 1; background: #f3f4f6; color: #1f2937; font-weight: 600; text-align: left; border: 1px solid #d1d5db; padding: 6px 8px;">
        <button type="button" onclick="adjustManagementNumber(1)" class="mgmt-adjust-btn" style="width: 32px; padding: 0; border: 1px solid #d1d5db; background: white; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; border-radius: 4px;">â–²</button>
        <button type="button" onclick="adjustManagementNumber(-1)" class="mgmt-adjust-btn" style="width: 32px; padding: 0; border: 1px solid #d1d5db; background: white; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; border-radius: 4px;">â–¼</button>
      </div>
    </div>

    <!-- QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒœã‚¿ãƒ³ -->
    <div id="qrCodeSection" style="margin-top: 12px; display: none;">
      <button type="button" onclick="showQRCodeModal()" class="qr-code-btn" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <i class="bi bi-qr-code" style="font-size: 18px;"></i>
        QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ»å°åˆ·
      </button>
    </div>

    <!-- æ‹…å½“è€… -->
    <div style="margin-top: 12px;">
      <label>æ‹…å½“è€…</label>
      <input type="text" id="æ‹…å½“è€…" readonly style="background-color: #f3f4f6; cursor: not-allowed;">
    </div>
  </div>
</div>
<div class="group basic-section">
  <div class="group-title">åŸºæœ¬æƒ…å ±</div>

  <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px;">
    ğŸ’¡ å•†å“ã®åŸºæœ¬çš„ãªåˆ†é¡æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ã‚«ãƒ†ã‚´ãƒªã¨ãƒ–ãƒ©ãƒ³ãƒ‰ã¯å•†å“åã‚„AIèª¬æ˜æ–‡ã®ç”Ÿæˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  </div>

  <div class="form-section category-cascade-section">
    <div class="section-title">ã‚«ãƒ†ã‚´ãƒªãƒ¼</div>
    <!-- ç‰¹å¤§åˆ†é¡ï¼ˆãƒ¡ãƒ«ã‚«ãƒªã®ãƒˆãƒƒãƒ—ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰ -->
    <div style="margin-top: 4px;">
      <select id="ç‰¹å¤§åˆ†é¡" class="category-cascade-select">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        <option value="ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</option>
        <option value="ãƒ™ãƒ“ãƒ¼ãƒ»ã‚­ãƒƒã‚º">ãƒ™ãƒ“ãƒ¼ãƒ»ã‚­ãƒƒã‚º</option>
        <option value="ã‚²ãƒ¼ãƒ ãƒ»ãŠã‚‚ã¡ã‚ƒãƒ»ã‚°ãƒƒã‚º">ã‚²ãƒ¼ãƒ ãƒ»ãŠã‚‚ã¡ã‚ƒãƒ»ã‚°ãƒƒã‚º</option>
        <option value="ãƒ›ãƒ“ãƒ¼ãƒ»æ¥½å™¨ãƒ»ã‚¢ãƒ¼ãƒˆ">ãƒ›ãƒ“ãƒ¼ãƒ»æ¥½å™¨ãƒ»ã‚¢ãƒ¼ãƒˆ</option>
        <option value="ãƒã‚±ãƒƒãƒˆ">ãƒã‚±ãƒƒãƒˆ</option>
        <option value="æœ¬ãƒ»é›‘èªŒãƒ»æ¼«ç”»">æœ¬ãƒ»é›‘èªŒãƒ»æ¼«ç”»</option>
        <option value="CDãƒ»DVDãƒ»ãƒ–ãƒ«ãƒ¼ãƒ¬ã‚¤">CDãƒ»DVDãƒ»ãƒ–ãƒ«ãƒ¼ãƒ¬ã‚¤</option>
        <option value="ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‘ã‚½ã‚³ãƒ³">ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‘ã‚½ã‚³ãƒ³</option>
        <option value="ãƒ†ãƒ¬ãƒ“ãƒ»ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ»ã‚«ãƒ¡ãƒ©">ãƒ†ãƒ¬ãƒ“ãƒ»ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ»ã‚«ãƒ¡ãƒ©</option>
        <option value="ç”Ÿæ´»å®¶é›»ãƒ»ç©ºèª¿">ç”Ÿæ´»å®¶é›»ãƒ»ç©ºèª¿</option>
        <option value="ã‚¹ãƒãƒ¼ãƒ„">ã‚¹ãƒãƒ¼ãƒ„</option>
        <option value="ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ãƒ»é‡£ã‚Šãƒ»æ—…è¡Œç”¨å“">ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ãƒ»é‡£ã‚Šãƒ»æ—…è¡Œç”¨å“</option>
        <option value="ã‚³ã‚¹ãƒ¡ãƒ»ç¾å®¹">ã‚³ã‚¹ãƒ¡ãƒ»ç¾å®¹</option>
        <option value="ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ»å¥åº·">ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ»å¥åº·</option>
        <option value="é£Ÿå“ãƒ»é£²æ–™ãƒ»é…’">é£Ÿå“ãƒ»é£²æ–™ãƒ»é…’</option>
        <option value="ã‚­ãƒƒãƒãƒ³ãƒ»æ—¥ç”¨å“ãƒ»ãã®ä»–">ã‚­ãƒƒãƒãƒ³ãƒ»æ—¥ç”¨å“ãƒ»ãã®ä»–</option>
        <option value="å®¶å…·ãƒ»ã‚¤ãƒ³ãƒ†ãƒªã‚¢">å®¶å…·ãƒ»ã‚¤ãƒ³ãƒ†ãƒªã‚¢</option>
        <option value="ãƒšãƒƒãƒˆç”¨å“">ãƒšãƒƒãƒˆç”¨å“</option>
        <option value="DIYãƒ»å·¥å…·">DIYãƒ»å·¥å…·</option>
        <option value="ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ»ã‚¬ãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°">ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ»ã‚¬ãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°</option>
        <option value="ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ãƒ»æ‰‹èŠ¸">ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ãƒ»æ‰‹èŠ¸</option>
        <option value="è»Šãƒ»ãƒã‚¤ã‚¯ãƒ»è‡ªè»¢è»Š">è»Šãƒ»ãƒã‚¤ã‚¯ãƒ»è‡ªè»¢è»Š</option>
      </select>
    </div>

    <!-- å¤§åˆ†é¡ã€œç´°åˆ†é¡2: ãƒ©ãƒ™ãƒ«éè¡¨ç¤º -->
    <div style="margin-top: 8px;">
      <select id="å¤§åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)" class="category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div style="margin-top: 8px;">
      <select id="ä¸­åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)" class="category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div style="margin-top: 8px;">
      <select id="å°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)" class="category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div id="saibunruiRow" style="display: none; margin-top: 8px;">
      <select id="ç´°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)" class="category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div style="display: none; margin-top: 8px;" id="saibunrui2Container">
      <select id="ç´°åˆ†é¡2" class="category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ å: ãƒ©ãƒ™ãƒ«è¡¨ç¤º -->
    <div style="margin-top: 8px;">
      <label>ã‚¢ã‚¤ãƒ†ãƒ å</label>
      <select id="ã‚¢ã‚¤ãƒ†ãƒ å" class="full category-cascade-select" disabled>
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div style="margin-top: 8px;">
      <label>ã‚µã‚¤ã‚º</label>
      <select id="ã‚µã‚¤ã‚º">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div style="margin-top: 8px;">
      <label>å•†å“ã®çŠ¶æ…‹</label>
      <select id="å•†å“ã®çŠ¶æ…‹">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
      </select>
    </div>

    <div class="brand-field" style="margin-top: 8px; position: relative;">
      <label>ãƒ–ãƒ©ãƒ³ãƒ‰</label>
      <input id="ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)" autocomplete="off" placeholder="å…¥åŠ›ã™ã‚‹ã¨å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™">
      <div class="suggest" id="suggest-ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)" hidden></div>
      <!-- ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)ã‚’éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ä¿æŒ -->
      <input type="hidden" id="ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)">
    </div>
  </div>
</div><div class="group title-section">
    <div class="group-title">å•†å“å</div>

    <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px;">
      ğŸ’¡ å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã³æ›¿ãˆã¦å•†å“åã®è¡¨ç¤ºé †ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ON/OFFã‚‚å¯èƒ½ã§ã™ã€‚
    </div>

    <!-- å•†å“åãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ–ãƒ­ãƒƒã‚¯å¤–ï¼‰ -->
    <div style="margin-bottom: 12px;">
      <label style="display: flex; justify-content: space-between; align-items: center;">
        <span>å•†å“åãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
        <span class="counter" id="nameCounter">
          <span id="nameCount">0</span>/<span id="nameMax">40</span> æ–‡å­—
        </span>
      </label>
      <div class="preview-wrapper">
        <textarea id="å•†å“åãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" rows="2"
                  placeholder="é¸æŠã—ãŸå€¤ã‚’ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§è‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™"
                  style="margin-top: 4px;"></textarea>
        <button type="button" class="copy-icon-btn" onclick="copyToClipboard('å•†å“åãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼', 'copyNameBtn')" id="copyNameBtn" title="ã‚³ãƒ”ãƒ¼">
          <i class="bi bi-copy"></i>
        </button>
      </div>
      <input id="å•†å“å(ã‚¿ã‚¤ãƒˆãƒ«)" type="hidden">
    </div>

    <!-- ä¸¦ã³æ›¿ãˆå¯èƒ½ãªãƒ–ãƒ­ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="titleBlockContainer">

    <!-- ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section title-draggable-block" data-block-id="salesword" draggable="true">
      <h3 class="section-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="drag-handle" style="cursor: move; font-size: 16px; color: #9ca3af;">â‹®â‹®</span>
ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰
        <button type="button" class="collapse-btn" onclick="toggleTitleBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
      </h3>
      <div class="section-content">
        <!-- ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
        <div style="margin-bottom: 12px; position: relative;">
          <div class="search-input-wrapper">
            <i class="bi bi-search search-input-icon"></i>
            <input type="text" id="saleswordSearch" class="full search-input-with-icon" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢..." autocomplete="off">
          </div>
          <div id="saleswordSuggestList" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
        </div>
        <div class="row">
          <div>
            <label>ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰(ã‚«ãƒ†ã‚´ãƒª)" class="full">
              <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
            </select>
          </div>
          <div>
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
            <select id="ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="full">
              <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒ–ãƒ©ãƒ³ãƒ‰æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section title-draggable-block" data-block-id="brand" draggable="true">
      <h3 class="section-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="drag-handle" style="cursor: move; font-size: 16px; color: #9ca3af;">â‹®â‹®</span>
ãƒ–ãƒ©ãƒ³ãƒ‰æƒ…å ±
        <button type="button" class="collapse-btn" onclick="toggleTitleBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
      </h3>
      <div class="section-content">
        <div class="row">
          <div class="brand-field" style="position: relative;">
            <label>ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)</label>
            <div style="display: flex; align-items: center; gap: 4px; width: 100%;">
              <input type="checkbox" id="å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)_ãƒã‚§ãƒƒã‚¯" checked onchange="updateNamePreview()" style="width: 20px; flex-shrink: 0;">
              <input id="å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)" autocomplete="off" placeholder="å…¥åŠ›ã™ã‚‹ã¨å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™" style="flex: 1; min-width: 0;">
            </div>
            <div class="suggest" id="suggest-å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)" hidden></div>
          </div>
          <div class="brand-field" style="position: relative;">
            <label>ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)</label>
            <div style="display: flex; align-items: center; gap: 4px; width: 100%;">
              <input type="checkbox" id="å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)_ãƒã‚§ãƒƒã‚¯" checked onchange="updateNamePreview()" style="width: 20px; flex-shrink: 0;">
              <input id="å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)" autocomplete="off" placeholder="å…¥åŠ›ã™ã‚‹ã¨å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™" style="flex: 1; min-width: 0;">
            </div>
            <div class="suggest" id="suggest-å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)" hidden></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ åã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section title-draggable-block" data-block-id="item" draggable="true">
      <h3 class="section-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="drag-handle" style="cursor: move; font-size: 16px; color: #9ca3af;">â‹®â‹®</span>
ã‚¢ã‚¤ãƒ†ãƒ å
        <button type="button" class="collapse-btn" onclick="toggleTitleBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
      </h3>
      <div class="section-content">
        <input id="å•†å“å_ã‚¢ã‚¤ãƒ†ãƒ å" type="text" placeholder="åŸºæœ¬æƒ…å ±ã®ã‚¢ã‚¤ãƒ†ãƒ åã‚’é¸æŠã™ã‚‹ã‹ã€ã“ã“ã«ç›´æ¥å…¥åŠ›" onchange="updateNamePreview()" oninput="updateNamePreview()" style="width: 100%;">
      </div>
    </div>

    <!-- å•†å“å±æ€§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section title-draggable-block" data-block-id="attribute" draggable="true">
      <h3 class="section-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="drag-handle" style="cursor: move; font-size: 16px; color: #9ca3af;">â‹®â‹®</span>
å•†å“å±æ€§
        <button type="button" class="collapse-btn" onclick="toggleTitleBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
      </h3>
      <div class="section-content">
        <div id="attributeList">
          <!-- åˆæœŸè¡¨ç¤ºã¯1ã‚»ãƒƒãƒˆ -->
          <div class="attribute-item" data-index="1">
            <div class="attribute-header">
              <span>å±æ€§ 1</span>
              <button type="button" class="remove-attribute-btn" onclick="removeProductAttribute(1)" style="display:none;">å‰Šé™¤</button>
            </div>

            <!-- æ¤œç´¢ãƒãƒ¼ -->
            <div class="attribute-search-wrapper" style="margin-bottom: 8px; position: relative;">
              <input type="text" class="attribute-search-input" data-index="1" placeholder="å±æ€§ã‚’æ¤œç´¢..." autocomplete="off" style="font-size: 16px; width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
              <div class="attribute-suggest-list" data-index="1" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
            </div>

            <div class="row" style="margin-top: 6px;">
              <div>
                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                <select id="å•†å“å±æ€§1_ã‚«ãƒ†ã‚´ãƒª">
                  <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
                </select>
              </div>
              <div>
                <label>å€¤</label>
                <select id="å•†å“å±æ€§1_å€¤" disabled>
                  <option value="">--ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„--</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <button type="button" id="addAttributeBtn" class="add-attribute-btn">+ å•†å“å±æ€§ã‚’è¿½åŠ </button>
      </div>
    </div>

    </div><!-- titleBlockContainer -->

  </div><div class="group description-section">
  <div class="group-title">å•†å“ã®èª¬æ˜</div>

  <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px;">
    ğŸ’¡ å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã³æ›¿ãˆã¦èª¬æ˜æ–‡ã®æ§‹æˆã‚’è‡ªç”±ã«å¤‰æ›´ã§ãã¾ã™ã€‚AIç”Ÿæˆã§é­…åŠ›çš„ãªèª¬æ˜æ–‡ã‚’è‡ªå‹•ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
  </div>

  <!-- å•†å“ã®èª¬æ˜æ¬„ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ -->
  <div style="margin-bottom: 12px;">
    <label style="display: flex; justify-content: space-between; align-items: center;">
      <span>å•†å“ã®èª¬æ˜</span>
      <span class="counter" id="descCounter">
        <span id="descCount">0</span>/<span id="descMax">1000</span> æ–‡å­—
      </span>
    </label>
    <div class="preview-wrapper">
      <textarea
        id="å•†å“ã®èª¬æ˜"
        placeholder="å•†å“ã®çŠ¶æ…‹ãƒ»ç´ æãƒ»ã‚µã‚¤ã‚ºæ„Ÿãƒ»ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ãƒ»æ³¨æ„ç‚¹ãªã©ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
        style="margin-top: 4px; min-height: 120px; resize: none;"
      ></textarea>
      <button type="button" class="copy-icon-btn" onclick="copyToClipboard('å•†å“ã®èª¬æ˜', 'copyDescBtn')" id="copyDescBtn" title="ã‚³ãƒ”ãƒ¼">
        <i class="bi bi-copy"></i>
      </button>
    </div>
  </div>

  <!-- ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒ–ãƒ­ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div id="descriptionBlocksContainer">

  <!-- ãƒ–ãƒ©ãƒ³ãƒ‰åã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ¡ä»¶ä»˜ãè¡¨ç¤ºï¼‰ -->
  <div id="brandNameSection" class="form-section desc-draggable-block" data-block-type="brandName" style="margin-bottom: 12px; display: none;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
      <span class="section-icon">ğŸ·ï¸</span>ãƒ–ãƒ©ãƒ³ãƒ‰å
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin-bottom: 12px;">
        ğŸ’¡ åŸºæœ¬æƒ…å ±ã§é¸æŠã—ãŸãƒ–ãƒ©ãƒ³ãƒ‰åãŒè‡ªå‹•çš„ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
        ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã®ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…ã®è¡¨ç¤ºä½ç½®ã‚’èª¿æ•´ã§ãã¾ã™ã€‚
      </div>
    </div>
  </div>

  <!-- ã‚µã‚¤ã‚ºæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="sizeSection" class="form-section desc-draggable-block" data-block-type="size" style="margin-bottom: 12px; display: none;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
<span id="sizeLabelDisplay">ã‚µã‚¤ã‚º</span>
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <!-- ãƒˆãƒƒãƒ—ã‚¹/ã‚¢ã‚¦ã‚¿ãƒ¼ç”¨ã‚µã‚¤ã‚º -->
      <div id="topsSize" style="display: none;">
        <!-- ã‚µã‚¤ã‚º(è¡¨è¨˜) -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ã‚µã‚¤ã‚º(è¡¨è¨˜)</label>
          <select id="ã‚µã‚¤ã‚º(è¡¨è¨˜)_ãƒˆãƒƒãƒ—ã‚¹" style="width: 100%;">
            <option value="">--</option>
          </select>
        </div>

        <!-- ã‚µã‚¤ã‚º(å®Ÿå¯¸) -->
        <div style="margin-bottom: 8px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ã‚µã‚¤ã‚º(å®Ÿå¯¸)</label>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 4px;">
          <div>
            <label class="small" id="shoulderWidthLabel">è‚©å¹…</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="è‚©å¹…" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
          <div>
            <label class="small">èº«å¹…</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="èº«å¹…" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <div>
            <label class="small">è¢–ä¸ˆ</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="è¢–ä¸ˆ" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
          <div>
            <label class="small">ç€ä¸ˆ</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="ç€ä¸ˆ" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ãƒ‘ãƒ³ãƒ„ç”¨ã‚µã‚¤ã‚º -->
      <div id="bottomsSize" style="display: none;">
        <!-- ã‚µã‚¤ã‚º(è¡¨è¨˜) -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ã‚µã‚¤ã‚º(è¡¨è¨˜)</label>
          <select id="ã‚µã‚¤ã‚º(è¡¨è¨˜)_ãƒœãƒˆãƒ ã‚¹" style="width: 100%;">
            <option value="">--</option>
          </select>
        </div>

        <!-- ã‚µã‚¤ã‚º(å®Ÿå¯¸) -->
        <div style="margin-bottom: 8px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ã‚µã‚¤ã‚º(å®Ÿå¯¸)</label>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 4px;">
          <div>
            <label class="small">ã‚¦ã‚¨ã‚¹ãƒˆ</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="ã‚¦ã‚¨ã‚¹ãƒˆ" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
          <div>
            <label class="small">ãƒ’ãƒƒãƒ—</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="ãƒ’ãƒƒãƒ—" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <div>
            <label class="small">è‚¡ä¸Š</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="è‚¡ä¸Š" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
          <div>
            <label class="small">è‚¡ä¸‹</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <select id="è‚¡ä¸‹" style="flex: 1;">
                <option value="">--</option>
              </select>
              <span style="font-size: 12px; color: #6b7280;">cm</span>
            </div>
          </div>
        </div>
      </div>

      <!-- é´ç”¨ã‚µã‚¤ã‚º -->
      <div id="shoesSize" style="display: none;">
        <!-- ã‚µã‚¤ã‚º(è¡¨è¨˜) -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ã‚µã‚¤ã‚º(è¡¨è¨˜)</label>
          <select id="ã‚µã‚¤ã‚º(è¡¨è¨˜)_é´" style="width: 100%;">
            <option value="">--</option>
          </select>
        </div>

        <!-- ãã®ä»–ã®ã‚µã‚¤ã‚ºè¡¨è¨˜ -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ãã®ä»–ã®ã‚µã‚¤ã‚ºè¡¨è¨˜</label>
          <input type="text" id="ãã®ä»–ã®ã‚µã‚¤ã‚ºè¡¨è¨˜_é´" placeholder="ä¾‹: US8, EU38" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
        </div>

        <!-- æ™®æ®µã®ã‚µã‚¤ã‚º -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">æ™®æ®µã®ã‚µã‚¤ã‚º</label>
          <input type="text" id="æ™®æ®µã®ã‚µã‚¤ã‚º_é´" placeholder="ä¾‹: æ™®æ®µã¯25.0cmã‚’å±¥ã„ã¦ã„ã¾ã™" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
        </div>

        <!-- ãƒ•ã‚£ãƒƒãƒˆæ„Ÿ -->
        <div style="margin-bottom: 12px;">
          <label style="font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ãƒ•ã‚£ãƒƒãƒˆæ„Ÿãƒ»æ³¨æ„ç‚¹</label>
          <textarea id="ãƒ•ã‚£ãƒƒãƒˆæ„Ÿ_é´" placeholder="ä¾‹: ç´°ã‚ã®ä½œã‚Šã§ã™ã€‚æ™®æ®µã‚ˆã‚Š0.5cmå¤§ãã‚ã‚’ãŠã™ã™ã‚ã—ã¾ã™" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; min-height: 60px; resize: vertical;"></textarea>
        </div>

        <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
          ğŸ’¡ ã‚µã‚¤ã‚º(è¡¨è¨˜)ã¯åŸºæœ¬æƒ…å ±ãƒ–ãƒ­ãƒƒã‚¯ã§é¸æŠã—ãŸã‚µã‚¤ã‚ºãŒè‡ªå‹•åæ˜ ã•ã‚Œã¾ã™ã€‚<br>
          ğŸ’¡ ãã®ä»–ã®ã‚µã‚¤ã‚ºè¡¨è¨˜ã€æ™®æ®µã®ã‚µã‚¤ã‚ºã€ãƒ•ã‚£ãƒƒãƒˆæ„Ÿã¯è³¼å…¥è€…ãŒã‚µã‚¤ã‚ºæ„Ÿã‚’æŠŠæ¡ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®è£œè¶³æƒ…å ±ã§ã™ã€‚
        </div>
      </div>
    </div>
  </div>

  <!-- ã‚«ãƒ©ãƒ¼(è©³ç´°)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="form-section desc-draggable-block" data-block-type="color" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
ã‚«ãƒ©ãƒ¼(è©³ç´°)
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin-bottom: 12px;">
        ğŸ’¡ è¤‡æ•°ã‚«ãƒ©ãƒ¼ã®å•†å“ã¯ã€Œã‚«ãƒ©ãƒ¼ã‚’è¿½åŠ ã€ã§ç™»éŒ²ã§ãã¾ã™ã€‚æ¤œç´¢ã§ç´ æ—©ãé¸æŠã§ãã¾ã™ã€‚
      </div>
      <div id="colorList">
        <!-- åˆæœŸè¡¨ç¤ºã¯1ã‚»ãƒƒãƒˆ -->
        <div class="color-item" data-index="1">
          <div class="color-header">
            <span>ã‚«ãƒ©ãƒ¼ 1</span>
            <button type="button" class="remove-color-btn" onclick="removeColor(1)" style="display:none;">å‰Šé™¤</button>
          </div>

          <!-- ã‚«ãƒ©ãƒ¼æ¤œç´¢å…¥åŠ›æ¬„ -->
          <div class="color-search-wrapper" style="margin-bottom: 8px; position: relative;">
            <input type="text" class="color-search-input" data-index="1" placeholder="ã‚«ãƒ©ãƒ¼ã‚’æ¤œç´¢..." autocomplete="off" style="font-size: 16px; width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
            <div class="color-suggest-list" data-index="1" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 6px 6px; max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
          </div>

          <div class="color-fields">
            <label>è‰²:
              <select id="ã‚«ãƒ©ãƒ¼1" class="color-select">
                <option value="">--</option>
              </select>
            </label>
          </div>
        </div>
      </div>

      <button type="button" id="addColorBtn" class="add-color-btn">+ ã‚«ãƒ©ãƒ¼ã‚’è¿½åŠ </button>
    </div>
  </div>

  <!-- å•†å“çŠ¶æ…‹(è©³ç´°)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="form-section desc-draggable-block" data-block-type="condition" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
å•†å“çŠ¶æ…‹(è©³ç´°)
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin-bottom: 12px;">
        ğŸ’¡ ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å®šå‹æ–‡ã‚’ç´ æ—©ãæŒ¿å…¥ã§ãã¾ã™ã€‚å…¥åŠ›ä¸­ã«å€™è£œã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </div>
      <!-- ã‚¯ã‚¤ãƒƒã‚¯æŒ¿å…¥ãƒœã‚¿ãƒ³ç¾¤ -->
      <div id="quickInsertButtonsContainer" class="quick-insert-buttons" style="margin-bottom: 8px;">
        <!-- ãƒœã‚¿ãƒ³ã¯ã€Œå•†å“ã®çŠ¶æ…‹ã€ã«å¿œã˜ã¦å‹•çš„ã«è¡¨ç¤º -->
      </div>

      <!-- ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆå¯¾å¿œã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
      <div style="position: relative;">
        <textarea
          id="å•†å“çŠ¶æ…‹è©³ç´°"
          rows="3"
          placeholder="å•†å“ã®è©³ç´°ãªçŠ¶æ…‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆå‚·ã€æ±šã‚Œã€ä½¿ç”¨æ„Ÿãªã©ï¼‰"
        ></textarea>
        <div id="suggest-å•†å“çŠ¶æ…‹è©³ç´°" class="suggest" hidden></div>
      </div>

      <!-- å‚·ãƒ»æ±šã‚Œãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒï¼ˆä»•å…¥QRã‚¹ã‚­ãƒ£ãƒ³æ™‚ã«è¡¨ç¤ºï¼‰ -->
      <div id="damageMarkerPreviewSection" style="display: none; margin-top: 12px; padding: 12px; background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <span style="font-size: 14px; font-weight: 600; color: #92400e;">ğŸ“ å‚·ãƒ»æ±šã‚Œãƒãƒ¼ã‚­ãƒ³ã‚°</span>
          <span id="damageMarkerTypeLabel" style="font-size: 12px; color: #78716c;"></span>
        </div>
        <img id="damageMarkerPreviewImg" src="" alt="å‚·ãƒ»æ±šã‚Œãƒãƒ¼ã‚­ãƒ³ã‚°" style="max-width: 100%; border-radius: 6px; border: 1px solid #e5e7eb;">
        <div id="damageMarkerNoteSection" style="display: none; margin-top: 8px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e5e7eb;">
          <div style="font-size: 11px; color: #78716c; margin-bottom: 4px;">è£œè¶³èª¬æ˜</div>
          <div id="damageMarkerNoteText" style="font-size: 13px; color: #374151; white-space: pre-wrap;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ç´ æå…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="form-section desc-draggable-block" data-block-type="material" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
ç´ æ
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin-bottom: 12px;">
        ğŸ’¡ ç´ æã‚¿ã‚°ã‹ã‚‰èª­ã¿å–ã£ãŸæƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã™ã€‚è¤‡æ•°ç´ æã‚„æ··ç´¡ã®å ´åˆã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
      </div>
      <div id="materialList">
        <!-- åˆæœŸè¡¨ç¤ºã¯1ã‚»ãƒƒãƒˆ -->
        <div class="material-item" data-index="1">
          <div class="material-header">
            <span>ç´ æ 1</span>
            <button type="button" class="remove-material-btn" onclick="removeMaterial(1)"
style="display:none;">å‰Šé™¤</button>
          </div>

          <div class="material-fields">
            <label>ç®‡æ‰€:
              <select id="ç´ æ1_ç®‡æ‰€" class="material-location">
                <option value="">--</option>
              </select>
            </label>

            <div class="material-composition" data-material-index="1">
              <div class="composition-row" data-row-index="1">
                <label>ç¨®é¡:
                  <select id="ç´ æ1_ç¨®é¡1" class="material-type">
                    <option value="">--</option>
                  </select>
                </label>
                <label>å‰²åˆ:
                  <select id="ç´ æ1_ï¼…1" class="material-percent">
                    <option value="">--%</option>
                  </select>
                </label>
                <button type="button" class="remove-composition-btn" onclick="removeCompositionRow(1, 1)" style="display:none;">Ã—</button>
              </div>
            </div>
            <button type="button" class="add-composition-btn" onclick="addCompositionRow(1)">ï¼‹ ç¨®é¡ã‚’è¿½åŠ </button>
          </div>
        </div>
      </div>

      <button type="button" id="addMaterialBtn" class="add-material-btn">+ ç´ æã‚’è¿½åŠ </button>
    </div>
  </div>

  <!-- ä»˜å±å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="form-section desc-draggable-block" data-block-type="accessories" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
ä»˜å±å“
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; margin-bottom: 12px; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
        <span class="info-emoji">ğŸ’¡</span> å•†å“ã«ä»˜å±ã™ã‚‹ã‚‚ã®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚AIç”Ÿæˆæ™‚ã«èª¬æ˜æ–‡ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
      </div>
      <div id="accessoriesCheckboxes" class="accessories-checkboxes" style="display: flex; flex-wrap: wrap; gap: 8px;">
        <!-- ä»˜å±å“ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯å‹•çš„ã«ç”Ÿæˆ -->
      </div>
      <!-- ãã®ä»–ãƒ•ãƒªãƒ¼ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
      <div id="accessoryOtherInputContainer" style="display: none; margin-top: 12px;">
        <label style="font-size: 12px; color: #374151; font-weight: 500;">ãã®ä»–ã®ä»˜å±å“ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</label>
        <input type="text" id="accessoryOtherText" placeholder="ä¾‹: ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒãƒ³ã‚¬ãƒ¼ã€è³¼å…¥ãƒ¬ã‚·ãƒ¼ãƒˆ" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; margin-top: 4px;">
      </div>
    </div>
  </div>

  <!-- AIç”Ÿæˆãƒ–ãƒ­ãƒƒã‚¯ï¼ˆè¦ªï¼‰ -->
  <div class="form-section desc-draggable-block" data-block-type="aiGeneration" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
AIç”Ÿæˆ
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div class="section-content">
      <!-- èª¬æ˜æ–‡ -->
      <div class="guide-hint" style="font-size: 11px; color: #6b7280; margin-bottom: 12px; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
        <span class="info-emoji">ğŸ’¡</span> ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦AIç”Ÿæˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€é­…åŠ›çš„ãªå•†å“èª¬æ˜æ–‡ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br>
        <span style="color: #6b7280;">âš ï¸ ç”Ÿæˆå¾Œã¯å¿…ãšå†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</span>
      </div>

      <!-- ã‚µãƒ–ãƒ–ãƒ­ãƒƒã‚¯1: è¿½åŠ å±æ€§ï¼ˆä»»æ„ï¼‰ -->
      <div class="ai-sub-block" style="margin-bottom: 12px; padding: 12px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px;">
        <h4 style="display: flex; align-items: center; margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #374151; cursor: pointer;" onclick="toggleAiSubBlock(this)">
è¿½åŠ å±æ€§ï¼ˆä»»æ„ï¼‰
          <button type="button" class="ai-sub-collapse-btn" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 12px; color: #6b7280; padding: 0 8px;">â–¶</button>
        </h4>
        <div class="ai-sub-content" style="display: none;">
          <div class="guide-hint" style="font-size: 11px; color: #6b7280; margin-bottom: 8px; padding: 6px 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
            ğŸ’¡ å•†å“ã®è©³ç´°ãªå±æ€§ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚AIç”Ÿæˆæ™‚ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚
          </div>
          <textarea
            id="AIç”¨å•†å“å±æ€§"
            rows="3"
            placeholder="å•†å“ã®è©³ç´°ãªå±æ€§ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã€90å¹´ä»£ã€USAè£½ã€å¸Œå°‘ã€é™å®šå“ã€ã‚¿ã‚°ä»˜ãã€ãƒ‡ãƒƒãƒ‰ã‚¹ãƒˆãƒƒã‚¯ï¼‰&#10;&#10;ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°å…¥åŠ›å¯èƒ½ã§ã™ã€‚"
            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical;"
          ></textarea>
          <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
            ä¾‹: ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã€90å¹´ä»£ã€USAè£½ã€å¸Œå°‘ã€é™å®šå“
          </div>
        </div>
      </div>

      <!-- ã‚µãƒ–ãƒ–ãƒ­ãƒƒã‚¯2: å“ç•ªãƒ»è£½ç•ªï¼ˆä»»æ„ï¼‰ -->
      <div class="ai-sub-block" style="margin-bottom: 12px; padding: 12px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px;">
        <h4 style="display: flex; align-items: center; margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #374151; cursor: pointer;" onclick="toggleAiSubBlock(this)">
å“ç•ªãƒ»è£½ç•ªï¼ˆä»»æ„ï¼‰
          <button type="button" class="ai-sub-collapse-btn" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 12px; color: #6b7280; padding: 0 8px;">â–¶</button>
        </h4>
        <div class="ai-sub-content" style="display: none;">
          <div class="guide-hint" style="font-size: 11px; color: #6b7280; margin-bottom: 8px; padding: 6px 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
            ğŸ’¡ å•†å“ã®å“ç•ªãƒ»å‹ç•ªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
          </div>
          <input
            type="text"
            id="å“ç•ªå‹ç•ª"
            placeholder="ä¾‹: 555088-101, DM0522-100, FW23-M001"
            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px;"
          />
        </div>
      </div>

      <!-- ã‚µãƒ–ãƒ–ãƒ­ãƒƒã‚¯3: å•†å“ç”»åƒï¼ˆä»»æ„ï¼‰ -->
      <div class="ai-sub-block" style="margin-bottom: 12px; padding: 12px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px;">
        <h4 style="display: flex; align-items: center; margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #374151; cursor: pointer;" onclick="toggleAiSubBlock(this)">
å•†å“ç”»åƒï¼ˆä»»æ„ï¼‰
          <button type="button" class="ai-sub-collapse-btn" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 12px; color: #6b7280; padding: 0 8px;">â–¶</button>
        </h4>
        <div class="ai-sub-content" style="display: none;">
          <div class="guide-hint" style="font-size: 11px; color: #6b7280; margin-bottom: 8px; padding: 6px 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db;">
            ğŸ’¡ ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨AIãŒè§£æã—ã¦ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜æ–‡ã‚’ç”Ÿæˆã—ã¾ã™
          </div>

          <!-- ç”»åƒé¸æŠãƒœã‚¿ãƒ³ -->
          <input
            type="file"
            id="productImages"
            accept="image/*"
            multiple
            style="display: none;"
            onchange="handleImageUpload(event)"
          />
          <button
            type="button"
            onclick="document.getElementById('productImages').click()"
            style="padding: 10px 16px; background: #e0f2fe; border: 2px dashed #0ea5e9; border-radius: 6px; color: #0369a1; font-size: 13px; cursor: pointer; width: 100%; font-weight: 500; margin-bottom: 12px;"
          >
            <i class="bi bi-camera" style="margin-right: 6px;"></i>ç”»åƒã‚’é¸æŠ
          </button>

          <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
          <div id="imagePreviewContainer" style="display: none;">
            <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 8px;">
              <span>AIç”Ÿæˆç”¨: <span id="aiImageCount">0</span>/3</span>
            </div>
            <div id="imagePreviewList" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
              <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </div>
          </div>
        </div>
      </div>

      <!-- AIç”Ÿæˆãƒœã‚¿ãƒ³ï¼ˆè¦ªãƒ–ãƒ­ãƒƒã‚¯ã®æœ€å¾Œï¼‰ -->
      <div style="margin-top: 12px; text-align: center;">
        <a href="javascript:void(0);" class="btn btn-gradient" id="aiGenBtn" onclick="generateAiDescription()"><span>AIç”Ÿæˆ</span></a>
      </div>
    </div>
  </div>

  <!-- å‰²å¼•æƒ…å ±é¸æŠï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ -->
  <div class="form-section desc-draggable-block" data-block-type="discount" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
å‰²å¼•æƒ…å ±
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div id="discountSection" class="section-content collapsible-content">
      <div id="discountCheckboxContainer" style="padding: 8px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
        <!-- å‰²å¼•æƒ…å ±ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        <div style="font-size: 11px; color: #6b7280; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </div>
  </div>

  <!-- ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é¸æŠï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ -->
  <div class="form-section desc-draggable-block" data-block-type="hashtag" style="margin-bottom: 12px;">
    <h3 class="section-title" style="display: flex; align-items: center;">
      <span class="drag-handle" style="cursor: move; margin-right: 8px; color: #9ca3af; font-size: 14px;">â‹®â‹®</span>
ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°
      <button type="button" class="collapse-btn" onclick="toggleDescBlock(this)" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 0 8px;">â–¼</button>
    </h3>
    <div id="hashtagSection" class="section-content collapsible-content">
      <div id="hashtagCheckboxContainer" style="padding: 8px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
        <!-- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        <div style="font-size: 11px; color: #6b7280; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </div>
  </div>

  </div><!-- /descriptionBlocksContainer -->

</div>
<div class="group product-images-section" id="productImagesBlock" style="display: none;">
  <div class="group-title">å•†å“ç”»åƒ</div>

  <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px; line-height: 1.6;">
    ğŸ’¡ ãƒ•ãƒªãƒã€ECã‚µã‚¤ãƒˆãªã©ã«å‡ºå“ã™ã‚‹ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆæœ€å¤§20æšï¼‰<br>
    ç”»åƒã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ã•ã‚Œã€è¤‡æ•°ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¸ã®APIé€£æºã§è‡ªå‹•å‡ºå“ã«ä½¿ç”¨ã§ãã¾ã™
  </div>

  <div class="form-section">
    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
    <div style="margin-bottom: 16px;">
      <input
        type="file"
        id="productImagesForSave"
        accept="image/*"
        multiple
        style="display: none;"
        onchange="handleProductImageUpload(event)"
      />
      <button
        type="button"
        onclick="document.getElementById('productImagesForSave').click()"
        style="padding: 10px 16px; background: #e0f2fe; border: 2px dashed #0ea5e9; border-radius: 6px; color: #0369a1; font-size: 13px; cursor: pointer; width: 100%; font-weight: 500;"
      >
        <i class="bi bi-camera" style="margin-right: 6px;"></i>ç”»åƒã‚’é¸æŠ
      </button>
    </div>

    <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
    <div id="productImagesPreviewContainer" style="display: none;">
      <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
        <span>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ï¼ˆ<span id="productImageCount">0</span>/20ï¼‰</span>
        <button
          type="button"
          onclick="clearAllProductImages()"
          style="padding: 4px 8px; background: white; border: 1px solid #ef4444; border-radius: 4px; color: #ef4444; font-size: 11px; cursor: pointer; font-weight: 500;"
          title="ã™ã¹ã¦ã®ç”»åƒã‚’å‰Šé™¤"
        >
          ğŸ—‘ï¸ ã™ã¹ã¦å‰Šé™¤
        </button>
      </div>
      <div id="productImagesPreviewList" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
      </div>
    </div>
  </div>
</div>
<div class="group shipping-section">
  <div class="group-title">é…é€ã«ã¤ã„ã¦</div>
  <div class="form-section">
    <div class="row">
      <div>
        <label>é…é€æ–™ã®è² æ‹…</label>
        <select id="é…é€æ–™ã®è² æ‹…">
          <option value="é€æ–™è¾¼ã¿(å‡ºå“è€…è² æ‹…)">é€æ–™è¾¼ã¿(å‡ºå“è€…è² æ‹…)</option>
        </select>
      </div>
      <div>
        <label>é…é€ã®æ–¹æ³•</label>
        <select id="é…é€ã®æ–¹æ³•">
          <option value="ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿">ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿</option>
        </select>
      </div>
    </div>
    <div class="row" style="margin-top:4px;">
      <div>
        <label>ç™ºé€å…ƒã®åœ°åŸŸ</label>
        <select id="ç™ºé€å…ƒã®åœ°åŸŸ">
          <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
        </select>
      </div>
      <div>
        <label>ç™ºé€ã¾ã§ã®æ—¥æ•°</label>
        <select id="ç™ºé€ã¾ã§ã®æ—¥æ•°">
          <option value="1~2æ—¥ã§ç™ºé€">1~2æ—¥ã§ç™ºé€</option>
        </select>
      </div>
    </div>
  </div>
</div><div class="group purchase-section">
  <div class="group-title">ä»•å…¥æƒ…å ±</div>
  <div class="form-section">
    <div class="row">
      <div>
        <label>ä»•å…¥æ—¥</label>
        <input id="ä»•å…¥æ—¥" type="date">
      </div>
      <div>
        <label>ä»•å…¥å…ˆ</label>
        <select id="ä»•å…¥å…ˆ">
          <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        </select>
      </div>
    </div>
    
    <div style="margin-top: 8px;">
      <label>ä»•å…¥é‡‘é¡</label>
      <input id="ä»•å…¥é‡‘é¡" type="number" min="0" step="1" placeholder="0">
    </div>
  </div>
</div><div class="group listing-section">
  <div class="group-title">å‡ºå“æƒ…å ±</div>

  <div class="guide-hint" style="font-size: 11px; color: #6b7280; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #d1d5db; margin: 8px 12px 12px 12px;">
    ğŸ’¡ ä¾¡æ ¼ã‚„é…é€æ–¹æ³•ãªã©å‡ºå“ã«å¿…è¦ãªæƒ…å ±ã‚’è¨­å®šã—ã¾ã™ã€‚ç™ºé€æ–¹æ³•ã¯å•†å“ç™»éŒ²è¨­å®šã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã§ã™ã€‚
  </div>

  <div class="form-section">
    <div class="row">
      <div>
        <label>å‡ºå“æ—¥</label>
        <input id="å‡ºå“æ—¥" type="date">
      </div>
      <div>
        <label>å‡ºå“å…ˆ</label>
        <select id="å‡ºå“å…ˆ">
          <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        </select>
      </div>
    </div>
    
    <!-- è²©å£²ã‚¿ã‚¤ãƒ—ï¼ˆãƒ¡ãƒ«ã‚«ãƒªé¸æŠæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
    <div id="sales-type-container" style="margin-top: 8px; display: none;">
      <label style="font-size: 12px; color: #374151; margin-bottom: 4px; display: block;">è²©å£²ã‚¿ã‚¤ãƒ—</label>
      <select id="salesType" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background: white;">
        <option value="fixed" selected>ä¾¡æ ¼ã‚’è¨­å®šã™ã‚‹</option>
        <option value="auction">ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å½¢å¼</option>
      </select>
    </div>

    <div style="margin-top: 8px;">
      <label id="listing-price-label">å‡ºå“é‡‘é¡</label>
      <div style="position: relative;">
        <input id="å‡ºå“é‡‘é¡" type="number" min="0" step="1" placeholder="0">
        <span id="auction-suffix" style="display: none; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #6b7280; font-size: 14px;">ã€œ</span>
      </div>
    </div>
  </div>
</div><div class="actions">
<button onclick="onSave()">ä¿å­˜</button>
<button id="resetButton" onclick="onReset()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>
<div class="msg" id="msg"></div>
</div> <!-- /content-container -->
</div> <!-- /platform-content-mercari -->

<!-- ãƒ¡ãƒ«ã‚«ãƒªShopsç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆé–‹ç™ºä¸­ï¼‰ -->
<div id="platform-content-mercari-shops" class="platform-content" style="display: none;">
  <div class="content-container">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; padding: 40px 20px; text-align: center;">
      <img src="/images/platform/mercari-shops.png" alt="ãƒ¡ãƒ«ã‚«ãƒªShops" style="width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.6;">
      <h2 style="font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0;">ãƒ¡ãƒ«ã‚«ãƒªShops</h2>
      <p style="font-size: 14px; color: #6b7280; margin: 0 0 24px 0;">ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™</p>
      <span style="display: inline-block; background: #fef3c7; color: #b45309; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 20px;">ğŸš§ Coming Soon</span>
    </div>
  </div>
</div>

<!-- Yahoo!ãƒ•ãƒªãƒç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆé–‹ç™ºä¸­ï¼‰ -->
<div id="platform-content-yahoo-fleamarket" class="platform-content" style="display: none;">
  <div class="content-container">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; padding: 40px 20px; text-align: center;">
      <img src="/images/platform/yahoo-fleamarket.png" alt="Yahoo!ãƒ•ãƒªãƒ" style="width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.6;">
      <h2 style="font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0;">Yahoo!ãƒ•ãƒªãƒ</h2>
      <p style="font-size: 14px; color: #6b7280; margin: 0 0 24px 0;">ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™</p>
      <span style="display: inline-block; background: #fef3c7; color: #b45309; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 20px;">ğŸš§ Coming Soon</span>
    </div>
  </div>
</div>

<!-- Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆé–‹ç™ºä¸­ï¼‰ -->
<div id="platform-content-yahoo-auction" class="platform-content" style="display: none;">
  <div class="content-container">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; padding: 40px 20px; text-align: center;">
      <img src="/images/platform/yahoo-auction.png" alt="Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³" style="width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.6;">
      <h2 style="font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0;">Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</h2>
      <p style="font-size: 14px; color: #6b7280; margin: 0 0 24px 0;">ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™</p>
      <span style="display: inline-block; background: #fef3c7; color: #b45309; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 20px;">ğŸš§ Coming Soon</span>
    </div>
  </div>
</div>

<!-- ãƒ©ã‚¯ãƒç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆé–‹ç™ºä¸­ï¼‰ -->
<div id="platform-content-rakuma" class="platform-content" style="display: none;">
  <div class="content-container">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; padding: 40px 20px; text-align: center;">
      <img src="/images/platform/rakuma.png" alt="ãƒ©ã‚¯ãƒ" style="width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.6;">
      <h2 style="font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0;">ãƒ©ã‚¯ãƒ</h2>
      <p style="font-size: 14px; color: #6b7280; margin: 0 0 24px 0;">ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™</p>
      <span style="display: inline-block; background: #fef3c7; color: #b45309; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 20px;">ğŸš§ Coming Soon</span>
    </div>
  </div>
</div>

<!-- BASEç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆé–‹ç™ºä¸­ï¼‰ -->
<div id="platform-content-base" class="platform-content" style="display: none;">
  <div class="content-container">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; padding: 40px 20px; text-align: center;">
      <img src="/images/platform/base.png" alt="BASE" style="width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.6;">
      <h2 style="font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0;">BASE</h2>
      <p style="font-size: 14px; color: #6b7280; margin: 0 0 24px 0;">ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™</p>
      <span style="display: inline-block; background: #fef3c7; color: #b45309; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 20px;">ğŸš§ Coming Soon</span>
    </div>
  </div>
</div>

<!-- Firebase SDK (compatç‰ˆ: PWAç”¨) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
  // Firebaseè¨­å®šã¨åˆæœŸåŒ–ï¼ˆPWAç‰ˆï¼‰
  const firebaseConfig = {
    apiKey: "AIzaSyCe-mj6xoV1HbHkIOVqeHCjKjwwtCorUZQ",
    authDomain: "furira.jp",
    projectId: "reborn-chat",
    storageBucket: "reborn-chat.firebasestorage.app",
    messagingSenderId: "345706548795",
    appId: "1:345706548795:web:058a553da6b4b74db5161e"
  };

  // FirebaseåˆæœŸåŒ–ï¼ˆæ—¢å­˜ã‚¢ãƒ—ãƒªãŒã‚ã‚Œã°å†åˆ©ç”¨ï¼‰
  try {
    if (typeof firebase !== 'undefined') {
      const app = firebase.apps.length ? firebase.app() : firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Firestoreè¨­å®šã®æœ€é©åŒ–ï¼ˆWebChannelã‚¨ãƒ©ãƒ¼å¯¾ç­–ï¼‰
      db.settings({
        cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED,
        experimentalForceLongPolling: true // WebSocketã®ä»£ã‚ã‚Šã«long pollingã‚’ä½¿ç”¨
      });

      window.db = db; // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
      window.firestoreReady = true; // FirestoreåˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°
      console.log('âœ… FirestoreåˆæœŸåŒ–å®Œäº†');
      console.log('   firebase.apps.length:', firebase.apps.length);

      // Firebase StorageåˆæœŸåŒ–ï¼ˆå•†å“ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
      const storage = firebase.storage();
      window.firebaseStorage = storage;
      // compatç‰ˆã®Storage APIé–¢æ•°ã‚’windowã«å…¬é–‹
      window.storageRef = (storage, path) => storage.ref(path);
      window.storageUploadBytes = async (ref, blob) => await ref.put(blob);
      window.storageGetDownloadURL = async (ref) => await ref.getDownloadURL();
      console.log('âœ… Firebase StorageåˆæœŸåŒ–å®Œäº†');

    } else {
      console.error('âŒ Firebase SDKãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
    }
  } catch (error) {
    console.error('âŒ FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
  }
</script>

<script>
  // FCMãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å®šç¾©ï¼ˆPWAç‰ˆã§ã¯ç©ºï¼‰
  var GLOBAL_FCM_TOKEN = '';
</script>

<script>
  // ===== ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆå°†æ¥æ‹¡å¼µç”¨åŸºç›¤ï¼‰=====

  // ç¾åœ¨é¸æŠä¸­ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
  window.currentPlatform = 'mercari';

  // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­å®šãƒã‚¹ã‚¿ï¼ˆå°†æ¥çš„ã«Firestoreã‹ã‚‰èª­ã¿è¾¼ã¿äºˆå®šï¼‰
  window.platformConfig = {
    'mercari': {
      name: 'ãƒ¡ãƒ«ã‚«ãƒª',
      enabled: true,
      color: '#FF0211',
      features: ['standard']
    },
    'mercari-shops': {
      name: 'ãƒ¡ãƒ«ã‚«ãƒªShops',
      enabled: false,
      color: '#FF5722',
      features: ['shops', 'business']
    },
    'yahoo-fleamarket': {
      name: 'Yahoo!ãƒ•ãƒªãƒ',
      enabled: false,
      color: '#FF0033',
      features: ['yahoo']
    },
    'yahoo-auction': {
      name: 'ãƒ¤ãƒ•ã‚ªã‚¯!',
      enabled: false,
      color: '#FF6600',
      features: ['auction', 'bidding']
    },
    'rakuma': {
      name: 'ãƒ©ã‚¯ãƒ',
      enabled: false,
      color: '#E91E63',
      features: ['rakuten']
    },
    'base': {
      name: 'BASE',
      enabled: false,
      color: '#000000',
      features: ['ec', 'shop']
    }
  };

  // ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ï¼ˆè¨­å®šã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
  window.registrationMode = 'individual';

  // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ–ã‚’è¨­å®šã«åŸºã¥ã„ã¦åˆæœŸåŒ–
  function initPlatformTabs() {
    try {
      const config = JSON.parse(localStorage.getItem('config') || '{}');
      const platformSettings = config.ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­å®š;

      if (!platformSettings) {
        console.log('[Platform] è¨­å®šãªã—ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºï¼ˆãƒ¡ãƒ«ã‚«ãƒªã®ã¿ï¼‰');
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šãƒ¡ãƒ«ã‚«ãƒªã®ã¿è¡¨ç¤º
        hidePlatformTabsExcept(['mercari']);
        return;
      }

      console.log('[Platform] è¨­å®šã‚’èª­ã¿è¾¼ã¿:', platformSettings);

      // ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
      window.registrationMode = platformSettings.registrationMode || 'individual';

      // æœ‰åŠ¹ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã¿è¡¨ç¤º
      if (platformSettings.platforms && Array.isArray(platformSettings.platforms)) {
        const enabledPlatforms = platformSettings.platforms.filter(p => p.enabled);

        console.log('[Platform] æœ‰åŠ¹ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :', enabledPlatforms.map(p => p.id));

        // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¿ãƒ–ã‚’å‹•çš„ã«è¿½åŠ 
        enabledPlatforms.forEach(p => {
          if (!window.platformConfig[p.id]) {
            // æ–°ã—ã„ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  â†’ ã‚¿ãƒ–ã¨configã‚’è¿½åŠ 
            addCustomPlatformTab(p);
          }
        });

        const enabledIds = enabledPlatforms.map(p => p.id);

        if (enabledIds.length > 0) {
          hidePlatformTabsExcept(enabledIds);

          // æœ€åˆã®æœ‰åŠ¹ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠ
          selectPlatform(enabledIds[0]);
        } else {
          // ä½•ã‚‚æœ‰åŠ¹ã§ãªã„å ´åˆã¯ãƒ¡ãƒ«ã‚«ãƒªã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
          hidePlatformTabsExcept(['mercari']);
        }
      }

      // ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦UIã‚’èª¿æ•´
      updateRegistrationModeUI();

    } catch (e) {
      console.error('[Platform] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ¡ãƒ«ã‚«ãƒªã®ã¿è¡¨ç¤º
      hidePlatformTabsExcept(['mercari']);
    }
  }

  // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¿ãƒ–ã‚’å‹•çš„ã«è¿½åŠ 
  function addCustomPlatformTab(platform) {
    const tabsContainer = document.getElementById('platformTabs');
    if (!tabsContainer) return;

    // æ—¢ã«ã‚¿ãƒ–ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
    if (document.querySelector(`.platform-tab[data-platform="${platform.id}"]`)) {
      return;
    }

    // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
    const tabButton = document.createElement('button');
    tabButton.className = 'platform-tab';
    tabButton.dataset.platform = platform.id;
    tabButton.onclick = function() { selectPlatform(platform.id); };

    const iconSrc = platform.icon || '/images/platform/default.png';
    tabButton.innerHTML = `
      <img src="${iconSrc}" alt="${platform.name}" class="platform-logo" style="width:18px;height:18px;" onerror="this.src='/images/platform/default.png'">
      <span>${platform.name}</span>
    `;

    tabsContainer.appendChild(tabButton);

    // platformConfigã«è¿½åŠ 
    window.platformConfig[platform.id] = {
      name: platform.name,
      enabled: true,
      color: '#40B4E5',
      features: ['custom'],
      isCustom: true
    };

    console.log('[Platform] ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ–è¿½åŠ :', platform.id);
  }

  // æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä»¥å¤–ã‚’éè¡¨ç¤º
  function hidePlatformTabsExcept(enabledIds) {
    const tabs = document.querySelectorAll('.platform-tab');
    tabs.forEach(tab => {
      const platformId = tab.dataset.platform;
      if (enabledIds.includes(platformId)) {
        tab.style.display = '';
      } else {
        tab.style.display = 'none';
      }
    });

    // ã‚¿ãƒ–ãŒ1ã¤ã ã‘ãªã‚‰ã€ã‚¿ãƒ–ãƒãƒ¼è‡ªä½“ã‚’éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«ï¼‰
    const visibleTabs = document.querySelectorAll('.platform-tab:not([style*="display: none"])');
    const tabsContainer = document.querySelector('.platform-tabs-container');
    if (tabsContainer) {
      tabsContainer.style.display = visibleTabs.length <= 1 ? 'none' : '';
    }
  }

  // ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸUIèª¿æ•´
  function updateRegistrationModeUI() {
    // å°†æ¥å®Ÿè£…: ä¸€æ‹¬ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®UIå¤‰æ›´
    if (window.registrationMode === 'batch') {
      console.log('[Platform] ä¸€æ‹¬ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ - UIèª¿æ•´ï¼ˆå°†æ¥å®Ÿè£…ï¼‰');
      // ä¾‹: ç™»éŒ²ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´ã€è¤‡æ•°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åŒæ™‚é¸æŠUIç­‰
    }
  }

  // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
  function selectPlatform(platformId) {
    const config = window.platformConfig[platformId];

    if (!config) {
      console.error('[Platform] ä¸æ˜ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :', platformId);
      return;
    }

    // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
    const tabs = document.querySelectorAll('.platform-tab');
    tabs.forEach(tab => {
      if (tab.dataset.platform === platformId) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });

    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    const allContents = document.querySelectorAll('.platform-content');
    allContents.forEach(content => {
      content.style.display = 'none';
    });

    // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å ´åˆã¯ãƒ¡ãƒ«ã‚«ãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½¿ç”¨
    let contentId = 'platform-content-' + platformId;
    let targetContent = document.getElementById(contentId);

    if (!targetContent && config.isCustom) {
      // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  â†’ ãƒ¡ãƒ«ã‚«ãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½¿ç”¨
      contentId = 'platform-content-mercari';
      targetContent = document.getElementById(contentId);
      console.log('[Platform] ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  - ãƒ¡ãƒ«ã‚«ãƒªãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨:', platformId);
    }

    if (targetContent) {
      targetContent.style.display = 'block';
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’æ›´æ–°
    window.currentPlatform = platformId;
    console.log('[Platform] åˆ‡ã‚Šæ›¿ãˆ:', config.name, config.isCustom ? '(ã‚«ã‚¹ã‚¿ãƒ )' : (config.enabled ? '(å®Ÿè£…æ¸ˆ)' : '(æº–å‚™ä¸­)'));
  }

  // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰
  function onPlatformChanged(platformId) {
    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®UIã‚’è¡¨ç¤º/éè¡¨ç¤º
    // ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¿…é ˆ/ä»»æ„ã‚’åˆ‡ã‚Šæ›¿ãˆ
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›´
    console.log('[Platform] ãƒ•ã‚©ãƒ¼ãƒ æ›´æ–°:', platformId);
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ–ã‚’åˆæœŸåŒ–
  document.addEventListener('DOMContentLoaded', function() {
    initPlatformTabs();
  });
</script>

<!-- å¤–éƒ¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰-->
<!-- CACHED_CONFIGç­‰ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚ˆã‚Šå…ˆã«èª­ã¿è¾¼ã‚€ -->
<script src="/js/webhook-config.js"></script>
<script src="/js/product-scripts.js?v=180-category-filter"></script>

<!-- Firestoreç‰ˆãƒ–ãƒ©ãƒ³ãƒ‰æ¤œç´¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
<script type="module">
  // Cloudflare Pagesã‹ã‚‰Firestore APIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
  import('https://reborn-inventory-system.pages.dev/js/firestore-api.js').then(module => {
      
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    window.searchBrands = module.searchBrands || module.default?.searchBrands;
    window.incrementBrandUsageCount = module.incrementBrandUsageCount || module.default?.incrementBrandUsageCount;
    window.preloadBrandsInBackground = module.preloadBrandsInBackground || module.default?.preloadBrandsInBackground;
    window.searchBrandsFromCache = module.searchBrandsFromCache || module.default?.searchBrandsFromCache;
    
    // ãƒ–ãƒ©ãƒ³ãƒ‰ã‚µã‚¸ã‚§ã‚¹ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ï¼ˆAlgoliaç‰ˆï¼‰
    return import('https://reborn-inventory-system.pages.dev/js/brand-suggest-algolia.js?v=96-keyboard-auto-match');
  }).then(() => {
      // èª­ã¿è¾¼ã¿å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    window.algoliaBrandModulesLoaded = true;
  }).catch(error => {
    console.error('âŒ Firestoreãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
  });
</script>



<!-- Firebase Cloud Messaging - ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€šçŸ¥å¯¾å¿œ -->
<script type="module">
  // Firebaseè¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyAwJKTz1gm3CIz_R4YTlbQopgaBq1ULt1A",
    authDomain: "reborn-pwa.firebaseapp.com",
    projectId: "reborn-pwa",
    storageBucket: "reborn-pwa.firebasestorage.app",
    messagingSenderId: "345653439471",
    appId: "1:345653439471:web:7620819ce3f022d9cd241a",
    measurementId: "G-SX48K45X75"
  };

  // FirebaseåˆæœŸåŒ–
  async function initFirebaseMessaging() {
    // iframeå†…ã§ã¯åˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆPWAç‰ˆã§æ—¢ã«å‹•ä½œã—ã¦ã„ã‚‹ãŸã‚ï¼‰
    const isInIframe = window.self !== window.top;
    if (isInIframe) {
      console.log('â„¹ï¸ iframeå†…ã®ãŸã‚ã€Firebase MessagingåˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
      return;
    }
    
    try {
      // Firebase App ã¨ Messaging ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      const { initializeApp, getApps, getApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
      const { getMessaging, onMessage } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js');

      // æ—¢ã«åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      let app;
      if (getApps().length === 0) {
        app = initializeApp(firebaseConfig);
        console.log('âœ… Firebase AppåˆæœŸåŒ–ï¼ˆå•†å“ç™»éŒ²ãƒšãƒ¼ã‚¸ï¼‰');
      } else {
        app = getApp();
        console.log('âœ… æ—¢å­˜ã®Firebase Appã‚’ä½¿ç”¨ï¼ˆå•†å“ç™»éŒ²ãƒšãƒ¼ã‚¸ï¼‰');
      }

      const messaging = getMessaging(app);
    
      // ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ï¼ˆã‚¢ãƒ—ãƒªãŒé–‹ã„ã¦ã„ã‚‹æ™‚ï¼‰
      onMessage(messaging, (payload) => {
        console.log('ğŸ“¨ ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ï¼ˆå•†å“ç™»éŒ²ãƒšãƒ¼ã‚¸ï¼‰:', payload);

        // é€šçŸ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const notificationTitle = payload.data?.title || payload.notification?.title || 'REBORN';
        const notificationBody = payload.data?.body || payload.notification?.body || 'æ–°ã—ã„é€šçŸ¥ãŒã‚ã‚Šã¾ã™';

        // ãƒãƒƒã‚¸ã‚’æ›´æ–°
        incrementBadgeIfAvailable();

        // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ã‚’è¡¨ç¤º
        if (Notification.permission === 'granted') {
          new Notification(notificationTitle, {
            body: notificationBody,
            icon: '/reborn-inventory-system/icon-180.png',
            badge: '/reborn-inventory-system/icon-192.png',
            tag: 'reborn-notification-product-page',
            requireInteraction: false  // è‡ªå‹•ã§æ¶ˆãˆã‚‹
          });
          console.log('ğŸ”” ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼ˆå•†å“ç™»éŒ²ãƒšãƒ¼ã‚¸ï¼‰');
        }
      });

    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒšãƒ¼ã‚¸ã®ä»–ã®æ©Ÿèƒ½ã«å½±éŸ¿ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
      console.error('âŒ Firebase MessagingåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      console.log('âš ï¸ é€šçŸ¥æ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ãŒã€ä»–ã®æ©Ÿèƒ½ã¯æ­£å¸¸ã«å‹•ä½œã—ã¾ã™');
    }
  }

  // ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™ï¼ˆåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰
  function incrementBadgeIfAvailable() {
    try {
      // localStorageã‹ã‚‰ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—
      const currentCount = parseInt(localStorage.getItem('badgeCount') || '0', 10);
      const newCount = currentCount + 1;

      // localStorageã«ä¿å­˜
      localStorage.setItem('badgeCount', newCount.toString());
      console.log('ğŸ“› ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°:', newCount);

      // Badge APIã§æ›´æ–°ï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰
      if ('setAppBadge' in navigator) {
        navigator.setAppBadge(newCount)
          .then(() => console.log('âœ… Badge APIæ›´æ–°æˆåŠŸ:', newCount))
          .catch(err => console.error('âŒ Badge APIã‚¨ãƒ©ãƒ¼:', err));
      }
    } catch (error) {
      console.error('âŒ ãƒãƒƒã‚¸æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã€å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰Firebase Messagingã‚’åˆæœŸåŒ–
  // ï¼ˆä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã‚’å¾…ã¤ï¼‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initFirebaseMessaging, 2000);
    });
  } else {
    setTimeout(initFirebaseMessaging, 2000);
  }

  // ================= è¨­å®šå¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼ï¼ˆpostMessageï¼‰ =================

  /**
   * localStorageã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§window.CACHED_CONFIGã‚’æ›´æ–°
   * CONFIG_STORAGE_KEYSã¯product-scripts.jsã§å®šç¾©æ¸ˆã¿ï¼ˆwindow.CONFIG_STORAGE_KEYSï¼‰
   */
  function reloadConfigFromLocalStorage() {
    try {
      console.log('ğŸ”„ localStorageã‹ã‚‰è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ä¸­...');

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«window.CACHED_CONFIGå¤‰æ•°ã‚’æ›´æ–°
      if (!window.CACHED_CONFIG) {
        window.CACHED_CONFIG = {};
      }

      const conditionButtons = localStorage.getItem(window.CONFIG_STORAGE_KEYS.CONDITION_BUTTONS);
      const hashtag = localStorage.getItem(window.CONFIG_STORAGE_KEYS.HASHTAG);
      const discount = localStorage.getItem(window.CONFIG_STORAGE_KEYS.DISCOUNT);
      const shippingDefault = localStorage.getItem(window.CONFIG_STORAGE_KEYS.SHIPPING_DEFAULT);
      const procureListingDefault = localStorage.getItem(window.CONFIG_STORAGE_KEYS.PROCURE_LISTING_DEFAULT);
      const managementNumber = localStorage.getItem(window.CONFIG_STORAGE_KEYS.MANAGEMENT_NUMBER);
      const salesword = localStorage.getItem(window.CONFIG_STORAGE_KEYS.SALESWORD);
      const aiSettings = localStorage.getItem(window.CONFIG_STORAGE_KEYS.AI_SETTINGS);
      const theme = localStorage.getItem(window.CONFIG_STORAGE_KEYS.DESIGN_THEME);

      if (conditionButtons) window.CACHED_CONFIG['å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³'] = JSON.parse(conditionButtons);
      if (hashtag) window.CACHED_CONFIG['ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°'] = JSON.parse(hashtag);
      if (discount) window.CACHED_CONFIG['å‰²å¼•æƒ…å ±'] = JSON.parse(discount);
      if (shippingDefault) window.CACHED_CONFIG['é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'] = JSON.parse(shippingDefault);
      if (procureListingDefault) window.CACHED_CONFIG['ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'] = JSON.parse(procureListingDefault);
      if (managementNumber) window.CACHED_CONFIG['ç®¡ç†ç•ªå·è¨­å®š'] = JSON.parse(managementNumber);
      if (salesword) window.CACHED_CONFIG['ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰'] = JSON.parse(salesword);
      if (aiSettings) window.CACHED_CONFIG['AIç”Ÿæˆè¨­å®š'] = JSON.parse(aiSettings);
      if (theme) window.CACHED_CONFIG['ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ'] = theme;

      console.log('âœ… window.CACHED_CONFIGã‚’æ›´æ–°ã—ã¾ã—ãŸ:', window.CACHED_CONFIG);

      // å•†å“ç”»åƒãƒ–ãƒ­ãƒƒã‚¯ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ›´æ–°
      checkProductImageBlockVisibility();

      console.log('âœ… è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã—ãŸ');
    } catch (e) {
      console.error('âŒ localStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
    }
  }

  /**
   * postMessageãƒªã‚¹ãƒŠãƒ¼ï¼ˆè¨­å®šå¤‰æ›´é€šçŸ¥ã‚’å—ã‘å–ã‚‹ï¼‰
   */
  window.addEventListener('message', function(event) {
    // configChangedãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã£ãŸã‚‰è¨­å®šã‚’å†èª­ã¿è¾¼ã¿
    if (event.data && event.data.type === 'configChanged') {
      console.log('ğŸ“¥ è¨­å®šå¤‰æ›´é€šçŸ¥ã‚’å—ä¿¡ã—ã¾ã—ãŸ');
      reloadConfigFromLocalStorage();
    }
  });

  console.log('âœ… è¨­å®šå¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');

  // DOMContentLoadedå¾Œã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’åˆæœŸåŒ–
  document.addEventListener('DOMContentLoaded', initLoadingOverlay);

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰é©ç”¨ã¯product-scripts.jsã«çµ±åˆï¼ˆé‡è¤‡å‰Šé™¤ï¼‰

</script>

<!-- QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<!-- QRã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="qrCodeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
  <div style="background: white; border-radius: 16px; padding: 24px; max-width: 360px; width: 90%; text-align: center;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
      <h5 style="margin: 0; font-weight: 600;">QRã‚³ãƒ¼ãƒ‰</h5>
      <button onclick="closeQRCodeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">Ã—</button>
    </div>

    <div id="qrCodeContainer" style="margin: 16px auto; padding: 16px; background: white; border: 2px solid #e5e7eb; border-radius: 12px;">
      <canvas id="qrCodeCanvas"></canvas>
    </div>

    <div id="qrCodeInfo" style="margin-bottom: 16px; text-align: left; background: #f9fafb; border-radius: 8px; padding: 12px;">
      <div style="font-size: 12px; color: #6b7280;">ç®¡ç†ç•ªå·</div>
      <div id="qrMgmtNumber" style="font-weight: 700; font-size: 18px; color: #1f2937;"></div>
      <div id="qrProductName" style="font-size: 13px; color: #374151; margin-top: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
    </div>

    <div style="display: flex; gap: 8px;">
      <button onclick="downloadQRCode()" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        <i class="bi bi-download"></i> ä¿å­˜
      </button>
      <button onclick="printQRCode()" style="flex: 1; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        <i class="bi bi-printer"></i> å°åˆ·
      </button>
    </div>

    <div style="margin-top: 12px; font-size: 11px; color: #9ca3af;">
      æ£šå¸æ™‚ã«ã‚¹ãƒãƒ›ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã¨<br>å•†å“æƒ…å ±ã‚’ç´ æ—©ãå‘¼ã³å‡ºã›ã¾ã™
    </div>
  </div>
</div>

<script>
  // QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ç•ªå·ãŒç¢ºå®šã—ãŸã‚‰è¡¨ç¤º
  function updateQRCodeSectionVisibility() {
    const mgmtNumber = document.getElementById('ç®¡ç†ç•ªå·')?.value;
    const qrSection = document.getElementById('qrCodeSection');
    if (qrSection) {
      qrSection.style.display = mgmtNumber ? 'block' : 'none';
    }
  }

  // ç®¡ç†ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤‰æ›´ã‚’ç›£è¦–
  const mgmtNumberInput = document.getElementById('ç®¡ç†ç•ªå·');
  if (mgmtNumberInput) {
    // MutationObserverã§valueå¤‰æ›´ã‚’æ¤œçŸ¥
    const observer = new MutationObserver(() => updateQRCodeSectionVisibility());
    observer.observe(mgmtNumberInput, { attributes: true, attributeFilter: ['value'] });

    // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚‚æ¤œçŸ¥
    mgmtNumberInput.addEventListener('input', updateQRCodeSectionVisibility);
    mgmtNumberInput.addEventListener('change', updateQRCodeSectionVisibility);

    // åˆæœŸãƒã‚§ãƒƒã‚¯ï¼ˆé…å»¶å®Ÿè¡Œï¼‰
    setTimeout(updateQRCodeSectionVisibility, 1000);
  }

  // QRã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  function showQRCodeModal() {
    const mgmtNumber = document.getElementById('ç®¡ç†ç•ªå·')?.value;
    if (!mgmtNumber) {
      alert('ç®¡ç†ç•ªå·ãŒã‚ã‚Šã¾ã›ã‚“');
      return;
    }

    const productName = document.getElementById('å•†å“å')?.value ||
                       document.getElementById('productName')?.value ||
                       '';
    const brand = document.getElementById('ãƒ–ãƒ©ãƒ³ãƒ‰')?.value || '';

    // QRã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
    const qrData = JSON.stringify({
      type: 'product',
      managementNumber: mgmtNumber,
      name: (brand + ' ' + productName).trim().slice(0, 50)
    });

    // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
    const canvas = document.getElementById('qrCodeCanvas');
    QRCode.toCanvas(canvas, qrData, {
      width: 200,
      margin: 2,
      errorCorrectionLevel: 'M',
      color: {
        dark: '#000000',
        light: '#ffffff'
      }
    }, function(error) {
      if (error) {
        console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        alert('QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        return;
      }
    });

    // æƒ…å ±è¡¨ç¤º
    document.getElementById('qrMgmtNumber').textContent = mgmtNumber;
    document.getElementById('qrProductName').textContent = (brand + ' ' + productName).trim() || '-';

    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    document.getElementById('qrCodeModal').style.display = 'flex';
  }

  function closeQRCodeModal() {
    document.getElementById('qrCodeModal').style.display = 'none';
  }

  // QRã‚³ãƒ¼ãƒ‰ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  function downloadQRCode() {
    const canvas = document.getElementById('qrCodeCanvas');
    const mgmtNumber = document.getElementById('qrMgmtNumber').textContent;

    const link = document.createElement('a');
    link.download = `QR_${mgmtNumber}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
  }

  // QRã‚³ãƒ¼ãƒ‰å°åˆ· v307: iOSå¯¾å¿œï¼ˆé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³è¿½åŠ ï¼‰
  function printQRCode() {
    const canvas = document.getElementById('qrCodeCanvas');
    const mgmtNumber = document.getElementById('qrMgmtNumber').textContent;
    const productName = document.getElementById('qrProductName').textContent;

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>QRã‚³ãƒ¼ãƒ‰ - ${mgmtNumber}</title>
        <style>
          @page { size: 62mm 29mm; margin: 0; }
          body {
            margin: 0;
            padding: 4mm;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            align-items: center;
            gap: 4mm;
          }
          .qr-code { width: 20mm; height: 20mm; }
          .info { flex: 1; }
          .mgmt-number { font-size: 14pt; font-weight: bold; }
          .product-name { font-size: 8pt; color: #666; margin-top: 2mm; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 30mm; }
          /* v307: iOSç”¨ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
          .close-btn-container {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 9999;
          }
          .close-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          }
          @media print {
            .close-btn-container { display: none !important; }
          }
        </style>
      </head>
      <body>
        <img src="${canvas.toDataURL('image/png')}" class="qr-code">
        <div class="info">
          <div class="mgmt-number">${mgmtNumber}</div>
          <div class="product-name">${productName}</div>
        </div>
        <!-- v307: iOSç”¨ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="close-btn-container">
          <button class="close-btn" onclick="window.close(); history.back();">å°åˆ·å®Œäº†ãƒ»é–‰ã˜ã‚‹</button>
        </div>
      </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.onload = function() {
      printWindow.print();
      // v307: iOS Safariã§ã¯window.close()ãŒåŠ¹ã‹ãªã„ãŸã‚ã€ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
      // PCãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯è‡ªå‹•ã§é–‰ã˜ã‚‹è©¦è¡Œ
      setTimeout(function() {
        try { printWindow.close(); } catch(e) {}
      }, 1000);
    };
  }

  // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  document.getElementById('qrCodeModal')?.addEventListener('click', function(e) {
    if (e.target === this) closeQRCodeModal();
  });

  // ========================================
  // QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šæ©Ÿèƒ½ï¼ˆä»•å…¥å•†å“ç´ä»˜ã‘ï¼‰
  // ========================================
  let qrScanner = null;

  function openQRScanner() {
    const modal = document.getElementById('qrScannerModal');
    if (modal) {
      modal.style.display = 'flex';
      startQRScanner();
    }
  }

  function closeQRScanner() {
    const modal = document.getElementById('qrScannerModal');
    if (modal) {
      modal.style.display = 'none';
    }
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆã‚’éè¡¨ç¤ºï¼ˆæ¬¡å›ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã®ãŸã‚ï¼‰
    const overlay = document.getElementById('qrOverlayText');
    if (overlay) overlay.style.display = 'none';
    stopQRScanner();

    // ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
    const pageHeader = document.getElementById('pageHeader');
    if (pageHeader) {
      pageHeader.style.display = 'flex';  // flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãŸã‚
    }
    const mainContent = document.getElementById('mainFormContent');
    if (mainContent) {
      mainContent.style.display = 'block';
    }
  }

  function startQRScanner() {
    const readerElement = document.getElementById('qrReader');
    if (!readerElement) return;

    // html5-qrcodeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
    if (typeof Html5Qrcode === 'undefined') {
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js';
      script.onload = function() {
        initQRScanner();
      };
      document.head.appendChild(script);
    } else {
      initQRScanner();
    }
  }

  function initQRScanner() {
    qrScanner = new Html5Qrcode("qrReader");
    qrScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: { width: 250, height: 250 } },
      onQRScanSuccess,
      onQRScanFailure
    ).then(() => {
      // ã‚«ãƒ¡ãƒ©èµ·å‹•æˆåŠŸæ™‚ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
      const overlay = document.getElementById('qrOverlayText');
      if (overlay) overlay.style.display = 'block';
    }).catch(err => {
      console.error("ã‚«ãƒ¡ãƒ©èµ·å‹•å¤±æ•—:", err);
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤ºã®ã¾ã¾
      const overlay = document.getElementById('qrOverlayText');
      if (overlay) overlay.style.display = 'none';
      document.getElementById('qrReader').innerHTML = `
        <div style="text-align: center; padding: 20px; color: #ef4444;">
          <i class="bi bi-camera-video-off" style="font-size: 48px;"></i>
          <p>ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“</p>
          <button onclick="manualInvIdInput()" style="margin-top: 12px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
            æ‰‹å‹•ã§å…¥åŠ›
          </button>
        </div>
      `;
    });
  }

  function stopQRScanner() {
    if (qrScanner) {
      qrScanner.stop().catch(err => console.log("Scanner stop error:", err));
      qrScanner = null;
    }
  }

  async function onQRScanSuccess(decodedText) {
    console.log('ğŸ“· QRã‚¹ã‚­ãƒ£ãƒ³æˆåŠŸ:', decodedText);

    // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢
    stopQRScanner();
    closeQRScanner();

    // INV-010: slotIdå½¢å¼ã®QRã‚³ãƒ¼ãƒ‰å¯¾å¿œï¼ˆBATCH-ã§å§‹ã¾ã‚‹ï¼‰
    if (decodedText.startsWith('BATCH-')) {
      try {
        const db = firebase.firestore();
        const slotDoc = await db.collection('purchaseSlots').doc(decodedText).get();
        if (!slotDoc.exists) {
          alert('âš ï¸ ã“ã®ã‚¹ãƒ­ãƒƒãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
          return;
        }
        const slotData = slotDoc.data();
        console.log('ğŸ“¦ slotIdå½¢å¼QRã‚³ãƒ¼ãƒ‰æ¤œå‡º:', slotData);

        // INV-010: sku-basedå•†å“ã®å ´åˆã¯åœ¨åº«è¿½åŠ ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
        if (slotData.itemType === 'sku-based' && slotData.skuId) {
          // æ—¢å­˜SKUã§ç™»éŒ²æ¸ˆã¿å•†å“ãŒã‚ã‚‹ã‹ç¢ºèª
          const existingProduct = await findProductBySkuId(slotData.skuId);

          if (existingProduct) {
            // æ—¢å­˜SKUå•†å“ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆï¼šåœ¨åº«è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
            const choice = confirm(
              `ğŸ“¦ æ—¢å­˜SKUå•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ\n\n` +
              `å•†å“å: ${existingProduct.å•†å“å || existingProduct.name || 'æœªè¨­å®š'}\n` +
              `ç¾åœ¨åº«: ${existingProduct.stockQuantity || 0}ç‚¹\n` +
              `è¿½åŠ æ•°: ${slotData.quantity}ç‚¹\n\n` +
              `ã€OKã€‘åœ¨åº«ã‚’è¿½åŠ ï¼ˆ${(existingProduct.stockQuantity || 0) + slotData.quantity}ç‚¹ã«ãªã‚Šã¾ã™ï¼‰\n` +
              `ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‘æ–°è¦å•†å“ã¨ã—ã¦ç™»éŒ²`
            );

            if (choice) {
              // åœ¨åº«è¿½åŠ å‡¦ç†
              await addStockToExistingSku(slotData.skuId, slotData.quantity, slotData.slotId);
              alert(`âœ… åœ¨åº«ã‚’è¿½åŠ ã—ã¾ã—ãŸ\n\nå•†å“: ${existingProduct.å•†å“å || existingProduct.name}\næ–°åœ¨åº«æ•°: ${(existingProduct.stockQuantity || 0) + slotData.quantity}ç‚¹`);
              return;
            }
            // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼šæ–°è¦å•†å“ç™»éŒ²ã¸ç¶šè¡Œ
          } else {
            // SKUã¯ã‚ã‚‹ãŒå•†å“æœªç™»éŒ²ã®å ´åˆ
            const result = confirm(
              `ğŸ“¦ æ–°å“(è¤‡æ•°)å•†å“ã§ã™\n\n` +
              `æ•°é‡: ${slotData.quantity}ç‚¹\n` +
              `ä»•å…¥å˜ä¾¡: Â¥${slotData.unitPrice?.toLocaleString() || '-'}\n` +
              `SKU: ${slotData.skuId}\n\n` +
              `å•†å“ç™»éŒ²ã‚’ç¶šã‘ã¾ã™ã‹ï¼Ÿ`
            );
            if (!result) return;
          }
        } else if (slotData.itemType === 'sku-based') {
          // SKU IDãŒãªã„å ´åˆï¼ˆæ—§ãƒ‡ãƒ¼ã‚¿äº’æ›ï¼‰
          const result = confirm(
            `ğŸ“¦ æ–°å“(è¤‡æ•°)å•†å“ã§ã™\n\n` +
            `æ•°é‡: ${slotData.quantity}ç‚¹\n` +
            `ä»•å…¥å˜ä¾¡: Â¥${slotData.unitPrice?.toLocaleString() || '-'}\n\n` +
            `å•†å“ç™»éŒ²ã‚’ç¶šã‘ã¾ã™ã‹ï¼Ÿ`
          );
          if (!result) return;
        }

        // qrDataãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
        const qrData = {
          s: slotData.slotId,
          n: slotData.slotNumber,
          d: slotData.purchaseDate,
          sup: slotData.supplier,
          amt: slotData.amount,
          asg: slotData.assignee,
          m: slotData.memo || '',
          cat: slotData.category || null,
          sz: slotData.size || '',
          br: slotData.brand || '',
          brk: slotData.brandKana || '',
          cnd: slotData.condition || '',
          acc: slotData.accessories || [],
          nt: slotData.note || '',
          // INV-010: è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
          itemType: slotData.itemType || 'unique',
          quantity: slotData.quantity || 1,
          skuId: slotData.skuId || null,
          unitPrice: slotData.unitPrice || null
        };

        // ä»•å…¥å•†å“IDã‚’ã‚»ãƒƒãƒˆ
        setInvId(slotData.slotId);

        // ä»•å…¥æƒ…å ±ã‚’è‡ªå‹•åæ˜ 
        applyPurchaseQRData(qrData);
        return;
      } catch (error) {
        console.error('slotId QRã‚³ãƒ¼ãƒ‰å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
        alert('âš ï¸ ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        return;
      }
    }

    // JSONå½¢å¼ã®ä»•å…¥QRã‚³ãƒ¼ãƒ‰ã‹ãƒã‚§ãƒƒã‚¯
    let qrData = null;
    try {
      qrData = JSON.parse(decodedText);
    } catch (e) {
      // JSONå½¢å¼ã§ãªã„å ´åˆã¯å¾“æ¥ã®å‡¦ç†
    }

    // ä»•å…¥QRã‚³ãƒ¼ãƒ‰ï¼ˆæ¤œå“æƒ…å ±ä»˜ãï¼‰ã®å ´åˆ
    if (qrData && qrData.s && qrData.n) {
      console.log('ğŸ“¦ ä»•å…¥QRã‚³ãƒ¼ãƒ‰æ¤œå‡ºï¼ˆæ¤œå“æƒ…å ±ä»˜ãï¼‰:', qrData);

      // ä»•å…¥å•†å“IDã‚’ã‚»ãƒƒãƒˆ
      setInvId(qrData.s);

      // ä»•å…¥æƒ…å ±ã‚’è‡ªå‹•åæ˜ 
      applyPurchaseQRData(qrData);
      return;
    }

    // å¾“æ¥ã®å‡¦ç†ï¼ˆURLãƒ™ãƒ¼ã‚¹ã®invIdæŠ½å‡ºï¼‰
    let invId = decodedText;
    try {
      const url = new URL(decodedText);
      invId = url.searchParams.get('inv') || decodedText;
    } catch (e) {
      // URLã§ãªã„å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
    }

    // ä»•å…¥å•†å“IDã‚’ã‚»ãƒƒãƒˆ
    setInvId(invId);
  }

  // ä»•å…¥QRã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å•†å“ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•åæ˜ 
  function applyPurchaseQRData(qrData) {
    console.log('ğŸ”„ æ¤œå“æƒ…å ±ã‚’è‡ªå‹•åæ˜ ä¸­...');
    
    // ä»•å…¥æ—¥
    if (qrData.d) {
      const purchaseDateEl = document.getElementById('ä»•å…¥æ—¥');
      if (purchaseDateEl) purchaseDateEl.value = qrData.d;
    }
    
    // ä»•å…¥é‡‘é¡
    if (qrData.amt) {
      const purchaseAmountEl = document.getElementById('ä»•å…¥é‡‘é¡');
      if (purchaseAmountEl) purchaseAmountEl.value = qrData.amt;
    }
    
    // ä»•å…¥å…ˆ
    if (qrData.sup) {
      const supplierEl = document.getElementById('ä»•å…¥å…ˆ');
      if (supplierEl) {
        // selectã®é¸æŠè‚¢ã‹ã‚‰ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æ¢ã™
        const options = supplierEl.options;
        for (let i = 0; i < options.length; i++) {
          if (options[i].value === qrData.sup || options[i].text.includes(qrData.sup)) {
            supplierEl.selectedIndex = i;
            break;
          }
        }
      }
    }
    
    // ã‚«ãƒ†ã‚´ãƒªï¼ˆ7éšå±¤å¯¾å¿œï¼‰
    if (qrData.cat) {
      const categoryObj = typeof qrData.cat === 'object' ? qrData.cat : { superCategory: qrData.cat };

      // ç‰¹å¤§åˆ†é¡
      if (categoryObj.superCategory) {
        const l0El = document.getElementById('ç‰¹å¤§åˆ†é¡');
        if (l0El) {
          for (let i = 0; i < l0El.options.length; i++) {
            if (l0El.options[i].value === categoryObj.superCategory) {
              l0El.selectedIndex = i;
              l0El.dispatchEvent(new Event('change', { bubbles: true }));
              break;
            }
          }
        }
      }

      // å¤§åˆ†é¡ã€œã‚¢ã‚¤ãƒ†ãƒ åã¯é€£å‹•ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãªã®ã§ã€å°‘ã—é…å»¶ã•ã›ã¦è¨­å®š
      setTimeout(() => {
        // å¤§åˆ†é¡
        if (categoryObj.major) {
          const l1El = document.getElementById('å¤§åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
          if (l1El) {
            for (let i = 0; i < l1El.options.length; i++) {
              if (l1El.options[i].value === categoryObj.major) {
                l1El.selectedIndex = i;
                l1El.dispatchEvent(new Event('change', { bubbles: true }));
                break;
              }
            }
          }
        }

        setTimeout(() => {
          // ä¸­åˆ†é¡
          if (categoryObj.middle) {
            const l2El = document.getElementById('ä¸­åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
            if (l2El) {
              for (let i = 0; i < l2El.options.length; i++) {
                if (l2El.options[i].value === categoryObj.middle) {
                  l2El.selectedIndex = i;
                  l2El.dispatchEvent(new Event('change', { bubbles: true }));
                  break;
                }
              }
            }
          }

          setTimeout(() => {
            // å°åˆ†é¡
            if (categoryObj.small) {
              const l3El = document.getElementById('å°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
              if (l3El) {
                for (let i = 0; i < l3El.options.length; i++) {
                  if (l3El.options[i].value === categoryObj.small) {
                    l3El.selectedIndex = i;
                    l3El.dispatchEvent(new Event('change', { bubbles: true }));
                    break;
                  }
                }
              }
            }

            setTimeout(() => {
              // ç´°åˆ†é¡
              if (categoryObj.fine) {
                const l4El = document.getElementById('ç´°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
                if (l4El) {
                  for (let i = 0; i < l4El.options.length; i++) {
                    if (l4El.options[i].value === categoryObj.fine) {
                      l4El.selectedIndex = i;
                      l4El.dispatchEvent(new Event('change', { bubbles: true }));
                      break;
                    }
                  }
                }
              }

              setTimeout(() => {
                // ç´°åˆ†é¡2
                if (categoryObj.fine2) {
                  const l5El = document.getElementById('ç´°åˆ†é¡2');
                  if (l5El) {
                    for (let i = 0; i < l5El.options.length; i++) {
                      if (l5El.options[i].value === categoryObj.fine2) {
                        l5El.selectedIndex = i;
                        l5El.dispatchEvent(new Event('change', { bubbles: true }));
                        break;
                      }
                    }
                  }
                }

                setTimeout(() => {
                  // ã‚¢ã‚¤ãƒ†ãƒ å
                  if (categoryObj.itemName) {
                    const itemEl = document.getElementById('ã‚¢ã‚¤ãƒ†ãƒ å');
                    if (itemEl) {
                      for (let i = 0; i < itemEl.options.length; i++) {
                        if (itemEl.options[i].value === categoryObj.itemName) {
                          itemEl.selectedIndex = i;
                          itemEl.dispatchEvent(new Event('change', { bubbles: true }));
                          break;
                        }
                      }
                    }
                  }
                }, 100);
              }, 100);
            }, 100);
          }, 100);
        }, 100);
      }, 100);
    }

    // ã‚µã‚¤ã‚º
    if (qrData.sz) {
      const sizeEl = document.getElementById('ã‚µã‚¤ã‚º');
      if (sizeEl) sizeEl.value = qrData.sz;
    }

    // ãƒ–ãƒ©ãƒ³ãƒ‰
    if (qrData.br) {
      const brandEl = document.getElementById('ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)');
      if (brandEl) brandEl.value = qrData.br;
      // å•†å“åç”¨ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚‚åæ˜ 
      const brandNameEl = document.getElementById('å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)');
      if (brandNameEl) brandNameEl.value = qrData.br;
      // ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒŠã‚‚åæ˜ 
      if (qrData.brk) {
        const brandKanaEl = document.getElementById('ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)');
        if (brandKanaEl) brandKanaEl.value = qrData.brk;
        const brandNameKanaEl = document.getElementById('å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)');
        if (brandNameKanaEl) brandNameKanaEl.value = qrData.brk;
      }
    }
    
    // å•†å“ã®çŠ¶æ…‹
    if (qrData.cnd) {
      const conditionEl = document.getElementById('å•†å“ã®çŠ¶æ…‹');
      if (conditionEl) {
        const options = conditionEl.options;
        for (let i = 0; i < options.length; i++) {
          if (options[i].value === qrData.cnd || options[i].text === qrData.cnd) {
            conditionEl.selectedIndex = i;
            conditionEl.dispatchEvent(new Event('change', { bubbles: true }));
            break;
          }
        }
      }
    }
    
    // ä»˜å±å“æƒ…å ±ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«é€£å‹•ï¼‰
    if (qrData.acc && qrData.acc.length > 0) {
      // ä»˜å±å“ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¨­å®šï¼ˆproduct-scripts.jsã§å®šç¾©ï¼‰
      if (typeof window.setAccessoriesFromQR === 'function') {
        window.setAccessoriesFromQR(qrData.acc);
      } else {
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å•†å“çŠ¶æ…‹è©³ç´°ã«è¿½åŠ 
        const accessoriesText = 'ã€ä»˜å±å“ã€‘' + qrData.acc.join('ã€');
        const conditionDetailEl = document.getElementById('å•†å“çŠ¶æ…‹è©³ç´°');
        if (conditionDetailEl) {
          const current = conditionDetailEl.value;
          conditionDetailEl.value = current ? current + '\n' + accessoriesText : accessoriesText;
        }
      }
    }
    
    // ç‰¹è¨˜äº‹é …ï¼ˆæ¤œå“ãƒ¡ãƒ¢ï¼‰
    if (qrData.nt) {
      const conditionDetailEl = document.getElementById('å•†å“çŠ¶æ…‹è©³ç´°');
      if (conditionDetailEl) {
        const current = conditionDetailEl.value;
        const noteText = 'ã€æ¤œå“ãƒ¡ãƒ¢ã€‘' + qrData.nt;
        conditionDetailEl.value = current ? current + '\n' + noteText : noteText;
      }
    }
    
    // ãƒ¡ãƒ¢
    if (qrData.m) {
      const conditionDetailEl = document.getElementById('å•†å“çŠ¶æ…‹è©³ç´°');
      if (conditionDetailEl && qrData.m) {
        const current = conditionDetailEl.value;
        const memoText = 'ã€ä»•å…¥ãƒ¡ãƒ¢ã€‘' + qrData.m;
        conditionDetailEl.value = current ? current + '\n' + memoText : memoText;
      }
    }

    // å‚·ãƒ»æ±šã‚Œãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã‚’Firestoreã‹ã‚‰å–å¾—
    if (qrData.s && window.db) {
      loadDamageMarkerFromFirestore(qrData.s);
    }

    // INV-010: SKUæƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿æŒï¼ˆå•†å“ç™»éŒ²æ™‚ã«ä½¿ç”¨ï¼‰
    window.currentSkuInfo = {
      itemType: qrData.itemType || 'unique',
      quantity: qrData.quantity || 1,
      skuId: qrData.skuId || null,
      unitPrice: qrData.unitPrice || null
    };

    // INV-010: sku-basedå•†å“ã®å ´åˆã¯æƒ…å ±ã‚’è¡¨ç¤º
    if (qrData.itemType === 'sku-based') {
      showSkuInfoBanner(qrData);
    }

    // åæ˜ å®Œäº†é€šçŸ¥
    showInspectionDataAppliedNotification(qrData);

    console.log('âœ… æ¤œå“æƒ…å ±ã®è‡ªå‹•åæ˜ å®Œäº†');
  }

  // INV-010: SKUæƒ…å ±ãƒãƒŠãƒ¼è¡¨ç¤º
  function showSkuInfoBanner(qrData) {
    // æ—¢å­˜ãƒãƒŠãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤
    const existingBanner = document.getElementById('skuInfoBanner');
    if (existingBanner) existingBanner.remove();

    const banner = document.createElement('div');
    banner.id = 'skuInfoBanner';
    banner.style.cssText = `
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 12px 16px;
      margin: 12px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    `;
    banner.innerHTML = `
      <span style="font-size: 24px;">ğŸ“¦</span>
      <div style="flex: 1;">
        <div style="font-weight: 600; color: #1e40af; margin-bottom: 4px;">æ–°å“(è¤‡æ•°)å•†å“</div>
        <div style="font-size: 13px; color: #1e3a8a;">
          æ•°é‡: <strong>${qrData.quantity}ç‚¹</strong> ï¼
          ä»•å…¥å˜ä¾¡: <strong>Â¥${qrData.unitPrice?.toLocaleString() || '-'}</strong>
          ${qrData.skuId ? `ï¼ SKU: <code style="background:#e0f2fe; padding:2px 6px; border-radius:4px;">${qrData.skuId}</code>` : ''}
        </div>
      </div>
    `;

    // ä»•å…¥å•†å“IDå…¥åŠ›æ¬„ã®å¾Œã«æŒ¿å…¥
    const invIdEl = document.getElementById('invId');
    if (invIdEl && invIdEl.parentElement) {
      invIdEl.parentElement.insertAdjacentElement('afterend', banner);
    }
  }

  // ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¿æŒï¼ˆå•†å“ç™»éŒ²æ™‚ã«ä½¿ç”¨ï¼‰
  window.currentDamageMarker = {
    image: null,
    type: null,
    note: null
  };

  // Firestoreã‹ã‚‰å‚·ãƒ»æ±šã‚Œãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã‚’å–å¾—ã—ã¦è¡¨ç¤º
  async function loadDamageMarkerFromFirestore(slotId) {
    try {
      console.log('ğŸ“ ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒå–å¾—ä¸­:', slotId);
      const slotDoc = await window.db.collection('purchaseSlots').doc(slotId).get();
      
      if (slotDoc.exists) {
        const slotData = slotDoc.data();
        
        if (slotData.damageMarkerImage) {
          console.log('âœ… ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã‚’æ¤œå‡º');
          const previewSection = document.getElementById('damageMarkerPreviewSection');
          const previewImg = document.getElementById('damageMarkerPreviewImg');
          const typeLabel = document.getElementById('damageMarkerTypeLabel');
          const noteSection = document.getElementById('damageMarkerNoteSection');
          const noteText = document.getElementById('damageMarkerNoteText');

          previewImg.src = slotData.damageMarkerImage;
          typeLabel.textContent = slotData.damageMarkerType || '';
          previewSection.style.display = 'block';

          // è£œè¶³èª¬æ˜ãŒã‚ã‚Œã°è¡¨ç¤º
          if (slotData.damageMarkerNote) {
            noteText.textContent = slotData.damageMarkerNote;
            noteSection.style.display = 'block';
          } else {
            noteSection.style.display = 'none';
          }

          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿æŒï¼ˆå•†å“ç™»éŒ²æ™‚ã«ä½¿ç”¨ï¼‰
          window.currentDamageMarker = {
            image: slotData.damageMarkerImage,
            type: slotData.damageMarkerType || null,
            note: slotData.damageMarkerNote || null
          };
        } else {
          console.log('â„¹ï¸ ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒãªã—');
          window.currentDamageMarker = { image: null, type: null, note: null };
        }
      } else {
        console.log('âš ï¸ ã‚¹ãƒ­ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', slotId);
        window.currentDamageMarker = { image: null, type: null, note: null };
      }
    } catch (error) {
      console.error('âŒ ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      window.currentDamageMarker = { image: null, type: null, note: null };
    }
  }

  // æ¤œå“æƒ…å ±åæ˜ å®Œäº†ã®é€šçŸ¥è¡¨ç¤º
  function showInspectionDataAppliedNotification(qrData) {
    // åæ˜ ã•ã‚ŒãŸé …ç›®ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    const appliedItems = [];
    if (qrData.d) appliedItems.push('ä»•å…¥æ—¥');
    if (qrData.amt) appliedItems.push('ä»•å…¥é‡‘é¡');
    if (qrData.sup) appliedItems.push('ä»•å…¥å…ˆ');
    if (qrData.cat) appliedItems.push('ã‚«ãƒ†ã‚´ãƒª');
    if (qrData.br) appliedItems.push('ãƒ–ãƒ©ãƒ³ãƒ‰');
    if (qrData.cnd) appliedItems.push('å•†å“çŠ¶æ…‹');
    if (qrData.acc && qrData.acc.length > 0) appliedItems.push('ä»˜å±å“');
    if (qrData.nt) appliedItems.push('æ¤œå“ãƒ¡ãƒ¢');
    
    // é€šçŸ¥è¦ç´ ã‚’ä½œæˆ
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 20000;
      font-weight: 600;
      text-align: center;
      max-width: 90%;
      animation: slideDown 0.3s ease-out;
    `;
    notification.innerHTML = `
      <div style="display: flex; align-items: center; gap: 12px;">
        <i class="bi bi-check-circle-fill" style="font-size: 24px;"></i>
        <div>
          <div>æ¤œå“æƒ…å ±ã‚’è‡ªå‹•åæ˜ ã—ã¾ã—ãŸ</div>
          <div style="font-size: 12px; font-weight: 400; margin-top: 4px; opacity: 0.9;">
            ${appliedItems.join('ã€')}
          </div>
        </div>
      </div>
    `;
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
    if (!document.getElementById('inspection-notification-style')) {
      const style = document.createElement('style');
      style.id = 'inspection-notification-style';
      style.textContent = `
        @keyframes slideDown {
          from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
          to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
    }
    
    document.body.appendChild(notification);
    
    // 3ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆã™
    setTimeout(() => {
      notification.style.transition = 'opacity 0.3s, transform 0.3s';
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(-50%) translateY(-20px)';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  function onQRScanFailure(error) {
    // ç¶™ç¶šã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ï¼‰
  }

  // INV-010: SKUã§æ—¢å­˜å•†å“ã‚’æ¤œç´¢
  async function findProductBySkuId(skuId) {
    try {
      const db = firebase.firestore();
      const snapshot = await db.collection('products')
        .where('skuId', '==', skuId)
        .limit(1)
        .get();

      if (snapshot.empty) return null;
      return { id: snapshot.docs[0].id, ...snapshot.docs[0].data() };
    } catch (error) {
      console.error('SKUæ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  // INV-010: æ—¢å­˜SKUå•†å“ã«åœ¨åº«è¿½åŠ 
  async function addStockToExistingSku(skuId, quantity, slotId) {
    try {
      const db = firebase.firestore();
      const batch = db.batch();

      // 1. productsã®åœ¨åº«æ•°ã‚’æ›´æ–°
      const productSnapshot = await db.collection('products')
        .where('skuId', '==', skuId)
        .limit(1)
        .get();

      if (!productSnapshot.empty) {
        const productRef = productSnapshot.docs[0].ref;
        batch.update(productRef, {
          stockQuantity: firebase.firestore.FieldValue.increment(quantity),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      // 2. skusã®åœ¨åº«æ•°ã‚’æ›´æ–°
      const skuRef = db.collection('skus').doc(skuId);
      batch.set(skuRef, {
        currentStock: firebase.firestore.FieldValue.increment(quantity),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      // 3. purchaseSlotsã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
      const slotRef = db.collection('purchaseSlots').doc(slotId);
      batch.update(slotRef, {
        status: 'registered',
        registeredAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      await batch.commit();
      console.log('âœ… åœ¨åº«è¿½åŠ å®Œäº†:', { skuId, quantity, slotId });
    } catch (error) {
      console.error('åœ¨åº«è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  function setInvId(invId) {
    document.getElementById('invId').value = invId;

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
    const statusSection = document.getElementById('qrStatusSection');
    statusSection.style.display = 'block';

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆèª­ã¿è¾¼ã¿ä¸­ï¼‰
    const statusDiv = document.getElementById('qrScanStatus');
    statusDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 8px;">
        <i class="bi bi-hourglass-split" style="color: #f59e0b; font-size: 20px;"></i>
        <div style="flex: 1;">
          <div style="font-weight: 600; color: #92400e;">ä»•å…¥æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
          <div style="font-size: 12px; color: #b45309;">${invId}</div>
        </div>
      </div>
    `;

    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    const floatingBtn = document.getElementById('qrFloatingBtn');
    floatingBtn.style.display = 'none';

    // Firestoreã‹ã‚‰ä»•å…¥æƒ…å ±ã‚’å–å¾—ã—ã¦åæ˜ 
    fetchAndApplyPurchaseSlotData(invId);
  }

  // Firestoreã‹ã‚‰ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
  async function fetchAndApplyPurchaseSlotData(slotId) {
    const statusDiv = document.getElementById('qrScanStatus');

    try {
      console.log('ğŸ“¦ ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆå–å¾—é–‹å§‹:', slotId);

      const doc = await window.db.collection('purchaseSlots').doc(slotId).get();

      if (!doc.exists) {
        console.warn('ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', slotId);
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <i class="bi bi-exclamation-triangle-fill" style="color: #f59e0b; font-size: 20px;"></i>
            <div style="flex: 1;">
              <div style="font-weight: 600; color: #92400e;">ä»•å…¥æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
              <div style="font-size: 12px; color: #b45309;">${slotId}</div>
            </div>
            <button onclick="clearInvId()" style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 4px;">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        `;
        return;
      }

      const slotData = doc.data();
      console.log('ğŸ“¦ ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿:', slotData);

      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆç´ä»˜ã‘å®Œäº†ï¼‰
      statusDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
          <i class="bi bi-check-circle-fill" style="color: #10b981; font-size: 20px;"></i>
          <div style="flex: 1;">
            <div style="font-weight: 600; color: #065f46;">ä»•å…¥å•†å“ã¨ç´ä»˜ã‘æ¸ˆã¿</div>
            <div style="font-size: 12px; color: #047857;">${slotId}</div>
          </div>
          <button onclick="clearInvId()" style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 4px;">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      `;

      // ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
      applyPurchaseSlotDataToForm(slotData);

    } catch (error) {
      console.error('ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      statusDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
          <i class="bi bi-x-circle-fill" style="color: #ef4444; font-size: 20px;"></i>
          <div style="flex: 1;">
            <div style="font-weight: 600; color: #dc2626;">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</div>
            <div style="font-size: 12px; color: #b91c1c;">${slotId}</div>
          </div>
          <button onclick="clearInvId()" style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 4px;">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      `;
    }
  }

  // ä»•å…¥ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
  function applyPurchaseSlotDataToForm(slotData) {
    console.log('ğŸ”„ ä»•å…¥æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ ä¸­...');

    // ä»•å…¥æ—¥
    if (slotData.purchaseDate) {
      const purchaseDateEl = document.getElementById('ä»•å…¥æ—¥');
      if (purchaseDateEl) purchaseDateEl.value = slotData.purchaseDate;
    }

    // ä»•å…¥é‡‘é¡
    if (slotData.amount) {
      const purchaseAmountEl = document.getElementById('ä»•å…¥é‡‘é¡');
      if (purchaseAmountEl) purchaseAmountEl.value = slotData.amount;
    }

    // ä»•å…¥å…ˆ
    if (slotData.supplier) {
      const supplierEl = document.getElementById('ä»•å…¥å…ˆ');
      if (supplierEl) {
        const options = supplierEl.options;
        for (let i = 0; i < options.length; i++) {
          if (options[i].value === slotData.supplier || options[i].text.includes(slotData.supplier)) {
            supplierEl.selectedIndex = i;
            break;
          }
        }
      }
    }

    // ã‚«ãƒ†ã‚´ãƒªï¼ˆ7éšå±¤å¯¾å¿œï¼‰
    if (slotData.category) {
      const categoryObj = slotData.category;

      // ç‰¹å¤§åˆ†é¡
      if (categoryObj.superCategory) {
        const l0El = document.getElementById('ç‰¹å¤§åˆ†é¡');
        if (l0El) {
          for (let i = 0; i < l0El.options.length; i++) {
            if (l0El.options[i].value === categoryObj.superCategory) {
              l0El.selectedIndex = i;
              l0El.dispatchEvent(new Event('change', { bubbles: true }));
              break;
            }
          }
        }
      }

      // å¤§åˆ†é¡ã€œã‚¢ã‚¤ãƒ†ãƒ åã¯é€£å‹•ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãªã®ã§ã€é…å»¶ã•ã›ã¦è¨­å®š
      setTimeout(() => {
        if (categoryObj.major) {
          const l1El = document.getElementById('å¤§åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
          if (l1El) {
            for (let i = 0; i < l1El.options.length; i++) {
              if (l1El.options[i].value === categoryObj.major) {
                l1El.selectedIndex = i;
                l1El.dispatchEvent(new Event('change', { bubbles: true }));
                break;
              }
            }
          }
        }

        setTimeout(() => {
          if (categoryObj.middle) {
            const l2El = document.getElementById('ä¸­åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
            if (l2El) {
              for (let i = 0; i < l2El.options.length; i++) {
                if (l2El.options[i].value === categoryObj.middle) {
                  l2El.selectedIndex = i;
                  l2El.dispatchEvent(new Event('change', { bubbles: true }));
                  break;
                }
              }
            }
          }

          setTimeout(() => {
            if (categoryObj.small) {
              const l3El = document.getElementById('å°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
              if (l3El) {
                for (let i = 0; i < l3El.options.length; i++) {
                  if (l3El.options[i].value === categoryObj.small) {
                    l3El.selectedIndex = i;
                    l3El.dispatchEvent(new Event('change', { bubbles: true }));
                    break;
                  }
                }
              }
            }

            setTimeout(() => {
              if (categoryObj.fine) {
                const l4El = document.getElementById('ç´°åˆ†é¡(ã‚«ãƒ†ã‚´ãƒª)');
                if (l4El) {
                  for (let i = 0; i < l4El.options.length; i++) {
                    if (l4El.options[i].value === categoryObj.fine) {
                      l4El.selectedIndex = i;
                      l4El.dispatchEvent(new Event('change', { bubbles: true }));
                      break;
                    }
                  }
                }
              }

              setTimeout(() => {
                if (categoryObj.fine2) {
                  const l5El = document.getElementById('ç´°åˆ†é¡2');
                  if (l5El) {
                    for (let i = 0; i < l5El.options.length; i++) {
                      if (l5El.options[i].value === categoryObj.fine2) {
                        l5El.selectedIndex = i;
                        l5El.dispatchEvent(new Event('change', { bubbles: true }));
                        break;
                      }
                    }
                  }
                }

                setTimeout(() => {
                  if (categoryObj.itemName) {
                    const itemEl = document.getElementById('ã‚¢ã‚¤ãƒ†ãƒ å');
                    if (itemEl) {
                      for (let i = 0; i < itemEl.options.length; i++) {
                        if (itemEl.options[i].value === categoryObj.itemName) {
                          itemEl.selectedIndex = i;
                          itemEl.dispatchEvent(new Event('change', { bubbles: true }));
                          break;
                        }
                      }
                    }
                  }
                }, 100);
              }, 100);
            }, 100);
          }, 100);
        }, 100);
      }, 100);
    }

    // ã‚µã‚¤ã‚º
    if (slotData.size) {
      const sizeEl = document.getElementById('ã‚µã‚¤ã‚º');
      if (sizeEl) sizeEl.value = slotData.size;
    }

    // ãƒ–ãƒ©ãƒ³ãƒ‰
    if (slotData.brand) {
      const brandEl = document.getElementById('ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)');
      if (brandEl) brandEl.value = slotData.brand;
      const brandNameEl = document.getElementById('å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(è‹±èª)');
      if (brandNameEl) brandNameEl.value = slotData.brand;
    }
    if (slotData.brandKana) {
      const brandKanaEl = document.getElementById('ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)');
      if (brandKanaEl) brandKanaEl.value = slotData.brandKana;
      const brandNameKanaEl = document.getElementById('å•†å“å_ãƒ–ãƒ©ãƒ³ãƒ‰(ã‚«ãƒŠ)');
      if (brandNameKanaEl) brandNameKanaEl.value = slotData.brandKana;
    }

    // å•†å“ã®çŠ¶æ…‹
    if (slotData.condition) {
      const conditionEl = document.getElementById('å•†å“ã®çŠ¶æ…‹');
      if (conditionEl) {
        const options = conditionEl.options;
        for (let i = 0; i < options.length; i++) {
          if (options[i].value === slotData.condition || options[i].text === slotData.condition) {
            conditionEl.selectedIndex = i;
            conditionEl.dispatchEvent(new Event('change', { bubbles: true }));
            break;
          }
        }
      }
    }

    // ä»˜å±å“
    if (slotData.accessories && slotData.accessories.length > 0) {
      if (typeof window.setAccessoriesFromQR === 'function') {
        window.setAccessoriesFromQR(slotData.accessories);
      }
    }

    // ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒï¼ˆå‚·ãƒ»ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼‰
    if (slotData.damageMarkerImage) {
      console.log('ğŸ“¸ ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã‚’åæ˜ :', slotData.damageMarkerImage);

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤º
      const previewSection = document.getElementById('damageMarkerPreviewSection');
      const previewImg = document.getElementById('damageMarkerPreviewImg');
      const typeLabel = document.getElementById('damageMarkerTypeLabel');
      const noteSection = document.getElementById('damageMarkerNoteSection');
      const noteText = document.getElementById('damageMarkerNoteText');

      if (previewSection && previewImg) {
        previewImg.src = slotData.damageMarkerImage;
        if (typeLabel) typeLabel.textContent = slotData.damageMarkerType || '';
        previewSection.style.display = 'block';

        // è£œè¶³èª¬æ˜ãŒã‚ã‚Œã°è¡¨ç¤º
        if (slotData.damageMarkerNote && noteSection && noteText) {
          noteText.textContent = slotData.damageMarkerNote;
          noteSection.style.display = 'block';
        } else if (noteSection) {
          noteSection.style.display = 'none';
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿æŒï¼ˆå•†å“ç™»éŒ²æ™‚ã«ä½¿ç”¨ï¼‰
        window.currentDamageMarker = {
          image: slotData.damageMarkerImage,
          type: slotData.damageMarkerType || null,
          note: slotData.damageMarkerNote || null
        };

        console.log('âœ… ãƒãƒ¼ã‚­ãƒ³ã‚°ç”»åƒã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤º');
      }
    }

    // ãƒ¡ãƒ¢
    if (slotData.note || slotData.memo) {
      const noteText = slotData.note || slotData.memo;
      const conditionDetailEl = document.getElementById('å•†å“çŠ¶æ…‹è©³ç´°');
      if (conditionDetailEl && noteText) {
        const current = conditionDetailEl.value;
        conditionDetailEl.value = current ? current + '\n' + noteText : noteText;
      }
    }

    console.log('âœ… ä»•å…¥æƒ…å ±ã®åæ˜ å®Œäº†');
  }

  function manualInvIdInput() {
    const invId = prompt('ä»•å…¥å•†å“IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nä¾‹: INV-20251212-XXXX-001');
    if (invId && invId.trim()) {
      closeQRScanner();
      setInvId(invId.trim());
    }
  }

  function clearInvId() {
    document.getElementById('invId').value = '';
    document.getElementById('qrStatusSection').style.display = 'none';
    
    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’å†è¡¨ç¤º
    const floatingBtn = document.getElementById('qrFloatingBtn');
    floatingBtn.style.display = 'flex';
    floatingBtn.style.background = 'white';
    floatingBtn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.25)';
    floatingBtn.innerHTML = '<img src="/images/qr-scan-icon.png" alt="QRã‚¹ã‚­ãƒ£ãƒ³" style="width: 100%; height: 100%; object-fit: contain;">';
  }

  // ç´ä»˜ã‘ãªã—ã§ä¿å­˜ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã®è­¦å‘Šãƒã‚§ãƒƒã‚¯
  function checkInvIdBeforeSave() {
    const invId = document.getElementById('invId').value;
    if (!invId) {
      // è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      const result = confirm('âš ï¸ ä»•å…¥å•†å“ã¨ã®ç´ä»˜ã‘ãŒã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nQRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã›ãšã«ç™»éŒ²ã™ã‚‹ã¨ã€ä»•å…¥æƒ…å ±ã¨ã®ç´ä»˜ã‘ãŒã§ããªããªã‚Šã¾ã™ã€‚\n\næœ¬å½“ã«ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ');
      return result;
    }
    return true;
  }
</script>

<!-- QRã‚¹ã‚­ãƒ£ãƒ³ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
<button id="qrFloatingBtn" onclick="openQRScanner()" style="
  position: fixed;
  bottom: 70px;
  right: 20px;
  width: 68px;
  height: 68px;
  border-radius: 50%;
  background: white;
  border: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  cursor: pointer;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px;
  transition: transform 0.2s, box-shadow 0.2s;
" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.3)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.25)';">
  <img src="/images/qr-scan-icon.png" alt="QRã‚¹ã‚­ãƒ£ãƒ³" style="width: 100%; height: 100%; object-fit: contain;">
</button>

</div><!-- /mainFormContent -->

<!-- QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="qrScannerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: white; border-radius: 16px; width: 90%; max-width: 400px; overflow: hidden;">
    <div style="padding: 16px; background: linear-gradient(135deg, #40B4E5 0%, #1E8FBF 100%); color: white; position: relative; text-align: center;">
      <span style="font-weight: 600; font-size: 18px;">QRã‚¹ã‚­ãƒ£ãƒ³</span>
      <button onclick="closeQRScanner()" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
    </div>
    <div style="position: relative; width: 100%;">
      <div id="qrReader" style="width: 100%;"></div>
      <!-- ã‚«ãƒ¡ãƒ©ãƒ“ãƒ¥ãƒ¼å†…ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚«ãƒ¡ãƒ©èµ·å‹•å¾Œã«è¡¨ç¤ºï¼‰ -->
      <div id="qrOverlayText" style="display: none; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; pointer-events: none;">
        æ å†…ã«QRã‚³ãƒ¼ãƒ‰ã‚’åˆã‚ã›ã¦ãã ã•ã„
      </div>
    </div>
    <div style="padding: 16px; text-align: center;">
      <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">å•†å“ã‚¿ã‚°ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«ã‹ã–ã—ã¦ãã ã•ã„</p>
      <button onclick="manualInvIdInput()" style="padding: 10px 20px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; border-radius: 8px; cursor: pointer;">
        <i class="bi bi-keyboard"></i> æ‰‹å‹•ã§å…¥åŠ›
      </button>
      <!-- è‡ªå‹•è¡¨ç¤ºè¨­å®šãƒˆã‚°ãƒ« -->
      <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
        <label style="display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 14px; color: #374151;">
          <span>å•†å“ç™»éŒ²æ™‚ã«è‡ªå‹•è¡¨ç¤º</span>
          <!-- iOSé¢¨ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ -->
          <div style="position: relative; width: 50px; height: 28px;">
            <input type="checkbox" id="qrAutoOpenToggle" onchange="toggleQrAutoOpen()" style="opacity: 0; width: 0; height: 0;">
            <span id="qrToggleTrack" style="
              position: absolute;
              cursor: pointer;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: #e5e7eb;
              transition: 0.3s;
              border-radius: 28px;
            "></span>
            <span id="qrToggleThumb" style="
              position: absolute;
              content: '';
              height: 22px;
              width: 22px;
              left: 3px;
              bottom: 3px;
              background-color: white;
              transition: 0.3s;
              border-radius: 50%;
              box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            "></span>
          </div>
        </label>
        <p style="font-size: 12px; color: #9ca3af; margin-top: 8px;">ã‚ªãƒ•ã«ã™ã‚‹ã¨ã€å³ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰æ‰‹å‹•ã§é–‹ã‘ã¾ã™</p>
      </div>
    </div>
  </div>
</div>

<script>
  // QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼è‡ªå‹•è¡¨ç¤ºè¨­å®š
  const QR_AUTO_OPEN_KEY = 'reborn_qr_auto_open';
  
  // è¨­å®šã®åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯true = è‡ªå‹•è¡¨ç¤ºã‚ªãƒ³ï¼‰
  function initQrAutoOpenSetting() {
    const saved = localStorage.getItem(QR_AUTO_OPEN_KEY);
    // åˆå›ã¯è¨­å®šãŒãªã„ã®ã§trueï¼ˆè‡ªå‹•è¡¨ç¤ºã‚ªãƒ³ï¼‰
    const isEnabled = saved === null ? true : saved === 'true';
    const toggle = document.getElementById('qrAutoOpenToggle');
    if (toggle) {
      toggle.checked = isEnabled;
      updateToggleVisual(isEnabled);
    }
    return isEnabled;
  }
  
  // ãƒˆã‚°ãƒ«ã®è¦‹ãŸç›®ã‚’æ›´æ–°
  function updateToggleVisual(isEnabled) {
    const track = document.getElementById('qrToggleTrack');
    const thumb = document.getElementById('qrToggleThumb');
    if (track && thumb) {
      if (isEnabled) {
        track.style.backgroundColor = '#3b82f6';
        thumb.style.transform = 'translateX(22px)';
      } else {
        track.style.backgroundColor = '#e5e7eb';
        thumb.style.transform = 'translateX(0)';
      }
    }
  }
  
  // ãƒˆã‚°ãƒ«å¤‰æ›´æ™‚
  function toggleQrAutoOpen() {
    const toggle = document.getElementById('qrAutoOpenToggle');
    const isEnabled = toggle.checked;
    localStorage.setItem(QR_AUTO_OPEN_KEY, isEnabled.toString());
    updateToggleVisual(isEnabled);
    console.log('[QRè¨­å®š] è‡ªå‹•è¡¨ç¤º:', isEnabled ? 'ã‚ªãƒ³' : 'ã‚ªãƒ•');
  }
  
  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®šã«åŸºã¥ã„ã¦è‡ªå‹•è¡¨ç¤º
  function autoOpenQrScannerIfEnabled() {
    const isEnabled = initQrAutoOpenSetting();
    const pageHeader = document.getElementById('pageHeader');
    const mainContent = document.getElementById('mainFormContent');

    if (isEnabled) {
      console.log('[QRè¨­å®š] è‡ªå‹•è¡¨ç¤ºãŒæœ‰åŠ¹ â†’ QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‚’é–‹ã');
      // å°‘ã—é…å»¶ã•ã›ã¦ã€ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰é–‹ã
      setTimeout(() => {
        openQRScanner();
      }, 500);
    } else {
      console.log('[QRè¨­å®š] è‡ªå‹•è¡¨ç¤ºãŒç„¡åŠ¹ â†’ ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º');
      // QRè‡ªå‹•è¡¨ç¤ºãŒç„¡åŠ¹ã®å ´åˆã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å³åº§ã«è¡¨ç¤º
      if (pageHeader) {
        pageHeader.style.display = 'flex';  // flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãŸã‚
      }
      if (mainContent) {
        mainContent.style.display = 'block';
      }
    }
  }
  
  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«å®Ÿè¡Œ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', autoOpenQrScannerIfEnabled);
  } else {
    // å°‘ã—é…å»¶ã•ã›ã¦ä»–ã®åˆæœŸåŒ–å‡¦ç†ãŒå®Œäº†ã—ã¦ã‹ã‚‰
    setTimeout(autoOpenQrScannerIfEnabled, 300);
  }
</script>

</body>
</html>