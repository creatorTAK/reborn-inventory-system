<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>プラン管理 - フリラ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      min-height: 100vh;
    }
    .page-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #40B4E5 0%, #1E8FBF 100%);
      padding: 20px;
      padding-top: calc(20px + env(safe-area-inset-top, 0px));
      color: white;
      text-align: center;
      z-index: 1000;
    }
    .page-header h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }
    .page-header .back-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 16px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 18px;
      margin-top: calc(env(safe-area-inset-top, 0px) / 2);
    }
    .page-header .back-button:active {
      background: rgba(255, 255, 255, 0.3);
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      padding-top: calc(70px + env(safe-area-inset-top, 0px));
    }

    /* 現在のプラン表示 */
    .current-plan-banner {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .current-plan-banner i {
      font-size: 24px;
    }
    .current-plan-info {
      flex: 1;
    }
    .current-plan-label {
      font-size: 12px;
      opacity: 0.9;
    }
    .current-plan-name {
      font-size: 18px;
      font-weight: 700;
    }

    /* プラン説明 */
    .page-description {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 24px;
      line-height: 1.6;
      text-align: center;
    }

    /* プランカード */
    .plans-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 768px) {
      .plans-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    .plan-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 2px solid transparent;
      transition: all 0.2s;
      position: relative;
    }
    .plan-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }
    .plan-card.recommended {
      border-color: #40B4E5;
    }
    .plan-card.current {
      border-color: #10b981;
      background: #f0fdf4;
    }
    .plan-badge {
      position: absolute;
      top: -12px;
      right: 16px;
      background: #40B4E5;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .plan-badge.current {
      background: #10b981;
    }
    .plan-name {
      font-size: 20px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 8px;
    }
    .plan-price {
      margin-bottom: 16px;
    }
    .plan-price .amount {
      font-size: 32px;
      font-weight: 800;
      color: #1f2937;
    }
    .plan-price .period {
      font-size: 14px;
      color: #6b7280;
    }
    .plan-description {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    .plan-features {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }
    .plan-features li {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 8px 0;
      font-size: 14px;
      color: #374151;
      border-bottom: 1px solid #f3f4f6;
    }
    .plan-features li:last-child {
      border-bottom: none;
    }
    .plan-features li i {
      color: #10b981;
      font-size: 16px;
      margin-top: 2px;
    }
    .plan-features li i.disabled {
      color: #d1d5db;
    }
    .plan-features li.disabled {
      color: #9ca3af;
      text-decoration: line-through;
    }
    .plan-btn {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }
    .plan-btn.primary {
      background: linear-gradient(135deg, #40B4E5 0%, #1E8FBF 100%);
      color: white;
    }
    .plan-btn.primary:hover {
      opacity: 0.9;
    }
    .plan-btn.secondary {
      background: #f3f4f6;
      color: #6b7280;
    }
    .plan-btn.secondary:hover {
      background: #e5e7eb;
    }
    .plan-btn.current {
      background: #10b981;
      color: white;
      cursor: default;
    }
    .plan-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* 注意書き */
    .note {
      background: #fef3c7;
      border-radius: 8px;
      padding: 16px;
      font-size: 13px;
      color: #92400e;
      margin-top: 24px;
    }
    .note i {
      margin-right: 6px;
    }
    .note-title {
      font-weight: 600;
      margin-bottom: 8px;
    }
    .note ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }
    .note li {
      margin-bottom: 4px;
    }

    /* 比較表 */
    .comparison-section {
      margin-top: 32px;
    }
    .comparison-title {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 16px;
      text-align: center;
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .comparison-table th,
    .comparison-table td {
      padding: 12px 16px;
      text-align: center;
      border-bottom: 1px solid #f3f4f6;
      font-size: 14px;
    }
    .comparison-table th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    .comparison-table th:first-child,
    .comparison-table td:first-child {
      text-align: left;
      font-weight: 500;
    }
    .comparison-table tr:last-child td {
      border-bottom: none;
    }
    .comparison-table .check {
      color: #10b981;
      font-size: 18px;
    }
    .comparison-table .cross {
      color: #d1d5db;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="page-header">
    <button class="back-button" onclick="goBack()">
      <i class="bi bi-chevron-left"></i>
    </button>
    <h1>プラン管理</h1>
  </div>

  <div class="container">
    <!-- 現在のプラン -->
    <div class="current-plan-banner">
      <i class="bi bi-award"></i>
      <div class="current-plan-info">
        <div class="current-plan-label">現在のプラン</div>
        <div class="current-plan-name" id="currentPlanName">Free</div>
      </div>
    </div>

    <p class="page-description">
      ビジネスの成長に合わせて、最適なプランをお選びください。<br>
      いつでもアップグレード・ダウングレードが可能です。
    </p>

    <!-- プランカード -->
    <div class="plans-grid">
      <!-- Free プラン -->
      <div class="plan-card current" id="planFree">
        <span class="plan-badge current">現在のプラン</span>
        <div class="plan-name">Free</div>
        <div class="plan-price">
          <span class="amount">¥0</span>
          <span class="period">/月</span>
        </div>
        <div class="plan-description">
          個人での小規模運用に最適。<br>基本機能をお試しください。
        </div>
        <ul class="plan-features">
          <li><i class="bi bi-check-circle-fill"></i> 商品登録 50件/月</li>
          <li><i class="bi bi-check-circle-fill"></i> 在庫管理</li>
          <li><i class="bi bi-check-circle-fill"></i> 販売記録</li>
          <li><i class="bi bi-check-circle-fill"></i> AIサポート 10回/月</li>
          <li class="disabled"><i class="bi bi-x-circle disabled"></i> チームメンバー追加</li>
          <li class="disabled"><i class="bi bi-x-circle disabled"></i> 自動化機能</li>
        </ul>
        <button class="plan-btn current" disabled>現在のプラン</button>
      </div>

      <!-- Standard プラン -->
      <div class="plan-card recommended" id="planStandard">
        <span class="plan-badge">おすすめ</span>
        <div class="plan-name">Standard</div>
        <div class="plan-price">
          <span class="amount">¥980</span>
          <span class="period">/月</span>
        </div>
        <div class="plan-description">
          成長中のビジネスに最適。<br>チーム運用と効率化を実現。
        </div>
        <ul class="plan-features">
          <li><i class="bi bi-check-circle-fill"></i> 商品登録 無制限</li>
          <li><i class="bi bi-check-circle-fill"></i> 在庫管理</li>
          <li><i class="bi bi-check-circle-fill"></i> 販売記録</li>
          <li><i class="bi bi-check-circle-fill"></i> AIサポート 50回/月</li>
          <li><i class="bi bi-check-circle-fill"></i> チームメンバー 3人まで</li>
          <li class="disabled"><i class="bi bi-x-circle disabled"></i> 完全自動化</li>
        </ul>
        <button class="plan-btn primary" onclick="selectPlan('standard')">アップグレード</button>
      </div>

      <!-- Pro プラン -->
      <div class="plan-card" id="planPro">
        <div class="plan-name">Pro</div>
        <div class="plan-price">
          <span class="amount">¥2,980</span>
          <span class="period">/月</span>
        </div>
        <div class="plan-description">
          本格的なEC運営に。<br>完全自動化で業務効率を最大化。
        </div>
        <ul class="plan-features">
          <li><i class="bi bi-check-circle-fill"></i> 商品登録 無制限</li>
          <li><i class="bi bi-check-circle-fill"></i> 在庫管理</li>
          <li><i class="bi bi-check-circle-fill"></i> 販売記録</li>
          <li><i class="bi bi-check-circle-fill"></i> AIサポート 無制限</li>
          <li><i class="bi bi-check-circle-fill"></i> チームメンバー 無制限</li>
          <li><i class="bi bi-check-circle-fill"></i> 完全自動化機能</li>
        </ul>
        <button class="plan-btn primary" onclick="selectPlan('pro')">アップグレード</button>
      </div>
    </div>

    <!-- 比較表 -->
    <div class="comparison-section">
      <h2 class="comparison-title">機能比較表</h2>
      <table class="comparison-table">
        <thead>
          <tr>
            <th>機能</th>
            <th>Free</th>
            <th>Standard</th>
            <th>Pro</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>商品登録</td>
            <td>50件/月</td>
            <td>無制限</td>
            <td>無制限</td>
          </tr>
          <tr>
            <td>AIサポート</td>
            <td>10回/月</td>
            <td>50回/月</td>
            <td>無制限</td>
          </tr>
          <tr>
            <td>チームメンバー</td>
            <td>1人</td>
            <td>3人</td>
            <td>無制限</td>
          </tr>
          <tr>
            <td>発送方法事前設定</td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
          </tr>
          <tr>
            <td>販売時自動入力</td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
          </tr>
          <tr>
            <td>詳細レポート</td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
          </tr>
          <tr>
            <td>優先サポート</td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-x-lg cross"></i></td>
            <td><i class="bi bi-check-lg check"></i></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 注意書き -->
    <div class="note">
      <div class="note-title"><i class="bi bi-info-circle"></i> プラン変更について</div>
      <ul>
        <li>アップグレードは即時反映されます</li>
        <li>ダウングレードは次回請求日から適用されます</li>
        <li>年間プランは2ヶ月分お得です（近日公開予定）</li>
        <li>14日間の無料トライアル期間があります</li>
      </ul>
    </div>
  </div>

  <script>
    // 現在のプランを取得（仮実装）
    let currentPlan = 'free';

    function initPage() {
      // localStorageからプラン情報を取得（将来実装）
      const savedPlan = localStorage.getItem('furira_plan') || 'free';
      currentPlan = savedPlan;
      updatePlanDisplay();
    }

    function updatePlanDisplay() {
      // 現在のプラン名を更新
      const planNames = {
        'free': 'Free',
        'standard': 'Standard',
        'pro': 'Pro'
      };
      document.getElementById('currentPlanName').textContent = planNames[currentPlan] || 'Free';

      // カードのスタイルを更新
      const cards = document.querySelectorAll('.plan-card');
      cards.forEach(card => {
        card.classList.remove('current');
        const badge = card.querySelector('.plan-badge');
        if (badge && badge.classList.contains('current')) {
          badge.remove();
        }
        const btn = card.querySelector('.plan-btn');
        if (btn) {
          btn.classList.remove('current');
          btn.disabled = false;
          if (card.id === 'planFree') {
            btn.textContent = 'ダウングレード';
            btn.classList.add('secondary');
            btn.classList.remove('primary');
          } else {
            btn.textContent = 'アップグレード';
            btn.classList.add('primary');
            btn.classList.remove('secondary');
          }
        }
      });

      // 現在のプランのカードを更新
      const currentCard = document.getElementById('plan' + currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1));
      if (currentCard) {
        currentCard.classList.add('current');

        // バッジを追加
        const existingBadge = currentCard.querySelector('.plan-badge');
        if (existingBadge) {
          existingBadge.textContent = '現在のプラン';
          existingBadge.classList.add('current');
        } else {
          const badge = document.createElement('span');
          badge.className = 'plan-badge current';
          badge.textContent = '現在のプラン';
          currentCard.appendChild(badge);
        }

        // ボタンを更新
        const btn = currentCard.querySelector('.plan-btn');
        if (btn) {
          btn.textContent = '現在のプラン';
          btn.classList.add('current');
          btn.classList.remove('primary', 'secondary');
          btn.disabled = true;
        }
      }

      // Standardのおすすめバッジを復元（現在のプランでなければ）
      if (currentPlan !== 'standard') {
        const standardCard = document.getElementById('planStandard');
        const existingBadge = standardCard.querySelector('.plan-badge');
        if (!existingBadge) {
          const badge = document.createElement('span');
          badge.className = 'plan-badge';
          badge.textContent = 'おすすめ';
          standardCard.appendChild(badge);
        } else if (!existingBadge.classList.contains('current')) {
          existingBadge.textContent = 'おすすめ';
        }
      }
    }

    function selectPlan(plan) {
      // 仮実装：確認ダイアログ
      const planNames = {
        'free': 'Free',
        'standard': 'Standard',
        'pro': 'Pro'
      };
      const planPrices = {
        'free': '¥0',
        'standard': '¥980',
        'pro': '¥2,980'
      };

      const isUpgrade = (currentPlan === 'free') ||
                        (currentPlan === 'standard' && plan === 'pro');
      const action = isUpgrade ? 'アップグレード' : 'ダウングレード';

      const confirmed = confirm(
        `${planNames[plan]}プラン（${planPrices[plan]}/月）に${action}しますか？\n\n` +
        `※ 現在は開発中のため、実際の課金は発生しません。`
      );

      if (confirmed) {
        // 仮実装：localStorageに保存
        localStorage.setItem('furira_plan', plan);
        currentPlan = plan;
        updatePlanDisplay();
        alert(`${planNames[plan]}プランへの${action}が完了しました！\n\n（開発中のためデモ動作です）`);
      }
    }

    function goBack() {
      const params = new URLSearchParams(window.location.search);
      const from = params.get('from');

      if (from === 'mypage' && window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'navigate', page: 'mypage' }, '*');
      } else {
        history.back();
      }
    }

    // 初期化
    initPage();
  </script>
</body>
</html>
