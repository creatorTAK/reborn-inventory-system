# Issues（未完了）

このファイルは、REBORN Inventoryプロジェクトの**未完了Issue**を管理します。

**運用ルール：**
- 新しいIssueは最上部に追加
- 完了したIssue（✅ DONE）は `issues-closed.md` に移動
- 定期的にレビュー（週1回推奨）

**関連ドキュメント：**
- [TDD_POLICY.md](./TDD_POLICY.md) - Issue管理ルール詳細
- [ISSUE_TEMPLATE.md](./ISSUE_TEMPLATE.md) - Issue起票テンプレート
- [issues-closed.md](./issues-closed.md) - 完了Issueアーカイブ

---

## RESET-005 | 機能改善: リセット機能の全面改修（「次の商品へ」機能）

### 📌 基本情報
- [ ] カテゴリ: 機能改善
- [ ] 優先度: 高
- [ ] 影響範囲: リセット機能全体、商品登録ワークフロー
- [ ] 要望日: 2025-10-21

### 💡 改善内容

現在のリセット機能を**「次の商品へ」機能**として全面改修する。

**現在の問題点：**
1. エラーが発生すると処理全体が中断される
2. 保持すべき項目とクリアすべき項目が混在
3. 1つの巨大な関数（300行超）で保守性が低い
4. デフォルト値の再適用が不安定
5. 部分的なリセット（割引情報・ハッシュタグ保持）が未実装

**改善後の期待効果：**
- 商品登録業務の効率化（設定を保持したまま次の商品へ）
- エラーに強い安定したリセット処理
- 保守性の高いコード構造
- 明確なテストケースによる品質保証

### ✅ 詳細仕様

#### 1. 管理番号ブロック - **全てクリア**
- [ ] 頭文字（prefix1）
- [ ] 棚番号
- [ ] 使用可能な管理番号（管理番号フィールド）
- [ ] 担当者
- [ ] 動的に生成される管理番号フィールド（mgmt_shelf_first, mgmt_shelf_second等）

#### 2. 基本情報ブロック - **全てクリア**
- [ ] カテゴリー（大分類、中分類、小分類、細分類、細分類2）
- [ ] ブランド（英語、カナ）
- [ ] アイテム名
- [ ] サイズ
- [ ] 商品の状態

#### 3. 商品名ブロック - **商品情報をクリア、デフォルト値は保持**
- [ ] 商品名プレビュー：クリア
- [ ] **セールスワード：デフォルト値を保持**（設定されている場合）
- [ ] ブランド情報：クリア（基本情報に連動）
- [ ] アイテム名：クリア（基本情報に連動）
- [ ] 商品属性：全クリア + 属性セクションを1つに戻す

#### 4. 商品詳細ブロック - **全てクリア + セクション初期化**
- [ ] サイズセクション：非表示に戻す
  - [ ] トップス/ボトムス/靴のサイズフィールド全クリア
  - [ ] サイズアイコン・ラベルを初期状態に戻す
- [ ] カラー（詳細）：全クリア + セクションを1つに戻す
  - [ ] カラー1以外を削除
  - [ ] カラー1を空に
- [ ] 素材：全クリア + セクションを1つに戻す
  - [ ] 素材1以外を削除
  - [ ] 素材1の全フィールドを空に
- [ ] 商品の状態詳細：クリア
- [ ] AI生成情報：全クリア
  - [ ] 追加属性（AI用商品属性）
  - [ ] 品番・型番
  - [ ] 商品画像（アップロード済み画像を全削除）

#### 5. 商品説明ブロック - **部分保持**
- [ ] 商品の説明textarea：デフォルト値に戻す
  - [ ] **割引情報：保持**（設定で定義されたもの）
  - [ ] **オリジナルハッシュタグ：保持**（設定で定義されたもの）
  - [ ] その他の商品固有情報：クリア

#### 6. 配送についてブロック - **デフォルト値を保持**
- [ ] 配送料の負担：デフォルト値を保持
- [ ] 配送の方法：デフォルト値を保持
- [ ] 発送元の地域：デフォルト値を保持
- [ ] 発送までの日数：デフォルト値を保持

#### 7. 仕入情報ブロック - **デフォルト値を保持**
- [ ] 仕入日：デフォルト値を保持（「今日」設定に従う）
- [ ] 仕入先：デフォルト値を保持
- [ ] 仕入金額：クリア

#### 8. 出品情報ブロック - **デフォルト値を保持**
- [ ] 出品日：デフォルト値を保持（「今日」設定に従う）
- [ ] 出品先：デフォルト値を保持
- [ ] 出品金額：クリア

### 🧪 テストケース

#### TC-RESET-005-001: 管理番号ブロックのリセット
**前提条件:**
- 頭文字: 「SN-2025-」入力済み
- 棚番号: 「A-01」入力済み
- 管理番号: 「SN-2025-001」生成済み
- 担当者: 「山田太郎」選択済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 頭文字: 空
- 棚番号: 空
- 管理番号: 空
- 担当者: 空

#### TC-RESET-005-002: 基本情報ブロックのリセット
**前提条件:**
- カテゴリー: 「スニーカー」選択済み
- ブランド: 「NIKE」選択済み
- アイテム名: 「ハイカットスニーカー」選択済み
- サイズ: 「27.0cm」選択済み
- 商品の状態: 「新品・未使用」選択済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- カテゴリー: 空（初期状態）
- ブランド: 空
- アイテム名: 空
- サイズ: 空
- 商品の状態: 空

#### TC-RESET-005-003: セールスワードのデフォルト値保持
**前提条件:**
- 設定でセールスワードのデフォルト値が設定済み（例: 【美品】）
- セールスワード: 「【美品】」表示済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- セールスワード: 「【美品】」が保持される

#### TC-RESET-005-004: 商品属性セクションの初期化
**前提条件:**
- 商品属性1: カテゴリ「カラー」、値「ブラック」
- 商品属性2: カテゴリ「サイズ」、値「L」
- 商品属性3: カテゴリ「素材」、値「レザー」
- （3つのセクションが表示されている）

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 商品属性2, 3のセクションが削除される
- 商品属性1のみ残り、空の状態になる

#### TC-RESET-005-005: カラーセクションの初期化
**前提条件:**
- カラー1: 「ブラック」
- カラー2: 「ホワイト」
- カラー3: 「レッド」
- （3つのセクションが表示されている）

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- カラー2, 3のセクションが削除される
- カラー1のみ残り、空の状態になる

#### TC-RESET-005-006: 素材セクションの初期化
**前提条件:**
- 素材1: 箇所「表地」、種類1「コットン」100%
- 素材2: 箇所「裏地」、種類1「ポリエステル」100%
- （2つのセクションが表示されている）

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 素材2のセクションが削除される
- 素材1のみ残り、全フィールドが空の状態になる

#### TC-RESET-005-007: 商品画像のクリア
**前提条件:**
- 商品画像: 3枚アップロード済み
- プレビュー表示されている

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 全ての画像が削除される
- プレビューが非表示になる
- ファイル入力がリセットされる

#### TC-RESET-005-008: 商品の説明の部分保持
**前提条件:**
- 商品の説明textarea: 以下の内容
  ```
  NIKE AIR JORDAN 1

  商品の状態：新品・未使用

  【割引情報】
  フォロー割: 500円引き

  #スニーカー #NIKE #エアジョーダン
  ```
- 設定で「割引情報」と「#スニーカー #NIKE」が登録済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 商品の説明textarea: 以下の内容
  ```
  【割引情報】
  フォロー割: 500円引き

  #スニーカー #NIKE
  ```
- 商品固有情報（NIKE AIR JORDAN 1、商品の状態）はクリア
- 設定済みの割引情報とハッシュタグは保持
- オリジナルハッシュタグ（#エアジョーダン）はクリア

#### TC-RESET-005-009: 配送情報のデフォルト値保持
**前提条件:**
- 設定でデフォルト値設定済み
  - 配送料の負担: 「送料込み（出品者負担）」
  - 配送の方法: 「ゆうパック」
- ユーザーが変更済み
  - 配送の方法: 「宅急便」

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 配送料の負担: 「送料込み（出品者負担）」（デフォルト値に戻る）
- 配送の方法: 「ゆうパック」（デフォルト値に戻る）

#### TC-RESET-005-010: 出品情報のデフォルト値保持
**前提条件:**
- 設定でデフォルト値設定済み
  - 出品先: 「メルカリ」「ラクマ」にチェック
- ユーザーが変更済み
  - 出品先: 「メルカリ」のみチェック

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 出品先: 「メルカリ」「ラクマ」にチェック（デフォルト値に戻る）

#### TC-RESET-005-011: エラー耐性テスト
**前提条件:**
- 一部のDOM要素が存在しない（意図的に削除）

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- エラーが発生しても処理が中断されない
- 存在する要素は正しくリセットされる
- コンソールにエラーログが出力される

#### TC-RESET-005-012: デグレードテスト（連続リセット）
**前提条件:**
- 商品情報を入力済み

**実行操作:**
1. リセットボタンを3回連続でクリック

**期待結果:**
- エラーが発生しない
- デフォルト値が保持され続ける

### 📐 設計方針

#### 1. 関数の分離
```javascript
function onReset() {
  try {
    console.log('=== リセット開始 ===');

    // 各セクションを独立した関数で処理
    resetManagementNumber();     // 管理番号ブロック
    resetBasicInfo();            // 基本情報ブロック
    resetProductName();          // 商品名ブロック
    resetProductDetails();       // 商品詳細ブロック
    resetDescription();          // 商品説明ブロック（部分保持）

    // デフォルト値を再適用
    applyDefaultValues();

    // プレビュー更新
    updateAllPreviews();

    console.log('=== リセット完了 ===');
  } catch (error) {
    console.error('リセット処理エラー:', error);
    alert('リセット処理中にエラーが発生しました。ページを再読み込みしてください。');
  }
}
```

#### 2. エラーハンドリング
- 各セクション関数内でtry-catchを使用
- エラーが発生してもログ出力して処理を継続
- 最終的なエラーのみユーザーに通知

#### 3. デフォルト値の管理
- 既存の `applyShippingDefaults()`, `applyProcureListingDefaults()` を活用
- セールスワードのデフォルト値適用を追加

#### 4. 商品の説明の部分保持ロジック
- `updateDescriptionFromDetail()` を改修
- 割引情報とハッシュタグを抽出して保持
- 商品固有情報のみクリア

### ✏️ 実装計画

#### Phase 1: 関数構造の作成
- [ ] 各セクションの関数を作成（空実装）
- [ ] onReset()から各関数を呼び出す構造にする
- [ ] エラーハンドリングの枠組みを追加

#### Phase 2: セクションごとの実装
- [ ] resetManagementNumber() 実装
- [ ] resetBasicInfo() 実装
- [ ] resetProductName() 実装
- [ ] resetProductDetails() 実装
- [ ] resetDescription() 実装（最重要・最難関）

#### Phase 3: デフォルト値の再適用
- [ ] applyDefaultValues() 実装
- [ ] セールスワードデフォルト値適用を追加
- [ ] 配送・仕入・出品情報のデフォルト値確認

#### Phase 4: テスト
- [ ] TC-RESET-005-001 ~ 012 を全て実行
- [ ] 不具合があれば修正
- [ ] デグレードテスト実施

### 📝 実装メモ

**注意点:**
- 商品の説明の部分保持は複雑（割引情報・ハッシュタグの抽出ロジックが必要）
- updateDescriptionFromDetail()との連携が重要
- デフォルト値の取得元を明確にする（config.json, グローバル変数）

### 状態
- [ ] ✅ DONE (完了日: )

---

## RESET-004 | バグ: 配送方法・出品先のデフォルト値が消える

### 📌 基本情報
- [ ] カテゴリ: バグ修正
- [ ] 優先度: 中
- [ ] 影響範囲: リセット機能、価格・出品情報ブロック
- [ ] 発見日: 2025-10-21

### 🐛 不具合内容
リセットボタンをクリックすると、配送方法と出品先のデフォルト値まで消えてしまう。

**現状の動作：**
- 配送方法：空になる
- 出品先チェックボックス：全て外れる

**問題点：**
- ユーザーが毎回デフォルト値を再設定する必要がある
- `config.json` で設定したデフォルト値の意味がなくなる

### ✅ 期待動作
リセット時に、配送方法と出品先は `config.json` で設定されたデフォルト値に戻る。

**例：**
- 配送方法：「ゆうパック」（デフォルト値）
- 出品先：「メルカリ」と「ラクマ」にチェック（デフォルト値）

### 📍 関連ファイル
- `sp_scripts.html` (resetForm関数)
- `config.json` (デフォルト値定義)
- `config_loader.js` (デフォルト値読み込み)

### 🧪 テストケース

#### TC-RESET-004-001: デフォルト値復元テスト
**前提条件:**
- config.json で以下を設定済み
  - 配送方法デフォルト: 「ゆうパック」
  - 出品先デフォルト: 「メルカリ」「ラクマ」
- ユーザーが以下に変更済み
  - 配送方法: 「宅急便」
  - 出品先: 「メルカリ」のみチェック

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 配送方法: 「ゆうパック」（デフォルト値に戻る）
- 出品先: 「メルカリ」「ラクマ」にチェック（デフォルト値に戻る）

#### TC-RESET-004-002: デグレードテスト（価格情報）
**前提条件:**
- 販売価格: 「50000」入力済み
- 原価: 「30000」入力済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 販売価格: 空（正常にクリアされる）
- 原価: 空（正常にクリアされる）

### ✏️ 修正内容
- [ ] resetForm関数で配送方法をデフォルト値に設定する処理を追加
- [ ] resetForm関数で出品先をデフォルト値に設定する処理を追加
- [ ] config.jsonのデフォルト値を正しく読み込めることを確認
- [ ] TC-RESET-004-001実行
- [ ] TC-RESET-004-002実行（デグレード確認）

### 📝 テスト結果
- [ ] TC-RESET-004-001: PASS / FAIL
- [ ] TC-RESET-004-002: PASS / FAIL

### 状態
- [ ] ✅ DONE (完了日: )

---

## RESET-003 | バグ: 商品の説明プレビューが消えない

### 📌 基本情報
- [ ] カテゴリ: バグ修正
- [ ] 優先度: 中
- [ ] 影響範囲: リセット機能、商品説明ブロック
- [ ] 発見日: 2025-10-21

### 🐛 不具合内容
リセットボタンをクリックしても、商品の説明プレビューが表示されたままになる。

**現状の動作：**
- 商品の説明（入力欄）: 正常にクリアされる ✅
- 商品の説明プレビュー: クリアされない ❌

**問題点：**
- ユーザーが混乱する（入力欄は空なのにプレビューは表示されている）
- 次の商品登録時に前の説明が見えている

### ✅ 期待動作
リセット時に、商品の説明プレビューも空になる。

### 📍 関連ファイル
- `sp_scripts.html` (resetForm関数)
- `sp_block_description.html` (プレビュー表示ロジック)

### 🧪 テストケース

#### TC-RESET-003-001: プレビュークリアテスト
**前提条件:**
- 商品の説明: 「NIKE AIR JORDAN 1は...」と入力済み
- 商品の説明プレビュー: HTML表示済み（文字装飾あり）

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 商品の説明: 空
- 商品の説明プレビュー: 空（何も表示されない）

#### TC-RESET-003-002: デグレードテスト（説明入力）
**前提条件:**
- リセット直後の状態

**実行操作:**
1. 商品の説明に「新しい商品説明」と入力
2. プレビュー更新ボタンをクリック

**期待結果:**
- プレビューに「新しい商品説明」が正常に表示される

### ✏️ 修正内容
- [x] resetForm関数に商品の説明プレビューをクリアする処理を追加
- [x] プレビュー要素のIDを特定（「商品の説明」textarea）
- [ ] TC-RESET-003-001実行
- [ ] TC-RESET-003-002実行（デグレード確認）

**実装詳細:**
- ファイル: `sp_scripts.html`
- 行数: 3962-3966
- 修正内容: `descPreview.value = '';` を追加してtextareaをクリア

### 📝 テスト結果
- [ ] TC-RESET-003-001: PASS / FAIL
- [ ] TC-RESET-003-002: PASS / FAIL

### 状態
- [ ] ✅ DONE (完了日: )

---

## RESET-002 | バグ: 商品名ブロックの情報が残る

### 📌 基本情報
- [ ] カテゴリ: バグ修正
- [ ] 優先度: 高
- [ ] 影響範囲: リセット機能、商品名ブロック
- [ ] 発見日: 2025-10-21

### 🐛 不具合内容
リセットボタンをクリックしても、商品名ブロック内の以下の情報が残る：
- ブランド情報表示
- 商品名プレビュー
- AI属性

**現状の動作：**
- 基本情報のブランド選択: 正常にクリアされる ✅
- 商品名ブロックのブランド情報表示: クリアされない ❌
- 商品名ブロックのアイテム名: 正常にクリアされる ✅
- 商品名プレビュー: クリアされない ❌
- AI属性: クリアされない ❌

**問題点：**
- 前の商品の情報が残ったまま次の商品を登録してしまう可能性
- 特にAI属性は重要な情報なので残っていると混乱する

### ✅ 期待動作
リセット時に、商品名ブロック内の全ての表示情報がクリアされる。

### 📍 関連ファイル
- `sp_scripts.html` (resetForm関数)
- `sp_block_product_name.html` (商品名ブロックUI)

### 🧪 テストケース

#### TC-RESET-002-001: 商品名ブロッククリアテスト
**前提条件:**
- 基本情報ブランド: 「NIKE」選択済み
- 商品名ブロックのブランド情報: 「NIKE」表示済み
- アイテム名: 「AIR JORDAN 1」入力済み
- 商品名プレビュー: 「NIKE AIR JORDAN 1」表示済み
- AI属性: 「HIGH OG」入力済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- 基本情報ブランド: 空
- 商品名ブロックのブランド情報: 空（非表示）
- アイテム名: 空
- 商品名プレビュー: 空（非表示）
- AI属性: 空

#### TC-RESET-002-002: デグレードテスト（ブランド連動）
**前提条件:**
- リセット直後の状態

**実行操作:**
1. 基本情報のブランドで「NIKE」を選択

**期待結果:**
- 商品名ブロックのブランド情報に「NIKE」が正常に表示される

### ✏️ 修正内容
- [ ] ブランド情報表示要素のIDを特定
- [ ] 商品名プレビュー要素のIDを特定
- [ ] AI属性要素のIDを特定
- [ ] resetForm関数に各要素をクリアする処理を追加
- [ ] TC-RESET-002-001実行
- [ ] TC-RESET-002-002実行（デグレード確認）

### 📝 テスト結果
- [ ] TC-RESET-002-001: PASS / FAIL
- [ ] TC-RESET-002-002: PASS / FAIL

### 状態
- [ ] ✅ DONE (完了日: )

---

## RESET-001 | バグ: 管理番号プレフィックス・棚番号が残る

### 📌 基本情報
- [ ] カテゴリ: バグ修正
- [ ] 優先度: 高
- [ ] 影響範囲: リセット機能、基本情報ブロック
- [ ] 発見日: 2025-10-21

### 🐛 不具合内容
リセットボタンをクリックしても、管理番号プレフィックスと棚番号が残る。

**現状の動作：**
- カテゴリー: 正常にクリアされる ✅
- ブランド: 正常にクリアされる ✅
- アイテム名: 正常にクリアされる ✅
- 管理番号プレフィックス: クリアされない ❌
- 棚番号: クリアされない ❌

**問題点：**
- 前の商品の管理番号プレフィックスが残る
- 前の商品の棚番号が残る
- 次の商品登録時に誤った情報が使われる可能性

### ✅ 期待動作
リセット時に、管理番号プレフィックスと棚番号も空になる。

### 📍 関連ファイル
- `sp_scripts.html` (resetForm関数)

### 🧪 テストケース

#### TC-RESET-001-001: 基本情報クリアテスト
**前提条件:**
- カテゴリー: 「スニーカー」選択済み
- ブランド: 「NIKE」選択済み
- アイテム名: 「ハイカットスニーカー」選択済み
- 管理番号プレフィックス: 「SN-2025-」入力済み
- 棚番号: 「A-01」入力済み

**実行操作:**
1. リセットボタンをクリック

**期待結果:**
- カテゴリー: 空（初期状態）
- ブランド: 空（初期状態）
- アイテム名: 空（初期状態）
- 管理番号プレフィックス: 空
- 棚番号: 空

#### TC-RESET-001-002: デグレードテスト（管理番号生成）
**前提条件:**
- リセット直後の状態

**実行操作:**
1. カテゴリー: 「スニーカー」選択
2. ブランド: 「NIKE」選択
3. アイテム名: 「ハイカットスニーカー」選択

**期待結果:**
- 管理番号が新規生成される（例: SN-2025-002）
- 連番が正しくインクリメントされる

### ✏️ 修正内容
- [ ] resetForm関数に管理番号プレフィックスのクリア処理を追加
- [ ] resetForm関数に棚番号のクリア処理を追加
- [ ] TC-RESET-001-001実行
- [ ] TC-RESET-001-002実行（デグレード確認）

### 📝 テスト結果
- [ ] TC-RESET-001-001: PASS / FAIL
- [ ] TC-RESET-001-002: PASS / FAIL

### 状態
- [ ] ✅ DONE (完了日: )

---

**Issue数: 4件**
**最終更新: 2025-10-21**
