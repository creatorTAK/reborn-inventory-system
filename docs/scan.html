<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>QRã‚¹ã‚­ãƒ£ãƒ³ - FURIRA</title>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- html5-qrcode -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }
  
  /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
  .header {
    background: linear-gradient(135deg, #40B4E5 0%, #1E8FBF 100%);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 600px;
    margin: 0 auto;
  }
  .header-title {
    font-size: 1.1rem;
    font-weight: 600;
  }
  .back-button {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
  }
  
  /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
  .content {
    max-width: 600px;
    margin: 0 auto;
    padding: 16px;
  }
  
  /* ã‚«ãƒ¼ãƒ‰ */
  .card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border: none;
  }
  .card-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 16px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  /* ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ */
  #reader {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
  }
  #reader video {
    border-radius: 12px;
  }
  
  /* ã‚¹ã‚­ãƒ£ãƒ³çµæœ */
  .scan-result {
    display: none;
  }
  .scan-result.show {
    display: block;
  }
  .scan-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
  }
  .scan-success-icon {
    font-size: 3rem;
    color: #28a745;
    text-align: center;
    display: block;
    margin-bottom: 8px;
  }
  
  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  .form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #555;
    margin-bottom: 6px;
  }
  .form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #ddd;
    padding: 12px;
    font-size: 1rem;
  }
  .form-control:focus, .form-select:focus {
    border-color: #40B4E5;
    box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
  }
  
  /* ãƒœã‚¿ãƒ³ */
  .btn-primary {
    background: linear-gradient(135deg, #40B4E5 0%, #1E8FBF 100%);
    border: none;
    border-radius: 8px;
    padding: 14px 24px;
    font-size: 1rem;
    font-weight: 600;
  }
  .btn-primary:hover {
    background: linear-gradient(135deg, #3dbdb5 0%, #3a9080 100%);
  }
  .btn-secondary {
    background: #6c757d;
    border: none;
    border-radius: 8px;
    padding: 14px 24px;
    font-size: 1rem;
  }
  .btn-outline-secondary {
    border: 2px solid #6c757d;
    color: #6c757d;
    border-radius: 8px;
    padding: 12px 20px;
  }
  
  /* ä»•å…¥æƒ…å ±ï¼ˆç®¡ç†è€…ã®ã¿è¡¨ç¤ºï¼‰ */
  .purchase-info {
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 16px;
    font-size: 0.875rem;
  }
  .purchase-info.hidden {
    display: none;
  }
  .purchase-info-label {
    color: #856404;
    font-weight: 500;
  }
  
  /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
  .mode-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  .mode-tab {
    flex: 1;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    text-align: center;
    cursor: pointer;
    font-weight: 500;
    color: #666;
    transition: all 0.2s;
  }
  .mode-tab.active {
    border-color: #40B4E5;
    background: #e8f8f6;
    color: #40B4E5;
  }
  .mode-tab i {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 4px;
  }
  
  /* æ‰‹å‹•å…¥åŠ› */
  .manual-input {
    display: none;
  }
  .manual-input.show {
    display: block;
  }
</style>
</head>
<body>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="header">
  <div class="header-content">
    <button class="back-button" onclick="history.back()">
      <i class="bi bi-chevron-left"></i>
    </button>
    <div class="header-title">
      <i class="bi bi-qr-code-scan"></i> QRã‚¹ã‚­ãƒ£ãƒ³
    </div>
    <button class="menu-button" onclick="window.parent.postMessage({type:'toggleDrawer'}, '*')" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
      <i class="bi bi-list"></i>
    </button>
  </div>
</div>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="content">
  
  <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
  <div class="mode-tabs">
    <div class="mode-tab active" onclick="switchMode('scan')">
      <i class="bi bi-camera"></i>
      ã‚«ãƒ¡ãƒ©
    </div>
    <div class="mode-tab" onclick="switchMode('manual')">
      <i class="bi bi-keyboard"></i>
      æ‰‹å‹•å…¥åŠ›
    </div>
  </div>
  
  <!-- ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ -->
  <div class="card" id="scannerCard">
    <div class="card-title">
      <i class="bi bi-camera-video"></i> QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
    </div>
    <div id="reader"></div>
    <p class="text-muted mt-3 mb-0 small">
      <i class="bi bi-info-circle"></i> 
      å•†å“ã‚¿ã‚°ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«ã‹ã–ã—ã¦ãã ã•ã„
    </p>
  </div>
  
  <!-- æ‰‹å‹•å…¥åŠ› -->
  <div class="card manual-input" id="manualInput">
    <div class="card-title">
      <i class="bi bi-keyboard"></i> ä»•å…¥å•†å“IDã‚’å…¥åŠ›
    </div>
    <div class="mb-3">
      <input type="text" class="form-control" id="manualInvId" placeholder="ä¾‹: abc123-001">
      <small class="text-muted mt-1 d-block">ãƒ©ãƒ™ãƒ«ã«å°å­—ã•ã‚Œã¦ã„ã‚‹IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</small>
    </div>
    <button class="btn btn-primary w-100" onclick="processManualInput()">
      <i class="bi bi-search"></i> æ¤œç´¢
    </button>
  </div>
  
  <!-- ã‚¹ã‚­ãƒ£ãƒ³çµæœ -->
  <div class="scan-result" id="scanResult">
    <div class="scan-success">
      <i class="bi bi-check-circle-fill scan-success-icon"></i>
      <div class="text-center">
        <strong>ã‚¹ã‚­ãƒ£ãƒ³æˆåŠŸï¼</strong><br>
        <span id="scannedInvId"></span>
      </div>
    </div>
    
    <!-- ä»•å…¥æƒ…å ±ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
    <div class="purchase-info" id="purchaseInfo">
      <div class="purchase-info-label">
        <i class="bi bi-lock-fill"></i> ä»•å…¥æƒ…å ±ï¼ˆç®¡ç†è€…ã®ã¿è¡¨ç¤ºï¼‰
      </div>
      <div class="mt-2">
        <div><strong>ä»•å…¥æ—¥:</strong> <span id="info-purchaseDate">2025/12/12</span></div>
        <div><strong>ä»•å…¥å…ˆ:</strong> <span id="info-supplier">ã€‡ã€‡å¤ç€å¸‚å ´</span></div>
        <div><strong>ä»•å…¥å˜ä¾¡:</strong> <span id="info-price">Â¥500</span></div>
      </div>
    </div>
    
    <!-- å•†å“ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card">
      <div class="card-title">
        <i class="bi bi-pencil-square"></i> å•†å“æƒ…å ±ã‚’å…¥åŠ›
      </div>
      
      <div class="mb-3">
        <label class="form-label">ç®¡ç†ç•ªå· <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="managementNumber" placeholder="ä¾‹: AB-1001">
        <small class="text-muted">ã‚ãªãŸã®æ£šã«åˆã‚ã›ã¦æ¡ç•ªã—ã¦ãã ã•ã„</small>
      </div>
      
      <div class="mb-3">
        <label class="form-label">å•†å“å <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="productName" placeholder="ä¾‹: ãƒŠã‚¤ã‚­ ã‚¹ã‚¦ã‚§ãƒƒãƒˆãƒ‘ãƒ¼ã‚«ãƒ¼">
      </div>
      
      <div class="row">
        <div class="col-6">
          <div class="mb-3">
            <label class="form-label">ãƒ–ãƒ©ãƒ³ãƒ‰</label>
            <input type="text" class="form-control" id="brand" placeholder="NIKE">
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3">
            <label class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
            <select class="form-select" id="category">
              <option value="">--é¸æŠ--</option>
              <option value="ãƒˆãƒƒãƒ—ã‚¹">ãƒˆãƒƒãƒ—ã‚¹</option>
              <option value="ãƒœãƒˆãƒ ã‚¹">ãƒœãƒˆãƒ ã‚¹</option>
              <option value="ã‚¢ã‚¦ã‚¿ãƒ¼">ã‚¢ã‚¦ã‚¿ãƒ¼</option>
              <option value="ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹">ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹</option>
              <option value="ãƒãƒƒã‚°">ãƒãƒƒã‚°</option>
              <option value="ã‚·ãƒ¥ãƒ¼ã‚º">ã‚·ãƒ¥ãƒ¼ã‚º</option>
              <option value="ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼">ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-6">
          <div class="mb-3">
            <label class="form-label">ã‚µã‚¤ã‚º</label>
            <input type="text" class="form-control" id="size" placeholder="M">
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3">
            <label class="form-label">ã‚«ãƒ©ãƒ¼</label>
            <input type="text" class="form-control" id="color" placeholder="ãƒ–ãƒ©ãƒƒã‚¯">
          </div>
        </div>
      </div>
      
      <div class="mb-3">
        <label class="form-label">å†™çœŸ</label>
        <div class="d-grid">
          <button class="btn btn-outline-secondary" onclick="openCamera()">
            <i class="bi bi-camera"></i> å†™çœŸã‚’æ’®å½±
          </button>
        </div>
        <div id="photoPreview" class="mt-2"></div>
      </div>
      
      <div class="d-grid gap-2 mt-4">
        <button class="btn btn-primary btn-lg" onclick="registerProduct()">
          <i class="bi bi-check-lg"></i> å•†å“ã‚’ç™»éŒ²
        </button>
        <button class="btn btn-outline-secondary" onclick="resetScan()">
          <i class="bi bi-arrow-counterclockwise"></i> æ¬¡ã®å•†å“ã‚’ã‚¹ã‚­ãƒ£ãƒ³
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase v313: Firestoreé€£æºè¿½åŠ  -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // v313: FirebaseåˆæœŸåŒ–
  const firebaseConfig = {
    apiKey: "AIzaSyD8U8l0noFza2Wrt5mni2VgKV3iKPLadWQ",
    authDomain: "furira.jp",
    projectId: "reborn-chat",
    storageBucket: "reborn-chat.firebasestorage.app",
    messagingSenderId: "684049628498",
    appId: "1:684049628498:web:efb1a6c5dfe93f9b5eb09c",
    measurementId: "G-KGFXDX5XQ2"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const db = firebase.firestore();

  let html5QrCode = null;
  let currentInvId = null;
  let currentSlotData = null; // v313: ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ä¿æŒ
  let isAdmin = true; // TODO: å®Ÿéš›ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
  
  // åˆæœŸåŒ–
  document.addEventListener('DOMContentLoaded', function() {
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ï¼ˆQRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
    const urlParams = new URLSearchParams(window.location.search);
    const invId = urlParams.get('inv');
    
    if (invId) {
      // QRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
      processScannedCode(invId);
    } else {
      // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼èµ·å‹•
      startScanner();
    }
    
    // ç®¡ç†è€…ã§ãªã‘ã‚Œã°ä»•å…¥æƒ…å ±ã‚’éè¡¨ç¤º
    if (!isAdmin) {
      document.getElementById('purchaseInfo').classList.add('hidden');
    }
  });
  
  // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼èµ·å‹•
  function startScanner() {
    html5QrCode = new Html5Qrcode("reader");
    
    html5QrCode.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: { width: 250, height: 250 }
      },
      onScanSuccess,
      onScanFailure
    ).catch(err => {
      console.error("ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—:", err);
      document.getElementById('reader').innerHTML = `
        <div class="text-center text-danger p-4">
          <i class="bi bi-camera-video-off" style="font-size: 3rem;"></i>
          <p class="mt-2">ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“</p>
          <p class="small">æ‰‹å‹•å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ã‚’ãŠä½¿ã„ãã ã•ã„</p>
        </div>
      `;
    });
  }
  
  // ã‚¹ã‚­ãƒ£ãƒ³æˆåŠŸ
  function onScanSuccess(decodedText, decodedResult) {
    // URLã‹ã‚‰invãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŠ½å‡º
    let invId = decodedText;
    try {
      const url = new URL(decodedText);
      invId = url.searchParams.get('inv') || decodedText;
    } catch (e) {
      // URLã§ãªã„å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
    }
    
    // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢
    if (html5QrCode) {
      html5QrCode.stop();
    }
    
    processScannedCode(invId);
  }
  
  // ã‚¹ã‚­ãƒ£ãƒ³å¤±æ•—ï¼ˆç¶™ç¶šã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ï¼‰
  function onScanFailure(error) {
    // ç„¡è¦–ï¼ˆç¶™ç¶šï¼‰
  }
  
  // ã‚¹ã‚­ãƒ£ãƒ³çµæœå‡¦ç†
  // v313: Firestoreã‹ã‚‰ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  async function processScannedCode(invId) {
    currentInvId = invId;
    console.log('ğŸ“· [scan.html v313] ã‚¹ã‚­ãƒ£ãƒ³:', invId);

    // è¡¨ç¤ºæ›´æ–°
    document.getElementById('scannedInvId').textContent = invId;
    document.getElementById('scannerCard').style.display = 'none';
    document.getElementById('manualInput').classList.remove('show');
    document.getElementById('scanResult').classList.add('show');

    // v313: Firestoreã‹ã‚‰ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    if (invId.startsWith('BATCH-')) {
      try {
        console.log('ğŸ“· [scan.html v313] Firestoreå–å¾—é–‹å§‹:', invId);

        // ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const slotSnap = await db.collection('purchaseSlots').doc(invId).get();
        if (slotSnap.exists) {
          currentSlotData = slotSnap.data();
          console.log('ğŸ“· [scan.html v313] ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿:', currentSlotData);

          // ä»•å…¥æƒ…å ±ã‚’è¡¨ç¤º
          document.getElementById('info-purchaseDate').textContent = currentSlotData.purchaseDate || '-';
          document.getElementById('info-supplier').textContent = currentSlotData.supplier || '-';
          document.getElementById('info-price').textContent = currentSlotData.amount ? `Â¥${Number(currentSlotData.amount).toLocaleString()}` : '-';
        } else {
          console.warn('ğŸ“· [scan.html v313] ã‚¹ãƒ­ãƒƒãƒˆæœªç™ºè¦‹:', invId);
          document.getElementById('info-purchaseDate').textContent = '-';
          document.getElementById('info-supplier').textContent = 'ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰';
          document.getElementById('info-price').textContent = '-';
        }
      } catch (error) {
        console.error('ğŸ“· [scan.html v313] Firestoreå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('info-purchaseDate').textContent = '-';
        document.getElementById('info-supplier').textContent = 'ï¼ˆå–å¾—ã‚¨ãƒ©ãƒ¼ï¼‰';
        document.getElementById('info-price').textContent = '-';
      }
    } else {
      // æ—§å½¢å¼ã¾ãŸã¯ä¸æ˜ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      document.getElementById('info-purchaseDate').textContent = '-';
      document.getElementById('info-supplier').textContent = 'ï¼ˆä¸æ˜ãªå½¢å¼ï¼‰';
      document.getElementById('info-price').textContent = '-';
    }

    // åŠ¹æœéŸ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    try {
      const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleUI...');
      audio.volume = 0.3;
      audio.play().catch(() => {});
    } catch (e) {}
  }
  
  // æ‰‹å‹•å…¥åŠ›å‡¦ç†
  function processManualInput() {
    const invId = document.getElementById('manualInvId').value.trim();
    if (invId) {
      processScannedCode(invId);
    } else {
      alert('ä»•å…¥å•†å“IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
  }
  
  // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
  function switchMode(mode) {
    document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
    
    if (mode === 'scan') {
      document.querySelector('.mode-tab:first-child').classList.add('active');
      document.getElementById('scannerCard').style.display = 'block';
      document.getElementById('manualInput').classList.remove('show');
      if (!html5QrCode) {
        startScanner();
      }
    } else {
      document.querySelector('.mode-tab:last-child').classList.add('active');
      document.getElementById('scannerCard').style.display = 'none';
      document.getElementById('manualInput').classList.add('show');
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
        html5QrCode = null;
      }
    }
  }
  
  // ãƒªã‚»ãƒƒãƒˆ
  function resetScan() {
    currentInvId = null;
    document.getElementById('scanResult').classList.remove('show');
    document.getElementById('scannerCard').style.display = 'block';
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
    document.getElementById('managementNumber').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('brand').value = '';
    document.getElementById('category').value = '';
    document.getElementById('size').value = '';
    document.getElementById('color').value = '';
    document.getElementById('photoPreview').innerHTML = '';
    
    // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼å†èµ·å‹•
    startScanner();
  }
  
  // ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆå†™çœŸæ’®å½±ï¼‰
  function openCamera() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment';
    input.onchange = function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('photoPreview').innerHTML = `
            <img src="${e.target.result}" class="img-thumbnail" style="max-height: 150px;">
          `;
        };
        reader.readAsDataURL(file);
      }
    };
    input.click();
  }
  
  // å•†å“ç™»éŒ²
  function registerProduct() {
    const managementNumber = document.getElementById('managementNumber').value.trim();
    const productName = document.getElementById('productName').value.trim();
    
    if (!managementNumber || !productName) {
      alert('ç®¡ç†ç•ªå·ã¨å•†å“åã¯å¿…é ˆã§ã™');
      return;
    }
    
    // TODO: Firestoreã«ä¿å­˜
    const productData = {
      invId: currentInvId,
      managementNumber: managementNumber,
      productName: productName,
      brand: document.getElementById('brand').value.trim(),
      category: document.getElementById('category').value,
      size: document.getElementById('size').value.trim(),
      color: document.getElementById('color').value.trim(),
      registeredAt: new Date().toISOString()
    };
    
    console.log('ç™»éŒ²ãƒ‡ãƒ¼ã‚¿:', productData);
    
    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    alert(`å•†å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼\n\nç®¡ç†ç•ªå·: ${managementNumber}\nå•†å“å: ${productName}`);
    
    // æ¬¡ã®å•†å“ã¸
    resetScan();
  }
</script>

</body>
</html>
