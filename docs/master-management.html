<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ãƒã‚¹ã‚¿ç®¡ç† - ãƒ•ãƒªãƒ©ç‰©è²©ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- REBORN Brand Colors & Theme -->
  <link rel="stylesheet" href="/css/reborn-brand-colors.css?v=2e88423">
  <link rel="stylesheet" href="/css/reborn-theme.css?v=304">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background: #f5f6fa;
      padding-bottom: 80px;
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ - reborn-theme.cssã®çµ±ä¸€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ */

    /* ãƒã‚¹ã‚¿ç¨®åˆ¥é¸æŠ */
    .master-selector-container {
      max-width: 800px;
      margin: 16px auto;
      padding: 0 16px;
    }

    .master-selector {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .master-selector-label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      display: block;
    }

    .master-selector-dropdown {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s;
      background: white;
      cursor: pointer;
    }

    .master-selector-dropdown:focus {
      border-color: #40B4E5;
    }

    /* æ¤œç´¢ãƒãƒ¼ */
    .search-container {
      max-width: 800px;
      margin: 16px auto;
      padding: 0 16px;
    }

    .search-box {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 40px 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s;
      background: white;
    }

    .search-input:focus {
      border-color: #40B4E5;
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
      font-size: 18px;
    }

    /* æ‹¡å¼µæ©Ÿèƒ½ãƒãƒ¼ */
    .action-bar {
      max-width: 800px;
      margin: 0 auto 16px;
      padding: 16px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-left: 16px;
      margin-right: 16px;
    }

    .stats-info {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #666;
      font-weight: 600;
    }

    .stats-info i {
      color: #40B4E5;
      font-size: 18px;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-action {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-add {
      background: #40B4E5;
      color: white;
    }

    .btn-add:active {
      transform: scale(0.95);
      background: #3a9ae6;
    }

    .btn-select {
      background: #f5f5f5;
      color: #666;
    }

    .btn-select:active {
      background: #e0e0e0;
    }

    .btn-select.active {
      background: #40B4E5;
      color: white;
    }

    /* é¸æŠãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
    .selection-toolbar {
      max-width: 800px;
      margin: 0 auto 16px;
      padding: 12px 16px;
      background: #40B4E5;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-left: 16px;
      margin-right: 16px;
    }

    .btn-tool {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.2s;
    }

    .btn-tool:active {
      background: rgba(255, 255, 255, 0.3);
    }

    .btn-delete-selected {
      background: rgba(255, 59, 48, 0.9);
    }

    .btn-delete-selected:active {
      background: rgba(255, 59, 48, 1);
    }

    .selected-count {
      color: white;
      font-weight: 600;
      font-size: 14px;
      flex: 1;
      text-align: center;
    }

    /* ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ */
    .brands-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .master-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .master-card:active {
      transform: scale(0.98);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    .master-info {
      flex: 1;
    }

    .master-field {
      margin-bottom: 4px;
    }

    .master-field-label {
      font-size: 12px;
      color: #999;
      margin-right: 4px;
    }

    .master-field-value {
      font-size: 14px;
      color: #333;
      font-weight: 600;
    }

    .master-field-primary {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .master-field-secondary {
      font-size: 14px;
      color: #666;
    }

    .master-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }

    .usage-count {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #999;
    }

    .master-actions {
      display: flex;
      gap: 8px;
    }

    .btn-delete {
      background: #ff4757;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-delete:active {
      background: #e84118;
    }

    /* ç·¨é›†ãƒœã‚¿ãƒ³ */
    .btn-edit {
      background: #40B4E5;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
      margin-right: 8px;
    }

    .btn-edit:active {
      background: #2196F3;
    }

    .master-actions {
      display: flex;
      align-items: center;
    }

    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³è¡¨ç¤º */
    .accordion-header {
      background: #40B4E5;
      color: white;
      padding: 14px 16px;
      border-radius: 10px;
      margin-bottom: 8px;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s;
    }

    .accordion-header:active {
      transform: scale(0.98);
    }

    .accordion-header.expanded {
      border-radius: 10px 10px 0 0;
      margin-bottom: 0;
    }

    .accordion-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .accordion-toggle i {
      font-size: 18px;
      transition: transform 0.2s;
    }

    .accordion-title {
      font-size: 16px;
      font-weight: 600;
      flex: 1;
    }

    .accordion-count {
      font-size: 14px;
      opacity: 0.9;
    }

    .accordion-content {
      display: grid;
      grid-template-rows: 0fr;
      overflow: hidden;
      transition: grid-template-rows 0.3s ease;
      background: #f8f9fa;
      border-radius: 0 0 10px 10px;
      margin-bottom: 12px;
    }

    .accordion-content.expanded {
      grid-template-rows: 1fr;
    }

    .accordion-content > .accordion-inner {
      overflow: hidden;
      padding: 0 12px;
      transition: padding 0.3s ease;
    }

    .accordion-content.expanded > .accordion-inner {
      padding: 12px;
    }

    .accordion-content .master-card {
      margin-bottom: 10px;
      border-radius: 8px;
    }

    .accordion-content .master-card:last-child {
      margin-bottom: 0;
    }

    /* ãƒ©ãƒ™ãƒ«ä»˜ãã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆç¸¦é…åˆ—ï¼‰ */
    .master-field-labeled {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
      gap: 2px;
    }

    .master-field-labeled:last-child {
      margin-bottom: 0;
    }

    .master-field-labeled .field-label {
      font-size: 11px;
      color: #888;
    }

    .master-field-labeled .field-value {
      font-size: 15px;
      color: #333;
      font-weight: 600;
    }

    /* ä¾¡æ ¼è¡¨ç¤ºã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
    .master-field-labeled .field-value.price-value {
      color: #e74c3c;
    }

    /* é¸æŠãƒ¢ãƒ¼ãƒ‰ç”¨ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
    .master-checkbox {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: #40B4E5;
    }

    .master-card.selection-mode {
      padding-left: 12px;
    }

    .master-card.selected {
      background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
      border: 2px solid #40B4E5;
    }

    /* ç©ºçŠ¶æ…‹ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state i {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-state-text {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .empty-state-hint {
      font-size: 14px;
      color: #bbb;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 400px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .modal-body {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: #40B4E5;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-primary {
      background: #40B4E5;
      color: white;
    }

    .btn-primary:active {
      background: #3a9ae6;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #666;
    }

    .btn-secondary:active {
      background: #d0d0d0;
    }

    /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */
    .error-message {
      background: #fff3f3;
      border: 1px solid #ffcaca;
      color: #d00;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    /* æ¤œç´¢çµæœè¶…éé€šçŸ¥ */
    .more-results-notice {
      background: #40B4E5;
      color: white;
      padding: 16px;
      border-radius: 12px;
      margin-top: 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
    }

    .more-results-notice i {
      font-size: 20px;
      margin-bottom: 8px;
      display: block;
    }

    .more-results-notice span {
      display: block;
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .more-results-notice small {
      display: block;
      font-size: 13px;
      opacity: 0.9;
    }

    /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆsidebar_configé¢¨ï¼‰ */
    .nav-tabs {
      margin-bottom: 0;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: hidden;
      border-bottom: none;
      background: #f8f9fa;
      padding: 8px 8px 0 8px;
      border-radius: 8px 8px 0 0;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
    }

    .nav-tabs::-webkit-scrollbar {
      height: 4px;
    }

    .nav-tabs::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 2px;
    }

    .nav-tabs .nav-link {
      font-size: 13px;
      padding: 10px 16px;
      white-space: nowrap;
      border: 1px solid transparent;
      border-radius: 6px 6px 0 0;
      color: #6c757d;
      background: transparent;
      margin-right: 4px;
      transition: all 0.2s;
    }

    .nav-tabs .nav-link:hover {
      background: #e9ecef;
      color: #495057;
    }

    .nav-tabs .nav-link.active {
      color: #212529;
      background: white;
      border-color: #dee2e6 #dee2e6 white;
      font-weight: 600;
    }

    .tab-content {
      background: white;
      padding: 20px;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒœãƒ‡ã‚£ã¨ã®çµ±åˆ */
    .accordion-body {
      background: #f8f9fa;
      border-radius: 0 0 8px 8px;
    }

    /* éè¡¨ç¤ºã‚¯ãƒ©ã‚¹ */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <!-- v304: ãƒ˜ãƒƒãƒ€ãƒ¼ã¯è¦ªãƒšãƒ¼ã‚¸ã«ç§»å‹• -->
  <script>
  (function() {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'setPageHeader',
        title: 'ãƒã‚¹ã‚¿ç®¡ç†',
        icon: 'bi bi-gear',
        showBackButton: true
      }, '*');
    }
  })();
  </script>

  <!-- ãƒã‚¹ã‚¿ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="master-tabs-container" style="max-width: 800px; margin: 16px auto; padding: 0 16px;">
    <!-- å•†å“é–¢é€£ãƒã‚¹ã‚¿ã‚¿ãƒ– -->
    <div id="product-master-tabs" style="display: none;">
      <ul class="nav nav-tabs" id="productMasterTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="master-brand-tab" data-bs-toggle="tab" data-bs-target="#master-brand" type="button" role="tab" onclick="loadMaster('product', 'brand')"><i class="bi bi-tags"></i> ãƒ–ãƒ©ãƒ³ãƒ‰</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-category-tab" data-bs-toggle="tab" data-bs-target="#master-category" type="button" role="tab" onclick="loadMaster('product', 'category')"><i class="bi bi-folder"></i> ã‚«ãƒ†ã‚´ãƒª</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-material-tab" data-bs-toggle="tab" data-bs-target="#master-material" type="button" role="tab" onclick="loadMaster('product', 'material')"><i class="bi bi-palette"></i> ç´ æ</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-fabric-tab" data-bs-toggle="tab" data-bs-target="#master-fabric" type="button" role="tab" onclick="loadMaster('product', 'fabric')"><i class="bi bi-layers"></i> ç”Ÿåœ°</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-accessory-tab" data-bs-toggle="tab" data-bs-target="#master-accessory" type="button" role="tab" onclick="loadMaster('product', 'accessory')"><i class="bi bi-box"></i> ä»˜å±å“</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-keyword-tab" data-bs-toggle="tab" data-bs-target="#master-keyword" type="button" role="tab" onclick="loadMaster('product', 'keyword')"><i class="bi bi-search"></i> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-salesword-tab" data-bs-toggle="tab" data-bs-target="#master-salesword" type="button" role="tab" onclick="loadMaster('product', 'salesword')"><i class="bi bi-chat-quote"></i> ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-attributeCategory-tab" data-bs-toggle="tab" data-bs-target="#master-attributeCategory" type="button" role="tab" onclick="loadMaster('product', 'attributeCategory')"><i class="bi bi-list-ul"></i> å±æ€§ã‚«ãƒ†ã‚´ãƒª</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-attributeValue-tab" data-bs-toggle="tab" data-bs-target="#master-attributeValue" type="button" role="tab" onclick="loadMaster('product', 'attributeValue')"><i class="bi bi-circle"></i> å±æ€§å€¤</button>
        </li>
      </ul>
    </div>

    <!-- æ¥­å‹™é–¢é€£ãƒã‚¹ã‚¿ã‚¿ãƒ– -->
    <div id="business-master-tabs" style="display: none;">
      <ul class="nav nav-tabs" id="businessMasterTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="master-shipping-tab" data-bs-toggle="tab" data-bs-target="#master-shipping" type="button" role="tab" onclick="loadMaster('business', 'shipping')"><i class="bi bi-truck"></i> ç™ºé€æ–¹æ³•</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-packaging-tab" data-bs-toggle="tab" data-bs-target="#master-packaging" type="button" role="tab" onclick="loadMaster('business', 'packaging')"><i class="bi bi-box-seam"></i> æ¢±åŒ…è³‡æ</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-staff-tab" data-bs-toggle="tab" data-bs-target="#master-staff" type="button" role="tab" onclick="loadMaster('business', 'staff')"><i class="bi bi-person"></i> æ‹…å½“è€…</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-supplier-tab" data-bs-toggle="tab" data-bs-target="#master-supplier" type="button" role="tab" onclick="loadMaster('business', 'supplier')"><i class="bi bi-building"></i> ä»•å…¥å…ˆ</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-assignee-tab" data-bs-toggle="tab" data-bs-target="#master-assignee" type="button" role="tab" onclick="loadMaster('business', 'assignee')"><i class="bi bi-geo-alt"></i> ç™ºé€å…ˆ</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-marketplace-tab" data-bs-toggle="tab" data-bs-target="#master-marketplace" type="button" role="tab" onclick="loadMaster('business', 'marketplace')"><i class="bi bi-shop"></i> å‡ºå“å…ˆ</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="master-categoryCode-tab" data-bs-toggle="tab" data-bs-target="#master-categoryCode" type="button" role="tab" onclick="loadMaster('business', 'categoryCode')"><i class="bi bi-upc"></i> ã‚«ãƒ†ã‚´ãƒªã‚³ãƒ¼ãƒ‰</button>
        </li>
      </ul>
    </div>
  </div>

  <!-- æ¤œç´¢ãƒãƒ¼ -->
  <div class="search-container">
    <div class="search-box">
      <input type="text" id="searchInput" class="search-input" placeholder="çµã‚Šè¾¼ã¿æ¤œç´¢...">
      <i class="bi bi-search search-icon"></i>
    </div>
  </div>

  <!-- GASç‰ˆãƒã‚¹ã‚¿ç®¡ç†iframeï¼ˆç™ºé€æ–¹æ³•ãƒ»æ¢±åŒ…è³‡æç”¨ï¼‰ -->
  <div class="gas-master-iframe-container hidden" id="gasMasterIframeContainer">
    <iframe id="gasMasterIframe" style="width: 100%; height: calc(100vh - 160px); border: none;"></iframe>
  </div>

  <!-- æ‹¡å¼µæ©Ÿèƒ½ãƒãƒ¼ -->
  <div class="action-bar">
    <div class="stats-info">
      <i class="bi bi-graph-up"></i>
      <span id="statsText">æ¤œç´¢çµæœ: 0ä»¶</span>
    </div>
    <div class="action-buttons">
      <button class="btn-action btn-add" onclick="showAddModal()">
        <i class="bi bi-plus-circle"></i>
        <span>æ–°è¦è¿½åŠ </span>
      </button>
      <button class="btn-action btn-select" onclick="toggleSelectionMode()" id="selectModeBtn">
        <i class="bi bi-check-square"></i>
        <span>é¸æŠå‰Šé™¤</span>
      </button>
    </div>
  </div>

  <!-- é¸æŠãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
  <div class="selection-toolbar hidden" id="selectionToolbar">
    <button class="btn-tool" onclick="selectAll()">
      <i class="bi bi-check-all"></i>
      å…¨é¸æŠ
    </button>
    <span class="selected-count" id="selectedCount">0ä»¶é¸æŠä¸­</span>
    <button class="btn-tool btn-delete-selected" onclick="deleteSelected()">
      <i class="bi bi-trash"></i>
      å‰Šé™¤
    </button>
  </div>

  <!-- ãƒã‚¹ã‚¿ãƒªã‚¹ãƒˆ -->
  <div class="brands-container" id="masterListContainer">
    <!-- ãƒã‚¹ã‚¿ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ç”Ÿæˆã•ã‚Œã‚‹ -->
  </div>

  <!-- ç©ºçŠ¶æ…‹ -->
  <div class="empty-state hidden" id="emptyState">
    <i class="bi bi-inbox"></i>
    <div class="empty-state-text" id="emptyStateText">ãƒã‚¹ã‚¿ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
    <div class="empty-state-hint" id="emptyStateHint"></div>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div class="loading-overlay hidden" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-backdrop hidden" id="addModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="addModalTitle">æ–°è¦è¿½åŠ </div>
      </div>
      <div class="modal-body">
        <div class="error-message hidden" id="addErrorMessage"></div>
        <div id="addModalBody">
          <!-- å‹•çš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="addCancelBtn" onclick="hideAddModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="addSubmitBtn" onclick="addMaster()">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-backdrop hidden" id="deleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="deleteModalTitle">å‰Šé™¤ç¢ºèª</div>
      </div>
      <div class="modal-body">
        <p>ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
        <div style="margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 8px;" id="deleteNameDisplay">
          <!-- å‰Šé™¤å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
        <p style="margin-top: 16px; color: #ff4757; font-size: 14px;">
          <i class="bi bi-exclamation-triangle"></i>
          ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" style="background: #ff4757;" onclick="confirmDelete()">å‰Šé™¤</button>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5.3 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase SDK (compatç‰ˆ) - ãƒã‚¹ã‚¿ç®¡ç†ç”¨ -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <!-- ãƒã‚¹ã‚¿å®šç¾©è¨­å®šèª­ã¿è¾¼ã¿ -->
  <script src="./js/master-config.js?v=287-accessories"></script>

  <!-- ãƒã‚¹ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰ï¼‹ã‚«ãƒ†ã‚´ãƒªï¼‰ -->
  <script src="/js/master-cache.js"></script>

  <!-- Firestore API + ãƒã‚¹ã‚¿ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯èª­ã¿è¾¼ã¿ -->
  <script type="module">
    // Firestore APIèª­ã¿è¾¼ã¿
    import('./js/firestore-api.js').then(module => {
      console.log('âœ… [Master Management] Firestore APIèª­ã¿è¾¼ã¿å®Œäº†');

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ä»£å…¥
      window.getMasterData = module.getMasterData;
      window.createMaster = module.createMaster;
      window.updateMaster = module.updateMaster;
      window.deleteMaster = module.deleteMaster;
      window.searchMaster = module.searchMaster;
      window.incrementMasterUsageCount = module.incrementMasterUsageCount;
      window.initializeFirestore = module.initializeFirestore;

      console.log('âœ… [Master Management] ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°è¨­å®šå®Œäº†');

      // ãƒã‚¹ã‚¿ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯èª­ã¿è¾¼ã¿
      return import('./js/master-manager.js?v=290-auto-init-default');
    }).then(() => {
      console.log('âœ… [Master Management] master-manager.jsèª­ã¿è¾¼ã¿å®Œäº†');

      // åˆæœŸåŒ–é–¢æ•°å‘¼ã³å‡ºã—
      if (typeof window.initMasterManager === 'function') {
        console.log('ğŸš€ [Master Management] åˆæœŸåŒ–é–‹å§‹...');
        window.initMasterManager();

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ category ã¨ sessionId ã‚’å–å¾—
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category') || 'product'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ product
        const sessionId = urlParams.get('sessionId');

        console.log('[Master Management] URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ category:', category);
        console.log('[Master Management] URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ sessionId:', sessionId);

        // sessionIdã‚’sessionStorageã«ä¿å­˜ï¼ˆiframeå†…ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ï¼‰
        if (sessionId) {
          sessionStorage.setItem('device_session_id', sessionId);
          console.log('[Master Management] âœ… sessionIdã‚’sessionStorageã«ä¿å­˜ã—ã¾ã—ãŸ');
        } else {
          console.warn('[Master Management] âš ï¸ URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«sessionIdãŒã‚ã‚Šã¾ã›ã‚“');
        }

        // ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ã¦ã‚¿ãƒ–ã‚’è¡¨ç¤º/éè¡¨ç¤º
        setTimeout(() => {
          const productTabs = document.getElementById('product-master-tabs');
          const businessTabs = document.getElementById('business-master-tabs');

          if (category === 'product') {
            productTabs.style.display = 'block';
            businessTabs.style.display = 'none';
            // å•†å“é–¢é€£ãƒã‚¹ã‚¿ã®æœ€åˆã®ã‚¿ãƒ–ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰ï¼‰ã‚’ãƒ­ãƒ¼ãƒ‰
            if (typeof window.loadMaster === 'function') {
              window.loadMaster('product', 'brand');
            }
          } else if (category === 'business') {
            productTabs.style.display = 'none';
            businessTabs.style.display = 'block';
            // æ¥­å‹™é–¢é€£ãƒã‚¹ã‚¿ã®æœ€åˆã®ã‚¿ãƒ–ï¼ˆç™ºé€æ–¹æ³•ï¼‰ã‚’ãƒ­ãƒ¼ãƒ‰
            if (typeof window.loadMaster === 'function') {
              window.loadMaster('business', 'shipping');
            }
          }
        }, 100);
      } else {
        console.error('âŒ [Master Management] initMasterManager ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    }).catch(error => {
      console.error('âŒ [Master Management] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      alert('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
    });
  </script>

  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³å‡¦ç† -->
  <script>
    function goBack() {
      // ç¢ºå®Ÿãªãƒ­ã‚°ï¼ˆé–¢æ•°å‘¼ã³å‡ºã—ç¢ºèªç”¨ï¼‰
      console.log('[master-management] >>> goBack() called at', new Date().toISOString());

      // iframeå†…ã§é–‹ã‹ã‚Œã¦ã„ã‚‹ã‹åˆ¤å®š
      const isInIframe = window.self !== window.top;

      if (isInIframe) {
        // iframeå†…ã‹ã‚‰è¦ªãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ï¼ˆpostMessageæ–¹å¼ - config.htmlã¨åŒã˜ï¼‰
        console.log('[master-management] iframeå†…ã§é–‹ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€postMessageé€ä¿¡ï¼ˆå±¥æ­´ãƒ™ãƒ¼ã‚¹ã®æˆ»ã‚‹ï¼‰');
        window.top.postMessage({ type: 'goBack' }, '*');
        console.log('[master-management] âœ… postMessageé€ä¿¡å®Œäº† (type: goBack)');
      } else {
        // ç›´æ¥é–‹ã‹ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«é·ç§»
        console.log('[master-management] ç›´æ¥é–‹ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«é·ç§»');
        // referrerãŒåŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å ´åˆã¯history.back()ã€ãã†ã§ãªã‘ã‚Œã°index.htmlã«é·ç§»
        const referrer = document.referrer;
        const isSameDomain = referrer && referrer.includes(window.location.hostname);

        if (isSameDomain && window.history.length > 1) {
          console.log('[master-management] åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®é·ç§» - history.back()');
          window.history.back();
        } else {
          console.log('[master-management] ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ - index.htmlã«é·ç§»');
          window.location.href = '/index.html';
        }
      }
    }

    // DOMContentLoadedå¾Œã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆæ¨å¥¨æ–¹å¼ï¼‰
    document.addEventListener('DOMContentLoaded', () => {
      const backButton = document.getElementById('back-button');
      if (backButton) {
        backButton.addEventListener('click', goBack);
        console.log('[master-management] âœ… æˆ»ã‚‹ãƒœã‚¿ãƒ³ã«goBack()ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ');
      } else {
        console.error('[master-management] âŒ æˆ»ã‚‹ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    });
  </script>

  <!-- ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ -->
  <script>
    // å•†å“é–¢é€£ãƒã‚¹ã‚¿ã‚¿ãƒ–ã®ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
    (function() {
      const productAccordionBody = document.getElementById('productMasterCollapse');
      if (!productAccordionBody) return;

      const tabIds = ['master-brand', 'master-category', 'master-material', 'master-fabric', 'master-accessory', 'master-keyword', 'master-salesword', 'master-attributeCategory', 'master-attributeValue'];
      const masterTypes = ['brand', 'category', 'material', 'fabric', 'accessory', 'keyword', 'salesword', 'attributeCategory', 'attributeValue'];
      let touchStartX = 0;
      let touchStartY = 0;
      let touchEndX = 0;
      let touchEndY = 0;
      let isSwiping = false;
      const minSwipeDistance = 80;
      const maxVerticalDeviation = 40;

      productAccordionBody.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
        isSwiping = true;
      }, { passive: true });

      productAccordionBody.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;

        const currentX = e.changedTouches[0].screenX;
        const currentY = e.changedTouches[0].screenY;
        const diffX = Math.abs(currentX - touchStartX);
        const diffY = Math.abs(currentY - touchStartY);

        if (diffY > maxVerticalDeviation || (diffY > 15 && diffY > diffX)) {
          isSwiping = false;
        }
      }, { passive: true });

      productAccordionBody.addEventListener('touchend', (e) => {
        if (!isSwiping) {
          isSwiping = false;
          return;
        }

        touchEndX = e.changedTouches[0].screenX;
        touchEndY = e.changedTouches[0].screenY;
        handleSwipe();
        isSwiping = false;
      }, { passive: true });

      function handleSwipe() {
        const diffX = touchStartX - touchEndX;
        const diffY = Math.abs(touchStartY - touchEndY);

        if (Math.abs(diffX) < minSwipeDistance || diffY > maxVerticalDeviation) return;
        if (Math.abs(diffX) < diffY * 2.5) return;

        const activeTab = document.querySelector('#productMasterTabs .nav-link.active');
        if (!activeTab) return;

        const currentId = activeTab.id.replace('-tab', '');
        const currentIndex = tabIds.indexOf(currentId);
        if (currentIndex === -1) return;

        let nextIndex;
        if (diffX > 0) {
          nextIndex = currentIndex + 1;
          if (nextIndex >= tabIds.length) return;
        } else {
          nextIndex = currentIndex - 1;
          if (nextIndex < 0) return;
        }

        const nextTabId = tabIds[nextIndex];
        const nextMasterType = masterTypes[nextIndex];
        const nextTabButton = document.getElementById(`${nextTabId}-tab`);
        if (nextTabButton) {
          const tab = new bootstrap.Tab(nextTabButton);
          tab.show();

          // ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          setTimeout(() => {
            nextTabButton.scrollIntoView({
              behavior: 'smooth',
              block: 'nearest',
              inline: 'center'
            });
          }, 50);

          // ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
          loadMaster('product', nextMasterType);
        }
      }
    })();

    // æ¥­å‹™é–¢é€£ãƒã‚¹ã‚¿ã‚¿ãƒ–ã®ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
    (function() {
      const businessAccordionBody = document.getElementById('businessMasterCollapse');
      if (!businessAccordionBody) return;

      const tabIds = ['master-shipping', 'master-packaging', 'master-staff', 'master-supplier', 'master-assignee', 'master-marketplace', 'master-categoryCode'];
      const masterTypes = ['shipping', 'packaging', 'staff', 'supplier', 'assignee', 'marketplace', 'categoryCode'];
      let touchStartX = 0;
      let touchStartY = 0;
      let touchEndX = 0;
      let touchEndY = 0;
      let isSwiping = false;
      const minSwipeDistance = 80;
      const maxVerticalDeviation = 40;

      businessAccordionBody.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
        isSwiping = true;
      }, { passive: true });

      businessAccordionBody.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;

        const currentX = e.changedTouches[0].screenX;
        const currentY = e.changedTouches[0].screenY;
        const diffX = Math.abs(currentX - touchStartX);
        const diffY = Math.abs(currentY - touchStartY);

        if (diffY > maxVerticalDeviation || (diffY > 15 && diffY > diffX)) {
          isSwiping = false;
        }
      }, { passive: true });

      businessAccordionBody.addEventListener('touchend', (e) => {
        if (!isSwiping) {
          isSwiping = false;
          return;
        }

        touchEndX = e.changedTouches[0].screenX;
        touchEndY = e.changedTouches[0].screenY;
        handleSwipe();
        isSwiping = false;
      }, { passive: true });

      function handleSwipe() {
        const diffX = touchStartX - touchEndX;
        const diffY = Math.abs(touchStartY - touchEndY);

        if (Math.abs(diffX) < minSwipeDistance || diffY > maxVerticalDeviation) return;
        if (Math.abs(diffX) < diffY * 2.5) return;

        const activeTab = document.querySelector('#businessMasterTabs .nav-link.active');
        if (!activeTab) return;

        const currentId = activeTab.id.replace('-tab', '');
        const currentIndex = tabIds.indexOf(currentId);
        if (currentIndex === -1) return;

        let nextIndex;
        if (diffX > 0) {
          nextIndex = currentIndex + 1;
          if (nextIndex >= tabIds.length) return;
        } else {
          nextIndex = currentIndex - 1;
          if (nextIndex < 0) return;
        }

        const nextTabId = tabIds[nextIndex];
        const nextMasterType = masterTypes[nextIndex];
        const nextTabButton = document.getElementById(`${nextTabId}-tab`);
        if (nextTabButton) {
          const tab = new bootstrap.Tab(nextTabButton);
          tab.show();

          // ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          setTimeout(() => {
            nextTabButton.scrollIntoView({
              behavior: 'smooth',
              block: 'nearest',
              inline: 'center'
            });
          }, 50);

          // ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
          loadMaster('business', nextMasterType);
        }
      }
    })();
  </script>
</body>
</html>
