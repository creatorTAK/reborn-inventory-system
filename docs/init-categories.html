<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿åˆæœŸåŒ–</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .danger {
      background: #f44336;
    }
    .danger:hover {
      background: #da190b;
    }
    #log {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .log-success { color: #4CAF50; }
    .log-error { color: #f44336; }
    .log-info { color: #2196F3; }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿åˆæœŸåŒ–</h1>

    <div class="warning">
      <strong>âš ï¸ æ³¨æ„</strong><br>
      ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ã§ã™ã€‚<br>
      æ—¢å­˜ã®ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã›ã‚“ï¼ˆè¿½åŠ ã®ã¿ï¼‰ã€‚
    </div>

    <div style="margin: 20px 0;">
      <button id="initBtn" onclick="initializeCategories()">ğŸš€ ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿åˆæœŸåŒ–</button>
      <button class="danger" onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <div id="log"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, addDoc, query, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyDSWnjNle3R4kUUNS1wa33xU0XRLoneDWQ",
      authDomain: "reborn-inventory.firebaseapp.com",
      projectId: "reborn-inventory",
      storageBucket: "reborn-inventory.firebasestorage.app",
      messagingSenderId: "119422504902",
      appId: "1:119422504902:web:cbf1ec1cd38e2f5c0eba70"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // åˆæœŸã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿
    const initialCategories = [
      { name: 'ãƒˆãƒƒãƒ—ã‚¹', parent: null, description: 'ã‚·ãƒ£ãƒ„ã€ãƒ–ãƒ©ã‚¦ã‚¹ã€Tã‚·ãƒ£ãƒ„ç­‰' },
      { name: 'ãƒœãƒˆãƒ ã‚¹', parent: null, description: 'ãƒ‘ãƒ³ãƒ„ã€ã‚¹ã‚«ãƒ¼ãƒˆç­‰' },
      { name: 'ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ãƒ»ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³', parent: null, description: 'ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ã€ã‚µãƒ­ãƒšãƒƒãƒˆç­‰' },
      { name: 'ã‚¢ã‚¦ã‚¿ãƒ¼', parent: null, description: 'ã‚¸ãƒ£ã‚±ãƒƒãƒˆã€ã‚³ãƒ¼ãƒˆç­‰' },
      { name: 'ãƒãƒƒã‚°', parent: null, description: 'ãƒãƒ³ãƒ‰ãƒãƒƒã‚°ã€ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒãƒƒã‚°ç­‰' },
      { name: 'ã‚·ãƒ¥ãƒ¼ã‚º', parent: null, description: 'é´å…¨èˆ¬' },
      { name: 'ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼', parent: null, description: 'ãƒãƒƒã‚¯ãƒ¬ã‚¹ã€ãƒ”ã‚¢ã‚¹ç­‰' },
      { name: 'å°ç‰©', parent: null, description: 'è²¡å¸ƒã€ãƒ™ãƒ«ãƒˆã€å¸½å­ç­‰' }
    ];

    // ãƒ­ã‚°å‡ºåŠ›
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString('ja-JP');
      const className = `log-${type}`;
      logDiv.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // ã‚«ãƒ†ã‚´ãƒªåˆæœŸåŒ–
    window.initializeCategories = async function() {
      const btn = document.getElementById('initBtn');
      btn.disabled = true;

      try {
        log('ğŸš€ ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿åˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...', 'info');

        const categoriesRef = collection(db, 'categories');
        let addedCount = 0;
        let skippedCount = 0;

        for (const category of initialCategories) {
          try {
            // æ—¢å­˜ãƒã‚§ãƒƒã‚¯
            const q = query(categoriesRef, where('name', '==', category.name));
            const snapshot = await getDocs(q);

            if (!snapshot.empty) {
              log(`â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ${category.name}ï¼ˆæ—¢ã«å­˜åœ¨ï¼‰`, 'info');
              skippedCount++;
              continue;
            }

            // è¿½åŠ 
            const docData = {
              name: category.name,
              parent: category.parent,
              description: category.description,
              usageCount: 0,
              createdAt: serverTimestamp()
            };

            await addDoc(categoriesRef, docData);
            log(`âœ… è¿½åŠ : ${category.name}`, 'success');
            addedCount++;

            // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
            await new Promise(resolve => setTimeout(resolve, 100));

          } catch (error) {
            log(`âŒ ã‚¨ãƒ©ãƒ¼ [${category.name}]: ${error.message}`, 'error');
          }
        }

        log('', 'info');
        log(`ğŸ‰ åˆæœŸåŒ–å®Œäº†ï¼`, 'success');
        log(`ğŸ“Š è¿½åŠ : ${addedCount}ä»¶ / ã‚¹ã‚­ãƒƒãƒ—: ${skippedCount}ä»¶`, 'info');

      } catch (error) {
        log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        console.error(error);
      } finally {
        btn.disabled = false;
      }
    };

    // ãƒ­ã‚°ã‚¯ãƒªã‚¢
    window.clearLog = function() {
      document.getElementById('log').innerHTML = '';
    };

    log('âœ… Firestoreæ¥ç¶šå®Œäº†', 'success');
  </script>
</body>
</html>
