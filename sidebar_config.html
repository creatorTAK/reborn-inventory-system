<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®šç®¡ç†</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
    }
    .config-container {
      padding: 16px;
    }
    .nav-tabs {
      margin-bottom: 0;
      flex-wrap: nowrap;
      overflow-x: auto;
      border-bottom: none;
      background: #f8f9fa;
      padding: 8px 8px 0 8px;
      border-radius: 8px 8px 0 0;
    }
    .nav-tabs .nav-link {
      font-size: 13px;
      padding: 10px 16px;
      white-space: nowrap;
      border: 1px solid transparent;
      border-radius: 6px 6px 0 0;
      color: #6c757d;
      background: transparent;
      margin-right: 4px;
      transition: all 0.2s;
    }
    .nav-tabs .nav-link:hover {
      background: #e9ecef;
      color: #495057;
    }
    .nav-tabs .nav-link.active {
      color: #212529;
      background: white;
      border-color: #dee2e6 #dee2e6 white;
      font-weight: 600;
    }
    .tab-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #212529;
    }
    .form-label {
      font-weight: 500;
      font-size: 13px;
      color: #495057;
      margin-bottom: 4px;
    }
    .form-control, .form-select {
      font-size: 13px;
      border-radius: 6px;
      border: 1px solid #ced4da;
    }
    .form-control:focus, .form-select:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }
    .btn-group-sm .btn {
      font-size: 12px;
      padding: 4px 8px;
    }
    .save-btn {
      position: sticky;
      bottom: 0;
      background: white;
      padding: 12px 16px;
      border-top: 1px solid #dee2e6;
      margin: -16px -16px 0 -16px;
      z-index: 10;
    }
    .button-config-item {
      background: #f8f9fa;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }
    .button-config-item .form-label {
      margin-bottom: 6px;
    }
    .add-btn {
      background: white;
      color: #3b82f6;
      border: 2px dashed #3b82f6;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .add-btn:hover {
      background: #eff6ff;
    }
    .remove-btn {
      font-size: 12px;
      padding: 2px 8px;
    }
    .discount-group {
      background: white;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .discount-range-item {
      background: #f9fafb;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
    }
    .alert {
      font-size: 13px;
      padding: 10px 14px;
      margin-bottom: 16px;
    }
    .input-group-text {
      font-size: 13px;
    }
    .condition-group {
      margin-bottom: 24px;
    }
    .condition-group-title {
      font-size: 14px;
      font-weight: 600;
      color: #495057;
      margin-bottom: 12px;
      padding: 8px 12px;
      background: #e9ecef;
      border-radius: 6px;
    }

  </style>
</head>
<body>
  <div class="config-container">
    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <ul class="nav nav-tabs" id="configTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="management-tab" data-bs-toggle="tab" data-bs-target="#management" type="button" role="tab">ğŸ”¢ ç®¡ç†ç•ªå·è¨­å®š</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="salesword-tab" data-bs-toggle="tab" data-bs-target="#salesword" type="button" role="tab">ğŸ’¬ ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="condition-tab" data-bs-toggle="tab" data-bs-target="#condition" type="button" role="tab">ğŸ”˜ å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="discount-tab" data-bs-toggle="tab" data-bs-target="#discount" type="button" role="tab">ğŸ’° å‰²å¼•æƒ…å ±</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="hashtag-tab" data-bs-toggle="tab" data-bs-target="#hashtag" type="button" role="tab">ğŸ·ï¸ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping" type="button" role="tab">ğŸ“¦ é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="procure-listing-tab" data-bs-toggle="tab" data-bs-target="#procure-listing" type="button" role="tab">ğŸ’¼ ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</button>
      </li>
    </ul>

    <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="tab-content" id="configTabContent">

      <!-- å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³è¨­å®š -->
      <div class="tab-pane fade" id="condition" role="tabpanel">
        <div class="section-title">ğŸ”˜ å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³è¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ å•†å“ç™»éŒ²æ™‚ã«ã€Œå•†å“çŠ¶æ…‹(è©³ç´°)ã€æ¬„ã¸ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§èª¬æ˜æ–‡ã‚’æŒ¿å…¥ã§ãã‚‹ãƒœã‚¿ãƒ³ã‚’è¨­å®šã§ãã¾ã™
        </div>

        <div id="conditionButtonsContainer">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>

      <!-- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¨­å®š -->
      <div class="tab-pane fade" id="hashtag" role="tabpanel">
        <div class="section-title">ğŸ·ï¸ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã¯å•†å“èª¬æ˜ã®æœ€å¾Œã«è‡ªå‹•ã§è¿½åŠ ã•ã‚Œã¾ã™
        </div>

        <!-- å…±é€šãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹è¨­å®š -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
            <span style="font-size: 16px;">âš™ï¸</span>
            <label style="font-size: 13px; font-weight: 600; color: #374151;">
              å…±é€šè¨­å®š
            </label>
          </div>
          <div style="display: flex; align-items: stretch;">
            <span style="width: 32px; padding: 8px 0; border: 2px solid #d1d5db; border-right: none; border-radius: 6px 0 0 6px; background: #f9fafb; font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; justify-content: center;">#</span>
            <input type="text" id="commonHashtagPrefix" placeholder="ã‚·ãƒ§ãƒƒãƒ—å_" style="width: calc(100% - 32px); padding: 8px 10px; border: 2px solid #d1d5db; border-radius: 0 6px 6px 0; font-size: 13px; transition: all 0.2s; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#d1d5db';" oninput="updateAllHashtagPreviews()">
          </div>
          <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">
            ğŸ’¡ ã‚·ãƒ§ãƒƒãƒ—åã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: Shopã€‡ã€‡_ï¼‰
          </div>
        </div>

        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›® -->
        <div id="hashtagItemsContainer"></div>

        <!-- è¿½åŠ ãƒœã‚¿ãƒ³ -->
        <button type="button" onclick="showHashtagTypeSelector()" style="width: 100%; padding: 10px; background: white; border: 2px dashed #3b82f6; border-radius: 8px; color: #3b82f6; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 8px; transition: all 0.2s;" onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
          + ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’è¿½åŠ 
        </button>

        <!-- ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
        <button type="button" onclick="clearAllHashtags()" style="width: 100%; padding: 10px; background: white; border: 2px solid #ef4444; border-radius: 8px; color: #ef4444; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 16px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
          ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢
        </button>

        <!-- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚¿ã‚¤ãƒ—é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div id="hashtagTypeSelectorMenu" style="display: none; margin-bottom: 16px; padding: 12px; background: white; border: 2px solid #3b82f6; border-radius: 8px;">
          <div style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">è¿½åŠ ã™ã‚‹ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ:</div>
          <div style="display: flex; flex-direction: column; gap: 6px;">
            <button type="button" onclick="addHashtagItemByType('å…¨å•†å“')" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.2s; text-align: left;" onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#3b82f6';" onmouseout="this.style.background='white'; this.style.borderColor='#d1d5db';">
              <span style="font-size: 18px;">ğŸŒ</span>
              <span style="font-size: 13px; font-weight: 500; color: #374151;">å…¨å•†å“</span>
            </button>
            <button type="button" onclick="addHashtagItemByType('ãƒ–ãƒ©ãƒ³ãƒ‰')" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.2s; text-align: left;" onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#3b82f6';" onmouseout="this.style.background='white'; this.style.borderColor='#d1d5db';">
              <span style="font-size: 18px;">ğŸ‘”</span>
              <span style="font-size: 13px; font-weight: 500; color: #374151;">ãƒ–ãƒ©ãƒ³ãƒ‰</span>
            </button>
            <button type="button" onclick="addHashtagItemByType('ã‚«ãƒ†ã‚´ãƒª')" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.2s; text-align: left;" onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#3b82f6';" onmouseout="this.style.background='white'; this.style.borderColor='#d1d5db';">
              <span style="font-size: 18px;">ğŸ“</span>
              <span style="font-size: 13px; font-weight: 500; color: #374151;">ã‚«ãƒ†ã‚´ãƒª</span>
            </button>
            <button type="button" onclick="addHashtagItemByType('ã‚«ãƒ©ãƒ¼')" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.2s; text-align: left;" onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#3b82f6';" onmouseout="this.style.background='white'; this.style.borderColor='#d1d5db';">
              <span style="font-size: 18px;">ğŸ¨</span>
              <span style="font-size: 13px; font-weight: 500; color: #374151;">ã‚«ãƒ©ãƒ¼</span>
            </button>
            <button type="button" onclick="addHashtagItemByType('ã‚µã‚¤ã‚º')" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.2s; text-align: left;" onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#3b82f6';" onmouseout="this.style.background='white'; this.style.borderColor='#d1d5db';">
              <span style="font-size: 18px;">ğŸ“</span>
              <span style="font-size: 13px; font-weight: 500; color: #374151;">ã‚µã‚¤ã‚º</span>
            </button>
            <button type="button" onclick="hideHashtagTypeSelector()" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 12px; color: #6b7280; margin-top: 4px;" onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
          </div>
        </div>
      </div>

      <!-- å‰²å¼•æƒ…å ±è¨­å®š -->
      <div class="tab-pane fade" id="discount" role="tabpanel">
        <div class="section-title">ğŸ’° å‰²å¼•è¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ è¨­å®šã—ãŸå‰²å¼•æƒ…å ±ãŒå•†å“èª¬æ˜ã«è‡ªå‹•ã§è¿½åŠ ã•ã‚Œã¾ã™
        </div>

        <!-- ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">
            ğŸ“Œ ã‚¿ã‚¤ãƒˆãƒ«
          </label>
          <select id="å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s; margin-bottom: 8px;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';" onchange="handleDiscountTitleChange()">
            <option value="ã€ãŠå¾—ãªå‰²å¼•æƒ…å ±ã€‘">ã€ãŠå¾—ãªå‰²å¼•æƒ…å ±ã€‘</option>
            <option value="ã€å‰²å¼•ã«ã¤ã„ã¦ã€‘">ã€å‰²å¼•ã«ã¤ã„ã¦ã€‘</option>
            <option value="ã€ãŠå€¤å¼•ãæƒ…å ±ã€‘">ã€ãŠå€¤å¼•ãæƒ…å ±ã€‘</option>
            <option value="ã€ç‰¹åˆ¥å‰²å¼•ã€‘">ã€ç‰¹åˆ¥å‰²å¼•ã€‘</option>
            <option value="ã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æƒ…å ±ã€‘">ã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æƒ…å ±ã€‘</option>
            <option value="">ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰</option>
            <option value="custom">âœï¸ ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
          </select>
          <input type="text" id="å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ " placeholder="ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; display: none; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#d1d5db';" oninput="updateDiscountPreview()">
        </div>

        <!-- å‰²å¼•ã‚¿ã‚¤ãƒ—ãƒªã‚¹ãƒˆï¼ˆå‹•çš„ã«ç”Ÿæˆï¼‰ -->
        <div id="discountTypesList">
          <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        </div>

        <!-- å‰²å¼•è¿½åŠ ãƒœã‚¿ãƒ³ -->
        <button type="button" onclick="addDiscountType()" style="width: 100%; margin-bottom: 16px; background: white; color: #10b981; border: 2px solid #10b981; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4';" onmouseout="this.style.background='white';">+ å‰²å¼•ã‚’è¿½åŠ </button>

        <!-- ã™ã¹ã¦ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
        <div style="text-align: center; margin-bottom: 16px;">
          <button type="button" onclick="clearAllDiscounts()" style="width: 100%; padding: 8px 16px; background: white; color: #ef4444; border: 2px solid #ef4444; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
            ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢
          </button>
        </div>

        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px;">
          <div style="font-size: 11px; color: #6b7280; margin-bottom: 8px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
          <div id="discountPreview" style="padding: 6px 10px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 11px; color: #1e40af; font-weight: 500; white-space: pre-line; line-height: 1.6;">
            ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆä¸­...
          </div>
        </div>
      </div>

      <!-- é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š -->
      <div class="tab-pane fade" id="shipping" role="tabpanel">
        <div class="section-title">ğŸ“¦ é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ ã“ã“ã§è¨­å®šã—ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå•†å“ç™»éŒ²æ™‚ã«è‡ªå‹•ã§é©ç”¨ã•ã‚Œã¾ã™
        </div>

        <!-- é…é€æ–™ã®è² æ‹… -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">
            ğŸ’° é…é€æ–™ã®è² æ‹…
          </label>
          <select id="é…é€æ–™ã®è² æ‹…" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            <option value="é€æ–™è¾¼ã¿(å‡ºå“è€…è² æ‹…)">é€æ–™è¾¼ã¿(å‡ºå“è€…è² æ‹…)</option>
            <option value="ç€æ‰•ã„(è³¼å…¥è€…è² æ‹…)">ç€æ‰•ã„(è³¼å…¥è€…è² æ‹…)</option>
          </select>
        </div>

        <!-- é…é€ã®æ–¹æ³• -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">
            ğŸ“® é…é€ã®æ–¹æ³•
          </label>
          <select id="é…é€ã®æ–¹æ³•" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            <option value="æœªå®š">æœªå®š</option>
            <option value="ã‚‰ãã‚‰ããƒ¡ãƒ«ã‚«ãƒªä¾¿">ã‚‰ãã‚‰ããƒ¡ãƒ«ã‚«ãƒªä¾¿</option>
            <option value="ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿">ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿</option>
            <option value="ã‚†ã†ãƒ¡ãƒ¼ãƒ«">ã‚†ã†ãƒ¡ãƒ¼ãƒ«</option>
            <option value="ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯">ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯</option>
            <option value="æ™®é€šéƒµä¾¿(å®šå½¢ã€å®šå½¢å¤–)">æ™®é€šéƒµä¾¿(å®šå½¢ã€å®šå½¢å¤–)</option>
            <option value="ã‚¯ãƒ­ãƒã‚³ãƒ¤ãƒãƒˆ">ã‚¯ãƒ­ãƒã‚³ãƒ¤ãƒãƒˆ</option>
            <option value="ã‚†ã†ãƒ‘ãƒƒã‚¯">ã‚†ã†ãƒ‘ãƒƒã‚¯</option>
            <option value="ã‚¯ãƒªãƒƒã‚¯ãƒã‚¹ãƒˆ">ã‚¯ãƒªãƒƒã‚¯ãƒã‚¹ãƒˆ</option>
            <option value="ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆ">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆ</option>
          </select>
        </div>

        <!-- ç™ºé€å…ƒã®åœ°åŸŸ -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">
            ğŸ“ ç™ºé€å…ƒã®åœ°åŸŸ
          </label>
          <select id="ç™ºé€å…ƒã®åœ°åŸŸ" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
            <option value="é’æ£®çœŒ">é’æ£®çœŒ</option>
            <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
            <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
            <option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option>
            <option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option>
            <option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option>
            <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
            <option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option>
            <option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option>
            <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
            <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
            <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
            <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
            <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
            <option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option>
            <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
            <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
            <option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option>
            <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
            <option value="å²é˜œçœŒ">å²é˜œçœŒ</option>
            <option value="é™å²¡çœŒ">é™å²¡çœŒ</option>
            <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
            <option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option>
            <option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option>
            <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
            <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
            <option value="å…µåº«çœŒ">å…µåº«çœŒ</option>
            <option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option>
            <option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option>
            <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
            <option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option>
            <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
            <option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option>
            <option value="å±±å£çœŒ">å±±å£çœŒ</option>
            <option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option>
            <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
            <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
            <option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option>
            <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
            <option value="ä½è³€çœŒ">ä½è³€çœŒ</option>
            <option value="é•·å´çœŒ">é•·å´çœŒ</option>
            <option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option>
            <option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option>
            <option value="å®®å´çœŒ">å®®å´çœŒ</option>
            <option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option>
            <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
          </select>
        </div>

        <!-- ç™ºé€ã¾ã§ã®æ—¥æ•° -->
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
          <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">
            â±ï¸ ç™ºé€ã¾ã§ã®æ—¥æ•°
          </label>
          <select id="ç™ºé€ã¾ã§ã®æ—¥æ•°" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            <option value="1~2æ—¥ã§ç™ºé€">1~2æ—¥ã§ç™ºé€</option>
            <option value="2~3æ—¥ã§ç™ºé€">2~3æ—¥ã§ç™ºé€</option>
            <option value="4~7æ—¥ã§ç™ºé€">4~7æ—¥ã§ç™ºé€</option>
          </select>
        </div>

        <!-- ã™ã¹ã¦ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
        <button type="button" onclick="clearShippingDefaults()" style="width: 100%; padding: 10px; background: white; border: 2px solid #ef4444; border-radius: 8px; color: #ef4444; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 16px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
          ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢
        </button>
      </div>

      <!-- ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š -->
      <div class="tab-pane fade" id="procure-listing" role="tabpanel">
        <div class="section-title">ğŸ’¼ ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ ã“ã“ã§è¨­å®šã—ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå•†å“ç™»éŒ²æ™‚ã«è‡ªå‹•ã§é©ç”¨ã•ã‚Œã¾ã™
        </div>

        <!-- ä»•å…¥æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div style="margin-bottom: 24px; padding: 16px; background: #fefce8; border-radius: 8px; border: 2px solid #fef08a;">
          <div style="font-size: 14px; font-weight: 600; color: #854d0e; margin-bottom: 16px;">
            ğŸ’° ä»•å…¥æƒ…å ±
          </div>

          <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥ -->
          <div style="margin-bottom: 16px;">
            <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">
              ğŸ“… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä»•å…¥æ—¥
            </label>
            <!-- å¸¸ã«ä»Šæ—¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-bottom: 8px;">
              <input type="checkbox" id="ä»•å…¥æ—¥_ä»Šæ—¥" onchange="toggleProcureDateField()" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="font-size: 13px; font-weight: 500; color: #374151;">
                å¸¸ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä½¿ç”¨
              </span>
            </label>
            <!-- æ—¥ä»˜å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
            <input type="date" id="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
              ç©ºæ¬„ã®å ´åˆã¯è‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã›ã‚“ã€‚ã¾ã¨ã‚ã¦ä»•å…¥ã‚ŒãŸæ—¥ä»˜ã‚’è¨­å®šã™ã‚‹ã¨ä¾¿åˆ©ã§ã™
            </div>
          </div>

          <!-- ä»•å…¥å…ˆ -->
          <div style="margin-bottom: 12px;">
            <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">
              ğŸª ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä»•å…¥å…ˆ
            </label>
            <select id="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
              <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            </select>
            <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
              ã‚ˆãä½¿ã†ä»•å…¥å…ˆã‚’é¸æŠï¼ˆç©ºæ¬„ã‚‚å¯ï¼‰
            </div>
          </div>
        </div>

        <!-- å‡ºå“æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div style="margin-bottom: 16px; padding: 16px; background: #eff6ff; border-radius: 8px; border: 2px solid #bfdbfe;">
          <div style="font-size: 14px; font-weight: 600; color: #1e40af; margin-bottom: 16px;">
            ğŸ“¤ å‡ºå“æƒ…å ±
          </div>

          <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥ -->
          <div style="margin-bottom: 16px;">
            <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">
              ğŸ“… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‡ºå“æ—¥ â˜…æ¨å¥¨
            </label>
            <!-- å¸¸ã«ä»Šæ—¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-bottom: 8px;">
              <input type="checkbox" id="å‡ºå“æ—¥_ä»Šæ—¥" onchange="toggleListingDateField()" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="font-size: 13px; font-weight: 500; color: #374151;">
                å¸¸ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä½¿ç”¨
              </span>
            </label>
            <!-- æ—¥ä»˜å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
            <input type="date" id="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
            <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
              ã€Œå¸¸ã«ä»Šæ—¥ã€ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨æ¯æ—¥è‡ªå‹•ã§ä»Šæ—¥ã®æ—¥ä»˜ãŒå…¥ã‚Šã¾ã™ã€‚å›ºå®šæ—¥ä»˜ã«ã™ã‚‹å ´åˆã¯ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¦ãã ã•ã„
            </div>
          </div>

          <!-- å‡ºå“å…ˆ -->
          <div style="margin-bottom: 12px;">
            <label style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">
              ğŸ›’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‡ºå“å…ˆ
            </label>
            <select id="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ" style="width: 100%; padding: 10px 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; transition: all 0.2s;" onfocus="this.style.borderColor='#3b82f6'; this.style.background='#f9fafb';" onblur="this.style.borderColor='#d1d5db'; this.style.background='white';">
              <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            </select>
            <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
              ã‚ˆãä½¿ã†å‡ºå“å…ˆã‚’é¸æŠï¼ˆç©ºæ¬„ã‚‚å¯ï¼‰
            </div>
          </div>
        </div>

        <!-- ã™ã¹ã¦ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
        <button type="button" onclick="clearProcureListingDefaults()" style="width: 100%; padding: 10px; background: white; border: 2px solid #ef4444; border-radius: 8px; color: #ef4444; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 16px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
          ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢
        </button>
      </div>

      <!-- ç®¡ç†ç•ªå·è¨­å®š -->
      <div class="tab-pane fade show active" id="management" role="tabpanel">
        <!-- å‹•çš„ãƒ–ãƒ­ãƒƒã‚¯ãƒ“ãƒ«ãƒ€ãƒ¼ -->
        <?!= include('management_number_builder'); ?>
      </div>

      <!-- ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ -->
      <div class="tab-pane fade" id="salesword" role="tabpanel">
        <div class="section-title">ğŸ’¬ ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š</div>

        <!-- ãƒ’ãƒ³ãƒˆ -->
        <div style="font-size: 11px; color: #6b7280; padding: 8px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #3b82f6; margin-bottom: 16px;">
          ğŸ’¡ å•†å“ç™»éŒ²æ™‚ã«é »ç¹ã«ä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™»éŒ²ã—ã¦ãŠãã¨ã€ã€Œã‚ˆãä½¿ã†ã€ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ç´ æ—©ãé¸æŠã§ãã¾ã™ã€‚
        </div>

        <!-- ç™»éŒ²æ¸ˆã¿ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ -->
        <div id="saleswordList" style="margin-bottom: 16px;">
          <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ç™»éŒ²æ¸ˆã¿ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ -->
        </div>

        <!-- 2æ®µå¼ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px;">â• ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div>
              <label style="font-size: 11px; margin-bottom: 4px; display: block; color: #6b7280;">ã‚«ãƒ†ã‚´ãƒª</label>
              <select id="saleswordCategorySelect" class="form-select form-select-sm" onchange="updateSaleswordOptions()">
                <option value="">--é¸æŠ--</option>
              </select>
            </div>
            <div>
              <label style="font-size: 11px; margin-bottom: 4px; display: block; color: #6b7280;">ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
              <select id="saleswordSelect" class="form-select form-select-sm" disabled>
                <option value="">--é¸æŠ--</option>
              </select>
            </div>
          </div>

          <button type="button" onclick="addSaleswordFromDropdown()" style="width: 100%; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
            + è¿½åŠ 
          </button>
        </div>

        <!-- ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºå½¢å¼è¨­å®š -->
        <div style="margin-top: 32px; padding-top: 24px; border-top: 2px solid #e9ecef;">
          <div class="section-title">ğŸ¨ ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºå½¢å¼</div>
          <div style="font-size: 13px; color: #6c757d; margin-bottom: 16px;">
            ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å‰å¾Œã«ä»˜ã‘ã‚‹æ–‡å­—ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚<br>
            ä¾‹ï¼šã€ç¾å“ã€‘ã€ã€åŒ¿åé…é€ã€ã€é€æ–™ç„¡æ–™â˜…ãªã©
          </div>

          <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š -->
          <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px;">ğŸ“Œ ã™ã¹ã¦ã®ãƒ¯ãƒ¼ãƒ‰ã«é©ç”¨</div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
              <div>
                <label style="font-size: 11px; margin-bottom: 4px; display: block;">å‰ã«ä»˜ã‘ã‚‹æ–‡å­—</label>
                <select id="saleswordPrefixGlobalSelect" class="form-select form-select-sm" onchange="handlePrefixChange()">
                  <option value="">ãªã—</option>
                  <option value="ã€">ã€</option>
                  <option value="ã€">ã€</option>
                  <option value="ã€Œ">ã€Œ</option>
                  <option value="(">ï¼ˆ</option>
                  <option value="â˜…">â˜…</option>
                  <option value="â˜†">â˜†</option>
                  <option value="â—†">â—†</option>
                  <option value="â—">â—</option>
                  <option value="â– ">â– </option>
                  <option value="â™¡">â™¡</option>
                  <option value="âœ¨">âœ¨</option>
                  <option value="â€»">â€»</option>
                  <option value="custom">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
                </select>
                <input type="text" id="saleswordPrefixGlobalCustom" class="form-control form-control-sm" placeholder="è‡ªç”±ã«å…¥åŠ›" maxlength="5" style="margin-top: 4px; display: none;" oninput="updateSaleswordFormatPreview()">
              </div>
              <div>
                <label style="font-size: 11px; margin-bottom: 4px; display: block;">å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—</label>
                <select id="saleswordSuffixGlobalSelect" class="form-select form-select-sm" onchange="handleSuffixChange()">
                  <option value="">ãªã—</option>
                  <option value="ã€‘">ã€‘</option>
                  <option value="ã€">ã€</option>
                  <option value="ã€">ã€</option>
                  <option value=")">ï¼‰</option>
                  <option value="!">ï¼</option>
                  <option value="â˜…">â˜…</option>
                  <option value="â˜†">â˜†</option>
                  <option value="â—†">â—†</option>
                  <option value="â—">â—</option>
                  <option value="â– ">â– </option>
                  <option value="â™¡">â™¡</option>
                  <option value="âœ¨">âœ¨</option>
                  <option value="â€»">â€»</option>
                  <option value="custom">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
                </select>
                <input type="text" id="saleswordSuffixGlobalCustom" class="form-control form-control-sm" placeholder="è‡ªç”±ã«å…¥åŠ›" maxlength="5" style="margin-top: 4px; display: none;" oninput="updateSaleswordFormatPreview()">
              </div>
            </div>

            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div style="background: white; padding: 8px 12px; border-radius: 4px; border: 1px solid #dee2e6;">
              <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</div>
              <div id="saleswordFormatPreview" style="font-size: 14px; color: #212529; font-weight: 500;">ã€ç¾å“ã€‘</div>
            </div>
          </div>

          <!-- ãƒ¯ãƒ¼ãƒ‰ã”ã¨ã«å€‹åˆ¥è¨­å®š -->
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #dee2e6;">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px;">
              ğŸ·ï¸ ãƒ¯ãƒ¼ãƒ‰ã”ã¨ã«å€‹åˆ¥è¨­å®š
            </div>

            <div style="font-size: 12px; color: #6c757d; margin-bottom: 12px;">
              ç‰¹å®šã®ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã ã‘ç•°ãªã‚‹å½¢å¼ã‚’ä½¿ã„ãŸã„å ´åˆã«è¨­å®šã—ã¾ã™ã€‚<br>
              ä¾‹ï¼šã€ŒåŒ¿åé…é€ã€ã ã‘â˜…ã§å›²ã‚€ã€ã€Œé€æ–™ç„¡æ–™ã€ã ã‘ã€ã€ã§å›²ã‚€ãªã©
            </div>

            <div id="wordOverrideList" style="margin-bottom: 12px;">
              <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®š -->
            </div>

            <button type="button" onclick="addWordOverride()" style="width: 100%; padding: 10px; background: white; border: 2px dashed #3b82f6; border-radius: 8px; color: #3b82f6; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 8px; transition: all 0.2s;" onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
              + ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’è¿½åŠ 
            </button>

            <button type="button" onclick="clearAllSaleswordSettings()" style="width: 100%; padding: 10px; background: white; border: 2px solid #ef4444; border-radius: 8px; color: #ef4444; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 16px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
              ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢
            </button>
          </div>
        </div>
      </div>


    </div>

    <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
    <div class="save-btn" style="display: flex; justify-content: center;">
      <button type="button" onclick="saveConfig()" style="background: #10b981; color: white; border: none; padding: 12px 48px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
        âœ“ è¨­å®šã‚’ä¿å­˜
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      loadSaleswordMasterData();

      // ä»•å…¥ãƒ»å‡ºå“ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
      initProcureListingDropdowns();
    });

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let currentConfig = null;
    const CONDITION_STATES = [
      'æ–°å“ã€æœªä½¿ç”¨',
      'æœªä½¿ç”¨ã«è¿‘ã„',
      'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—',
      'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š',
      'å‚·ã‚„æ±šã‚Œã‚ã‚Š',
      'å…¨ä½“çš„ã«çŠ¶æ…‹ãŒæ‚ªã„'
    ];

    // å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ
    const CONDITION_BUTTON_PRESETS = {
      'æ–°å“ã€æœªä½¿ç”¨': [
        { label: 'ã‚¿ã‚°ä»˜ãæœªä½¿ç”¨', text: 'ã‚¿ã‚°ä»˜ãæœªä½¿ç”¨å“ã§ã™ã€‚' },
        { label: 'æ–°å“æœªé–‹å°', text: 'æ–°å“æœªé–‹å°ã§ã™ã€‚' },
        { label: 'è©¦ç€ã®ã¿', text: 'è©¦ç€ã®ã¿ã®æœªä½¿ç”¨å“ã§ã™ã€‚' }
      ],
      'æœªä½¿ç”¨ã«è¿‘ã„': [
        { label: 'æ•°å›ç€ç”¨', text: 'æ•°å›ã®ã¿ç€ç”¨ã®ç¾å“ã§ã™ã€‚' },
        { label: 'ã»ã¼æœªä½¿ç”¨', text: 'ã»ã¼æœªä½¿ç”¨ã«è¿‘ã„çŠ¶æ…‹ã§ã™ã€‚' },
        { label: 'å®¤å†…è©¦ç€ã®ã¿', text: 'å®¤å†…ã§è©¦ç€ã—ãŸã®ã¿ã§ã™ã€‚' }
      ],
      'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—': [
        { label: 'ç¾å“', text: 'ã»ã¨ã‚“ã©ä½¿ç”¨æ„ŸãŒãªãã€ã¨ã¦ã‚‚ç¶ºéº—ãªçŠ¶æ…‹ã§ã™ã€‚' },
        { label: 'ä¿ç®¡æ™‚ã®ã‚·ãƒ¯', text: 'ä¿ç®¡æ™‚ã®å°ã•ãªã‚·ãƒ¯ãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' },
        { label: 'ç€ç”¨æ„Ÿå°‘ãªã„', text: 'ç€ç”¨æ„ŸãŒå°‘ãªãã€ã¾ã ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' }
      ],
      'ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š': [
        { label: 'ä½¿ç”¨æ„Ÿã‚ã‚Š', text: 'è‹¥å¹²ã®ä½¿ç”¨æ„ŸãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' },
        { label: 'å°ã•ãªæ±šã‚Œ', text: 'ç›®ç«‹ãŸãªã„ç¨‹åº¦ã®å°ã•ãªæ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚' },
        { label: 'æ¯›ç‰ã‚ã‚Š', text: 'è‹¥å¹²ã®æ¯›ç‰ãŒã”ã–ã„ã¾ã™ãŒã€ã¾ã ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' },
        { label: 'è‰²è¤ªã›ã‚ã‚Š', text: 'è‹¥å¹²ã®è‰²è¤ªã›ãŒã‚ã‚Šã¾ã™ãŒã€ç€ç”¨ã«ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚' }
      ],
      'å‚·ã‚„æ±šã‚Œã‚ã‚Š': [
        { label: 'ä½¿ç”¨æ„Ÿå¼·ã„', text: 'ä½¿ç”¨æ„ŸãŒå¼·ã‚ã§ã™ãŒã€ã¾ã ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ã€‚' },
        { label: 'æ±šã‚Œã‚ã‚Š', text: 'æ±šã‚ŒãŒã”ã–ã„ã¾ã™ã€‚å†™çœŸã§ã”ç¢ºèªãã ã•ã„ã€‚' },
        { label: 'å‚·ã‚ã‚Š', text: 'å‚·ãŒã”ã–ã„ã¾ã™ã€‚å†™çœŸã§ã”ç¢ºèªãã ã•ã„ã€‚' }
      ],
      'å…¨ä½“çš„ã«çŠ¶æ…‹ãŒæ‚ªã„': [
        { label: 'å…¨ä½“çš„ã«å‚·ã‚ã‚Š', text: 'å…¨ä½“çš„ã«å‚·ã‚„æ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ã®ä¸Šã”è³¼å…¥ãã ã•ã„ã€‚' },
        { label: 'ç›®ç«‹ã¤æ±šã‚Œ', text: 'ç›®ç«‹ã¤æ±šã‚ŒãŒã‚ã‚Šã¾ã™ã€‚å†™çœŸã‚’ã‚ˆãã”ç¢ºèªãã ã•ã„ã€‚' }
      ]
    };

    // åˆæœŸåŒ–
    window.onload = function() {
      loadAllConfig();
    };

    /**
     * å…¨è¨­å®šã‚’èª­ã¿è¾¼ã¿
     */
    function loadAllConfig() {
      if (google && google.script && google.script.run) {
        google.script.run
          .withSuccessHandler(function(config) {
            if (config) {
              currentConfig = config;
              renderAllConfig(config);
            }
          })
          .withFailureHandler(function(error) {
            alert('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error);
          })
          .loadConfigMaster();
      }
    }

    /**
     * å…¨è¨­å®šã‚’ç”»é¢ã«åæ˜ 
     */
    function renderAllConfig(config) {
      renderConditionButtons(config.å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ || []);
      renderHashtagConfig(config.ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° || {});
      renderDiscountConfig(config.å‰²å¼•æƒ…å ± || {});
      renderShippingDefaults(config.é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ || {});
      renderProcureListingDefaults(config.ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ || {});
      renderManagementConfig(config.ç®¡ç†ç•ªå·è¨­å®š || {});

      // ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
      if (config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰) {
        // æ–°ã—ã„æ§‹é€ ï¼ˆã‚ˆãä½¿ã† + è¡¨ç¤ºå½¢å¼ï¼‰ã«å¯¾å¿œ
        if (typeof config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ === 'object' && config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.ã‚ˆãä½¿ã†) {
          SALESWORD_LIST = config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.ã‚ˆãä½¿ã† || [];
          renderSaleswordList();
          renderSaleswordFormat(config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.è¡¨ç¤ºå½¢å¼ || {});
        } else {
          // æ—§å½¢å¼ï¼ˆé…åˆ—ã®ã¿ï¼‰ã«å¯¾å¿œ
          SALESWORD_LIST = config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰;
          renderSaleswordList();
          renderSaleswordFormat({ globalPrefix: 'ã€', globalSuffix: 'ã€‘', categoryOverrides: [] });
        }
      }
    }

    /**
     * å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³è¨­å®šã‚’è¡¨ç¤º
     */
    function renderConditionButtons(buttons) {
      const container = document.getElementById('conditionButtonsContainer');
      container.innerHTML = '';

      CONDITION_STATES.forEach((state, stateIndex) => {
        const stateButtons = buttons.filter(b => b.å•†å“ã®çŠ¶æ…‹ === state);

        const groupDiv = document.createElement('div');
        groupDiv.style.cssText = 'background: white; margin-bottom: 12px; border-radius: 8px; border: 1px solid #e5e7eb; overflow: hidden;';

        // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰
        const headerDiv = document.createElement('div');
        headerDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; background: #f9fafb; transition: background 0.2s;';
        headerDiv.onclick = () => toggleAccordion(stateIndex);
        headerDiv.onmouseover = () => headerDiv.style.background = '#f3f4f6';
        headerDiv.onmouseout = () => headerDiv.style.background = '#f9fafb';

        headerDiv.innerHTML = `
          <strong style="font-size: 14px; color: #1f2937;">${state}</strong>
          <span id="accordion-icon-${stateIndex}" style="font-size: 18px; color: #6b7280; transition: transform 0.3s;">â–¼</span>
        `;
        groupDiv.appendChild(headerDiv);

        // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰
        const contentDiv = document.createElement('div');
        contentDiv.id = `accordion-content-${stateIndex}`;
        contentDiv.style.cssText = 'display: none; padding: 12px; border-top: 1px solid #e5e7eb;';

        const buttonsContainer = document.createElement('div');
        buttonsContainer.id = `condition-${state}`;

        stateButtons.forEach((btn, idx) => {
          buttonsContainer.appendChild(createButtonConfigItem(state, idx, btn.ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«, btn.ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ));
        });

        contentDiv.appendChild(buttonsContainer);

        const addBtn = document.createElement('button');
        addBtn.type = 'button';
        addBtn.className = 'add-btn';
        addBtn.style.cssText = 'width: 100%; margin-top: 8px;';
        addBtn.textContent = '+ ãƒœã‚¿ãƒ³è¿½åŠ ';
        addBtn.onclick = () => addConditionButton(state);
        contentDiv.appendChild(addBtn);

        groupDiv.appendChild(contentDiv);
        container.appendChild(groupDiv);
      });
    }

    /**
     * ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‹é–‰
     */
    function toggleAccordion(index) {
      const content = document.getElementById(`accordion-content-${index}`);
      const icon = document.getElementById(`accordion-icon-${index}`);

      if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';

        // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ã„ãŸæ™‚ã«å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´
        setTimeout(() => {
          const textareas = content.querySelectorAll('textarea.auto-resize');
          textareas.forEach(textarea => {
            if (textarea.value) {
              autoResizeTextarea(textarea);
            }
          });
        }, 0);
      } else {
        content.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
      }
    }

    /**
     * ãƒœã‚¿ãƒ³è¨­å®šé …ç›®ã‚’ä½œæˆ
     */
    function createButtonConfigItem(state, index, label, text) {
      const div = document.createElement('div');
      div.className = 'condition-button-item';
      div.style.cssText = 'background: #f9fafb; padding: 10px; margin-bottom: 8px; border-radius: 4px; border: 1px solid #dee2e6;';

      // ãƒ—ãƒªã‚»ãƒƒãƒˆå–å¾—
      const presets = CONDITION_BUTTON_PRESETS[state] || [];

      // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
      let selectOptions = '<option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>';
      presets.forEach(preset => {
        const selected = label === preset.label ? 'selected' : '';
        selectOptions += `<option value="${preset.label}" ${selected}>${preset.label}</option>`;
      });
      selectOptions += '<option value="custom">âœï¸ ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>';

      // ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‹ã©ã†ã‹ã‚’åˆ¤å®š
      const isCustom = label && !presets.find(p => p.label === label);
      const selectedValue = isCustom ? 'custom' : (label || '');

      div.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong style="font-size: 13px;">ãƒœã‚¿ãƒ³ ${index + 1}</strong>
          <button type="button" class="btn btn-sm btn-outline-danger remove-btn" onclick="removeConditionButton('${state}', ${index})">å‰Šé™¤</button>
        </div>
        <div class="mb-2">
          <label style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«</label>
          <select class="form-control label-preset-select" data-state="${state}" data-index="${index}" data-field="label-select" onchange="handleLabelPresetChange(this, '${state}', ${index})" style="font-size: 13px; margin-bottom: 4px; appearance: auto; -webkit-appearance: menulist; -moz-appearance: menulist; background-color: white; border: 1px solid #d1d5db; padding: 6px 12px; border-radius: 6px; cursor: pointer;">
            ${selectOptions}
          </select>
          <input type="text" class="form-control label-custom-input" data-state="${state}" data-index="${index}" data-field="label" value="${label || ''}" placeholder="ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’å…¥åŠ›" style="font-size: 13px; display: none;">
        </div>
        <div>
          <label style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 4px; display: block;">ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</label>
          <textarea class="form-control auto-resize" rows="2" data-state="${state}" data-index="${index}" data-field="text" placeholder="ã‚¯ãƒªãƒƒã‚¯æ™‚ã«æŒ¿å…¥ã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›" style="font-size: 13px; resize: none; overflow: hidden;" oninput="autoResizeTextarea(this)">${text}</textarea>
        </div>
      `;

      // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®å€¤ã‚’è¨­å®š
      setTimeout(() => {
        const select = div.querySelector('[data-field="label-select"]');
        const customInput = div.querySelector('[data-field="label"]');

        if (select) {
          select.value = selectedValue;

          // ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›æ¬„ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
          if (selectedValue === 'custom') {
            customInput.style.display = 'block';
          } else {
            customInput.style.display = 'none';
          }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®åˆæœŸã‚µã‚¤ã‚ºèª¿æ•´
        const textarea = div.querySelector('textarea');
        if (textarea && textarea.value) {
          autoResizeTextarea(textarea);
        }
      }, 0);

      return div;
    }

    /**
     * ãƒ©ãƒ™ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆå¤‰æ›´æ™‚ã®å‡¦ç†
     */
    function handleLabelPresetChange(selectElement, state, index) {
      const selectedValue = selectElement.value;

      // dataå±æ€§ã‚’ä½¿ã£ã¦åŒã˜state/indexã®è¦ç´ ã‚’ç›´æ¥å–å¾—
      const containerId = `condition-${state}`;
      const container = document.getElementById(containerId);
      const items = container.querySelectorAll('.condition-button-item');
      const targetItem = items[index];

      if (!targetItem) {
        console.error('ãƒœã‚¿ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', { state, index });
        return;
      }

      const labelInput = targetItem.querySelector('[data-field="label"]');
      const textArea = targetItem.querySelector('[data-field="text"]');

      console.log('handleLabelPresetChange:', { selectedValue, state, index, targetItem });

      if (selectedValue === 'custom') {
        // ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’è¡¨ç¤º
        labelInput.style.display = 'block';
        labelInput.value = '';
        textArea.value = '';
        labelInput.focus();
        setTimeout(() => autoResizeTextarea(textArea), 0);
      } else if (selectedValue === '') {
        // æœªé¸æŠ
        labelInput.style.display = 'none';
        labelInput.value = '';
        textArea.value = '';
        setTimeout(() => autoResizeTextarea(textArea), 0);
      } else {
        // ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ
        labelInput.style.display = 'none';
        const presets = CONDITION_BUTTON_PRESETS[state] || [];
        const preset = presets.find(p => p.label === selectedValue);
        console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆæ¤œç´¢çµæœ:', preset);
        if (preset) {
          labelInput.value = preset.label;
          textArea.value = preset.text;
          console.log('ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è¨­å®š:', preset.text);
          setTimeout(() => autoResizeTextarea(textArea), 0);
        } else {
          console.warn('ãƒ—ãƒªã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', selectedValue, state);
        }
      }
    }

    /**
     * å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
     */
    function addConditionButton(state) {
      const container = document.getElementById(`condition-${state}`);
      const index = container.children.length;
      container.appendChild(createButtonConfigItem(state, index, '', ''));
    }

    /**
     * å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
     */
    function removeConditionButton(state, index) {
      const container = document.getElementById(`condition-${state}`);
      if (container.children.length > 1) {
        container.children[index].remove();
        // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†è¨ˆç®—
        Array.from(container.children).forEach((child, newIndex) => {
          const inputs = child.querySelectorAll('[data-index]');
          inputs.forEach(input => input.setAttribute('data-index', newIndex));
          child.querySelector('strong').textContent = `ãƒœã‚¿ãƒ³ ${newIndex + 1}`;
          child.querySelector('.remove-btn').onclick = () => removeConditionButton(state, newIndex);
        });
      } else {
        alert('æœ€ä½1ã¤ã®ãƒœã‚¿ãƒ³ã¯å¿…è¦ã§ã™');
      }
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¨­å®šã‚’è¡¨ç¤º
     */
    function renderHashtagConfig(config) {
      const container = document.getElementById('hashtagItemsContainer');
      container.innerHTML = '';

      // å…±é€šãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¨­å®š
      const removeHash = (value) => {
        if (!value) return '';
        return value.startsWith('#') ? value.substring(1) : value;
      };

      let commonPrefix = '';
      let hashtags = [];

      if (config.hashtags && Array.isArray(config.hashtags)) {
        // æ–°å½¢å¼: å‹•çš„é…åˆ—
        commonPrefix = removeHash(config.commonPrefix || 'REBORN_');
        hashtags = config.hashtags;
      } else if (config.å…¨å•†å“ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ã‚«ãƒ†ã‚´ãƒªãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹) {
        // æ—§å½¢å¼: å›ºå®š3é …ç›®ã‹ã‚‰å¤‰æ›ï¼ˆæœ€åˆã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å…±é€šã¨ã—ã¦ä½¿ç”¨ï¼‰
        commonPrefix = removeHash(config.å…¨å•†å“ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ã‚«ãƒ†ã‚´ãƒªãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || 'REBORN_');

        if (config.å…¨å•†å“ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ) {
          hashtags.push({
            title: 'å…¨å•†å“',
            icon: 'ğŸŒ',
            suffix: config.å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ || 'å…¨å•†å“',
            suffixOptions: ['å…¨å•†å“', 'å…¨ã‚¢ã‚¤ãƒ†ãƒ ', 'å•†å“ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§']
          });
        }
        if (config.ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ãƒ–ãƒ©ãƒ³ãƒ‰ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹) {
          hashtags.push({
            title: 'ãƒ–ãƒ©ãƒ³ãƒ‰',
            icon: 'ğŸ‘”',
            suffix: config.ãƒ–ãƒ©ãƒ³ãƒ‰ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ || 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§',
            suffixOptions: ['ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³', 'ãƒ–ãƒ©ãƒ³ãƒ‰å•†å“']
          });
        }
        if (config.ã‚«ãƒ†ã‚´ãƒªãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ || config.ã‚«ãƒ†ã‚´ãƒªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹) {
          hashtags.push({
            title: 'ã‚«ãƒ†ã‚´ãƒª',
            icon: 'ğŸ“‚',
            suffix: config.ã‚«ãƒ†ã‚´ãƒªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ || 'ä¸€è¦§',
            suffixOptions: ['ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³']
          });
        }
      }

      // å…±é€šãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¨­å®š
      document.getElementById('commonHashtagPrefix').value = commonPrefix;

      // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      hashtags.forEach((item, index) => {
        container.appendChild(createHashtagItem(index, item));
      });

      // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      setupHashtagDragAndDrop();
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
     */
    function setupHashtagDragAndDrop() {
      const container = document.getElementById('hashtagItemsContainer');
      let draggedElement = null;
      let draggedIndex = null;

      container.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('hashtag-item')) {
          draggedElement = e.target;
          draggedIndex = parseInt(e.target.getAttribute('data-index'));
          e.target.style.opacity = '0.5';
        }
      });

      container.addEventListener('dragend', (e) => {
        if (e.target.classList.contains('hashtag-item')) {
          e.target.style.opacity = '1';
        }
      });

      container.addEventListener('dragover', (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(container, e.clientY);

        if (afterElement == null) {
          container.appendChild(draggedElement);
        } else {
          container.insertBefore(draggedElement, afterElement);
        }
      });

      container.addEventListener('drop', (e) => {
        e.preventDefault();
        reindexHashtagItems();
      });
    }

    /**
     * ãƒ‰ãƒ©ãƒƒã‚°ä½ç½®ã‚’è¨ˆç®—
     */
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.hashtag-item:not([style*="opacity: 0.5"])')];

      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;

        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã‚’ä½œæˆ
     */
    function createHashtagItem(index, data = {}) {
      const title = data.title || '';
      const icon = data.icon || 'ğŸ·ï¸';
      const suffix = data.suffix || '';
      const suffixOptions = data.suffixOptions || ['å…¨å•†å“', 'å…¨ã‚¢ã‚¤ãƒ†ãƒ ', 'å•†å“ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§'];

      const div = document.createElement('div');
      div.className = 'hashtag-item';
      div.setAttribute('data-index', index);
      div.setAttribute('draggable', 'true');
      div.style.cssText = 'margin-bottom: 12px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e5e7eb; cursor: move; transition: all 0.2s;';

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ä¸­é–“éƒ¨åˆ†ã‚’æ±ºå®šï¼ˆå…·ä½“ä¾‹ã‚’è¡¨ç¤ºï¼‰
      let previewMiddle = '';
      if (title === 'ãƒ–ãƒ©ãƒ³ãƒ‰') {
        previewMiddle = 'UNIQLO';
      } else if (title === 'ã‚«ãƒ†ã‚´ãƒª') {
        // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã®å…·ä½“ä¾‹ã‚’è¡¨ç¤º
        const categoryOptions = data.categoryOptions || ['å¤§åˆ†é¡', 'ä¸­åˆ†é¡'];
        const exampleMap = {
          'å¤§åˆ†é¡': 'ãƒ¡ãƒ³ã‚º',
          'ä¸­åˆ†é¡': 'ãƒˆãƒƒãƒ—ã‚¹',
          'å°åˆ†é¡': 'ã‚·ãƒ£ãƒ„',
          'ç´°åˆ†é¡1': 'åŠè¢–ã‚·ãƒ£ãƒ„',
          'ç´°åˆ†é¡2': 'ã‚¢ãƒ­ãƒã‚·ãƒ£ãƒ„ãƒ»ã‹ã‚Šã‚†ã—ã‚¦ã‚§ã‚¢',
          'ã‚¢ã‚¤ãƒ†ãƒ å': 'ã‚¢ãƒ­ãƒã‚·ãƒ£ãƒ„'
        };
        const examples = categoryOptions.map(opt => exampleMap[opt] || opt);
        previewMiddle = examples.join('');
      } else if (title === 'ã‚«ãƒ©ãƒ¼') {
        previewMiddle = 'é»’';
      } else if (title === 'ã‚µã‚¤ã‚º') {
        previewMiddle = 'M';
      }

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
      const commonPrefix = document.getElementById('commonHashtagPrefix')?.value || 'REBORN_';
      const previewText = `#${commonPrefix}${previewMiddle}${suffixOptions.includes(suffix) ? suffix : (!suffixOptions.includes(suffix) && suffix ? suffix : '')}`;

      // ã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®å ´åˆã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
      const isCategoryHashtag = title === 'ã‚«ãƒ†ã‚´ãƒª';
      const categoryOptions = data.categoryOptions || ['å¤§åˆ†é¡', 'ä¸­åˆ†é¡'];

      const categoryCheckboxesHtml = isCategoryHashtag ? `
        <div style="margin-bottom: 8px; padding: 8px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
          <div style="font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">é€£çµã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰:</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 11px;">
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="å¤§åˆ†é¡" ${categoryOptions.includes('å¤§åˆ†é¡') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>å¤§åˆ†é¡</span>
            </label>
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="ä¸­åˆ†é¡" ${categoryOptions.includes('ä¸­åˆ†é¡') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>ä¸­åˆ†é¡</span>
            </label>
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="å°åˆ†é¡" ${categoryOptions.includes('å°åˆ†é¡') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>å°åˆ†é¡</span>
            </label>
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="ç´°åˆ†é¡1" ${categoryOptions.includes('ç´°åˆ†é¡1') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>ç´°åˆ†é¡1</span>
            </label>
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="ç´°åˆ†é¡2" ${categoryOptions.includes('ç´°åˆ†é¡2') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>ç´°åˆ†é¡2</span>
            </label>
            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" class="category-option" data-option="ã‚¢ã‚¤ãƒ†ãƒ å" ${categoryOptions.includes('ã‚¢ã‚¤ãƒ†ãƒ å') ? 'checked' : ''} onchange="updateHashtagItemPreview(${index})" style="cursor: pointer;">
              <span>ã‚¢ã‚¤ãƒ†ãƒ å</span>
            </label>
          </div>
        </div>
      ` : '';

      div.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <span class="hashtag-drag-handle" style="font-size: 16px; color: #9ca3af; cursor: grab; user-select: none; flex-shrink: 0;" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â‹®â‹®</span>
          <span class="hashtag-icon-display" style="font-size: 18px; user-select: none; flex-shrink: 0;">${icon}</span>
          <input type="hidden" class="hashtag-icon" value="${icon}">
          <input type="hidden" class="hashtag-title" value="${title}">
          <div style="flex: 1; font-size: 14px; font-weight: 600; color: #374151;">${title}</div>
        </div>

        ${categoryCheckboxesHtml}

        <div style="margin-bottom: 8px;">
          <select class="hashtag-suffix-select" style="width: 100%; padding: 6px 8px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 12px; transition: all 0.2s; background: white; cursor: pointer;" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#d1d5db';" onchange="handleHashtagItemSuffixChange(${index})">
            ${suffixOptions.map(opt => `<option value="${opt}"${opt === suffix ? ' selected' : ''}>${opt}</option>`).join('')}
            <option value="custom"${!suffixOptions.includes(suffix) && suffix ? ' selected' : ''}>ã‚«ã‚¹ã‚¿ãƒ ...</option>
          </select>
          <input type="text" class="hashtag-suffix-custom" value="${!suffixOptions.includes(suffix) && suffix ? suffix : ''}" placeholder="ã‚«ã‚¹ã‚¿ãƒ å€¤ã‚’å…¥åŠ›" style="width: 100%; padding: 6px 8px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 12px; transition: all 0.2s; margin-top: 6px; display: ${!suffixOptions.includes(suffix) && suffix ? 'block' : 'none'};" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#d1d5db';" oninput="updateHashtagItemPreview(${index})">
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
          <div style="flex: 1;">
            <div style="font-size: 10px; color: #6b7280; margin-bottom: 2px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</div>
            <div class="hashtag-preview" style="padding: 6px 10px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 11px; color: #1e40af; font-weight: 500;">
              ${previewText}
            </div>
          </div>
          <button type="button" onclick="removeHashtagItem(${index})" style="padding: 4px 8px; background: white; border: 1px solid #ef4444; color: #ef4444; border-radius: 4px; font-size: 10px; cursor: pointer; transition: all 0.2s; white-space: nowrap; flex-shrink: 0;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">
            å‰Šé™¤
          </button>
        </div>
      `;

      return div;
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚¿ã‚¤ãƒ—é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
     */
    function showHashtagTypeSelector() {
      const menu = document.getElementById('hashtagTypeSelectorMenu');
      menu.style.display = 'block';
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚¿ã‚¤ãƒ—é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’éè¡¨ç¤º
     */
    function hideHashtagTypeSelector() {
      const menu = document.getElementById('hashtagTypeSelectorMenu');
      menu.style.display = 'none';
    }

    /**
     * ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã—ã¦ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã‚’è¿½åŠ 
     */
    function addHashtagItemByType(type) {
      const container = document.getElementById('hashtagItemsContainer');
      const index = container.children.length;

      let newItem = {};

      if (type === 'å…¨å•†å“') {
        newItem = {
          title: 'å…¨å•†å“',
          icon: 'ğŸŒ',
          suffix: 'å…¨å•†å“',
          suffixOptions: ['å…¨å•†å“', 'å…¨ã‚¢ã‚¤ãƒ†ãƒ ', 'å•†å“ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§']
        };
      } else if (type === 'ãƒ–ãƒ©ãƒ³ãƒ‰') {
        newItem = {
          title: 'ãƒ–ãƒ©ãƒ³ãƒ‰',
          icon: 'ğŸ‘”',
          suffix: 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§',
          suffixOptions: ['ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'å…¨å•†å“', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³']
        };
      } else if (type === 'ã‚«ãƒ†ã‚´ãƒª') {
        newItem = {
          title: 'ã‚«ãƒ†ã‚´ãƒª',
          icon: 'ğŸ“',
          suffix: 'ä¸€è¦§',
          suffixOptions: ['ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³'],
          categoryOptions: ['å¤§åˆ†é¡']
        };
      } else if (type === 'ã‚«ãƒ©ãƒ¼') {
        newItem = {
          title: 'ã‚«ãƒ©ãƒ¼',
          icon: 'ğŸ¨',
          suffix: 'ä¸€è¦§',
          suffixOptions: ['ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³']
        };
      } else if (type === 'ã‚µã‚¤ã‚º') {
        newItem = {
          title: 'ã‚µã‚¤ã‚º',
          icon: 'ğŸ“',
          suffix: 'ä¸€è¦§',
          suffixOptions: ['ä¸€è¦§', 'ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§', 'å•†å“ä¸€è¦§', 'ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³']
        };
      }

      container.appendChild(createHashtagItem(index, newItem));
      hideHashtagTypeSelector();
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã‚’è¿½åŠ ï¼ˆæ—§é–¢æ•°ãƒ»äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
     */
    function addHashtagItem() {
      showHashtagTypeSelector();
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã‚’å‰Šé™¤
     */
    function removeHashtagItem(index) {
      const container = document.getElementById('hashtagItemsContainer');

      // é …ç›®ã‚’å‰Šé™¤
      if (container.children[index]) {
        container.children[index].remove();
      }

      // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†å‰²ã‚Šå½“ã¦
      Array.from(container.children).forEach((item, newIndex) => {
        item.setAttribute('data-index', newIndex);

        // å„ãƒœã‚¿ãƒ³ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
        const deleteBtn = item.querySelector('button[onclick*="removeHashtagItem"]');
        if (deleteBtn) {
          deleteBtn.setAttribute('onclick', `removeHashtagItem(${newIndex})`);
        }

        const suffixSelect = item.querySelector('.hashtag-suffix-select');
        if (suffixSelect) {
          suffixSelect.setAttribute('onchange', `handleHashtagItemSuffixChange(${newIndex})`);
        }

        const suffixCustom = item.querySelector('.hashtag-suffix-custom');
        if (suffixCustom) {
          suffixCustom.setAttribute('oninput', `updateHashtagItemPreview(${newIndex})`);
        }
      });
    }

    /**
     * ã™ã¹ã¦ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢
     */
    function clearAllHashtags() {
      if (!confirm('ã™ã¹ã¦ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        return;
      }

      const container = document.getElementById('hashtagItemsContainer');
      container.innerHTML = '';

      alert('ã™ã¹ã¦ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚\nå¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†å‰²ã‚Šå½“ã¦
     */
    function reindexHashtagItems() {
      const container = document.getElementById('hashtagItemsContainer');
      Array.from(container.children).forEach((item, newIndex) => {
        item.setAttribute('data-index', newIndex);

        const deleteBtn = item.querySelector('button[onclick*="removeHashtagItem"]');
        if (deleteBtn) {
          deleteBtn.setAttribute('onclick', `removeHashtagItem(${newIndex})`);
        }

        const suffixSelect = item.querySelector('.hashtag-suffix-select');
        if (suffixSelect) {
          suffixSelect.setAttribute('onchange', `handleHashtagItemSuffixChange(${newIndex})`);
        }

        const suffixCustom = item.querySelector('.hashtag-suffix-custom');
        if (suffixCustom) {
          suffixCustom.setAttribute('oninput', `updateHashtagItemPreview(${newIndex})`);
        }

        const categoryOptions = item.querySelectorAll('.category-option');
        categoryOptions.forEach(checkbox => {
          checkbox.setAttribute('onchange', `updateHashtagItemPreview(${newIndex})`);
        });
      });
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
     */
    function updateHashtagItemPreview(index) {
      const container = document.getElementById('hashtagItemsContainer');
      const item = container.children[index];
      if (!item) return;

      const commonPrefix = document.getElementById('commonHashtagPrefix').value || '';
      const titleInput = item.querySelector('.hashtag-title');
      const title = titleInput ? titleInput.value || '' : '';
      const suffixSelect = item.querySelector('.hashtag-suffix-select');
      const suffixCustom = item.querySelector('.hashtag-suffix-custom');

      let suffix = '';
      if (suffixSelect.value === 'custom') {
        suffix = suffixCustom.value || '';
      } else {
        suffix = suffixSelect.value || '';
      }

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ä¸­é–“éƒ¨åˆ†ã‚’æ±ºå®šï¼ˆå…·ä½“ä¾‹ã‚’è¡¨ç¤ºï¼‰
      let previewMiddle = '';
      if (title === 'ãƒ–ãƒ©ãƒ³ãƒ‰') {
        previewMiddle = 'UNIQLO';
      } else if (title === 'ã‚«ãƒ†ã‚´ãƒª') {
        // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å…·ä½“ä¾‹ã‚’è¡¨ç¤º
        const categoryCheckboxes = item.querySelectorAll('.category-option:checked');
        const selectedCategories = Array.from(categoryCheckboxes).map(cb => cb.getAttribute('data-option'));
        const exampleMap = {
          'å¤§åˆ†é¡': 'ãƒ¡ãƒ³ã‚º',
          'ä¸­åˆ†é¡': 'ãƒˆãƒƒãƒ—ã‚¹',
          'å°åˆ†é¡': 'ã‚·ãƒ£ãƒ„',
          'ç´°åˆ†é¡1': 'åŠè¢–ã‚·ãƒ£ãƒ„',
          'ç´°åˆ†é¡2': 'ã‚¢ãƒ­ãƒã‚·ãƒ£ãƒ„ãƒ»ã‹ã‚Šã‚†ã—ã‚¦ã‚§ã‚¢',
          'ã‚¢ã‚¤ãƒ†ãƒ å': 'ã‚¢ãƒ­ãƒã‚·ãƒ£ãƒ„'
        };
        const examples = selectedCategories.map(opt => exampleMap[opt] || opt);
        previewMiddle = examples.length > 0 ? examples.join('') : 'ã‚«ãƒ†ã‚´ãƒª';
      } else if (title === 'ã‚«ãƒ©ãƒ¼') {
        previewMiddle = 'é»’';
      } else if (title === 'ã‚µã‚¤ã‚º') {
        previewMiddle = 'M';
      }

      const preview = `#${commonPrefix}${previewMiddle}${suffix}`;
      const previewDiv = item.querySelector('.hashtag-preview');
      if (previewDiv) {
        previewDiv.textContent = preview;
      }
    }

    /**
     * ã™ã¹ã¦ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
     */
    function updateAllHashtagPreviews() {
      const container = document.getElementById('hashtagItemsContainer');
      for (let i = 0; i < container.children.length; i++) {
        updateHashtagItemPreview(i);
      }
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é …ç›®ã®ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å¤‰æ›´å‡¦ç†
     */
    function handleHashtagItemSuffixChange(index) {
      const container = document.getElementById('hashtagItemsContainer');
      const item = container.children[index];
      if (!item) return;

      const suffixSelect = item.querySelector('.hashtag-suffix-select');
      const suffixCustom = item.querySelector('.hashtag-suffix-custom');

      if (suffixSelect.value === 'custom') {
        suffixCustom.style.display = 'block';
        suffixCustom.focus();
      } else {
        suffixCustom.style.display = 'none';
        suffixCustom.value = '';
      }

      updateHashtagItemPreview(index);
    }


    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆé¸æŠè‚¢ã¨ã‚«ã‚¹ã‚¿ãƒ å€¤ã®å‡¦ç†ï¼‰
     */
    function setupHashtagSuffix(type, value, options) {
      const selectId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ_select' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹_select`;
      const inputId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹`;

      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);

      if (options.includes(value)) {
        // ãƒ—ãƒªã‚»ãƒƒãƒˆå€¤ã®å ´åˆ
        select.value = value;
        input.style.display = 'none';
        input.value = '';
      } else {
        // ã‚«ã‚¹ã‚¿ãƒ å€¤ã®å ´åˆ
        select.value = 'custom';
        input.style.display = 'block';
        input.value = value;
      }
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
     */
    function updateHashtagPreview(type) {
      const prefixId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹' : `${type}ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹`;
      const selectId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ_select' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹_select`;
      const inputId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹`;
      const previewId = `${type}ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼`;

      const prefix = document.getElementById(prefixId).value || '';
      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);

      let suffix = '';
      if (select.value === 'custom') {
        suffix = input.value || '';
      } else {
        suffix = select.value || '';
      }

      // ãƒ–ãƒ©ãƒ³ãƒ‰ã®å ´åˆã¯ä¾‹ã¨ã—ã¦UNIQLOã‚’è¡¨ç¤º
      const middlePart = type === 'ãƒ–ãƒ©ãƒ³ãƒ‰' ? 'UNIQLO' : (type === 'ã‚«ãƒ†ã‚´ãƒª' ? 'ãƒˆãƒƒãƒ—ã‚¹' : '');

      const preview = `#${prefix}${middlePart}${suffix}`;
      document.getElementById(previewId).textContent = preview;
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å¤‰æ›´å‡¦ç†
     */
    function handleHashtagSuffixChange(type) {
      const selectId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ_select' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹_select`;
      const inputId = type === 'å…¨å•†å“' ? 'å…¨å•†å“ãƒ†ã‚­ã‚¹ãƒˆ' : `${type}ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹`;

      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);

      if (select.value === 'custom') {
        input.style.display = 'block';
        input.focus();
      } else {
        input.style.display = 'none';
        input.value = '';
      }

      updateHashtagPreview(type);
    }

    // å‰²å¼•ã‚¿ã‚¤ãƒ—ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
    const DISCOUNT_ICONS = {
      'ãƒ•ã‚©ãƒ­ãƒ¼å‰²': 'ğŸ‘¥',
      'ãƒªãƒ”ãƒ¼ãƒˆå‰²': 'ğŸ”„',
      'ã¾ã¨ã‚å‰²': 'ğŸ“¦',
      'å­¦å‰²': 'ğŸ“',
      'ã‚»ãƒƒãƒˆå‰²': 'ğŸ',
      'ã‚¯ãƒ¼ãƒãƒ³å‰²': 'ğŸ«',
      'æ–°è¦ä¼šå“¡å‰²': 'âœ¨',
      'æœŸé–“é™å®šå‰²': 'â°'
    };

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‰²å¼•ã‚¿ã‚¤ãƒ—
    const DEFAULT_DISCOUNT_TYPES = ['ãƒ•ã‚©ãƒ­ãƒ¼å‰²', 'ãƒªãƒ”ãƒ¼ãƒˆå‰²', 'ã¾ã¨ã‚å‰²'];

    /**
     * å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 
     */
    function addDiscountType() {
      const typesList = document.getElementById('discountTypesList');

      // ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠUI
      const selectorDiv = document.createElement('div');
      selectorDiv.style.cssText = 'background: white; padding: 12px; margin-bottom: 16px; border-radius: 8px; border: 2px solid #3b82f6;';
      selectorDiv.innerHTML = `
        <div style="margin-bottom: 8px; font-size: 13px; font-weight: 600; color: #374151;">å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</div>
        <select id="newDiscountTypeSelect" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 8px; font-size: 13px;">
          <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
          <option value="ãƒ•ã‚©ãƒ­ãƒ¼å‰²">ğŸ‘¥ ãƒ•ã‚©ãƒ­ãƒ¼å‰²</option>
          <option value="ãƒªãƒ”ãƒ¼ãƒˆå‰²">ğŸ”„ ãƒªãƒ”ãƒ¼ãƒˆå‰²</option>
          <option value="ã¾ã¨ã‚å‰²">ğŸ“¦ ã¾ã¨ã‚å‰²</option>
          <option value="å­¦å‰²">ğŸ“ å­¦å‰²</option>
          <option value="ã‚»ãƒƒãƒˆå‰²">ğŸ ã‚»ãƒƒãƒˆå‰²</option>
          <option value="ã‚¯ãƒ¼ãƒãƒ³å‰²">ğŸ« ã‚¯ãƒ¼ãƒãƒ³å‰²</option>
          <option value="æ–°è¦ä¼šå“¡å‰²">âœ¨ æ–°è¦ä¼šå“¡å‰²</option>
          <option value="æœŸé–“é™å®šå‰²">â° æœŸé–“é™å®šå‰²</option>
          <option value="custom">âœï¸ ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
        </select>
        <input type="text" id="newDiscountTypeCustom" placeholder="ã‚«ã‚¹ã‚¿ãƒ å‰²å¼•åã‚’å…¥åŠ›ï¼ˆä¾‹: èª•ç”Ÿæ—¥å‰²ï¼‰" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 8px; font-size: 13px; display: none;">
        <input type="text" id="newDiscountTypeIcon" placeholder="ã‚¢ã‚¤ã‚³ãƒ³ã‚’å…¥åŠ›ï¼ˆä¾‹: ğŸ‚ï¼‰" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 8px; font-size: 13px; display: none;">
        <div style="display: flex; gap: 8px;">
          <button type="button" onclick="confirmAddDiscountType()" style="flex: 1; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600;">è¿½åŠ </button>
          <button type="button" onclick="cancelAddDiscountType()" style="flex: 1; padding: 8px; background: #f3f4f6; color: #6b7280; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 13px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      `;

      typesList.appendChild(selectorDiv);

      // ã‚»ãƒ¬ã‚¯ãƒˆå¤‰æ›´æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
      document.getElementById('newDiscountTypeSelect').addEventListener('change', function() {
        const customInput = document.getElementById('newDiscountTypeCustom');
        const iconInput = document.getElementById('newDiscountTypeIcon');
        if (this.value === 'custom') {
          customInput.style.display = 'block';
          iconInput.style.display = 'block';
        } else {
          customInput.style.display = 'none';
          iconInput.style.display = 'none';
        }
      });
    }

    /**
     * å‰²å¼•ã‚¿ã‚¤ãƒ—è¿½åŠ ã‚’ç¢ºå®š
     */
    function confirmAddDiscountType() {
      const select = document.getElementById('newDiscountTypeSelect');
      const customInput = document.getElementById('newDiscountTypeCustom');
      const iconInput = document.getElementById('newDiscountTypeIcon');

      let typeName, icon;

      if (select.value === 'custom') {
        typeName = customInput.value.trim();
        icon = iconInput.value.trim() || 'ğŸ’°';
        if (!typeName) {
          alert('å‰²å¼•åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
      } else if (select.value) {
        typeName = select.value;
        icon = DISCOUNT_ICONS[typeName] || 'ğŸ’°';
      } else {
        alert('å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      // æ—¢å­˜ãƒã‚§ãƒƒã‚¯
      if (document.getElementById(`${typeName}Group`)) {
        alert('åŒã˜åå‰ã®å‰²å¼•ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™');
        return;
      }

      // é¸æŠUIã‚’å‰Šé™¤
      cancelAddDiscountType();

      // æ–°ã—ã„å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’ä½œæˆ
      createDiscountTypeBlock(typeName, icon);

      updateDiscountPreview();
    }

    /**
     * å‰²å¼•ã‚¿ã‚¤ãƒ—è¿½åŠ ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
     */
    function cancelAddDiscountType() {
      const typesList = document.getElementById('discountTypesList');
      const selector = typesList.querySelector('[id="newDiscountTypeSelect"]')?.closest('div');
      if (selector) {
        selector.remove();
      }
    }

    /**
     * å‰²å¼•ã‚¿ã‚¤ãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆ
     */
    function createDiscountTypeBlock(typeName, icon, ranges = [], description = '') {
      const typesList = document.getElementById('discountTypesList');

      const groupDiv = document.createElement('div');
      groupDiv.id = `${typeName}Group`;
      groupDiv.className = 'discount-group';

      groupDiv.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <strong style="font-size: 14px; color: #1f2937;">${icon} ${typeName}</strong>
          <button type="button" onclick="removeDiscountType('${typeName}')" style="padding: 4px 12px; background: white; color: #ef4444; border: 1px solid #ef4444; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2';" onmouseout="this.style.background='white';">å‰Šé™¤</button>
        </div>
        <div id="${typeName}Container">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <button type="button" class="btn btn-sm btn-primary add-btn" onclick="addDiscountRange('${typeName}')" style="width: 100%; margin-bottom: 12px;">+ ç¯„å›²è¿½åŠ </button>
        <div>
          <label class="form-label" style="font-size: 12px;">èª¬æ˜æ–‡ï¼ˆä»»æ„ï¼‰</label>
          <textarea class="form-control auto-resize" id="${typeName}_èª¬æ˜æ–‡" placeholder="èª¬æ˜æ–‡ã‚’å…¥åŠ›" style="font-size: 13px; resize: none; overflow: hidden; min-height: 100px;" oninput="autoResizeTextarea(this); updateDiscountPreview();">${description}</textarea>
        </div>
      `;

      typesList.appendChild(groupDiv);

      const container = document.getElementById(`${typeName}Container`);
      ranges.forEach((range, idx) => {
        container.appendChild(createDiscountRangeItem(typeName, idx, range.ç¯„å›², range.å‰²å¼•é¡));
      });

      // èª¬æ˜æ–‡textareaã®åˆæœŸã‚µã‚¤ã‚ºèª¿æ•´
      setTimeout(() => {
        const textarea = document.getElementById(`${typeName}_èª¬æ˜æ–‡`);
        if (textarea && textarea.value) {
          autoResizeTextarea(textarea);
        }
      }, 0);
    }

    /**
     * å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’å‰Šé™¤
     */
    function removeDiscountType(typeName) {
      if (!confirm(`ã€Œ${typeName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
      }

      const group = document.getElementById(`${typeName}Group`);
      if (group) {
        group.remove();
      }

      updateDiscountPreview();
    }

    /**
     * å‰²å¼•æƒ…å ±è¨­å®šã‚’è¡¨ç¤º
     */
    function renderDiscountConfig(config) {
      // ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š
      const select = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ');
      const customInput = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ ');

      if (select) {
        const titleSelection = config['ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ'] || config['ã‚¿ã‚¤ãƒˆãƒ«'] || 'ã€ãŠå¾—ãªå‰²å¼•æƒ…å ±ã€‘';

        // ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã®å ´åˆ
        if (titleSelection === 'custom') {
          select.value = 'custom';
          customInput.value = config['ã‚¿ã‚¤ãƒˆãƒ«'] || '';
          customInput.style.display = 'block';
        } else {
          // ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠã®å ´åˆ
          select.value = titleSelection;
          customInput.style.display = 'none';
        }
      }

      // æ—¢å­˜ã®å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’ã‚¯ãƒªã‚¢
      const typesList = document.getElementById('discountTypesList');
      typesList.innerHTML = '';

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèª¬æ˜æ–‡
      const defaultDescriptions = {
        'ãƒ•ã‚©ãƒ­ãƒ¼å‰²': '',
        'ãƒªãƒ”ãƒ¼ãƒˆå‰²': 'ã€Œãƒªãƒ”ãƒ¼ãƒˆå‰²å¸Œæœ›ã€ã¨ã‚³ãƒ¡ãƒ³ãƒˆã«ã¦ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚',
        'ã¾ã¨ã‚å‰²': 'è³¼å…¥ã—ãŸã„å•†å“ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€ã‚³ãƒ¡ãƒ³ãƒˆã«ã¦ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚'
      };

      // è¨­å®šã‹ã‚‰å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’å–å¾—ï¼ˆä¿å­˜ã•ã‚Œã¦ã„ã‚‹é †åºã‚’ç¶­æŒï¼‰
      const savedTypes = config['å‰²å¼•ã‚¿ã‚¤ãƒ—é †åº'] || DEFAULT_DISCOUNT_TYPES;

      savedTypes.forEach(typeName => {
        const ranges = config[typeName] || [];
        const description = config[`${typeName}_èª¬æ˜æ–‡`] || defaultDescriptions[typeName] || '';
        const icon = config[`${typeName}_ã‚¢ã‚¤ã‚³ãƒ³`] || DISCOUNT_ICONS[typeName] || 'ğŸ’°';

        createDiscountTypeBlock(typeName, icon, ranges, description);
      });

      // å…¨ã¦ã®å‰²å¼•ã‚¿ã‚¤ãƒ—ä½œæˆå¾Œã€èª¬æ˜æ–‡ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´
      setTimeout(() => {
        const textareas = typesList.querySelectorAll('textarea.auto-resize');
        textareas.forEach(textarea => {
          if (textarea.value) {
            autoResizeTextarea(textarea);
          }
        });
      }, 100);

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
      updateDiscountPreview();
    }

    /**
     * å‰²å¼•ç¯„å›²é …ç›®ã‚’ä½œæˆ
     */
    function createDiscountRangeItem(type, index, range, amount) {
      const div = document.createElement('div');
      div.className = 'discount-range-item';
      div.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong style="font-size: 13px;">ç¯„å›² ${index + 1}</strong>
          <button type="button" class="btn btn-sm btn-outline-danger remove-btn" onclick="removeDiscountRange('${type}', ${index})">å‰Šé™¤</button>
        </div>
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
          <div style="writing-mode: vertical-rl; font-size: 9px; font-weight: 600; color: #6b7280; display: flex; align-items: center; justify-content: center; padding: 4px 2px; background: #f3f4f6; border-radius: 4px;">ç¯„å›²</div>
          <input type="text" class="form-control" data-discount="${type}" data-index="${index}" data-field="range" value="${range}" placeholder="ç©ºæ¬„å¯ï¼ˆä¾‹: ã€œ2,999å††ï¼‰" style="flex: 1;" oninput="updateDiscountPreview()">
        </div>
        <div style="display: flex; gap: 8px;">
          <div style="writing-mode: vertical-rl; font-size: 9px; font-weight: 600; color: #6b7280; display: flex; align-items: center; justify-content: center; padding: 4px 2px; background: #f3f4f6; border-radius: 4px;">å‰²å¼•</div>
          <input type="text" class="form-control" data-discount="${type}" data-index="${index}" data-field="amount" value="${amount}" placeholder="100å††å¼•" style="flex: 1;" oninput="updateDiscountPreview()">
        </div>
      `;
      return div;
    }

    /**
     * å‰²å¼•ç¯„å›²ã‚’è¿½åŠ 
     */
    function addDiscountRange(type) {
      const container = document.getElementById(`${type}Container`);
      const index = container.children.length;
      container.appendChild(createDiscountRangeItem(type, index, '', ''));
      updateDiscountPreview();
    }

    /**
     * å‰²å¼•ç¯„å›²ã‚’å‰Šé™¤
     */
    function removeDiscountRange(type, index) {
      const container = document.getElementById(`${type}Container`);
      if (container.children.length > 1) {
        container.children[index].remove();
        // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†è¨ˆç®—
        Array.from(container.children).forEach((child, newIndex) => {
          const inputs = child.querySelectorAll('[data-index]');
          inputs.forEach(input => input.setAttribute('data-index', newIndex));
          child.querySelector('strong').textContent = `ç¯„å›² ${newIndex + 1}`;
          child.querySelector('.remove-btn').onclick = () => removeDiscountRange(type, newIndex);
        });
        updateDiscountPreview();
      } else {
        alert('æœ€ä½1ã¤ã®ç¯„å›²ã¯å¿…è¦ã§ã™');
      }
    }

    /**
     * å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã®å¤‰æ›´ã‚’å‡¦ç†
     */
    function handleDiscountTitleChange() {
      const select = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ');
      const customInput = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ ');

      if (select.value === 'custom') {
        customInput.style.display = 'block';
        customInput.focus();
      } else {
        customInput.style.display = 'none';
      }

      updateDiscountPreview();
    }

    /**
     * å‰²å¼•æƒ…å ±ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
     */
    function updateDiscountPreview() {
      const preview = document.getElementById('discountPreview');
      if (!preview) return;

      const select = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ');
      const customInput = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ ');
      const title = select?.value === 'custom' ? customInput?.value : select?.value || 'ã€ãŠå¾—ãªå‰²å¼•æƒ…å ±ã€‘';
      const discountConfig = collectDiscountConfig();
      let previewText = title ? title + '\n\n' : '';

      // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’å‡¦ç†
      const typesList = document.getElementById('discountTypesList');
      const discountGroups = typesList?.querySelectorAll('.discount-group') || [];

      discountGroups.forEach(group => {
        const typeName = group.id.replace('Group', '');
        const ranges = discountConfig[typeName] || [];

        if (ranges.length > 0) {
          previewText += `â–  ${typeName}\n`;
          ranges.forEach(item => {
            // ç¯„å›²ãŒç©ºæ¬„ã®å ´åˆã¯å‰²å¼•é¡ã®ã¿è¡¨ç¤º
            if (item.ç¯„å›²) {
              previewText += `${item.ç¯„å›²} â‡’ ${item.å‰²å¼•é¡}\n`;
            } else {
              previewText += `${item.å‰²å¼•é¡}\n`;
            }
          });
          const desc = document.getElementById(`${typeName}_èª¬æ˜æ–‡`)?.value;
          if (desc) previewText += desc + '\n';
          previewText += '\n';
        }
      });

      preview.textContent = previewText.trim() || 'å‰²å¼•æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
    }

    /**
     * å‰²å¼•è¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
     */
    function clearAllDiscounts() {
      if (!confirm('ã™ã¹ã¦ã®å‰²å¼•è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      // ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
      const select = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ');
      const customInput = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ ');
      if (select) {
        select.value = 'ã€ãŠå¾—ãªå‰²å¼•æƒ…å ±ã€‘';
      }
      if (customInput) {
        customInput.value = '';
        customInput.style.display = 'none';
      }

      // ã™ã¹ã¦ã®å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’å‰Šé™¤
      const typesList = document.getElementById('discountTypesList');
      if (typesList) {
        typesList.innerHTML = '';
      }

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
      updateDiscountPreview();
    }

    /**
     * é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
     */
    function clearShippingDefaults() {
      if (!confirm('é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      // ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç©ºæ¬„ã«æˆ»ã™
      document.getElementById('é…é€æ–™ã®è² æ‹…').value = '';
      document.getElementById('é…é€ã®æ–¹æ³•').value = '';
      document.getElementById('ç™ºé€å…ƒã®åœ°åŸŸ').value = '';
      document.getElementById('ç™ºé€ã¾ã§ã®æ—¥æ•°').value = '';

      alert('é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚\nå¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€Œè¨­å®šã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
    }

    /**
     * é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’è¡¨ç¤º
     */
    function renderShippingDefaults(config) {
      document.getElementById('é…é€æ–™ã®è² æ‹…').value = config.é…é€æ–™ã®è² æ‹… || 'é€æ–™è¾¼ã¿(å‡ºå“è€…è² æ‹…)';
      document.getElementById('é…é€ã®æ–¹æ³•').value = config.é…é€ã®æ–¹æ³• || 'ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿';
      document.getElementById('ç™ºé€å…ƒã®åœ°åŸŸ').value = config.ç™ºé€å…ƒã®åœ°åŸŸ || 'å²¡å±±çœŒ';
      document.getElementById('ç™ºé€ã¾ã§ã®æ—¥æ•°').value = config.ç™ºé€ã¾ã§ã®æ—¥æ•° || '1~2æ—¥ã§ç™ºé€';
    }

    /**
     * ç®¡ç†ç•ªå·è¨­å®šã‚’è¡¨ç¤º
     */
    function renderManagementConfig(config) {
      // æ–°ã—ã„ç®¡ç†ç•ªå·ãƒ“ãƒ«ãƒ€ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
      if (typeof ManagementNumberBuilder !== 'undefined' && config.segments) {
        ManagementNumberBuilder.setData(config);
      }
    }

    /**
     * ç®¡ç†ç•ªå·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¨­å®š
     */
    function setupManagementNumberPreview() {
      document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·ä½¿ç”¨').addEventListener('change', () => {
        toggleShelfNumberSection();
        updateManagementNumberPreview();
      });
      document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·å½¢å¼').addEventListener('change', () => {
        toggleShelfCustomSection();
        updateManagementNumberPreview();
      });
      document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·ã‚µãƒ³ãƒ—ãƒ«').addEventListener('input', updateManagementNumberPreview);
      document.getElementById('ç®¡ç†ç•ªå·_åŒºåˆ‡ã‚Šæ–‡å­—').addEventListener('input', updateManagementNumberPreview);
      document.getElementById('ç®¡ç†ç•ªå·_å•†å“ç•ªå·æ¡æ•°').addEventListener('change', updateManagementNumberPreview);
      document.getElementById('ç®¡ç†ç•ªå·_å•†å“ç•ªå·é–‹å§‹å€¤').addEventListener('input', updateManagementNumberPreview);
    }

    /**
     * æ£šç•ªå·ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡æ›¿
     */
    function toggleShelfNumberSection() {
      const useShelf = document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·ä½¿ç”¨').checked;
      document.getElementById('shelfNumberSection').style.display = useShelf ? 'block' : 'none';
    }

    /**
     * æ£šç•ªå·ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã®è¡¨ç¤ºåˆ‡æ›¿
     */
    function toggleShelfCustomSection() {
      const format = document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·å½¢å¼').value;
      document.getElementById('shelfCustomSection').style.display = format === 'custom' ? 'block' : 'none';
    }

    /**
     * ç®¡ç†ç•ªå·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
     */
    function updateManagementNumberPreview() {
      const useShelf = document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·ä½¿ç”¨').checked;
      const format = document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·å½¢å¼').value;
      const customSample = document.getElementById('ç®¡ç†ç•ªå·_æ£šç•ªå·ã‚µãƒ³ãƒ—ãƒ«').value;
      const separator = document.getElementById('ç®¡ç†ç•ªå·_åŒºåˆ‡ã‚Šæ–‡å­—').value;
      const width = parseInt(document.getElementById('ç®¡ç†ç•ªå·_å•†å“ç•ªå·æ¡æ•°').value) || 4;
      const startNum = parseInt(document.getElementById('ç®¡ç†ç•ªå·_å•†å“ç•ªå·é–‹å§‹å€¤').value) || 1;

      let shelfPart = '';
      if (useShelf) {
        // æ£šç•ªå·ã®ã‚µãƒ³ãƒ—ãƒ«å€¤ã‚’æ±ºå®š
        switch (format) {
          case 'AA':
            shelfPart = 'AA';
            break;
          case 'A':
            shelfPart = 'A';
            break;
          case '01':
            shelfPart = '01';
            break;
          case '001':
            shelfPart = '001';
            break;
          case 'custom':
            shelfPart = customSample || 'RACK-A';
            break;
          default:
            shelfPart = 'AA';
        }
      }

      // å•†å“ç•ªå·éƒ¨åˆ†
      const itemPart = String(startNum).padStart(width, '0');

      // ç®¡ç†ç•ªå·ã‚’ç”Ÿæˆ
      let preview = '';
      if (useShelf && shelfPart) {
        // åŒºåˆ‡ã‚Šæ–‡å­—ãŒç©ºã®å ´åˆã¯ãã®ã¾ã¾é€£çµ
        preview = separator ? `${shelfPart}${separator}${itemPart}` : `${shelfPart}${itemPart}`;
      } else {
        preview = itemPart;
      }

      document.getElementById('ç®¡ç†ç•ªå·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼').value = preview;
    }

    /**
     * è¨­å®šã‚’ä¿å­˜
     */
    function saveConfig() {
      console.log('=== saveConfig é–‹å§‹ ===');
      const managementConfig = collectManagementConfig();
      console.log('ç®¡ç†ç•ªå·è¨­å®š:', managementConfig);

      const newConfig = {
        å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³: collectConditionButtons(),
        ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: collectHashtagConfig(),
        å‰²å¼•æƒ…å ±: collectDiscountConfig(),
        é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: collectShippingDefaults(),
        ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: collectProcureListingDefaults(),
        ç®¡ç†ç•ªå·è¨­å®š: managementConfig,
        ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰: collectSaleswordConfig()
      };

      console.log('ä¿å­˜ã™ã‚‹è¨­å®šå…¨ä½“:', newConfig);

      if (google && google.script && google.script.run) {
        google.script.run
          .withSuccessHandler(function(result) {
            console.log('ä¿å­˜çµæœ:', result);
            if (result.success) {
              alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
              // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
              google.script.run.clearConfigCache();
            } else {
              alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error);
            }
          })
          .withFailureHandler(function(error) {
            console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error);
          })
          .saveConfigMaster(newConfig);
      } else {
        console.error('google.script.run ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
      }
    }

    /**
     * å•†å“çŠ¶æ…‹ãƒœã‚¿ãƒ³è¨­å®šã‚’åé›†
     */
    function collectConditionButtons() {
      const buttons = [];
      CONDITION_STATES.forEach(state => {
        const container = document.getElementById(`condition-${state}`);
        Array.from(container.children).forEach((item, index) => {
          const labelSelect = item.querySelector('[data-field="label-select"]');
          const labelInput = item.querySelector('[data-field="label"]');
          const text = item.querySelector('[data-field="text"]').value;

          // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãŒã‚«ã‚¹ã‚¿ãƒ ã¾ãŸã¯æœªé¸æŠã®å ´åˆã¯inputã‹ã‚‰ã€ãã‚Œä»¥å¤–ã¯selectã‹ã‚‰å–å¾—
          let label = '';
          if (labelSelect && labelSelect.value === 'custom') {
            label = labelInput.value;
          } else if (labelSelect && labelSelect.value) {
            label = labelSelect.value;
          } else {
            label = labelInput.value;
          }

          if (label || text) {
            buttons.push({
              å•†å“ã®çŠ¶æ…‹: state,
              ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«: label,
              ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: text
            });
          }
        });
      });
      return buttons;
    }

    /**
     * ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°è¨­å®šã‚’åé›†
     */
    function collectHashtagConfig() {
      const container = document.getElementById('hashtagItemsContainer');
      const hashtags = [];

      // ä¿å­˜æ™‚ã« # ã‚’è‡ªå‹•ã§ä»˜ã‘ã‚‹
      const addHash = (value) => {
        const trimmed = (value || '').trim();
        if (!trimmed) return '';
        return trimmed.startsWith('#') ? trimmed : '#' + trimmed;
      };

      // å…±é€šãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å–å¾—
      const commonPrefix = addHash(document.getElementById('commonHashtagPrefix').value || '');

      Array.from(container.children).forEach(item => {
        const title = item.querySelector('.hashtag-title').value || '';
        const icon = item.querySelector('.hashtag-icon').value || 'ğŸ·ï¸';
        const suffixSelect = item.querySelector('.hashtag-suffix-select');
        const suffixCustom = item.querySelector('.hashtag-suffix-custom');

        let suffix = '';
        if (suffixSelect.value === 'custom') {
          suffix = suffixCustom.value || '';
        } else {
          suffix = suffixSelect.value || '';
        }

        // ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åé›†
        const suffixOptions = Array.from(suffixSelect.options)
          .filter(opt => opt.value !== 'custom')
          .map(opt => opt.value);

        // ã‚«ãƒ†ã‚´ãƒªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åé›†ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®å ´åˆã®ã¿ï¼‰
        let categoryOptions = null;
        if (title === 'ã‚«ãƒ†ã‚´ãƒª') {
          categoryOptions = [];
          const checkboxes = item.querySelectorAll('.category-option');
          checkboxes.forEach(cb => {
            if (cb.checked) {
              categoryOptions.push(cb.getAttribute('data-option'));
            }
          });
        }

        // ã‚¿ã‚¤ãƒˆãƒ«ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ä¿å­˜
        if (title) {
          const hashtagData = {
            title: title,
            icon: icon,
            suffix: suffix,
            suffixOptions: suffixOptions
          };
          if (categoryOptions) {
            hashtagData.categoryOptions = categoryOptions;
          }
          hashtags.push(hashtagData);
        }
      });

      return {
        commonPrefix: commonPrefix,
        hashtags: hashtags
      };
    }

    /**
     * å‰²å¼•æƒ…å ±è¨­å®šã‚’åé›†
     */
    function collectDiscountConfig() {
      const config = {};

      // ã‚¿ã‚¤ãƒˆãƒ«ã‚’åé›†
      const select = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ');
      const customInput = document.getElementById('å‰²å¼•æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«ã‚«ã‚¹ã‚¿ãƒ ');
      if (select) {
        if (select.value === 'custom') {
          config['ã‚¿ã‚¤ãƒˆãƒ«'] = customInput?.value || '';
          config['ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ'] = 'custom';
        } else {
          config['ã‚¿ã‚¤ãƒˆãƒ«'] = select.value;
          config['ã‚¿ã‚¤ãƒˆãƒ«é¸æŠ'] = select.value;
        }
      }

      // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®å‰²å¼•ã‚¿ã‚¤ãƒ—ã‚’åé›†
      const typesList = document.getElementById('discountTypesList');
      const discountGroups = typesList?.querySelectorAll('.discount-group') || [];
      const discountTypes = [];

      discountGroups.forEach(group => {
        const typeName = group.id.replace('Group', '');
        discountTypes.push(typeName);

        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—
        const iconElement = group.querySelector('strong');
        const iconText = iconElement?.textContent || '';
        const icon = iconText.split(' ')[0] || 'ğŸ’°'; // ã‚¢ã‚¤ã‚³ãƒ³éƒ¨åˆ†ã‚’æŠ½å‡º
        config[`${typeName}_ã‚¢ã‚¤ã‚³ãƒ³`] = icon;

        // ç¯„å›²ã‚’åé›†
        config[typeName] = [];
        const container = document.getElementById(`${typeName}Container`);
        if (container) {
          Array.from(container.children).forEach(item => {
            const range = item.querySelector('[data-field="range"]')?.value || '';
            const amount = item.querySelector('[data-field="amount"]')?.value || '';
            if (range || amount) {
              config[typeName].push({ ç¯„å›²: range, å‰²å¼•é¡: amount });
            }
          });
        }

        // èª¬æ˜æ–‡ã‚’åé›†
        const descField = document.getElementById(`${typeName}_èª¬æ˜æ–‡`);
        if (descField) {
          config[`${typeName}_èª¬æ˜æ–‡`] = descField.value;
        }
      });

      // å‰²å¼•ã‚¿ã‚¤ãƒ—ã®é †åºã‚’ä¿å­˜
      config['å‰²å¼•ã‚¿ã‚¤ãƒ—é †åº'] = discountTypes;

      return config;
    }

    /**
     * ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’è‡ªå‹•ãƒªã‚µã‚¤ã‚º
     */
    function autoResizeTextarea(textarea) {
      // é«˜ã•ã‚’ãƒªã‚»ãƒƒãƒˆ
      textarea.style.height = 'auto';
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é«˜ã•ã«åˆã‚ã›ã‚‹
      textarea.style.height = textarea.scrollHeight + 'px';
    }

    /**
     * é…é€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’åé›†
     */
    function collectShippingDefaults() {
      return {
        é…é€æ–™ã®è² æ‹…: document.getElementById('é…é€æ–™ã®è² æ‹…').value,
        é…é€ã®æ–¹æ³•: document.getElementById('é…é€ã®æ–¹æ³•').value,
        ç™ºé€å…ƒã®åœ°åŸŸ: document.getElementById('ç™ºé€å…ƒã®åœ°åŸŸ').value,
        ç™ºé€ã¾ã§ã®æ—¥æ•°: document.getElementById('ç™ºé€ã¾ã§ã®æ—¥æ•°').value
      };
    }

    /**
     * ç®¡ç†ç•ªå·è¨­å®šã‚’åé›†
     */
    function collectManagementConfig() {
      // æ–°ã—ã„ç®¡ç†ç•ªå·ãƒ“ãƒ«ãƒ€ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      try {
        if (typeof ManagementNumberBuilder !== 'undefined' && ManagementNumberBuilder) {
          const data = ManagementNumberBuilder.getData();
          console.log('ManagementNumberBuilderã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—:', data);
          return data;
        } else {
          console.warn('ManagementNumberBuilderãŒæœªå®šç¾©ã§ã™');
          return { segments: [] };
        }
      } catch (e) {
        console.error('collectManagementConfig ã‚¨ãƒ©ãƒ¼:', e);
        return { segments: [] };
      }
    }

    // ========================================
    // ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
    // ========================================

    let SALESWORD_LIST = [];

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ + å‰Šé™¤ãƒœã‚¿ãƒ³ï¼‰
     */
    function renderSaleswordList() {
      const container = document.getElementById('saleswordList');
      if (!container) return;

      container.innerHTML = '';

      // SALESWORD_LISTãŒé…åˆ—ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼
      if (!Array.isArray(SALESWORD_LIST)) {
        console.warn('SALESWORD_LISTãŒé…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç©ºé…åˆ—ã«åˆæœŸåŒ–ã—ã¾ã™ã€‚', SALESWORD_LIST);
        SALESWORD_LIST = [];
      }

      if (SALESWORD_LIST.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 16px; font-size: 13px;">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      SALESWORD_LIST.forEach((word, index) => {
        const item = document.createElement('div');
        item.style.display = 'flex';
        item.style.alignItems = 'center';
        item.style.gap = '8px';
        item.style.padding = '8px';
        item.style.background = 'white';
        item.style.border = '1px solid #e5e7eb';
        item.style.borderRadius = '6px';
        item.style.marginBottom = '8px';

        item.innerHTML = `
          <span style="color: #6c757d; font-size: 12px; min-width: 30px;">${index + 1}.</span>
          <span style="flex: 1; font-size: 13px; color: #374151;">${word}</span>
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSalesword(${index})" style="font-size: 11px; padding: 4px 12px;">å‰Šé™¤</button>
        `;

        container.appendChild(item);
      });
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤
     */
    function removeSalesword(index) {
      SALESWORD_LIST.splice(index, 1);
      renderSaleswordList();
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼‰
     */
    let SALESWORD_MASTER = {};

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
     */
    function loadSaleswordMasterData() {
      google.script.run
        .withSuccessHandler(function(data) {
          SALESWORD_MASTER = data;
          initSaleswordDropdowns();
        })
        .withFailureHandler(function(error) {
          console.error('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        })
        .getSaleswordHierarchy();
    }

    /**
     * 2æ®µå¼ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
     */
    function initSaleswordDropdowns() {
      const categorySelect = document.getElementById('saleswordCategorySelect');
      if (!categorySelect || !SALESWORD_MASTER) return;

      categorySelect.innerHTML = '<option value="">--é¸æŠ--</option>';

      Object.keys(SALESWORD_MASTER).sort().forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }

    /**
     * ã‚«ãƒ†ã‚´ãƒªé¸æŠæ™‚ã«ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°
     */
    function updateSaleswordOptions() {
      const categorySelect = document.getElementById('saleswordCategorySelect');
      const saleswordSelect = document.getElementById('saleswordSelect');

      if (!categorySelect || !saleswordSelect) return;

      const category = categorySelect.value;
      saleswordSelect.innerHTML = '<option value="">--é¸æŠ--</option>';

      if (!category || !SALESWORD_MASTER[category]) {
        saleswordSelect.disabled = true;
        return;
      }

      SALESWORD_MASTER[category].forEach(word => {
        const option = document.createElement('option');
        option.value = word;
        option.textContent = word;
        saleswordSelect.appendChild(option);
      });

      saleswordSelect.disabled = false;
    }

    /**
     * ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ 
     */
    function addSaleswordFromDropdown() {
      const saleswordSelect = document.getElementById('saleswordSelect');
      if (!saleswordSelect) return;

      const word = saleswordSelect.value.trim();
      if (!word) {
        alert('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      // é‡è¤‡ãƒã‚§ãƒƒã‚¯
      if (SALESWORD_LIST.includes(word)) {
        alert('ã“ã®ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
        return;
      }

      SALESWORD_LIST.push(word);  // é…åˆ—ã®æœ«å°¾ã«è¿½åŠ ï¼ˆè¿½åŠ ã—ãŸé †ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
      renderSaleswordList();

      // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
      document.getElementById('saleswordCategorySelect').value = '';
      saleswordSelect.value = '';
      saleswordSelect.disabled = true;
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’åé›†
     */
    function collectSaleswordConfig() {
      // SALESWORD_LISTãŒé…åˆ—ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼
      const saleswordList = Array.isArray(SALESWORD_LIST) ? SALESWORD_LIST : [];

      const result = {
        ã‚ˆãä½¿ã†: saleswordList.filter(word => word.trim() !== ''),
        è¡¨ç¤ºå½¢å¼: collectSaleswordFormat()
      };
      console.log('collectSaleswordConfig çµæœ:', result);
      return result;
    }

    // ========================================
    // ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºå½¢å¼è¨­å®š
    // ========================================

    let WORD_OVERRIDES = [];

    /**
     * å‰ã«ä»˜ã‘ã‚‹æ–‡å­—ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¤‰æ›´æ™‚
     */
    function handlePrefixChange() {
      const select = document.getElementById('saleswordPrefixGlobalSelect');
      const customInput = document.getElementById('saleswordPrefixGlobalCustom');

      if (select.value === 'custom') {
        customInput.style.display = 'block';
      } else {
        customInput.style.display = 'none';
        customInput.value = '';
      }

      updateSaleswordFormatPreview();
    }

    /**
     * å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¤‰æ›´æ™‚
     */
    function handleSuffixChange() {
      const select = document.getElementById('saleswordSuffixGlobalSelect');
      const customInput = document.getElementById('saleswordSuffixGlobalCustom');

      if (select.value === 'custom') {
        customInput.style.display = 'block';
      } else {
        customInput.style.display = 'none';
        customInput.value = '';
      }

      updateSaleswordFormatPreview();
    }

    /**
     * ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
     */
    function updateSaleswordFormatPreview() {
      const prefixSelect = document.getElementById('saleswordPrefixGlobalSelect');
      const prefixCustom = document.getElementById('saleswordPrefixGlobalCustom');
      const suffixSelect = document.getElementById('saleswordSuffixGlobalSelect');
      const suffixCustom = document.getElementById('saleswordSuffixGlobalCustom');

      let prefix = '';
      let suffix = '';

      if (prefixSelect.value === 'custom') {
        prefix = prefixCustom.value || '';
      } else {
        prefix = prefixSelect.value || '';
      }

      if (suffixSelect.value === 'custom') {
        suffix = suffixCustom.value || '';
      } else {
        suffix = suffixSelect.value || '';
      }

      const preview = document.getElementById('saleswordFormatPreview');
      if (preview) {
        preview.textContent = `${prefix}ç¾å“${suffix}`;
      }
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’è¿½åŠ 
     */
    function addWordOverride() {
      WORD_OVERRIDES.push({
        word: '',
        prefix: '',
        suffix: ''
      });
      renderWordOverrides();
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’å‰Šé™¤
     */
    function removeWordOverride(index) {
      WORD_OVERRIDES.splice(index, 1);
      renderWordOverrides();
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’æ›´æ–°
     */
    function updateWordOverride(index, field, value) {
      WORD_OVERRIDES[index][field] = value;
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã®å‰ã«ä»˜ã‘ã‚‹æ–‡å­—ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¤‰æ›´æ™‚
     */
    function handleWordPrefixChange(index) {
      const select = document.getElementById(`wordPrefixSelect_${index}`);
      const customInput = document.getElementById(`wordPrefixCustom_${index}`);

      if (select.value === 'custom') {
        customInput.style.display = 'block';
      } else {
        customInput.style.display = 'none';
        customInput.value = '';
      }

      updateWordOverrideFromInput(index);
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã®å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¤‰æ›´æ™‚
     */
    function handleWordSuffixChange(index) {
      const select = document.getElementById(`wordSuffixSelect_${index}`);
      const customInput = document.getElementById(`wordSuffixCustom_${index}`);

      if (select.value === 'custom') {
        customInput.style.display = 'block';
      } else {
        customInput.style.display = 'none';
        customInput.value = '';
      }

      updateWordOverrideFromInput(index);
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å€¤ã‚’æ›´æ–°
     */
    function updateWordOverrideFromInput(index) {
      const prefixSelect = document.getElementById(`wordPrefixSelect_${index}`);
      const prefixCustom = document.getElementById(`wordPrefixCustom_${index}`);
      const suffixSelect = document.getElementById(`wordSuffixSelect_${index}`);
      const suffixCustom = document.getElementById(`wordSuffixCustom_${index}`);

      let prefix = '';
      let suffix = '';

      if (prefixSelect && prefixSelect.value === 'custom') {
        prefix = prefixCustom ? (prefixCustom.value || '').trim() : '';
      } else if (prefixSelect) {
        prefix = (prefixSelect.value || '').trim();
      }

      if (suffixSelect && suffixSelect.value === 'custom') {
        suffix = suffixCustom ? (suffixCustom.value || '').trim() : '';
      } else if (suffixSelect) {
        suffix = (suffixSelect.value || '').trim();
      }

      WORD_OVERRIDES[index].prefix = prefix;
      WORD_OVERRIDES[index].suffix = suffix;
    }

    /**
     * ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
     */
    function renderWordOverrides() {
      const container = document.getElementById('wordOverrideList');
      if (!container) return;

      container.innerHTML = '';

      WORD_OVERRIDES.forEach((override, index) => {
        const item = document.createElement('div');
        item.style.background = '#f8f9fa';
        item.style.padding = '12px';
        item.style.borderRadius = '6px';
        item.style.marginBottom = '8px';
        item.style.border = '1px solid #dee2e6';

        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é¸æŠè‚¢ã‚’ä½œæˆï¼ˆå‰ã¨å¾Œã‚ã§åˆ†ã‘ã‚‹ï¼‰
        const prefixSelectOptions = `
          <option value="">ãªã—</option>
          <option value="ã€">ã€</option>
          <option value="ã€">ã€</option>
          <option value="ã€Œ">ã€Œ</option>
          <option value="ï¼ˆ">ï¼ˆ</option>
          <option value="â˜…">â˜…</option>
          <option value="â˜†">â˜†</option>
          <option value="â—†">â—†</option>
          <option value="â—">â—</option>
          <option value="â– ">â– </option>
          <option value="â™¡">â™¡</option>
          <option value="âœ¨">âœ¨</option>
          <option value="â€»">â€»</option>
          <option value="custom">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
        `;

        const suffixSelectOptions = `
          <option value="">ãªã—</option>
          <option value="ã€‘">ã€‘</option>
          <option value="ã€">ã€</option>
          <option value="ã€">ã€</option>
          <option value="ï¼‰">ï¼‰</option>
          <option value="ï¼">ï¼</option>
          <option value="â˜…">â˜…</option>
          <option value="â˜†">â˜†</option>
          <option value="â—†">â—†</option>
          <option value="â—">â—</option>
          <option value="â– ">â– </option>
          <option value="â™¡">â™¡</option>
          <option value="âœ¨">âœ¨</option>
          <option value="â€»">â€»</option>
          <option value="custom">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
        `;

        // å‰ã«ä»˜ã‘ã‚‹æ–‡å­—ã®åˆæœŸå€¤ã‚’åˆ¤å®š
        const prefixValue = override.prefix || '';
        const prefixIsCustom = prefixValue && !['', 'ã€', 'ã€', 'ã€Œ', 'ï¼ˆ', 'â˜…', 'â˜†', 'â—†', 'â—', 'â– ', 'â™¡', 'âœ¨', 'â€»'].includes(prefixValue);
        const prefixSelectValue = prefixIsCustom ? 'custom' : prefixValue;

        // å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—ã®åˆæœŸå€¤ã‚’åˆ¤å®š
        const suffixValue = override.suffix || '';
        const suffixIsCustom = suffixValue && !['', 'ã€‘', 'ã€', 'ã€', 'ï¼‰', 'ï¼', 'â˜…', 'â˜†', 'â—†', 'â—', 'â– ', 'â™¡', 'âœ¨', 'â€»'].includes(suffixValue);
        const suffixSelectValue = suffixIsCustom ? 'custom' : suffixValue;

        item.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 13px; font-weight: 500;">è¨­å®š ${index + 1}</span>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeWordOverride(${index})">å‰Šé™¤</button>
          </div>
          <div style="margin-bottom: 8px;">
            <label style="font-size: 12px; margin-bottom: 4px; display: block;">ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="text" class="form-control form-control-sm" value="${override.word || ''}"
                   onchange="updateWordOverride(${index}, 'word', this.value)"
                   placeholder="ä¾‹: åŒ¿åé…é€">
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <div>
              <label style="font-size: 12px; margin-bottom: 4px; display: block;">å‰ã«ä»˜ã‘ã‚‹æ–‡å­—</label>
              <select id="wordPrefixSelect_${index}" class="form-select form-select-sm" onchange="handleWordPrefixChange(${index})" style="margin-bottom: 4px;">
                ${prefixSelectOptions}
              </select>
              <input type="text" id="wordPrefixCustom_${index}" class="form-control form-control-sm"
                     value="${prefixIsCustom ? prefixValue : ''}"
                     onchange="updateWordOverrideFromInput(${index})"
                     placeholder="ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›" maxlength="5"
                     style="display: ${prefixIsCustom ? 'block' : 'none'};">
            </div>
            <div>
              <label style="font-size: 12px; margin-bottom: 4px; display: block;">å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—</label>
              <select id="wordSuffixSelect_${index}" class="form-select form-select-sm" onchange="handleWordSuffixChange(${index})" style="margin-bottom: 4px;">
                ${suffixSelectOptions}
              </select>
              <input type="text" id="wordSuffixCustom_${index}" class="form-control form-control-sm"
                     value="${suffixIsCustom ? suffixValue : ''}"
                     onchange="updateWordOverrideFromInput(${index})"
                     placeholder="ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›" maxlength="5"
                     style="display: ${suffixIsCustom ? 'block' : 'none'};">
            </div>
          </div>
        `;

        container.appendChild(item);

        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®å€¤ã‚’è¨­å®š
        const prefixSelect = document.getElementById(`wordPrefixSelect_${index}`);
        const suffixSelect = document.getElementById(`wordSuffixSelect_${index}`);
        if (prefixSelect) prefixSelect.value = prefixSelectValue;
        if (suffixSelect) suffixSelect.value = suffixSelectValue;
      });
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºå½¢å¼è¨­å®šã‚’åé›†
     */
    function collectSaleswordFormat() {
      const prefixSelect = document.getElementById('saleswordPrefixGlobalSelect');
      const prefixCustom = document.getElementById('saleswordPrefixGlobalCustom');
      const suffixSelect = document.getElementById('saleswordSuffixGlobalSelect');
      const suffixCustom = document.getElementById('saleswordSuffixGlobalCustom');

      let prefix = '';
      let suffix = '';

      if (prefixSelect && prefixSelect.value === 'custom') {
        prefix = prefixCustom ? (prefixCustom.value || '').trim() : '';
      } else if (prefixSelect) {
        prefix = (prefixSelect.value || '').trim();
      }

      if (suffixSelect && suffixSelect.value === 'custom') {
        suffix = suffixCustom ? (suffixCustom.value || '').trim() : '';
      } else if (suffixSelect) {
        suffix = (suffixSelect.value || '').trim();
      }

      // ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã®æœ€æ–°å€¤ã‚’åé›†
      WORD_OVERRIDES.forEach((override, index) => {
        updateWordOverrideFromInput(index);
      });

      const result = {
        globalPrefix: prefix,
        globalSuffix: suffix,
        wordOverrides: WORD_OVERRIDES.filter(o => o.word.trim() !== '')
      };

      console.log('collectSaleswordFormat çµæœ:', result);
      return result;
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºå½¢å¼è¨­å®šã‚’èª­ã¿è¾¼ã¿
     */
    function renderSaleswordFormat(config) {
      console.log('renderSaleswordFormat å—ä¿¡ãƒ‡ãƒ¼ã‚¿:', config);

      if (!config) config = { globalPrefix: 'ã€', globalSuffix: 'ã€‘', wordOverrides: [] };

      // æ—§ãƒ‡ãƒ¼ã‚¿ï¼ˆcategoryOverridesï¼‰ã‹ã‚‰æ–°ãƒ‡ãƒ¼ã‚¿ï¼ˆwordOverridesï¼‰ã¸ã®å¤‰æ›
      if (config.categoryOverrides && !config.wordOverrides) {
        config.wordOverrides = [];
      }

      const prefixSelect = document.getElementById('saleswordPrefixGlobalSelect');
      const prefixCustom = document.getElementById('saleswordPrefixGlobalCustom');
      const suffixSelect = document.getElementById('saleswordSuffixGlobalSelect');
      const suffixCustom = document.getElementById('saleswordSuffixGlobalCustom');

      console.log('prefixè¨­å®šå€¤:', config.globalPrefix, 'suffixè¨­å®šå€¤:', config.globalSuffix);

      // å‰ã«ä»˜ã‘ã‚‹æ–‡å­—ã‚’è¨­å®š
      const prefix = config.globalPrefix || 'ã€';
      const prefixOption = Array.from(prefixSelect.options).find(opt => opt.value === prefix);

      console.log('prefix:', prefix, 'prefixOption:', prefixOption);

      if (prefixOption && prefix !== '') {
        prefixSelect.value = prefix;
        prefixCustom.style.display = 'none';
        prefixCustom.value = '';
        console.log('prefixã‚’ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«è¨­å®š:', prefix);
      } else if (prefix === '') {
        prefixSelect.value = '';
        prefixCustom.style.display = 'none';
        prefixCustom.value = '';
        console.log('prefixã‚’ç©ºã«è¨­å®š');
      } else {
        prefixSelect.value = 'custom';
        prefixCustom.style.display = 'block';
        prefixCustom.value = prefix;
        console.log('prefixã‚’ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã«è¨­å®š:', prefix);
      }

      // å¾Œã‚ã«ä»˜ã‘ã‚‹æ–‡å­—ã‚’è¨­å®š
      const suffix = config.globalSuffix || 'ã€‘';
      const suffixOption = Array.from(suffixSelect.options).find(opt => opt.value === suffix);

      console.log('suffix:', suffix, 'suffixOption:', suffixOption);

      if (suffixOption && suffix !== '') {
        suffixSelect.value = suffix;
        suffixCustom.style.display = 'none';
        suffixCustom.value = '';
        console.log('suffixã‚’ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«è¨­å®š:', suffix);
      } else if (suffix === '') {
        suffixSelect.value = '';
        suffixCustom.style.display = 'none';
        suffixCustom.value = '';
        console.log('suffixã‚’ç©ºã«è¨­å®š');
      } else {
        suffixSelect.value = 'custom';
        suffixCustom.style.display = 'block';
        suffixCustom.value = suffix;
        console.log('suffixã‚’ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã«è¨­å®š:', suffix);
      }

      // ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®š
      WORD_OVERRIDES = config.wordOverrides || [];
      renderWordOverrides();

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
      updateSaleswordFormatPreview();
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
     */
    function loadSaleswordConfig() {
      if (google && google.script && google.script.run) {
        google.script.run
          .withSuccessHandler(function(config) {
            console.log('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', config);
            if (config && config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰) {
              // æ–°ã—ã„æ§‹é€ ï¼ˆã‚ˆãä½¿ã† + è¡¨ç¤ºå½¢å¼ï¼‰ã«å¯¾å¿œ
              if (typeof config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ === 'object' && config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.ã‚ˆãä½¿ã†) {
                SALESWORD_LIST = config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.ã‚ˆãä½¿ã† || [];
                renderSaleswordList();
                renderSaleswordFormat(config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰.è¡¨ç¤ºå½¢å¼ || {});
              } else if (Array.isArray(config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰)) {
                // æ—§å½¢å¼ï¼ˆé…åˆ—ã®ã¿ï¼‰ã«å¯¾å¿œ
                SALESWORD_LIST = config.ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰;
                renderSaleswordList();
                renderSaleswordFormat({ globalPrefix: 'ã€', globalSuffix: 'ã€‘', wordOverrides: [] });
              } else {
                // ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨
                console.log('ã‚ˆãä½¿ã†ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒç©ºã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                SALESWORD_LIST = [];
                renderSaleswordList();
                renderSaleswordFormat({ globalPrefix: 'ã€', globalSuffix: 'ã€‘', wordOverrides: [] });
              }
            }
          })
          .withFailureHandler(function(error) {
            console.error('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          })
          .loadConfigMaster();
      }
    }

    /**
     * ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
     */
    function clearAllSaleswordSettings() {
      if (!confirm('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã€ã€‘ï¼‰ã«æˆ»ã‚Šã¾ã™\nãƒ»ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™')) {
        return;
      }

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™
      const prefixSelect = document.getElementById('saleswordPrefixGlobalSelect');
      const prefixCustom = document.getElementById('saleswordPrefixGlobalCustom');
      const suffixSelect = document.getElementById('saleswordSuffixGlobalSelect');
      const suffixCustom = document.getElementById('saleswordSuffixGlobalCustom');

      if (prefixSelect) {
        prefixSelect.value = 'ã€';
        prefixCustom.style.display = 'none';
        prefixCustom.value = '';
      }

      if (suffixSelect) {
        suffixSelect.value = 'ã€‘';
        suffixCustom.style.display = 'none';
        suffixCustom.value = '';
      }

      // ãƒ¯ãƒ¼ãƒ‰åˆ¥è¨­å®šã‚’ã™ã¹ã¦å‰Šé™¤
      WORD_OVERRIDES = [];
      renderWordOverrides();

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
      updateSaleswordFormatPreview();

      console.log('ã‚»ãƒ¼ãƒ«ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
    }

    // ========================================
    // ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
    // ========================================

    /**
     * ä»•å…¥ãƒ»å‡ºå“ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–ï¼ˆãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ï¼‰
     */
    function initProcureListingDropdowns() {
      if (google && google.script && google.script.run) {
        // ä»•å…¥å…ˆã‚’å–å¾—
        google.script.run
          .withSuccessHandler(function(options) {
            const select = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ');
            if (select && options) {
              select.innerHTML = '<option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>';
              options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                select.appendChild(option);
              });

              // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³åˆæœŸåŒ–å¾Œã€ç¾åœ¨ã®è¨­å®šå€¤ã‚’é©ç”¨
              if (currentConfig && currentConfig.ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) {
                const defaultValue = currentConfig.ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ;
                if (defaultValue) {
                  select.value = defaultValue;
                }
              }
            }
          })
          .withFailureHandler(function(error) {
            console.error('ä»•å…¥å…ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          })
          .getMasterData('ä»•å…¥å…ˆ');

        // å‡ºå“å…ˆã‚’å–å¾—
        google.script.run
          .withSuccessHandler(function(options) {
            const select = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ');
            if (select && options) {
              select.innerHTML = '<option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>';
              options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                select.appendChild(option);
              });

              // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³åˆæœŸåŒ–å¾Œã€ç¾åœ¨ã®è¨­å®šå€¤ã‚’é©ç”¨
              if (currentConfig && currentConfig.ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) {
                const defaultValue = currentConfig.ä»•å…¥å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ;
                if (defaultValue) {
                  select.value = defaultValue;
                }
              }
            }
          })
          .withFailureHandler(function(error) {
            console.error('å‡ºå“å…ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          })
          .getMasterData('å‡ºå“å…ˆ');
      }
    }

    /**
     * ä»•å…¥æ—¥ã®ã€Œå¸¸ã«ä»Šæ—¥ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å‡¦ç†
     */
    function toggleProcureDateField() {
      const checkbox = document.getElementById('ä»•å…¥æ—¥_ä»Šæ—¥');
      const dateField = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥');
      if (checkbox && dateField) {
        dateField.disabled = checkbox.checked;
        if (checkbox.checked) {
          dateField.style.background = '#f3f4f6';
          dateField.style.cursor = 'not-allowed';
        } else {
          dateField.style.background = 'white';
          dateField.style.cursor = 'pointer';
        }
      }
    }

    /**
     * å‡ºå“æ—¥ã®ã€Œå¸¸ã«ä»Šæ—¥ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å‡¦ç†
     */
    function toggleListingDateField() {
      const checkbox = document.getElementById('å‡ºå“æ—¥_ä»Šæ—¥');
      const dateField = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥');
      if (checkbox && dateField) {
        dateField.disabled = checkbox.checked;
        if (checkbox.checked) {
          dateField.style.background = '#f3f4f6';
          dateField.style.cursor = 'not-allowed';
        } else {
          dateField.style.background = 'white';
          dateField.style.cursor = 'pointer';
        }
      }
    }

    /**
     * ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’è¡¨ç¤º
     */
    function renderProcureListingDefaults(config) {
      console.log('ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’è¡¨ç¤º:', config);

      // ä»•å…¥æ—¥_ä»Šæ—¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
      const procureTodayCheckbox = document.getElementById('ä»•å…¥æ—¥_ä»Šæ—¥');
      if (procureTodayCheckbox) {
        procureTodayCheckbox.checked = config.ä»•å…¥æ—¥_ä»Šæ—¥ === true;
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥
      const procureDate = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥');
      if (procureDate) {
        procureDate.value = config.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥ || '';
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ
      const procureSource = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ');
      if (procureSource) {
        procureSource.value = config.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ || '';
      }

      // å‡ºå“æ—¥_ä»Šæ—¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
      const listingTodayCheckbox = document.getElementById('å‡ºå“æ—¥_ä»Šæ—¥');
      if (listingTodayCheckbox) {
        listingTodayCheckbox.checked = config.å‡ºå“æ—¥_ä»Šæ—¥ === true;
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥
      const listingDate = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥');
      if (listingDate) {
        listingDate.value = config.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥ || '';
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ
      const listingDest = document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ');
      if (listingDest) {
        listingDest.value = config.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ || '';
      }

      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã«å¿œã˜ã¦æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹åŒ–
      toggleProcureDateField();
      toggleListingDateField();
    }

    /**
     * ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’åé›†
     */
    function collectProcureListingDefaults() {
      const result = {
        ä»•å…¥æ—¥_ä»Šæ—¥: document.getElementById('ä»•å…¥æ—¥_ä»Šæ—¥')?.checked || false,
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥: document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥')?.value || '',
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ: document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ')?.value || '',
        å‡ºå“æ—¥_ä»Šæ—¥: document.getElementById('å‡ºå“æ—¥_ä»Šæ—¥')?.checked || false,
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥: document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥')?.value || '',
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ: document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ')?.value || ''
      };
      console.log('ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’åé›†:', result);
      return result;
    }

    /**
     * ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
     */
    function clearProcureListingDefaults() {
      if (!confirm('ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      document.getElementById('ä»•å…¥æ—¥_ä»Šæ—¥').checked = false;
      document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥æ—¥').value = '';
      document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»•å…¥å…ˆ').value = '';
      document.getElementById('å‡ºå“æ—¥_ä»Šæ—¥').checked = false;
      document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“æ—¥').value = '';
      document.getElementById('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºå“å…ˆ').value = '';

      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ãŸã®ã§æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–
      toggleProcureDateField();
      toggleListingDateField();

      alert('ä»•å…¥ãƒ»å‡ºå“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚\nå¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€Œè¨­å®šã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
    }
  </script>
</body>
</html>
