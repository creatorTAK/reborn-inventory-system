<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body { font-family: system-ui, sans-serif; padding: 12px; font-size: 13px; }
label { display: block; margin: 6px 0 2px; font-size: 12px; color: #374151; }
input, select, textarea { width: 100%; box-sizing: border-box; padding: 6px 8px; font-size: 13px; border: 1px solid #d1d5db; border-radius: 4px; }
input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
.group { border: 1px solid #e5e7eb; background: #f8fafc; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
.group-title { font-size: 14px; font-weight: 700; color: #1f2937; margin-bottom: 8px; border-bottom: 1px solid #e5e7eb; padding-bottom: 4px; }
.row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.actions { margin-top: 16px; display: flex; gap: 8px; }
.btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; }
.btn-primary { background: #3b82f6; color: white; }
.btn-primary:hover { background: #2563eb; }
.btn-secondary { background: #6b7280; color: white; }
.btn-secondary:hover { background: #4b5563; }
.btn-success { background: #10b981; color: white; }
.btn-success:hover { background: #059669; }
.msg { margin-top: 12px; padding: 8px 12px; border-radius: 4px; font-size: 12px; white-space: pre-wrap; }
.msg.success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
.msg.error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
.product-info { background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 10px; margin: 8px 0; }
.product-info .title { font-weight: 600; color: #0c4a6e; margin-bottom: 4px; }
.product-info .detail { font-size: 12px; color: #0369a1; margin: 2px 0; }
.search-section { background: #fefce8; border: 1px solid #eab308; }
.sale-section { background: #fef2f2; border: 1px solid #ef4444; }
.shipping-section { background: #f0fdf4; border: 1px solid #22c55e; }
</style>
</head>
<body>

<!-- å•†å“æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="group search-section">
  <div class="group-title">ğŸ” å•†å“æ¤œç´¢</div>
  <label>ç®¡ç†ç•ªå·</label>
  <input id="searchMgmtNo" type="text" placeholder="AA-1001" style="text-transform: uppercase;">
  <div class="actions">
    <button class="btn btn-primary" onclick="searchProduct()">æ¤œç´¢ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—</button>
    <button class="btn btn-secondary" onclick="clearSearch()">ã‚¯ãƒªã‚¢</button>
  </div>
  
  <!-- å•†å“æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div id="productInfoArea" style="display: none;">
    <div class="product-info">
      <div class="title" id="productTitle">å•†å“æƒ…å ±</div>
      <div class="detail" id="productDetails"></div>
    </div>
  </div>
</div>

<!-- è²©å£²æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="group sale-section">
  <div class="group-title">ğŸ’° è²©å£²æƒ…å ±</div>
  
  <div class="row">
    <div>
      <label>è²©å£²æ—¥</label>
      <input id="saleDate" type="date">
    </div>
    <div>
      <label>è²©å£²å…ˆ</label>
      <select id="saleDestination">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        <option value="ãƒ¡ãƒ«ã‚«ãƒª">ãƒ¡ãƒ«ã‚«ãƒª</option>
        <option value="Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³">Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</option>
        <option value="Yahoo!ãƒ•ãƒªãƒ">Yahoo!ãƒ•ãƒªãƒ</option>
        <option value="ãƒ©ã‚¯ãƒ">ãƒ©ã‚¯ãƒ</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </div>
  </div>
  
  <label>è²©å£²é‡‘é¡</label>
  <input id="saleAmount" type="number" min="0" step="1" placeholder="0">
  
  <div class="actions">
    <button class="btn btn-success" onclick="updateSaleInfo()">è²©å£²æƒ…å ±æ›´æ–°</button>
  </div>
</div>

<!-- ç™ºé€ãƒ»æ¢±åŒ…æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="group shipping-section">
  <div class="group-title">ğŸ“¦ ç™ºé€ãƒ»æ¢±åŒ…æƒ…å ±</div>
  
  <div class="row">
    <div>
      <label>ç™ºé€æ–¹æ³•</label>
      <select id="shippingMethod">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        <option value="ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿">ã‚†ã†ã‚†ã†ãƒ¡ãƒ«ã‚«ãƒªä¾¿</option>
        <option value="ã‚‰ãã‚‰ããƒ¡ãƒ«ã‚«ãƒªä¾¿">ã‚‰ãã‚‰ããƒ¡ãƒ«ã‚«ãƒªä¾¿</option>
        <option value="æ™®é€šéƒµä¾¿">æ™®é€šéƒµä¾¿</option>
        <option value="ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯">ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯</option>
        <option value="å®…æ€¥ä¾¿">å®…æ€¥ä¾¿</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </div>
    <div>
      <label>æ¢±åŒ…è³‡æ</label>
      <select id="packagingMaterial">
        <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
        <option value="å°ç­’">å°ç­’</option>
        <option value="å®…æ€¥ä¾¿ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ">å®…æ€¥ä¾¿ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ</option>
        <option value="60ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«">60ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«</option>
        <option value="80ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«">80ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«</option>
        <option value="100ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«">100ã‚µã‚¤ã‚ºæ®µãƒœãƒ¼ãƒ«</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </div>
  </div>
  
  <div class="row">
    <div>
      <label>æ¢±åŒ…è³‡æè²»</label>
      <input id="packagingCost" type="number" min="0" step="1" placeholder="0">
    </div>
    <div>
      <label>é€æ–™</label>
      <input id="shippingCost" type="number" min="0" step="1" placeholder="0">
    </div>
  </div>
  
  <div class="actions">
    <button class="btn btn-success" onclick="updateShippingInfo()">ç™ºé€æƒ…å ±æ›´æ–°</button>
  </div>
</div>

<!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="group">
  <div class="group-title">ğŸ“‹ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†</div>
  
  <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
  <select id="productStatus">
    <option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>
    <option value="ä»•å…¥å®Œäº†">ä»•å…¥å®Œäº†</option>
    <option value="å‡ºå“æº–å‚™ä¸­">å‡ºå“æº–å‚™ä¸­</option>
    <option value="å‡ºå“ä¸­">å‡ºå“ä¸­</option>
    <option value="è²©å£²å®Œäº†">è²©å£²å®Œäº†</option>
    <option value="ç™ºé€å®Œäº†">ç™ºé€å®Œäº†</option>
    <option value="å–å¼•å®Œäº†">å–å¼•å®Œäº†</option>
  </select>
  
  <div class="actions">
    <button class="btn btn-secondary" onclick="updateStatus()">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°</button>
  </div>
</div>

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="msg" class="msg" style="display: none;"></div>

<script>
let currentMgmtNo = '';

// å•†å“æ¤œç´¢
function searchProduct() {
  const mgmtNo = document.getElementById('searchMgmtNo').value.trim();
  if (!mgmtNo) {
    showMessage('ç®¡ç†ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  showMessage('æ¤œç´¢ä¸­...', '');
  
  // ã‚¸ãƒ£ãƒ³ãƒ—å®Ÿè¡Œ
  google.script.run
    .withSuccessHandler(handleSearchResult)
    .withFailureHandler(handleError)
    .jumpToRowByCode(mgmtNo);
  
  // å•†å“æƒ…å ±å–å¾—
  google.script.run
    .withSuccessHandler(displayProductInfo)
    .withFailureHandler(() => {})
    .getProductInfo(mgmtNo);
    
  currentMgmtNo = mgmtNo.toUpperCase();
}

function handleSearchResult(result) {
  if (result && result.startsWith('OK:')) {
    showMessage(result, 'success');
  } else {
    showMessage(result || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
  }
}

function displayProductInfo(result) {
  const infoArea = document.getElementById('productInfoArea');
  const title = document.getElementById('productTitle');
  const details = document.getElementById('productDetails');
  
  if (result.success && result.data) {
    const data = result.data;
    title.textContent = `${data.managementNumber} - ${data.brand || ''} ${data.itemName || ''}`;
    
    const detailText = [
      `åˆ†é¡: ${data.category || ''}`,
      `ã‚µã‚¤ã‚º: ${data.size || ''}`,
      `çŠ¶æ…‹: ${data.condition || ''}`,
      `ä»•å…¥é¡: Â¥${data.purchaseAmount || 0}`,
      `å‡ºå“é¡: Â¥${data.listingAmount || 0}`,
      `è²©å£²é¡: Â¥${data.saleAmount || 'æœªè²©å£²'}`,
      `åˆ©ç›Š: Â¥${data.profit || 0}`
    ].join('\n');
    
    details.textContent = detailText;
    infoArea.style.display = 'block';
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
    if (data.saleDate) document.getElementById('saleDate').value = data.saleDate;
    if (data.saleDestination) document.getElementById('saleDestination').value = data.saleDestination;
    if (data.saleAmount) document.getElementById('saleAmount').value = data.saleAmount;
    if (data.shippingMethod) document.getElementById('shippingMethod').value = data.shippingMethod;
    if (data.packagingMaterial) document.getElementById('packagingMaterial').value = data.packagingMaterial;
    if (data.packagingCost) document.getElementById('packagingCost').value = data.packagingCost;
    if (data.shippingCost) document.getElementById('shippingCost').value = data.shippingCost;
    
  } else {
    infoArea.style.display = 'none';
  }
}

function clearSearch() {
  document.getElementById('searchMgmtNo').value = '';
  document.getElementById('productInfoArea').style.display = 'none';
  currentMgmtNo = '';
  clearAllFields();
  showMessage('', '');
}

function clearAllFields() {
  ['saleDate', 'saleDestination', 'saleAmount', 'shippingMethod', 'packagingMaterial', 'packagingCost', 'shippingCost', 'productStatus']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });
}

// è²©å£²æƒ…å ±æ›´æ–°
function updateSaleInfo() {
  if (!currentMgmtNo) {
    showMessage('å…ˆã«å•†å“ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  const saleData = {
    saleDate: document.getElementById('saleDate').value,
    saleDestination: document.getElementById('saleDestination').value,
    saleAmount: document.getElementById('saleAmount').value
  };
  
  if (!saleData.saleAmount) {
    showMessage('è²©å£²é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  showMessage('æ›´æ–°ä¸­...', '');
  
  google.script.run
    .withSuccessHandler(handleUpdateResult)
    .withFailureHandler(handleError)
    .updateSaleInfo(currentMgmtNo, saleData);
}

// ç™ºé€æƒ…å ±æ›´æ–°
function updateShippingInfo() {
  if (!currentMgmtNo) {
    showMessage('å…ˆã«å•†å“ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  const shippingData = {
    shippingMethod: document.getElementById('shippingMethod').value,
    packagingMaterial: document.getElementById('packagingMaterial').value,
    packagingCost: document.getElementById('packagingCost').value,
    shippingCost: document.getElementById('shippingCost').value
  };
  
  showMessage('æ›´æ–°ä¸­...', '');
  
  google.script.run
    .withSuccessHandler(handleUpdateResult)
    .withFailureHandler(handleError)
    .updateShippingInfo(currentMgmtNo, shippingData);
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
function updateStatus() {
  if (!currentMgmtNo) {
    showMessage('å…ˆã«å•†å“ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  const status = document.getElementById('productStatus').value;
  if (!status) {
    showMessage('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
    return;
  }
  
  showMessage('æ›´æ–°ä¸­...', '');
  
  google.script.run
    .withSuccessHandler(handleUpdateResult)
    .withFailureHandler(handleError)
    .updateProductStatus(currentMgmtNo, status);
}

function handleUpdateResult(result) {
  if (result && result.startsWith('OK:')) {
    showMessage(result, 'success');
    // å•†å“æƒ…å ±ã‚’å†å–å¾—ã—ã¦è¡¨ç¤ºæ›´æ–°
    if (currentMgmtNo) {
      google.script.run
        .withSuccessHandler(displayProductInfo)
        .withFailureHandler(() => {})
        .getProductInfo(currentMgmtNo);
    }
  } else {
    showMessage(result || 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
  }
}

function handleError(error) {
  showMessage(`ã‚¨ãƒ©ãƒ¼: ${error.message || error}`, 'error');
}

function showMessage(text, type = '') {
  const msgEl = document.getElementById('msg');
  msgEl.textContent = text;
  msgEl.className = 'msg';
  
  if (type === 'success') msgEl.classList.add('success');
  if (type === 'error') msgEl.classList.add('error');
  
  msgEl.style.display = text ? 'block' : 'none';
}

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
  // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
  document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
});
</script>

</body>
</html>