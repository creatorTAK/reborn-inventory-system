# 在庫管理機能 - 次のステップ情報

## ✅ Issue INV-002完了状況（2025-10-26）

### 解決済み
- ✅ 商品一覧表示が完全に動作（スプレッドシート版・PWA版）
- ✅ Date型シリアライズ問題を解決（inventory.js:1630-1670）
- ✅ 67件の商品データ表示成功
- ✅ ページネーション動作（23ページ）
- ✅ ダッシュボード統計表示
- ✅ デプロイバージョン：v300（完成版）

### 技術的解決策
- google.script.runでDate型をtoISOString()で文字列化
- null/undefinedを空文字列に変換
- jsonSuccessResponse/jsonErrorResponseを直接オブジェクト返却に変更

---

## 🎯 次の実装予定（優先順位：A → B）

### 仕様変更（要対応）
**手動検索のみに変更**
- 現在：ページ読み込み時に自動的にloadDashboardAndSearch()実行
- 変更後：開いたときは空欄、検索ボタンを押したときだけ読み込み
- 修正箇所：sidebar_inventory.html:300

---

## 📸 画像関連の現状

### スプレッドシート構造
- **画像URL1、画像URL2、画像URL3列**: AI生成用（最大3枚）
- **JSONデータ列**: 商品画像情報が保存される（最大20枚）

### 実装済み機能
- ✅ R2（Cloudflare R2）への画像アップロード機能
- ✅ 商品登録の「商品画像」ブロックから最大20枚アップロード可能
- ✅ JSONデータ列に画像情報保存

### 現在の表示
- ❓マーク表示（imageUrl/mainImageUrlが未設定のため）

---

## 🔧 実装予定機能

### A. 商品画像の表示（優先度：高）
**要件:**
- JSONデータ列から画像URLを取得
- 商品一覧でサムネイル表示
- 最大20枚の画像に対応
- R2にアップロードされた画像を表示

**実装箇所:**
- inventory.js: getInventoryDashboardAPI()でJSONデータから画像URL抽出
- sidebar_inventory.html: displayProducts()で画像表示処理

**調査必要:**
- JSONデータの構造（imageフィールドの形式）
- R2の画像URL形式
- サムネイル最適化の必要性

---

### B. 商品詳細・編集機能の強化（優先度：高）
**要件:**
- 「詳細」ボタンクリック時のモーダル表示改善
- ステータス変更機能
- 在庫数変更機能
- 商品情報の編集機能

**実装箇所:**
- sidebar_inventory.html: モーダルUI改善
- inventory.js: updateProductAPI()の活用

---

### C. 検索・フィルタの強化（優先度：中）
**候補機能:**
- ブランド別フィルタ
- カテゴリ別フィルタ
- 価格帯フィルタ
- 日付範囲フィルタ

---

### D. パフォーマンス改善（優先度：中）
- 画像遅延読み込み（Lazy Loading）
- 読み込み速度の最適化

---

### E. モバイルUI改善（優先度：低）
- スマホ用レイアウト最適化
- スワイプ操作対応

---

## 📝 技術メモ

### google.script.runの制約
- Date型はシリアライズ不可 → toISOString()で文字列化必須
- null/undefinedはシリアライズ不可 → 空文字列に変換必須
- 大量データは問題なし（67件でも動作確認済み）

### 関連ファイル
- `sidebar_inventory.html`: フロントエンド UI
- `inventory.js`: バックエンド API（getInventoryDashboardAPI）
- `menu.js`: doGet()ルーティング

---

## 🔄 作業再開時のチェックリスト

1. [ ] JSONデータ列の構造確認（画像URL形式）
2. [ ] 手動検索のみに変更（自動読み込み無効化）
3. [ ] A: 商品画像表示機能の実装
4. [ ] B: 商品詳細・編集機能の実装
5. [ ] 動作確認（スプレッドシート版・PWA版）

---

## 📌 保留中の確認事項
ユーザーから「確認したいことがある」との発言あり。
内容未確認のため、作業再開時に最初に確認すること。
