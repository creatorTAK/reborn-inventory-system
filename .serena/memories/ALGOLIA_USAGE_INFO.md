# Algolia 使用量管理情報

**最終更新: 2025-11-19**

## 📊 Algolia無料プラン（Build Plan）の制限

### 無料枠
- **レコード数**: 100万件まで無料
- **検索リクエスト**: 月間10,000回
- **推奨リクエスト**: 月間10,000回
- **クロール**: 月間10,000回

### 現在の使用状況（2025-11-19時点）

**ブランドインデックス:**
- レコード数: 51,343件（無料枠の5.1%）
- 検索リクエスト: 13回/月（無料枠の0.13%）
- 平均検索速度: 0ミリ秒

**次回更新日:** 2025年12月18日

---

## 🔍 検索リクエストのカウント仕組み

### 現在の設定
- **デバウンス**: 300ms（入力後300ms待ってから検索）
- **最小入力文字数**: 1文字
- **検索結果件数**: 15件

### リクエスト例

「NIKE」と検索した場合:
1. 「N」入力 → 300ms後に検索（1回）
2. 「I」追加 → 300ms後に「NI」で検索（1回）
3. 「K」追加 → 300ms後に「NIK」で検索（1回）
4. 「E」追加 → 300ms後に「NIKE」で検索（1回）

**合計: 4回のリクエスト**

### 実測データ
- 3回のブランド検索で13リクエスト消費
- 平均: 1回の検索あたり4〜5リクエスト
- 推定: 毎日10回検索しても月間1,200〜1,500リクエスト程度

---

## 💡 リクエスト数を抑える方法（将来の最適化）

### 方法1: 最小入力文字数を増やす（推奨）

**ファイル:** `docs/js/brand-suggest-algolia.js`

```javascript
// 現在
minChars: 1

// 変更後（2文字以上で検索）
minChars: 2
```

**効果:**
- 「NIKE」検索: 4回 → 3回に削減（約25%削減）
- UX影響: 1文字では検索されないが、ブランド名は通常2文字以上なので問題なし

### 方法2: デバウンス時間を延長

```javascript
// 現在
debounceMs: 300

// 変更後
debounceMs: 500
```

**効果:**
- 入力が速い場合、途中の文字での検索がスキップされる
- リクエスト数削減（約10〜20%）
- UX影響: 検索結果表示が若干遅くなる

### 方法3: 検索結果件数を減らす

```javascript
// 現在
limit: 15

// 変更後
limit: 10
```

**効果:**
- データ転送量削減（リクエスト数は変わらない）
- UX影響: 検索結果が10件までになる

---

## 📈 使用量確認方法

### ダッシュボードでの確認手順

1. **Algoliaダッシュボードにアクセス**
   - URL: https://www.algolia.com/dashboard
   - サインイン

2. **使用量確認（Analytics）**
   - 左サイドバー「Analytics」をクリック
   - 検索リクエスト数、平均速度を確認
   - 日別・時間別グラフで推移確認

3. **データソース確認**
   - 左サイドバー「Data Sources」
   - 「ブランド」インデックスのレコード数確認

4. **プラン確認**
   - 左サイドバー「Settings」→「Plan」
   - 無料枠の残量、次回更新日確認

---

## ⚠️ 運用上の注意点

### 無料枠超過の可能性

**検索リクエスト超過（10,000回/月）:**
- 現在のペースでは超過の心配なし
- 毎日333回以上検索する場合のみ注意

**レコード数超過（100万件）:**
- 現在51,343件で問題なし
- ブランドデータが100万件を超える場合のみ注意

### 超過した場合の対応

**検索リクエスト超過:**
- 自動的に検索が停止される（有料プランへの自動移行なし）
- 次月1日にリセット
- 対策: 最小入力文字数を2文字に変更

**レコード数超過:**
- 無料プランでは100万件まで使用可能
- 超過した場合、有料プラン（月$1〜）への移行が必要

---

## 🔧 実装ファイル

### 検索UI設定ファイル
- **ファイル:** `docs/js/brand-suggest-algolia.js`
- **設定箇所:** attachBrandSuggestAlgolia() 関数のオプション

### Algoliaインデックス設定
- **ファイル:** `import-brands-from-json.js`
- **設定内容:**
  - searchableAttributes: ['name', 'nameKana']
  - typoTolerance: false（誤マッチ防止）
  - queryType: 'prefixAll'（前方一致）

---

## 📝 今後の検討事項

### 使用量が増加した場合

**フェーズ1: 無料枠内での最適化**
1. 最小入力文字数を2文字に変更
2. デバウンス時間を500msに延長

**フェーズ2: 有料プラン移行検討**
- 月間10,000リクエスト超過が継続する場合
- 有料プラン（月$1〜）への移行を検討

**フェーズ3: 代替案検討**
- Firestoreフルテキスト検索への切り替え
- GASキャッシュ方式への切り替え

---

## 🎯 結論

**現状:** 全く問題なし。無料枠内で余裕を持って運用可能。

**推奨:** このまま運用を継続し、月次で使用量をモニタリング。
