# QRコード基盤システム設計

**作成日**: 2025-12-12
**ステータス**: 設計確定（最重要機能）

---

## 概要

QRコード/バーコードを全ての業務の起点とし、物理商品とデジタルデータを常に同期させる仕組み。

---

## 解決できる課題

| 課題 | QRコードによる解決 |
|------|-------------------|
| 仕入と商品の紐付け | 自動紐付け（手作業不要） |
| 仕入情報の機密性 | 管理者のみ閲覧可能 |
| 外注の採番フロー維持 | QR読み取り後に自由採番 |
| 棚卸作業 | スキャンで自動照合 |
| ピッキングミス | スキャンで確認 |
| 在庫移動追跡 | スキャンで記録 |
| 複数拠点管理 | 誰がどこで管理か明確 |

---

## 基本フロー

### 1. 仕入登録（管理者）

```
仕入登録
  ↓
仕入商品ID発行（例: INV-20251212-001）
  ↓
QRコード生成
  ↓
タグ印刷 → 商品に貼付
  ↓
外注に発送
```

### 2. 商品登録（外注）

```
商品受領
  ↓
QRコード読み取り
  ↓
商品登録画面が開く（仕入商品IDは自動セット・非表示）
  ↓
管理番号を自分で採番（AB-1001等）
  ↓
写真・商品情報入力
  ↓
保存 → 仕入情報と自動紐付け完了
```

### 3. 棚卸（外注）

```
棚卸モード開始
  ↓
商品を次々スキャン
  ↓
システムが自動照合
  - ✅ スキャン済み
  - ❌ 未スキャン（見つからない）
  - ⚠️ 想定外（在庫ないはずがある）
  ↓
差異レポート自動生成
```

### 4. ピッキング（外注）

```
売れた商品通知
  ↓
商品のQRコード読み取り
  ↓
正しい商品か確認
  ↓
発送処理
```

### 5. 在庫移動

```
移動元でQRスキャン（出庫）
  ↓
移動先でQRスキャン（入庫）
  ↓
移動履歴が自動記録
```

---

## QRコードの仕様

### 内容
```
https://furira.jp/scan?id=INV-20251212-001
```

### 含まれる情報（DB側で管理）
- 仕入商品ID
- 仕入日
- 仕入先
- 仕入金額（管理者のみ閲覧可）
- ステータス（未登録/登録済/出品中/販売済）

### タグ印刷
- サイズ: 30mm x 20mm 程度
- ラベルプリンター対応
- 耐久性のあるシール素材

---

## 権限設計

| 機能 | 管理者 | 外注 |
|------|--------|------|
| 仕入登録 | ✅ | ❌ |
| QRコード発行 | ✅ | ❌ |
| 仕入金額閲覧 | ✅ | ❌ |
| 商品登録 | ✅ | ✅ |
| QRスキャン | ✅ | ✅ |
| 棚卸実行 | ✅ | ✅ |
| 棚卸結果閲覧 | ✅ | 自分の分のみ |
| 利益閲覧 | ✅ | ❌ |

---

## 技術要件

### フロントエンド
- PWAでカメラアクセス
- QRコード読み取りライブラリ（html5-qrcode等）
- オフライン対応（スキャンデータの一時保存）

### バックエンド
- 仕入商品コレクション（Firestore）
- QRコード生成API
- スキャン履歴記録

### ハードウェア（推奨）
- ラベルプリンター（Brother QL-800等）
- QRコード対応（バーコードでも可）

---

## 本質的な価値

> **「物理的な商品」と「デジタルデータ」を常に同期させる**

これにより：
- 在庫数の信頼性が上がる
- 「売れたのに商品がない」を防げる
- 外注拠点が増えても管理可能
- 仕入情報の機密性を保ちながらチーム連携
- 棚卸が劇的に効率化
- スケール可能な物販インフラの実現

---

## 実装優先度

1. **Phase 1**: 仕入登録 + QRコード生成
2. **Phase 2**: QR読み取り → 商品登録連携
3. **Phase 3**: 棚卸モード
4. **Phase 4**: ピッキング確認
5. **Phase 5**: 在庫移動追跡
