# 送迎システム 要件定義書

**作成日**: 2025-11-30
**ステータス**: REBORN完成後に実装予定

---

## 概要

送迎サービスの予約・配車・請求を一元管理するシステム。
LINE ミニアプリをメインインターフェースとして構築。

---

## 4つのユーザー層

| ロール | 説明 | インターフェース |
|--------|------|-----------------|
| **運営側** | 全体管理、請求・支払い処理 | Web管理画面 |
| **送迎ドライバー** | 送迎実行、シフト確認 | LINEミニアプリ or Web |
| **店舗責任者** | 自店キャストの予約管理、請求受領 | LINEミニアプリ |
| **キャスト** | 送迎予約、GPS確認、評価 | LINEミニアプリ |

---

## 規模想定

| 項目 | 現在 | 将来想定 |
|------|------|---------|
| キャスト | 50名 | 300〜500名 |
| ドライバー | 20名 | 100名 |
| 店舗 | − | 最大200店舗 |
| デバイス | スマホ | スマホ |
| LINE公式 | あり | − |

**設計方針**: 10倍規模への拡張を前提に設計

---

## 主要機能

### 1. シフト作成/修正

**現状の課題:**
- Excel + マクロで週単位シフト作成
- 縦軸: キャスト名、横軸: 日時曜日 + 担当ドライバー
- マクロでドライバーごとに切り分け → LINEで個別送信
- 当日変更が頻繁、修正に追われている

**実装方針:**
- スプレッドシートベースは維持（運営側の使い慣れたツール）
- シフト通知・確認をLINEミニアプリで自動化
- 変更時の関係者への自動通知

### 2. 送迎予約

**機能:**
- 週単位の定例予約
- 単発予約
- 予約状況の可視化（断り、返答待ち等）
- 新規依頼対応（距離ベースの自動料金計算）
- 店舗責任者 or キャスト単位で予約可能

**AIチャットボット（実現可能）:**
- 24時間予約受付
- 空き状況確認 → 自動応答
- 曖昧な表現の解釈（「明後日の夕方」→ 具体的日時）
- 段階的実装: ルールベース → AI補助 → フルAI

### 3. リアルタイムGPS

**キャスト向け:**
- Uber風のドライバー位置表示
- 到着予定時刻
- ドライバー情報

**運営向け:**
- 全ドライバーの位置一覧
- 戻り時間の可視化 → 配車効率化

**自動記録:**
- 乗車/降車をワンタップ記録
- 自動で請求・報酬データに反映

### 4. 料金体系

```
キャストA（単価: 1,000円）がドライバーAに乗車
  → 店舗Aへの請求: 1,000円
  → ドライバーAへの支払い: 650円（65%）
```

- 乗車/降車時に自動記録
- 月次で店舗への請求書自動生成
- 月次でドライバーへの報酬明細自動生成

### 5. ドライバー評価制度

- 5段階 + コメント（キャストからの任意評価）
- 星評価の可視化（例: ⭐3.5）
- 評価に応じた報酬率変動

---

## 行き vs 帰りの送迎特性

| 項目 | 行きの送迎 | 帰りの送迎 |
|------|-----------|-----------|
| **時間** | 入り時間厳守 | 終わったら連絡（柔軟） |
| **ルート** | 各自宅→店舗（固定傾向） | 店舗→各自宅（その日次第） |
| **変更** | 同伴等で当日変更あり | 比較的少ない |
| **複雑さ** | 高（逆算・乗り合わせ調整） | 中（空いてる車に乗せる） |
| **AI自動化** | △ サポート中心 | ◎ かなり自動化可能 |

### 行きの送迎（複雑）

**考慮すべき変数:**
- ドライバーの出発地点・出発可能時間
- キャストの乗車地点（自宅 or 任意の場所）
- 入り時間（店舗・キャストによりバラバラ）
- 目的地（同伴の場合は都度変更）
- 同方面の乗り合わせ最適化

**AI の役割（サポート型）:**
- 大枠の時間配分を提案（余裕を持った見積もり）
- 変更発生時の影響範囲可視化
- 関係者への自動通知
- 最終判断は人間

### 帰りの送迎（自動化しやすい）

**フロー:**
```
キャスト: 「上がりました」
AI: 空き状況を表示、配車提案
キャスト: 選択
AI: 手配完了、GPS共有
```

---

## 権限マトリクス

| データ | 運営 | ドライバー | 店舗 | キャスト |
|--------|------|-----------|------|---------|
| 全シフト | ◎ | 自分のみ | − | − |
| 予約状況 | ◎ | 担当のみ | 自店のみ | 自分のみ |
| GPS位置 | ◎全員 | 自分のみ | − | 担当車のみ |
| 請求金額 | ◎ | − | 自店のみ | − |
| ドライバー報酬 | ◎ | 自分のみ | − | − |
| 評価詳細 | ◎ | 自分のみ | − | 自分の投稿のみ |
| キャスト住所 | − | 担当時のみ | − | − |

---

## 技術構成

```
┌─────────────────────────────────────────────────────────────┐
│                    【4つのユーザー層】                        │
├──────────────┬──────────────┬──────────────┬───────────────┤
│   運営側      │  ドライバー   │  店舗責任者   │   キャスト     │
│  Web管理画面  │ LINEミニアプリ│ LINEミニアプリ│ LINEミニアプリ │
└──────┬───────┴──────┬───────┴──────┬───────┴───────┬───────┘
       └──────────────┴──────────────┴───────────────┘
                              │
                    ┌────────┴────────┐
                    │   Firebase      │
                    │  (Firestore)    │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
        ┌─────┴─────┐  ┌─────┴─────┐  ┌─────┴─────┐
        │Google     │  │LINE       │  │Google     │
        │Sheets     │  │Messaging  │  │Maps API   │
        │(シフト)   │  │(通知)     │  │(GPS/距離) │
        └───────────┘  └───────────┘  └───────────┘
```

---

## 開発フェーズ案

### Phase 1: 基盤構築（MVP）
- LINE公式アカウント・ミニアプリ設定
- 4者の認証・権限システム
- キャスト予約機能（週単位・単発）
- ドライバーへのシフト通知
- スプレッドシート連携

### Phase 2: GPS・記録機能
- リアルタイムGPS追跡
- 乗車/降車ワンタップ記録
- 自動料金計算・集計
- 運営向けダッシュボード

### Phase 3: 自動化・効率化
- 請求書自動生成・送信
- ドライバー報酬明細自動生成
- 評価システム
- 配車効率レポート

### Phase 4: AI・高度化
- AIチャットボット予約対応
- シフト最適化サポート（提案型）
- 需要予測

---

## AI活用方針

| 機能 | AI の役割 | 実現性 |
|------|----------|--------|
| 帰りの送迎 | ほぼ自動（空車マッチング + 通知） | ◎ |
| 行きの送迎 | サポート（提案 + 変更通知 + 影響確認） | ○ |
| 新規依頼 | 受付 + ドライバー照会 + 回答補助 | ◎ |
| 当日変更 | 影響範囲表示 + 関係者への通知 | ◎ |
| シフト最適化 | 複数パターン提案、人が選択（Lv2提案型） | ○ |

**重要方針:**
- 完全自律システムは目指さない（トラブル防止）
- AI はサポート役、最終判断は人間
- 針に糸を通す精度は不要、余裕を持ったバッファ設計

---

## 費用見積もり

| 項目 | 費用 |
|------|------|
| LINE公式アカウント | 0円〜5,000円/月（メッセージ数次第） |
| Firebase | 無料枠内〜数千円/月 |
| Google Maps API | 従量課金（月200ドル無料枠あり） |
| OpenAI/Claude API | 1,000〜5,000円/月 |
| ホスティング | 0円（Cloudflare Pages） |

---

## 注意事項

- LINE Pay は2025年4月終了 → 決済機能は不要（月次請求方式）
- キャスト住所のセキュリティ → 乗車完了後は非表示、暗号化保存
- GPS電池消費 → 移動中のみ追跡、インターバル調整

---

**最終更新**: 2025-11-30
